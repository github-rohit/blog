"format amd";!function(window){"use strict";function minErr(module,ErrorConstructor){return ErrorConstructor=ErrorConstructor||Error,function(){var paramPrefix,i,code=arguments[0],template=arguments[1],message="["+(module?module+":":"")+code+"] ",templateArgs=sliceArgs(arguments,2).map(function(arg){return toDebugString(arg,minErrConfig.objectMaxDepth)});for(message+=template.replace(/\{\d+\}/g,function(match){var index=+match.slice(1,-1);return index<templateArgs.length?templateArgs[index]:match}),message+="\nhttp://errors.angularjs.org/1.6.4/"+(module?module+"/":"")+code,i=0,paramPrefix="?";i<templateArgs.length;i++,paramPrefix="&")message+=paramPrefix+"p"+i+"="+encodeURIComponent(templateArgs[i]);return new ErrorConstructor(message)}}function errorHandlingConfig(config){if(!isObject(config))return minErrConfig;isDefined(config.objectMaxDepth)&&(minErrConfig.objectMaxDepth=isValidObjectMaxDepth(config.objectMaxDepth)?config.objectMaxDepth:NaN)}function isValidObjectMaxDepth(maxDepth){return isNumber(maxDepth)&&maxDepth>0}function isArrayLike(obj){if(null==obj||isWindow(obj))return!1;if(isArray(obj)||isString(obj)||jqLite&&obj instanceof jqLite)return!0;var length="length"in Object(obj)&&obj.length;return isNumber(length)&&(length>=0&&(length-1 in obj||obj instanceof Array)||"function"==typeof obj.item)}function forEach(obj,iterator,context){var key,length;if(obj)if(isFunction(obj))for(key in obj)"prototype"!==key&&"length"!==key&&"name"!==key&&obj.hasOwnProperty(key)&&iterator.call(context,obj[key],key,obj);else if(isArray(obj)||isArrayLike(obj)){var isPrimitive="object"!=typeof obj;for(key=0,length=obj.length;key<length;key++)(isPrimitive||key in obj)&&iterator.call(context,obj[key],key,obj)}else if(obj.forEach&&obj.forEach!==forEach)obj.forEach(iterator,context,obj);else if(isBlankObject(obj))for(key in obj)iterator.call(context,obj[key],key,obj);else if("function"==typeof obj.hasOwnProperty)for(key in obj)obj.hasOwnProperty(key)&&iterator.call(context,obj[key],key,obj);else for(key in obj)hasOwnProperty.call(obj,key)&&iterator.call(context,obj[key],key,obj);return obj}function forEachSorted(obj,iterator,context){for(var keys=Object.keys(obj).sort(),i=0;i<keys.length;i++)iterator.call(context,obj[keys[i]],keys[i]);return keys}function reverseParams(iteratorFn){return function(value,key){iteratorFn(key,value)}}function nextUid(){return++uid}function setHashKey(obj,h){h?obj.$$hashKey=h:delete obj.$$hashKey}function baseExtend(dst,objs,deep){for(var h=dst.$$hashKey,i=0,ii=objs.length;i<ii;++i){var obj=objs[i];if(isObject(obj)||isFunction(obj))for(var keys=Object.keys(obj),j=0,jj=keys.length;j<jj;j++){var key=keys[j],src=obj[key];deep&&isObject(src)?isDate(src)?dst[key]=new Date(src.valueOf()):isRegExp(src)?dst[key]=new RegExp(src):src.nodeName?dst[key]=src.cloneNode(!0):isElement(src)?dst[key]=src.clone():(isObject(dst[key])||(dst[key]=isArray(src)?[]:{}),baseExtend(dst[key],[src],!0)):dst[key]=src}}return setHashKey(dst,h),dst}function extend(dst){return baseExtend(dst,slice.call(arguments,1),!1)}function merge(dst){return baseExtend(dst,slice.call(arguments,1),!0)}function toInt(str){return parseInt(str,10)}function inherit(parent,extra){return extend(Object.create(parent),extra)}function noop(){}function identity($){return $}function valueFn(value){return function(){return value}}function hasCustomToString(obj){return isFunction(obj.toString)&&obj.toString!==toString}function isUndefined(value){return void 0===value}function isDefined(value){return void 0!==value}function isObject(value){return null!==value&&"object"==typeof value}function isBlankObject(value){return null!==value&&"object"==typeof value&&!getPrototypeOf(value)}function isString(value){return"string"==typeof value}function isNumber(value){return"number"==typeof value}function isDate(value){return"[object Date]"===toString.call(value)}function isFunction(value){return"function"==typeof value}function isRegExp(value){return"[object RegExp]"===toString.call(value)}function isWindow(obj){return obj&&obj.window===obj}function isScope(obj){return obj&&obj.$evalAsync&&obj.$watch}function isFile(obj){return"[object File]"===toString.call(obj)}function isFormData(obj){return"[object FormData]"===toString.call(obj)}function isBlob(obj){return"[object Blob]"===toString.call(obj)}function isBoolean(value){return"boolean"==typeof value}function isPromiseLike(obj){return obj&&isFunction(obj.then)}function isTypedArray(value){return value&&isNumber(value.length)&&TYPED_ARRAY_REGEXP.test(toString.call(value))}function isArrayBuffer(obj){return"[object ArrayBuffer]"===toString.call(obj)}function isElement(node){return!(!node||!(node.nodeName||node.prop&&node.attr&&node.find))}function makeMap(str){var i,obj={},items=str.split(",");for(i=0;i<items.length;i++)obj[items[i]]=!0;return obj}function nodeName_(element){return lowercase(element.nodeName||element[0]&&element[0].nodeName)}function includes(array,obj){return-1!==Array.prototype.indexOf.call(array,obj)}function arrayRemove(array,value){var index=array.indexOf(value);return index>=0&&array.splice(index,1),index}function copy(source,destination,maxDepth){function copyRecurse(source,destination,maxDepth){if(--maxDepth<0)return"...";var key,h=destination.$$hashKey;if(isArray(source))for(var i=0,ii=source.length;i<ii;i++)destination.push(copyElement(source[i],maxDepth));else if(isBlankObject(source))for(key in source)destination[key]=copyElement(source[key],maxDepth);else if(source&&"function"==typeof source.hasOwnProperty)for(key in source)source.hasOwnProperty(key)&&(destination[key]=copyElement(source[key],maxDepth));else for(key in source)hasOwnProperty.call(source,key)&&(destination[key]=copyElement(source[key],maxDepth));return setHashKey(destination,h),destination}function copyElement(source,maxDepth){if(!isObject(source))return source;var index=stackSource.indexOf(source);if(-1!==index)return stackDest[index];if(isWindow(source)||isScope(source))throw ngMinErr("cpws","Can't copy! Making copies of Window or Scope instances is not supported.");var needsRecurse=!1,destination=copyType(source);return void 0===destination&&(destination=isArray(source)?[]:Object.create(getPrototypeOf(source)),needsRecurse=!0),stackSource.push(source),stackDest.push(destination),needsRecurse?copyRecurse(source,destination,maxDepth):destination}function copyType(source){switch(toString.call(source)){case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Float32Array]":case"[object Float64Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return new source.constructor(copyElement(source.buffer),source.byteOffset,source.length);case"[object ArrayBuffer]":if(!source.slice){var copied=new ArrayBuffer(source.byteLength);return new Uint8Array(copied).set(new Uint8Array(source)),copied}return source.slice(0);case"[object Boolean]":case"[object Number]":case"[object String]":case"[object Date]":return new source.constructor(source.valueOf());case"[object RegExp]":var re=new RegExp(source.source,source.toString().match(/[^\/]*$/)[0]);return re.lastIndex=source.lastIndex,re;case"[object Blob]":return new source.constructor([source],{type:source.type})}if(isFunction(source.cloneNode))return source.cloneNode(!0)}var stackSource=[],stackDest=[];if(maxDepth=isValidObjectMaxDepth(maxDepth)?maxDepth:NaN,destination){if(isTypedArray(destination)||isArrayBuffer(destination))throw ngMinErr("cpta","Can't copy! TypedArray destination cannot be mutated.");if(source===destination)throw ngMinErr("cpi","Can't copy! Source and destination are identical.");return isArray(destination)?destination.length=0:forEach(destination,function(value,key){"$$hashKey"!==key&&delete destination[key]}),stackSource.push(source),stackDest.push(destination),copyRecurse(source,destination,maxDepth)}return copyElement(source,maxDepth)}function simpleCompare(a,b){return a===b||a!==a&&b!==b}function equals(o1,o2){if(o1===o2)return!0;if(null===o1||null===o2)return!1;if(o1!==o1&&o2!==o2)return!0;var length,key,keySet,t1=typeof o1,t2=typeof o2;if(t1===t2&&"object"===t1){if(!isArray(o1)){if(isDate(o1))return!!isDate(o2)&&simpleCompare(o1.getTime(),o2.getTime());if(isRegExp(o1))return!!isRegExp(o2)&&o1.toString()===o2.toString();if(isScope(o1)||isScope(o2)||isWindow(o1)||isWindow(o2)||isArray(o2)||isDate(o2)||isRegExp(o2))return!1;keySet=createMap();for(key in o1)if("$"!==key.charAt(0)&&!isFunction(o1[key])){if(!equals(o1[key],o2[key]))return!1;keySet[key]=!0}for(key in o2)if(!(key in keySet)&&"$"!==key.charAt(0)&&isDefined(o2[key])&&!isFunction(o2[key]))return!1;return!0}if(!isArray(o2))return!1;if((length=o1.length)===o2.length){for(key=0;key<length;key++)if(!equals(o1[key],o2[key]))return!1;return!0}}return!1}function concat(array1,array2,index){return array1.concat(slice.call(array2,index))}function sliceArgs(args,startIndex){return slice.call(args,startIndex||0)}function bind(self,fn){var curryArgs=arguments.length>2?sliceArgs(arguments,2):[];return!isFunction(fn)||fn instanceof RegExp?fn:curryArgs.length?function(){return arguments.length?fn.apply(self,concat(curryArgs,arguments,0)):fn.apply(self,curryArgs)}:function(){return arguments.length?fn.apply(self,arguments):fn.call(self)}}function toJsonReplacer(key,value){var val=value;return"string"==typeof key&&"$"===key.charAt(0)&&"$"===key.charAt(1)?val=void 0:isWindow(value)?val="$WINDOW":value&&window.document===value?val="$DOCUMENT":isScope(value)&&(val="$SCOPE"),val}function toJson(obj,pretty){if(!isUndefined(obj))return isNumber(pretty)||(pretty=pretty?2:null),JSON.stringify(obj,toJsonReplacer,pretty)}function fromJson(json){return isString(json)?JSON.parse(json):json}function timezoneToOffset(timezone,fallback){timezone=timezone.replace(ALL_COLONS,"");var requestedTimezoneOffset=Date.parse("Jan 01, 1970 00:00:00 "+timezone)/6e4;return isNumberNaN(requestedTimezoneOffset)?fallback:requestedTimezoneOffset}function addDateMinutes(date,minutes){return date=new Date(date.getTime()),date.setMinutes(date.getMinutes()+minutes),date}function convertTimezoneToLocal(date,timezone,reverse){reverse=reverse?-1:1;var dateTimezoneOffset=date.getTimezoneOffset();return addDateMinutes(date,reverse*(timezoneToOffset(timezone,dateTimezoneOffset)-dateTimezoneOffset))}function startingTag(element){element=jqLite(element).clone();try{element.empty()}catch(e){}var elemHtml=jqLite("<div>").append(element).html();try{return element[0].nodeType===NODE_TYPE_TEXT?lowercase(elemHtml):elemHtml.match(/^(<[^>]+>)/)[1].replace(/^<([\w-]+)/,function(match,nodeName){return"<"+lowercase(nodeName)})}catch(e){return lowercase(elemHtml)}}function tryDecodeURIComponent(value){try{return decodeURIComponent(value)}catch(e){}}function parseKeyValue(keyValue){var obj={};return forEach((keyValue||"").split("&"),function(keyValue){var splitPoint,key,val;keyValue&&(key=keyValue=keyValue.replace(/\+/g,"%20"),splitPoint=keyValue.indexOf("="),-1!==splitPoint&&(key=keyValue.substring(0,splitPoint),val=keyValue.substring(splitPoint+1)),key=tryDecodeURIComponent(key),isDefined(key)&&(val=!isDefined(val)||tryDecodeURIComponent(val),hasOwnProperty.call(obj,key)?isArray(obj[key])?obj[key].push(val):obj[key]=[obj[key],val]:obj[key]=val))}),obj}function toKeyValue(obj){var parts=[];return forEach(obj,function(value,key){isArray(value)?forEach(value,function(arrayValue){parts.push(encodeUriQuery(key,!0)+(!0===arrayValue?"":"="+encodeUriQuery(arrayValue,!0)))}):parts.push(encodeUriQuery(key,!0)+(!0===value?"":"="+encodeUriQuery(value,!0)))}),parts.length?parts.join("&"):""}function encodeUriSegment(val){return encodeUriQuery(val,!0).replace(/%26/gi,"&").replace(/%3D/gi,"=").replace(/%2B/gi,"+")}function encodeUriQuery(val,pctEncodeSpaces){return encodeURIComponent(val).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%3B/gi,";").replace(/%20/g,pctEncodeSpaces?"%20":"+")}function getNgAttribute(element,ngAttr){var attr,i,ii=ngAttrPrefixes.length;for(i=0;i<ii;++i)if(attr=ngAttrPrefixes[i]+ngAttr,isString(attr=element.getAttribute(attr)))return attr;return null}function allowAutoBootstrap(document){var script=document.currentScript;if(!script)return!0;if(!(script instanceof window.HTMLScriptElement||script instanceof window.SVGScriptElement))return!1;var attributes=script.attributes;return[attributes.getNamedItem("src"),attributes.getNamedItem("href"),attributes.getNamedItem("xlink:href")].every(function(src){if(!src)return!0;if(!src.value)return!1;var link=document.createElement("a");if(link.href=src.value,document.location.origin===link.origin)return!0;switch(link.protocol){case"http:":case"https:":case"ftp:":case"blob:":case"file:":case"data:":return!0;default:return!1}})}function angularInit(element,bootstrap){var appElement,module,config={};if(forEach(ngAttrPrefixes,function(prefix){var name=prefix+"app";!appElement&&element.hasAttribute&&element.hasAttribute(name)&&(appElement=element,module=element.getAttribute(name))}),forEach(ngAttrPrefixes,function(prefix){var candidate,name=prefix+"app";!appElement&&(candidate=element.querySelector("["+name.replace(":","\\:")+"]"))&&(appElement=candidate,module=candidate.getAttribute(name))}),appElement){if(!isAutoBootstrapAllowed)return void window.console.error("Angular: disabling automatic bootstrap. <script> protocol indicates an extension, document.location.href does not match.");config.strictDi=null!==getNgAttribute(appElement,"strict-di"),bootstrap(appElement,module?[module]:[],config)}}function bootstrap(element,modules,config){isObject(config)||(config={}),config=extend({strictDi:!1},config);var doBootstrap=function(){if(element=jqLite(element),element.injector()){var tag=element[0]===window.document?"document":startingTag(element);throw ngMinErr("btstrpd","App already bootstrapped with this element '{0}'",tag.replace(/</,"&lt;").replace(/>/,"&gt;"))}modules=modules||[],modules.unshift(["$provide",function($provide){$provide.value("$rootElement",element)}]),config.debugInfoEnabled&&modules.push(["$compileProvider",function($compileProvider){$compileProvider.debugInfoEnabled(!0)}]),modules.unshift("ng");var injector=createInjector(modules,config.strictDi);return injector.invoke(["$rootScope","$rootElement","$compile","$injector",function(scope,element,compile,injector){scope.$apply(function(){element.data("$injector",injector),compile(element)(scope)})}]),injector},NG_ENABLE_DEBUG_INFO=/^NG_ENABLE_DEBUG_INFO!/,NG_DEFER_BOOTSTRAP=/^NG_DEFER_BOOTSTRAP!/;if(window&&NG_ENABLE_DEBUG_INFO.test(window.name)&&(config.debugInfoEnabled=!0,window.name=window.name.replace(NG_ENABLE_DEBUG_INFO,"")),window&&!NG_DEFER_BOOTSTRAP.test(window.name))return doBootstrap();window.name=window.name.replace(NG_DEFER_BOOTSTRAP,""),angular.resumeBootstrap=function(extraModules){return forEach(extraModules,function(module){modules.push(module)}),doBootstrap()},isFunction(angular.resumeDeferredBootstrap)&&angular.resumeDeferredBootstrap()}function reloadWithDebugInfo(){window.name="NG_ENABLE_DEBUG_INFO!"+window.name,window.location.reload()}function getTestability(rootElement){var injector=angular.element(rootElement).injector();if(!injector)throw ngMinErr("test","no injector found for element argument to getTestability");return injector.get("$$testability")}function snake_case(name,separator){return separator=separator||"_",name.replace(SNAKE_CASE_REGEXP,function(letter,pos){return(pos?separator:"")+letter.toLowerCase()})}function bindJQuery(){var originalCleanData;if(!bindJQueryFired){var jqName=jq();jQuery=isUndefined(jqName)?window.jQuery:jqName?window[jqName]:void 0,jQuery&&jQuery.fn.on?(jqLite=jQuery,extend(jQuery.fn,{scope:JQLitePrototype.scope,isolateScope:JQLitePrototype.isolateScope,controller:JQLitePrototype.controller,injector:JQLitePrototype.injector,inheritedData:JQLitePrototype.inheritedData}),originalCleanData=jQuery.cleanData,jQuery.cleanData=function(elems){for(var events,elem,i=0;null!=(elem=elems[i]);i++)(events=jQuery._data(elem,"events"))&&events.$destroy&&jQuery(elem).triggerHandler("$destroy");originalCleanData(elems)}):jqLite=JQLite,angular.element=jqLite,bindJQueryFired=!0}}function assertArg(arg,name,reason){if(!arg)throw ngMinErr("areq","Argument '{0}' is {1}",name||"?",reason||"required");return arg}function assertArgFn(arg,name,acceptArrayAnnotation){return acceptArrayAnnotation&&isArray(arg)&&(arg=arg[arg.length-1]),assertArg(isFunction(arg),name,"not a function, got "+(arg&&"object"==typeof arg?arg.constructor.name||"Object":typeof arg)),arg}function assertNotHasOwnProperty(name,context){if("hasOwnProperty"===name)throw ngMinErr("badname","hasOwnProperty is not a valid {0} name",context)}function getter(obj,path,bindFnToScope){if(!path)return obj;for(var key,keys=path.split("."),lastInstance=obj,len=keys.length,i=0;i<len;i++)key=keys[i],obj&&(obj=(lastInstance=obj)[key]);return!bindFnToScope&&isFunction(obj)?bind(lastInstance,obj):obj}function getBlockNodes(nodes){for(var blockNodes,node=nodes[0],endNode=nodes[nodes.length-1],i=1;node!==endNode&&(node=node.nextSibling);i++)(blockNodes||nodes[i]!==node)&&(blockNodes||(blockNodes=jqLite(slice.call(nodes,0,i))),blockNodes.push(node));return blockNodes||nodes}function createMap(){return Object.create(null)}function stringify(value){if(null==value)return"";switch(typeof value){case"string":break;case"number":value=""+value;break;default:value=!hasCustomToString(value)||isArray(value)||isDate(value)?toJson(value):value.toString()}return value}function setupModuleLoader(window){function ensure(obj,name,factory){return obj[name]||(obj[name]=factory())}var $injectorMinErr=minErr("$injector"),ngMinErr=minErr("ng"),angular=ensure(window,"angular",Object);return angular.$$minErr=angular.$$minErr||minErr,ensure(angular,"module",function(){var modules={};return function(name,requires,configFn){var info={};return function(name,context){if("hasOwnProperty"===name)throw ngMinErr("badname","hasOwnProperty is not a valid {0} name",context)}(name,"module"),requires&&modules.hasOwnProperty(name)&&(modules[name]=null),ensure(modules,name,function(){function invokeLater(provider,method,insertMethod,queue){return queue||(queue=invokeQueue),function(){return queue[insertMethod||"push"]([provider,method,arguments]),moduleInstance}}function invokeLaterAndSetModuleName(provider,method,queue){return queue||(queue=invokeQueue),function(recipeName,factoryFunction){return factoryFunction&&isFunction(factoryFunction)&&(factoryFunction.$$moduleName=name),queue.push([provider,method,arguments]),moduleInstance}}if(!requires)throw $injectorMinErr("nomod","Module '{0}' is not available! You either misspelled the module name or forgot to load it. If registering a module ensure that you specify the dependencies as the second argument.",name);var invokeQueue=[],configBlocks=[],runBlocks=[],config=invokeLater("$injector","invoke","push",configBlocks),moduleInstance={_invokeQueue:invokeQueue,_configBlocks:configBlocks,_runBlocks:runBlocks,info:function(value){if(isDefined(value)){if(!isObject(value))throw ngMinErr("aobj","Argument '{0}' must be an object","value");return info=value,this}return info},requires:requires,name:name,provider:invokeLaterAndSetModuleName("$provide","provider"),factory:invokeLaterAndSetModuleName("$provide","factory"),service:invokeLaterAndSetModuleName("$provide","service"),value:invokeLater("$provide","value"),constant:invokeLater("$provide","constant","unshift"),decorator:invokeLaterAndSetModuleName("$provide","decorator",configBlocks),animation:invokeLaterAndSetModuleName("$animateProvider","register"),filter:invokeLaterAndSetModuleName("$filterProvider","register"),controller:invokeLaterAndSetModuleName("$controllerProvider","register"),directive:invokeLaterAndSetModuleName("$compileProvider","directive"),component:invokeLaterAndSetModuleName("$compileProvider","component"),config:config,run:function(block){return runBlocks.push(block),this}};return configFn&&config(configFn),moduleInstance})}})}function shallowCopy(src,dst){if(isArray(src)){dst=dst||[];for(var i=0,ii=src.length;i<ii;i++)dst[i]=src[i]}else if(isObject(src)){dst=dst||{};for(var key in src)"$"===key.charAt(0)&&"$"===key.charAt(1)||(dst[key]=src[key])}return dst||src}function serializeObject(obj,maxDepth){var seen=[];return isValidObjectMaxDepth(maxDepth)&&(obj=copy(obj,null,maxDepth)),JSON.stringify(obj,function(key,val){if(val=toJsonReplacer(key,val),isObject(val)){if(seen.indexOf(val)>=0)return"...";seen.push(val)}return val})}function toDebugString(obj,maxDepth){return"function"==typeof obj?obj.toString().replace(/ \{[\s\S]*$/,""):isUndefined(obj)?"undefined":"string"!=typeof obj?serializeObject(obj,maxDepth):obj}function publishExternalAPI(angular){extend(angular,{errorHandlingConfig:errorHandlingConfig,bootstrap:bootstrap,copy:copy,extend:extend,merge:merge,equals:equals,element:jqLite,forEach:forEach,injector:createInjector,noop:noop,bind:bind,toJson:toJson,fromJson:fromJson,identity:identity,isUndefined:isUndefined,isDefined:isDefined,isString:isString,isFunction:isFunction,isObject:isObject,isNumber:isNumber,isElement:isElement,isArray:isArray,version:version,isDate:isDate,lowercase:lowercase,uppercase:uppercase,callbacks:{$$counter:0},getTestability:getTestability,reloadWithDebugInfo:reloadWithDebugInfo,$$minErr:minErr,$$csp:csp,$$encodeUriSegment:encodeUriSegment,$$encodeUriQuery:encodeUriQuery,$$stringify:stringify}),angularModule=setupModuleLoader(window),angularModule("ng",["ngLocale"],["$provide",function($provide){$provide.provider({$$sanitizeUri:$$SanitizeUriProvider}),$provide.provider("$compile",$CompileProvider).directive({a:htmlAnchorDirective,input:inputDirective,textarea:inputDirective,form:formDirective,script:scriptDirective,select:selectDirective,option:optionDirective,ngBind:ngBindDirective,ngBindHtml:ngBindHtmlDirective,ngBindTemplate:ngBindTemplateDirective,ngClass:ngClassDirective,ngClassEven:ngClassEvenDirective,ngClassOdd:ngClassOddDirective,ngCloak:ngCloakDirective,ngController:ngControllerDirective,ngForm:ngFormDirective,ngHide:ngHideDirective,ngIf:ngIfDirective,ngInclude:ngIncludeDirective,ngInit:ngInitDirective,ngNonBindable:ngNonBindableDirective,ngPluralize:ngPluralizeDirective,ngRepeat:ngRepeatDirective,ngShow:ngShowDirective,ngStyle:ngStyleDirective,ngSwitch:ngSwitchDirective,ngSwitchWhen:ngSwitchWhenDirective,ngSwitchDefault:ngSwitchDefaultDirective,ngOptions:ngOptionsDirective,ngTransclude:ngTranscludeDirective,ngModel:ngModelDirective,ngList:ngListDirective,ngChange:ngChangeDirective,pattern:patternDirective,ngPattern:patternDirective,required:requiredDirective,ngRequired:requiredDirective,minlength:minlengthDirective,ngMinlength:minlengthDirective,maxlength:maxlengthDirective,ngMaxlength:maxlengthDirective,ngValue:ngValueDirective,ngModelOptions:ngModelOptionsDirective}).directive({ngInclude:ngIncludeFillContentDirective}).directive(ngAttributeAliasDirectives).directive(ngEventDirectives),$provide.provider({$anchorScroll:$AnchorScrollProvider,$animate:$AnimateProvider,$animateCss:$CoreAnimateCssProvider,$$animateJs:$$CoreAnimateJsProvider,$$animateQueue:$$CoreAnimateQueueProvider,$$AnimateRunner:$$AnimateRunnerFactoryProvider,$$animateAsyncRun:$$AnimateAsyncRunFactoryProvider,$browser:$BrowserProvider,$cacheFactory:$CacheFactoryProvider,$controller:$ControllerProvider,$document:$DocumentProvider,$$isDocumentHidden:$$IsDocumentHiddenProvider,$exceptionHandler:$ExceptionHandlerProvider,$filter:$FilterProvider,$$forceReflow:$$ForceReflowProvider,$interpolate:$InterpolateProvider,$interval:$IntervalProvider,$http:$HttpProvider,$httpParamSerializer:$HttpParamSerializerProvider,$httpParamSerializerJQLike:$HttpParamSerializerJQLikeProvider,$httpBackend:$HttpBackendProvider,$xhrFactory:$xhrFactoryProvider,$jsonpCallbacks:$jsonpCallbacksProvider,$location:$LocationProvider,$log:$LogProvider,$parse:$ParseProvider,$rootScope:$RootScopeProvider,$q:$QProvider,$$q:$$QProvider,$sce:$SceProvider,$sceDelegate:$SceDelegateProvider,$sniffer:$SnifferProvider,$templateCache:$TemplateCacheProvider,$templateRequest:$TemplateRequestProvider,$$testability:$$TestabilityProvider,$timeout:$TimeoutProvider,$window:$WindowProvider,$$rAF:$$RAFProvider,$$jqLite:$$jqLiteProvider,$$Map:$$MapProvider,$$cookieReader:$$CookieReaderProvider})}]).info({angularVersion:"1.6.4"})}function jqNextId(){return++jqId}function cssKebabToCamel(name){return kebabToCamel(name.replace(MS_HACK_REGEXP,"ms-"))}function fnCamelCaseReplace(all,letter){return letter.toUpperCase()}function kebabToCamel(name){return name.replace(DASH_LOWERCASE_REGEXP,fnCamelCaseReplace)}function jqLiteIsTextNode(html){return!HTML_REGEXP.test(html)}function jqLiteAcceptsData(node){var nodeType=node.nodeType;return nodeType===NODE_TYPE_ELEMENT||!nodeType||nodeType===NODE_TYPE_DOCUMENT}function jqLiteHasData(node){for(var key in jqCache[node.ng339])return!0;return!1}function jqLiteBuildFragment(html,context){var tmp,tag,wrap,i,fragment=context.createDocumentFragment(),nodes=[];if(jqLiteIsTextNode(html))nodes.push(context.createTextNode(html));else{for(tmp=fragment.appendChild(context.createElement("div")),tag=(TAG_NAME_REGEXP.exec(html)||["",""])[1].toLowerCase(),wrap=wrapMap[tag]||wrapMap._default,tmp.innerHTML=wrap[1]+html.replace(XHTML_TAG_REGEXP,"<$1></$2>")+wrap[2],i=wrap[0];i--;)tmp=tmp.lastChild;nodes=concat(nodes,tmp.childNodes),tmp=fragment.firstChild,tmp.textContent=""}return fragment.textContent="",fragment.innerHTML="",forEach(nodes,function(node){fragment.appendChild(node)}),fragment}function jqLiteParseHTML(html,context){context=context||window.document;var parsed;return(parsed=SINGLE_TAG_REGEXP.exec(html))?[context.createElement(parsed[1])]:(parsed=jqLiteBuildFragment(html,context))?parsed.childNodes:[]}function jqLiteWrapNode(node,wrapper){var parent=node.parentNode;parent&&parent.replaceChild(wrapper,node),wrapper.appendChild(node)}function JQLite(element){if(element instanceof JQLite)return element;var argIsString;if(isString(element)&&(element=trim(element),argIsString=!0),!(this instanceof JQLite)){if(argIsString&&"<"!==element.charAt(0))throw jqLiteMinErr("nosel","Looking up elements via selectors is not supported by jqLite! See: http://docs.angularjs.org/api/angular.element");return new JQLite(element)}argIsString?jqLiteAddNodes(this,jqLiteParseHTML(element)):isFunction(element)?jqLiteReady(element):jqLiteAddNodes(this,element)}function jqLiteClone(element){return element.cloneNode(!0)}function jqLiteDealoc(element,onlyDescendants){!onlyDescendants&&jqLiteAcceptsData(element)&&jqLite.cleanData([element]),element.querySelectorAll&&jqLite.cleanData(element.querySelectorAll("*"))}function jqLiteOff(element,type,fn,unsupported){if(isDefined(unsupported))throw jqLiteMinErr("offargs","jqLite#off() does not support the `selector` argument");var expandoStore=jqLiteExpandoStore(element),events=expandoStore&&expandoStore.events,handle=expandoStore&&expandoStore.handle;if(handle)if(type){var removeHandler=function(type){var listenerFns=events[type];isDefined(fn)&&arrayRemove(listenerFns||[],fn),isDefined(fn)&&listenerFns&&listenerFns.length>0||(element.removeEventListener(type,handle),delete events[type])};forEach(type.split(" "),function(type){removeHandler(type),MOUSE_EVENT_MAP[type]&&removeHandler(MOUSE_EVENT_MAP[type])})}else for(type in events)"$destroy"!==type&&element.removeEventListener(type,handle),delete events[type]}function jqLiteRemoveData(element,name){var expandoId=element.ng339,expandoStore=expandoId&&jqCache[expandoId];if(expandoStore){if(name)return void delete expandoStore.data[name];expandoStore.handle&&(expandoStore.events.$destroy&&expandoStore.handle({},"$destroy"),jqLiteOff(element)),delete jqCache[expandoId],element.ng339=void 0}}function jqLiteExpandoStore(element,createIfNecessary){var expandoId=element.ng339,expandoStore=expandoId&&jqCache[expandoId];return createIfNecessary&&!expandoStore&&(element.ng339=expandoId=jqNextId(),expandoStore=jqCache[expandoId]={events:{},data:{},handle:void 0}),expandoStore}function jqLiteData(element,key,value){if(jqLiteAcceptsData(element)){var prop,isSimpleSetter=isDefined(value),isSimpleGetter=!isSimpleSetter&&key&&!isObject(key),massGetter=!key,expandoStore=jqLiteExpandoStore(element,!isSimpleGetter),data=expandoStore&&expandoStore.data;if(isSimpleSetter)data[kebabToCamel(key)]=value;else{if(massGetter)return data;if(isSimpleGetter)return data&&data[kebabToCamel(key)];for(prop in key)data[kebabToCamel(prop)]=key[prop]}}}function jqLiteHasClass(element,selector){return!!element.getAttribute&&(" "+(element.getAttribute("class")||"")+" ").replace(/[\n\t]/g," ").indexOf(" "+selector+" ")>-1}function jqLiteRemoveClass(element,cssClasses){cssClasses&&element.setAttribute&&forEach(cssClasses.split(" "),function(cssClass){element.setAttribute("class",trim((" "+(element.getAttribute("class")||"")+" ").replace(/[\n\t]/g," ").replace(" "+trim(cssClass)+" "," ")))})}function jqLiteAddClass(element,cssClasses){if(cssClasses&&element.setAttribute){var existingClasses=(" "+(element.getAttribute("class")||"")+" ").replace(/[\n\t]/g," ");forEach(cssClasses.split(" "),function(cssClass){cssClass=trim(cssClass),-1===existingClasses.indexOf(" "+cssClass+" ")&&(existingClasses+=cssClass+" ")}),element.setAttribute("class",trim(existingClasses))}}function jqLiteAddNodes(root,elements){if(elements)if(elements.nodeType)root[root.length++]=elements;else{var length=elements.length;if("number"==typeof length&&elements.window!==elements){if(length)for(var i=0;i<length;i++)root[root.length++]=elements[i]}else root[root.length++]=elements}}function jqLiteController(element,name){return jqLiteInheritedData(element,"$"+(name||"ngController")+"Controller")}function jqLiteInheritedData(element,name,value){element.nodeType===NODE_TYPE_DOCUMENT&&(element=element.documentElement);for(var names=isArray(name)?name:[name];element;){for(var i=0,ii=names.length;i<ii;i++)if(isDefined(value=jqLite.data(element,names[i])))return value;element=element.parentNode||element.nodeType===NODE_TYPE_DOCUMENT_FRAGMENT&&element.host}}function jqLiteEmpty(element){for(jqLiteDealoc(element,!0);element.firstChild;)element.removeChild(element.firstChild)}function jqLiteRemove(element,keepData){keepData||jqLiteDealoc(element);var parent=element.parentNode;parent&&parent.removeChild(element)}function jqLiteDocumentLoaded(action,win){win=win||window,"complete"===win.document.readyState?win.setTimeout(action):jqLite(win).on("load",action)}function jqLiteReady(fn){function trigger(){window.document.removeEventListener("DOMContentLoaded",trigger),window.removeEventListener("load",trigger),fn()}"complete"===window.document.readyState?window.setTimeout(fn):(window.document.addEventListener("DOMContentLoaded",trigger),window.addEventListener("load",trigger))}function getBooleanAttrName(element,name){var booleanAttr=BOOLEAN_ATTR[name.toLowerCase()];return booleanAttr&&BOOLEAN_ELEMENTS[nodeName_(element)]&&booleanAttr}function getAliasedAttrName(name){return ALIASED_ATTR[name]}function createEventHandler(element,events){var eventHandler=function(event,type){event.isDefaultPrevented=function(){return event.defaultPrevented};var eventFns=events[type||event.type],eventFnsLength=eventFns?eventFns.length:0;if(eventFnsLength){if(isUndefined(event.immediatePropagationStopped)){var originalStopImmediatePropagation=event.stopImmediatePropagation;event.stopImmediatePropagation=function(){event.immediatePropagationStopped=!0,event.stopPropagation&&event.stopPropagation(),originalStopImmediatePropagation&&originalStopImmediatePropagation.call(event)}}event.isImmediatePropagationStopped=function(){return!0===event.immediatePropagationStopped};var handlerWrapper=eventFns.specialHandlerWrapper||defaultHandlerWrapper;eventFnsLength>1&&(eventFns=shallowCopy(eventFns));for(var i=0;i<eventFnsLength;i++)event.isImmediatePropagationStopped()||handlerWrapper(element,event,eventFns[i])}}
;return eventHandler.elem=element,eventHandler}function defaultHandlerWrapper(element,event,handler){handler.call(element,event)}function specialMouseHandlerWrapper(target,event,handler){var related=event.relatedTarget;related&&(related===target||jqLiteContains.call(target,related))||handler.call(target,event)}function $$jqLiteProvider(){this.$get=function(){return extend(JQLite,{hasClass:function(node,classes){return node.attr&&(node=node[0]),jqLiteHasClass(node,classes)},addClass:function(node,classes){return node.attr&&(node=node[0]),jqLiteAddClass(node,classes)},removeClass:function(node,classes){return node.attr&&(node=node[0]),jqLiteRemoveClass(node,classes)}})}}function hashKey(obj,nextUidFn){var key=obj&&obj.$$hashKey;if(key)return"function"==typeof key&&(key=obj.$$hashKey()),key;var objType=typeof obj;return key="function"===objType||"object"===objType&&null!==obj?obj.$$hashKey=objType+":"+(nextUidFn||nextUid)():objType+":"+obj}function NgMapShim(){this._keys=[],this._values=[],this._lastKey=NaN,this._lastIndex=-1}function stringifyFn(fn){return Function.prototype.toString.call(fn)}function extractArgs(fn){var fnText=stringifyFn(fn).replace(STRIP_COMMENTS,"");return fnText.match(ARROW_ARG)||fnText.match(FN_ARGS)}function anonFn(fn){var args=extractArgs(fn);return args?"function("+(args[1]||"").replace(/[\s\r\n]+/," ")+")":"fn"}function annotate(fn,strictDi,name){var $inject,argDecl,last;if("function"==typeof fn){if(!($inject=fn.$inject)){if($inject=[],fn.length){if(strictDi)throw isString(name)&&name||(name=fn.name||anonFn(fn)),$injectorMinErr("strictdi","{0} is not using explicit annotation and cannot be invoked in strict mode",name);argDecl=extractArgs(fn),forEach(argDecl[1].split(FN_ARG_SPLIT),function(arg){arg.replace(FN_ARG,function(all,underscore,name){$inject.push(name)})})}fn.$inject=$inject}}else isArray(fn)?(last=fn.length-1,assertArgFn(fn[last],"fn"),$inject=fn.slice(0,last)):assertArgFn(fn,"fn",!0);return $inject}function createInjector(modulesToLoad,strictDi){function supportObject(delegate){return function(key,value){if(!isObject(key))return delegate(key,value);forEach(key,reverseParams(delegate))}}function provider(name,provider_){if(assertNotHasOwnProperty(name,"service"),(isFunction(provider_)||isArray(provider_))&&(provider_=providerInjector.instantiate(provider_)),!provider_.$get)throw $injectorMinErr("pget","Provider '{0}' must define $get factory method.",name);return providerCache[name+providerSuffix]=provider_}function enforceReturnValue(name,factory){return function(){var result=instanceInjector.invoke(factory,this);if(isUndefined(result))throw $injectorMinErr("undef","Provider '{0}' must return a value from $get factory method.",name);return result}}function factory(name,factoryFn,enforce){return provider(name,{$get:!1!==enforce?enforceReturnValue(name,factoryFn):factoryFn})}function service(name,constructor){return factory(name,["$injector",function($injector){return $injector.instantiate(constructor)}])}function value(name,val){return factory(name,valueFn(val),!1)}function constant(name,value){assertNotHasOwnProperty(name,"constant"),providerCache[name]=value,instanceCache[name]=value}function decorator(serviceName,decorFn){var origProvider=providerInjector.get(serviceName+providerSuffix),orig$get=origProvider.$get;origProvider.$get=function(){var origInstance=instanceInjector.invoke(orig$get,origProvider);return instanceInjector.invoke(decorFn,null,{$delegate:origInstance})}}function loadModules(modulesToLoad){assertArg(isUndefined(modulesToLoad)||isArray(modulesToLoad),"modulesToLoad","not an array");var moduleFn,runBlocks=[];return forEach(modulesToLoad,function(module){function runInvokeQueue(queue){var i,ii;for(i=0,ii=queue.length;i<ii;i++){var invokeArgs=queue[i],provider=providerInjector.get(invokeArgs[0]);provider[invokeArgs[1]].apply(provider,invokeArgs[2])}}if(!loadedModules.get(module)){loadedModules.set(module,!0);try{isString(module)?(moduleFn=angularModule(module),instanceInjector.modules[module]=moduleFn,runBlocks=runBlocks.concat(loadModules(moduleFn.requires)).concat(moduleFn._runBlocks),runInvokeQueue(moduleFn._invokeQueue),runInvokeQueue(moduleFn._configBlocks)):isFunction(module)?runBlocks.push(providerInjector.invoke(module)):isArray(module)?runBlocks.push(providerInjector.invoke(module)):assertArgFn(module,"module")}catch(e){throw isArray(module)&&(module=module[module.length-1]),e.message&&e.stack&&-1===e.stack.indexOf(e.message)&&(e=e.message+"\n"+e.stack),$injectorMinErr("modulerr","Failed to instantiate module {0} due to:\n{1}",module,e.stack||e.message||e)}}}),runBlocks}function createInternalInjector(cache,factory){function getService(serviceName,caller){if(cache.hasOwnProperty(serviceName)){if(cache[serviceName]===INSTANTIATING)throw $injectorMinErr("cdep","Circular dependency found: {0}",serviceName+" <- "+path.join(" <- "));return cache[serviceName]}try{return path.unshift(serviceName),cache[serviceName]=INSTANTIATING,cache[serviceName]=factory(serviceName,caller),cache[serviceName]}catch(err){throw cache[serviceName]===INSTANTIATING&&delete cache[serviceName],err}finally{path.shift()}}function injectionArgs(fn,locals,serviceName){for(var args=[],$inject=createInjector.$$annotate(fn,strictDi,serviceName),i=0,length=$inject.length;i<length;i++){var key=$inject[i];if("string"!=typeof key)throw $injectorMinErr("itkn","Incorrect injection token! Expected service name as string, got {0}",key);args.push(locals&&locals.hasOwnProperty(key)?locals[key]:getService(key,serviceName))}return args}function isClass(func){if(msie||"function"!=typeof func)return!1;var result=func.$$ngIsClass;return isBoolean(result)||(result=func.$$ngIsClass=/^(?:class\b|constructor\()/.test(stringifyFn(func))),result}function invoke(fn,self,locals,serviceName){"string"==typeof locals&&(serviceName=locals,locals=null);var args=injectionArgs(fn,locals,serviceName);return isArray(fn)&&(fn=fn[fn.length-1]),isClass(fn)?(args.unshift(null),new(Function.prototype.bind.apply(fn,args))):fn.apply(self,args)}function instantiate(Type,locals,serviceName){var ctor=isArray(Type)?Type[Type.length-1]:Type,args=injectionArgs(Type,locals,serviceName);return args.unshift(null),new(Function.prototype.bind.apply(ctor,args))}return{invoke:invoke,instantiate:instantiate,get:getService,annotate:createInjector.$$annotate,has:function(name){return providerCache.hasOwnProperty(name+providerSuffix)||cache.hasOwnProperty(name)}}}strictDi=!0===strictDi;var INSTANTIATING={},providerSuffix="Provider",path=[],loadedModules=new NgMap,providerCache={$provide:{provider:supportObject(provider),factory:supportObject(factory),service:supportObject(service),value:supportObject(value),constant:supportObject(constant),decorator:decorator}},providerInjector=providerCache.$injector=createInternalInjector(providerCache,function(serviceName,caller){throw angular.isString(caller)&&path.push(caller),$injectorMinErr("unpr","Unknown provider: {0}",path.join(" <- "))}),instanceCache={},protoInstanceInjector=createInternalInjector(instanceCache,function(serviceName,caller){var provider=providerInjector.get(serviceName+providerSuffix,caller);return instanceInjector.invoke(provider.$get,provider,void 0,serviceName)}),instanceInjector=protoInstanceInjector;providerCache["$injector"+providerSuffix]={$get:valueFn(protoInstanceInjector)},instanceInjector.modules=providerInjector.modules=createMap();var runBlocks=loadModules(modulesToLoad);return instanceInjector=protoInstanceInjector.get("$injector"),instanceInjector.strictDi=strictDi,forEach(runBlocks,function(fn){fn&&instanceInjector.invoke(fn)}),instanceInjector}function $AnchorScrollProvider(){var autoScrollingEnabled=!0;this.disableAutoScrolling=function(){autoScrollingEnabled=!1},this.$get=["$window","$location","$rootScope",function($window,$location,$rootScope){function getFirstAnchor(list){var result=null;return Array.prototype.some.call(list,function(element){if("a"===nodeName_(element))return result=element,!0}),result}function getYOffset(){var offset=scroll.yOffset;if(isFunction(offset))offset=offset();else if(isElement(offset)){var elem=offset[0],style=$window.getComputedStyle(elem);offset="fixed"!==style.position?0:elem.getBoundingClientRect().bottom}else isNumber(offset)||(offset=0);return offset}function scrollTo(elem){if(elem){elem.scrollIntoView();var offset=getYOffset();if(offset){var elemTop=elem.getBoundingClientRect().top;$window.scrollBy(0,elemTop-offset)}}else $window.scrollTo(0,0)}function scroll(hash){hash=isString(hash)?hash:isNumber(hash)?hash.toString():$location.hash();var elm;hash?(elm=document.getElementById(hash))?scrollTo(elm):(elm=getFirstAnchor(document.getElementsByName(hash)))?scrollTo(elm):"top"===hash&&scrollTo(null):scrollTo(null)}var document=$window.document;return autoScrollingEnabled&&$rootScope.$watch(function(){return $location.hash()},function(newVal,oldVal){newVal===oldVal&&""===newVal||jqLiteDocumentLoaded(function(){$rootScope.$evalAsync(scroll)})}),scroll}]}function mergeClasses(a,b){return a||b?a?b?(isArray(a)&&(a=a.join(" ")),isArray(b)&&(b=b.join(" ")),a+" "+b):a:b:""}function extractElementNode(element){for(var i=0;i<element.length;i++){var elm=element[i];if(elm.nodeType===ELEMENT_NODE)return elm}}function splitClasses(classes){isString(classes)&&(classes=classes.split(" "));var obj=createMap();return forEach(classes,function(klass){klass.length&&(obj[klass]=!0)}),obj}function prepareAnimateOptions(options){return isObject(options)?options:{}}function Browser(window,document,$log,$sniffer){function completeOutstandingRequest(fn){try{fn.apply(null,sliceArgs(arguments,1))}finally{if(0===--outstandingRequestCount)for(;outstandingRequestCallbacks.length;)try{outstandingRequestCallbacks.pop()()}catch(e){$log.error(e)}}}function getHash(url){var index=url.indexOf("#");return-1===index?"":url.substr(index)}function cacheStateAndFireUrlChange(){pendingLocation=null,fireStateOrUrlChange()}function cacheState(){cachedState=getCurrentState(),cachedState=isUndefined(cachedState)?null:cachedState,equals(cachedState,lastCachedState)&&(cachedState=lastCachedState),lastCachedState=cachedState,lastHistoryState=cachedState}function fireStateOrUrlChange(){var prevLastHistoryState=lastHistoryState;cacheState(),lastBrowserUrl===self.url()&&prevLastHistoryState===cachedState||(lastBrowserUrl=self.url(),lastHistoryState=cachedState,forEach(urlChangeListeners,function(listener){listener(self.url(),cachedState)}))}var self=this,location=window.location,history=window.history,setTimeout=window.setTimeout,clearTimeout=window.clearTimeout,pendingDeferIds={};self.isMock=!1;var outstandingRequestCount=0,outstandingRequestCallbacks=[];self.$$completeOutstandingRequest=completeOutstandingRequest,self.$$incOutstandingRequestCount=function(){outstandingRequestCount++},self.notifyWhenNoOutstandingRequests=function(callback){0===outstandingRequestCount?callback():outstandingRequestCallbacks.push(callback)};var cachedState,lastHistoryState,lastBrowserUrl=location.href,baseElement=document.find("base"),pendingLocation=null,getCurrentState=$sniffer.history?function(){try{return history.state}catch(e){}}:noop;cacheState(),self.url=function(url,replace,state){if(isUndefined(state)&&(state=null),location!==window.location&&(location=window.location),history!==window.history&&(history=window.history),url){var sameState=lastHistoryState===state;if(lastBrowserUrl===url&&(!$sniffer.history||sameState))return self;var sameBase=lastBrowserUrl&&stripHash(lastBrowserUrl)===stripHash(url);return lastBrowserUrl=url,lastHistoryState=state,!$sniffer.history||sameBase&&sameState?(sameBase||(pendingLocation=url),replace?location.replace(url):sameBase?location.hash=getHash(url):location.href=url,location.href!==url&&(pendingLocation=url)):(history[replace?"replaceState":"pushState"](state,"",url),cacheState()),pendingLocation&&(pendingLocation=url),self}return pendingLocation||location.href.replace(/%27/g,"'")},self.state=function(){return cachedState};var urlChangeListeners=[],urlChangeInit=!1,lastCachedState=null;self.onUrlChange=function(callback){return urlChangeInit||($sniffer.history&&jqLite(window).on("popstate",cacheStateAndFireUrlChange),jqLite(window).on("hashchange",cacheStateAndFireUrlChange),urlChangeInit=!0),urlChangeListeners.push(callback),callback},self.$$applicationDestroyed=function(){jqLite(window).off("hashchange popstate",cacheStateAndFireUrlChange)},self.$$checkUrlChange=fireStateOrUrlChange,self.baseHref=function(){var href=baseElement.attr("href");return href?href.replace(/^(https?:)?\/\/[^\/]*/,""):""},self.defer=function(fn,delay){var timeoutId;return outstandingRequestCount++,timeoutId=setTimeout(function(){delete pendingDeferIds[timeoutId],completeOutstandingRequest(fn)},delay||0),pendingDeferIds[timeoutId]=!0,timeoutId},self.defer.cancel=function(deferId){return!!pendingDeferIds[deferId]&&(delete pendingDeferIds[deferId],clearTimeout(deferId),completeOutstandingRequest(noop),!0)}}function $BrowserProvider(){this.$get=["$window","$log","$sniffer","$document",function($window,$log,$sniffer,$document){return new Browser($window,$document,$log,$sniffer)}]}function $CacheFactoryProvider(){this.$get=function(){function cacheFactory(cacheId,options){function refresh(entry){entry!==freshEnd&&(staleEnd?staleEnd===entry&&(staleEnd=entry.n):staleEnd=entry,link(entry.n,entry.p),link(entry,freshEnd),freshEnd=entry,freshEnd.n=null)}function link(nextEntry,prevEntry){nextEntry!==prevEntry&&(nextEntry&&(nextEntry.p=prevEntry),prevEntry&&(prevEntry.n=nextEntry))}if(cacheId in caches)throw minErr("$cacheFactory")("iid","CacheId '{0}' is already taken!",cacheId);var size=0,stats=extend({},options,{id:cacheId}),data=createMap(),capacity=options&&options.capacity||Number.MAX_VALUE,lruHash=createMap(),freshEnd=null,staleEnd=null;return caches[cacheId]={put:function(key,value){if(!isUndefined(value)){if(capacity<Number.MAX_VALUE){refresh(lruHash[key]||(lruHash[key]={key:key}))}return key in data||size++,data[key]=value,size>capacity&&this.remove(staleEnd.key),value}},get:function(key){if(capacity<Number.MAX_VALUE){var lruEntry=lruHash[key];if(!lruEntry)return;refresh(lruEntry)}return data[key]},remove:function(key){if(capacity<Number.MAX_VALUE){var lruEntry=lruHash[key];if(!lruEntry)return;lruEntry===freshEnd&&(freshEnd=lruEntry.p),lruEntry===staleEnd&&(staleEnd=lruEntry.n),link(lruEntry.n,lruEntry.p),delete lruHash[key]}key in data&&(delete data[key],size--)},removeAll:function(){data=createMap(),size=0,lruHash=createMap(),freshEnd=staleEnd=null},destroy:function(){data=null,stats=null,lruHash=null,delete caches[cacheId]},info:function(){return extend({},stats,{size:size})}}}var caches={};return cacheFactory.info=function(){var info={};return forEach(caches,function(cache,cacheId){info[cacheId]=cache.info()}),info},cacheFactory.get=function(cacheId){return caches[cacheId]},cacheFactory}}function $TemplateCacheProvider(){this.$get=["$cacheFactory",function($cacheFactory){return $cacheFactory("templates")}]}function UNINITIALIZED_VALUE(){}function $CompileProvider($provide,$$sanitizeUriProvider){function parseIsolateBindings(scope,directiveName,isController){var LOCAL_REGEXP=/^\s*([@&<]|=(\*?))(\??)\s*([\w$]*)\s*$/,bindings=createMap();return forEach(scope,function(definition,scopeName){if(definition in bindingCache)return void(bindings[scopeName]=bindingCache[definition]);var match=definition.match(LOCAL_REGEXP);if(!match)throw $compileMinErr("iscp","Invalid {3} for directive '{0}'. Definition: {... {1}: '{2}' ...}",directiveName,scopeName,definition,isController?"controller bindings definition":"isolate scope definition");bindings[scopeName]={mode:match[1][0],collection:"*"===match[2],optional:"?"===match[3],attrName:match[4]||scopeName},match[4]&&(bindingCache[definition]=bindings[scopeName])}),bindings}function parseDirectiveBindings(directive,directiveName){var bindings={isolateScope:null,bindToController:null};if(isObject(directive.scope)&&(!0===directive.bindToController?(bindings.bindToController=parseIsolateBindings(directive.scope,directiveName,!0),bindings.isolateScope={}):bindings.isolateScope=parseIsolateBindings(directive.scope,directiveName,!1)),isObject(directive.bindToController)&&(bindings.bindToController=parseIsolateBindings(directive.bindToController,directiveName,!0)),bindings.bindToController&&!directive.controller)throw $compileMinErr("noctrl","Cannot bind to controller without directive '{0}'s controller.",directiveName);return bindings}function assertValidDirectiveName(name){var letter=name.charAt(0);if(!letter||letter!==lowercase(letter))throw $compileMinErr("baddir","Directive/Component name '{0}' is invalid. The first character must be a lowercase letter",name);if(name!==name.trim())throw $compileMinErr("baddir","Directive/Component name '{0}' is invalid. The name should not contain leading or trailing whitespaces",name)}function getDirectiveRequire(directive){var require=directive.require||directive.controller&&directive.name;return!isArray(require)&&isObject(require)&&forEach(require,function(value,key){var match=value.match(REQUIRE_PREFIX_REGEXP);value.substring(match[0].length)||(require[key]=match[0]+key)}),require}function getDirectiveRestrict(restrict,name){if(restrict&&(!isString(restrict)||!/[EACM]/.test(restrict)))throw $compileMinErr("badrestrict","Restrict property '{0}' of directive '{1}' is invalid",restrict,name);return restrict||"EA"}var hasDirectives={},Suffix="Directive",COMMENT_DIRECTIVE_REGEXP=/^\s*directive:\s*([\w-]+)\s+(.*)$/,CLASS_DIRECTIVE_REGEXP=/(([\w-]+)(?::([^;]+))?;?)/,ALL_OR_NOTHING_ATTRS=makeMap("ngSrc,ngSrcset,src,srcset"),REQUIRE_PREFIX_REGEXP=/^(?:(\^\^?)?(\?)?(\^\^?)?)?/,EVENT_HANDLER_ATTR_REGEXP=/^(on[a-z]+|formaction)$/,bindingCache=createMap();this.directive=function registerDirective(name,directiveFactory){return assertArg(name,"name"),assertNotHasOwnProperty(name,"directive"),isString(name)?(assertValidDirectiveName(name),assertArg(directiveFactory,"directiveFactory"),hasDirectives.hasOwnProperty(name)||(hasDirectives[name]=[],$provide.factory(name+Suffix,["$injector","$exceptionHandler",function($injector,$exceptionHandler){var directives=[];return forEach(hasDirectives[name],function(directiveFactory,index){try{var directive=$injector.invoke(directiveFactory);isFunction(directive)?directive={compile:valueFn(directive)}:!directive.compile&&directive.link&&(directive.compile=valueFn(directive.link)),directive.priority=directive.priority||0,directive.index=index,directive.name=directive.name||name,directive.require=getDirectiveRequire(directive),directive.restrict=getDirectiveRestrict(directive.restrict,name),directive.$$moduleName=directiveFactory.$$moduleName,directives.push(directive)}catch(e){$exceptionHandler(e)}}),directives}])),hasDirectives[name].push(directiveFactory)):forEach(name,reverseParams(registerDirective)),this},this.component=function(name,options){function factory($injector){function makeInjectable(fn){return isFunction(fn)||isArray(fn)?function(tElement,tAttrs){return $injector.invoke(fn,this,{$element:tElement,$attrs:tAttrs})}:fn}var template=options.template||options.templateUrl?options.template:"",ddo={controller:controller,controllerAs:identifierForController(options.controller)||options.controllerAs||"$ctrl",template:makeInjectable(template),templateUrl:makeInjectable(options.templateUrl),transclude:options.transclude,scope:{},bindToController:options.bindings||{},restrict:"E",require:options.require};return forEach(options,function(val,key){"$"===key.charAt(0)&&(ddo[key]=val)}),ddo}var controller=options.controller||function(){};return forEach(options,function(val,key){"$"===key.charAt(0)&&(factory[key]=val,isFunction(controller)&&(controller[key]=val))}),factory.$inject=["$injector"],this.directive(name,factory)},this.aHrefSanitizationWhitelist=function(regexp){return isDefined(regexp)?($$sanitizeUriProvider.aHrefSanitizationWhitelist(regexp),this):$$sanitizeUriProvider.aHrefSanitizationWhitelist()},this.imgSrcSanitizationWhitelist=function(regexp){return isDefined(regexp)?($$sanitizeUriProvider.imgSrcSanitizationWhitelist(regexp),this):$$sanitizeUriProvider.imgSrcSanitizationWhitelist()};var debugInfoEnabled=!0;this.debugInfoEnabled=function(enabled){return isDefined(enabled)?(debugInfoEnabled=enabled,this):debugInfoEnabled};var preAssignBindingsEnabled=!1;this.preAssignBindingsEnabled=function(enabled){return isDefined(enabled)?(preAssignBindingsEnabled=enabled,this):preAssignBindingsEnabled};var TTL=10;this.onChangesTtl=function(value){return arguments.length?(TTL=value,this):TTL};var commentDirectivesEnabledConfig=!0;this.commentDirectivesEnabled=function(value){return arguments.length?(commentDirectivesEnabledConfig=value,this):commentDirectivesEnabledConfig};var cssClassDirectivesEnabledConfig=!0;this.cssClassDirectivesEnabled=function(value){return arguments.length?(cssClassDirectivesEnabledConfig=value,this):cssClassDirectivesEnabledConfig},this.$get=["$injector","$interpolate","$exceptionHandler","$templateRequest","$parse","$controller","$rootScope","$sce","$animate","$$sanitizeUri",function($injector,$interpolate,$exceptionHandler,$templateRequest,$parse,$controller,$rootScope,$sce,$animate,$$sanitizeUri){function flushOnChangesQueue(){try{if(!--onChangesTtl)throw onChangesQueue=void 0,$compileMinErr("infchng","{0} $onChanges() iterations reached. Aborting!\n",TTL);$rootScope.$apply(function(){for(var errors=[],i=0,ii=onChangesQueue.length;i<ii;++i)try{onChangesQueue[i]()}catch(e){errors.push(e)}if(onChangesQueue=void 0,errors.length)throw errors})}finally{onChangesTtl++}}function Attributes(element,attributesToCopy){if(attributesToCopy){var i,l,key,keys=Object.keys(attributesToCopy);for(i=0,l=keys.length;i<l;i++)key=keys[i],this[key]=attributesToCopy[key]}else this.$attr={};this.$$element=element}function setSpecialAttr(element,attrName,value){specialAttrHolder.innerHTML="<span "+attrName+">";var attributes=specialAttrHolder.firstChild.attributes,attribute=attributes[0];attributes.removeNamedItem(attribute.name),attribute.value=value,element.attributes.setNamedItem(attribute)}function safeAddClass($element,className){try{$element.addClass(className)}catch(e){}}function compile($compileNodes,transcludeFn,maxPriority,ignoreDirective,previousCompileContext){$compileNodes instanceof jqLite||($compileNodes=jqLite($compileNodes));var compositeLinkFn=compileNodes($compileNodes,transcludeFn,$compileNodes,maxPriority,ignoreDirective,previousCompileContext);compile.$$addScopeClass($compileNodes);var namespace=null;return function(scope,cloneConnectFn,options){if(!$compileNodes)throw $compileMinErr("multilink","This element has already been linked.");assertArg(scope,"scope"),previousCompileContext&&previousCompileContext.needsNewScope&&(scope=scope.$parent.$new()),options=options||{};var parentBoundTranscludeFn=options.parentBoundTranscludeFn,transcludeControllers=options.transcludeControllers,futureParentElement=options.futureParentElement;parentBoundTranscludeFn&&parentBoundTranscludeFn.$$boundTransclude&&(parentBoundTranscludeFn=parentBoundTranscludeFn.$$boundTransclude),namespace||(namespace=detectNamespaceForChildElements(futureParentElement));var $linkNode;if($linkNode="html"!==namespace?jqLite(wrapTemplate(namespace,jqLite("<div>").append($compileNodes).html())):cloneConnectFn?JQLitePrototype.clone.call($compileNodes):$compileNodes,transcludeControllers)for(var controllerName in transcludeControllers)$linkNode.data("$"+controllerName+"Controller",transcludeControllers[controllerName].instance);return compile.$$addScopeInfo($linkNode,scope),cloneConnectFn&&cloneConnectFn($linkNode,scope),compositeLinkFn&&compositeLinkFn(scope,$linkNode,$linkNode,parentBoundTranscludeFn),cloneConnectFn||($compileNodes=compositeLinkFn=null),$linkNode}}function detectNamespaceForChildElements(parentElement){var node=parentElement&&parentElement[0];return node&&"foreignobject"!==nodeName_(node)&&toString.call(node).match(/SVG/)?"svg":"html"}function compileNodes(nodeList,transcludeFn,$rootElement,maxPriority,ignoreDirective,previousCompileContext){function compositeLinkFn(scope,nodeList,$rootElement,parentBoundTranscludeFn){var nodeLinkFn,childLinkFn,node,childScope,i,ii,idx,childBoundTranscludeFn,stableNodeList;if(nodeLinkFnFound){var nodeListLength=nodeList.length;for(stableNodeList=new Array(nodeListLength),i=0;i<linkFns.length;i+=3)idx=linkFns[i],stableNodeList[idx]=nodeList[idx]}else stableNodeList=nodeList;for(i=0,ii=linkFns.length;i<ii;)node=stableNodeList[linkFns[i++]],nodeLinkFn=linkFns[i++],childLinkFn=linkFns[i++],nodeLinkFn?(nodeLinkFn.scope?(childScope=scope.$new(),compile.$$addScopeInfo(jqLite(node),childScope)):childScope=scope,childBoundTranscludeFn=nodeLinkFn.transcludeOnThisElement?createBoundTranscludeFn(scope,nodeLinkFn.transclude,parentBoundTranscludeFn):!nodeLinkFn.templateOnThisElement&&parentBoundTranscludeFn?parentBoundTranscludeFn:!parentBoundTranscludeFn&&transcludeFn?createBoundTranscludeFn(scope,transcludeFn):null,nodeLinkFn(childLinkFn,childScope,node,$rootElement,childBoundTranscludeFn)):childLinkFn&&childLinkFn(scope,node.childNodes,void 0,parentBoundTranscludeFn)}for(var attrs,directives,nodeLinkFn,childNodes,childLinkFn,linkFnFound,nodeLinkFnFound,linkFns=[],notLiveList=isArray(nodeList)||nodeList instanceof jqLite,i=0;i<nodeList.length;i++)attrs=new Attributes,11===msie&&mergeConsecutiveTextNodes(nodeList,i,notLiveList),directives=collectDirectives(nodeList[i],[],attrs,0===i?maxPriority:void 0,ignoreDirective),nodeLinkFn=directives.length?applyDirectivesToNode(directives,nodeList[i],attrs,transcludeFn,$rootElement,null,[],[],previousCompileContext):null,nodeLinkFn&&nodeLinkFn.scope&&compile.$$addScopeClass(attrs.$$element),childLinkFn=nodeLinkFn&&nodeLinkFn.terminal||!(childNodes=nodeList[i].childNodes)||!childNodes.length?null:compileNodes(childNodes,nodeLinkFn?(nodeLinkFn.transcludeOnThisElement||!nodeLinkFn.templateOnThisElement)&&nodeLinkFn.transclude:transcludeFn),(nodeLinkFn||childLinkFn)&&(linkFns.push(i,nodeLinkFn,childLinkFn),linkFnFound=!0,nodeLinkFnFound=nodeLinkFnFound||nodeLinkFn),previousCompileContext=null;return linkFnFound?compositeLinkFn:null}function mergeConsecutiveTextNodes(nodeList,idx,notLiveList){var sibling,node=nodeList[idx],parent=node.parentNode;if(node.nodeType===NODE_TYPE_TEXT)for(;;){if(!(sibling=parent?node.nextSibling:nodeList[idx+1])||sibling.nodeType!==NODE_TYPE_TEXT)break;node.nodeValue=node.nodeValue+sibling.nodeValue,sibling.parentNode&&sibling.parentNode.removeChild(sibling),notLiveList&&sibling===nodeList[idx+1]&&nodeList.splice(idx+1,1)}}function createBoundTranscludeFn(scope,transcludeFn,previousBoundTranscludeFn){function boundTranscludeFn(transcludedScope,cloneFn,controllers,futureParentElement,containingScope){return transcludedScope||(transcludedScope=scope.$new(!1,containingScope),transcludedScope.$$transcluded=!0),transcludeFn(transcludedScope,cloneFn,{parentBoundTranscludeFn:previousBoundTranscludeFn,transcludeControllers:controllers,futureParentElement:futureParentElement})}var boundSlots=boundTranscludeFn.$$slots=createMap();for(var slotName in transcludeFn.$$slots)transcludeFn.$$slots[slotName]?boundSlots[slotName]=createBoundTranscludeFn(scope,transcludeFn.$$slots[slotName],previousBoundTranscludeFn):boundSlots[slotName]=null;return boundTranscludeFn}function collectDirectives(node,directives,attrs,maxPriority,ignoreDirective){var match,nodeName,className,nodeType=node.nodeType,attrsMap=attrs.$attr;switch(nodeType){case NODE_TYPE_ELEMENT:nodeName=nodeName_(node),addDirective(directives,directiveNormalize(nodeName),"E",maxPriority,ignoreDirective);for(var attr,name,nName,ngAttrName,value,isNgAttr,nAttrs=node.attributes,j=0,jj=nAttrs&&nAttrs.length;j<jj;j++){var attrStartName=!1,attrEndName=!1;attr=nAttrs[j],name=attr.name,value=attr.value,ngAttrName=directiveNormalize(name),isNgAttr=NG_ATTR_BINDING.test(ngAttrName),isNgAttr&&(name=name.replace(PREFIX_REGEXP,"").substr(8).replace(/_(.)/g,function(match,letter){return letter.toUpperCase()}));var multiElementMatch=ngAttrName.match(MULTI_ELEMENT_DIR_RE);multiElementMatch&&directiveIsMultiElement(multiElementMatch[1])&&(attrStartName=name,attrEndName=name.substr(0,name.length-5)+"end",name=name.substr(0,name.length-6)),nName=directiveNormalize(name.toLowerCase()),attrsMap[nName]=name,!isNgAttr&&attrs.hasOwnProperty(nName)||(attrs[nName]=value,getBooleanAttrName(node,nName)&&(attrs[nName]=!0)),addAttrInterpolateDirective(node,directives,value,nName,isNgAttr),addDirective(directives,nName,"A",maxPriority,ignoreDirective,attrStartName,attrEndName)}if("input"===nodeName&&"hidden"===node.getAttribute("type")&&node.setAttribute("autocomplete","off"),!cssClassDirectivesEnabled)break;if(className=node.className,isObject(className)&&(className=className.animVal),isString(className)&&""!==className)for(;match=CLASS_DIRECTIVE_REGEXP.exec(className);)nName=directiveNormalize(match[2]),addDirective(directives,nName,"C",maxPriority,ignoreDirective)&&(attrs[nName]=trim(match[3])),className=className.substr(match.index+match[0].length);break;case NODE_TYPE_TEXT:addTextInterpolateDirective(directives,node.nodeValue);break;case NODE_TYPE_COMMENT:if(!commentDirectivesEnabled)break;collectCommentDirectives(node,directives,attrs,maxPriority,ignoreDirective)}return directives.sort(byPriority),directives}function collectCommentDirectives(node,directives,attrs,maxPriority,ignoreDirective){try{var match=COMMENT_DIRECTIVE_REGEXP.exec(node.nodeValue);if(match){var nName=directiveNormalize(match[1]);addDirective(directives,nName,"M",maxPriority,ignoreDirective)&&(attrs[nName]=trim(match[2]))}}catch(e){}}function groupScan(node,attrStart,attrEnd){var nodes=[],depth=0;if(attrStart&&node.hasAttribute&&node.hasAttribute(attrStart))do{if(!node)throw $compileMinErr("uterdir","Unterminated attribute, found '{0}' but no matching '{1}' found.",attrStart,attrEnd);node.nodeType===NODE_TYPE_ELEMENT&&(node.hasAttribute(attrStart)&&depth++,node.hasAttribute(attrEnd)&&depth--),nodes.push(node),node=node.nextSibling}while(depth>0);else nodes.push(node);return jqLite(nodes)}function groupElementsLinkFnWrapper(linkFn,attrStart,attrEnd){return function(scope,element,attrs,controllers,transcludeFn){return element=groupScan(element[0],attrStart,attrEnd),linkFn(scope,element,attrs,controllers,transcludeFn)}}function compilationGenerator(eager,$compileNodes,transcludeFn,maxPriority,ignoreDirective,previousCompileContext){var compiled;return eager?compile($compileNodes,transcludeFn,maxPriority,ignoreDirective,previousCompileContext):function(){return compiled||(compiled=compile($compileNodes,transcludeFn,maxPriority,ignoreDirective,previousCompileContext),$compileNodes=transcludeFn=previousCompileContext=null),compiled.apply(this,arguments)}}function applyDirectivesToNode(directives,compileNode,templateAttrs,transcludeFn,jqCollection,originalReplaceDirective,preLinkFns,postLinkFns,previousCompileContext){function addLinkFns(pre,post,attrStart,attrEnd){pre&&(attrStart&&(pre=groupElementsLinkFnWrapper(pre,attrStart,attrEnd)),pre.require=directive.require,pre.directiveName=directiveName,(newIsolateScopeDirective===directive||directive.$$isolateScope)&&(pre=cloneAndAnnotateFn(pre,{isolateScope:!0})),preLinkFns.push(pre)),post&&(attrStart&&(post=groupElementsLinkFnWrapper(post,attrStart,attrEnd)),post.require=directive.require,post.directiveName=directiveName,(newIsolateScopeDirective===directive||directive.$$isolateScope)&&(post=cloneAndAnnotateFn(post,{isolateScope:!0})),postLinkFns.push(post))}function nodeLinkFn(childLinkFn,scope,linkNode,$rootElement,boundTranscludeFn){function controllersBoundTransclude(scope,cloneAttachFn,futureParentElement,slotName){var transcludeControllers;if(isScope(scope)||(slotName=futureParentElement,futureParentElement=cloneAttachFn,cloneAttachFn=scope,scope=void 0),hasElementTranscludeDirective&&(transcludeControllers=elementControllers),
futureParentElement||(futureParentElement=hasElementTranscludeDirective?$element.parent():$element),!slotName)return boundTranscludeFn(scope,cloneAttachFn,transcludeControllers,futureParentElement,scopeToChild);var slotTranscludeFn=boundTranscludeFn.$$slots[slotName];if(slotTranscludeFn)return slotTranscludeFn(scope,cloneAttachFn,transcludeControllers,futureParentElement,scopeToChild);if(isUndefined(slotTranscludeFn))throw $compileMinErr("noslot",'No parent directive that requires a transclusion with slot name "{0}". Element: {1}',slotName,startingTag($element))}var i,ii,linkFn,isolateScope,controllerScope,elementControllers,transcludeFn,$element,attrs,scopeBindingInfo;compileNode===linkNode?(attrs=templateAttrs,$element=templateAttrs.$$element):($element=jqLite(linkNode),attrs=new Attributes($element,templateAttrs)),controllerScope=scope,newIsolateScopeDirective?isolateScope=scope.$new(!0):newScopeDirective&&(controllerScope=scope.$parent),boundTranscludeFn&&(transcludeFn=controllersBoundTransclude,transcludeFn.$$boundTransclude=boundTranscludeFn,transcludeFn.isSlotFilled=function(slotName){return!!boundTranscludeFn.$$slots[slotName]}),controllerDirectives&&(elementControllers=setupControllers($element,attrs,transcludeFn,controllerDirectives,isolateScope,scope,newIsolateScopeDirective)),newIsolateScopeDirective&&(compile.$$addScopeInfo($element,isolateScope,!0,!(templateDirective&&(templateDirective===newIsolateScopeDirective||templateDirective===newIsolateScopeDirective.$$originalDirective))),compile.$$addScopeClass($element,!0),isolateScope.$$isolateBindings=newIsolateScopeDirective.$$isolateBindings,scopeBindingInfo=initializeDirectiveBindings(scope,attrs,isolateScope,isolateScope.$$isolateBindings,newIsolateScopeDirective),scopeBindingInfo.removeWatches&&isolateScope.$on("$destroy",scopeBindingInfo.removeWatches));for(var name in elementControllers){var controllerDirective=controllerDirectives[name],controller=elementControllers[name],bindings=controllerDirective.$$bindings.bindToController;if(preAssignBindingsEnabled){controller.bindingInfo=bindings?initializeDirectiveBindings(controllerScope,attrs,controller.instance,bindings,controllerDirective):{};var controllerResult=controller();controllerResult!==controller.instance&&(controller.instance=controllerResult,$element.data("$"+controllerDirective.name+"Controller",controllerResult),controller.bindingInfo.removeWatches&&controller.bindingInfo.removeWatches(),controller.bindingInfo=initializeDirectiveBindings(controllerScope,attrs,controller.instance,bindings,controllerDirective))}else controller.instance=controller(),$element.data("$"+controllerDirective.name+"Controller",controller.instance),controller.bindingInfo=initializeDirectiveBindings(controllerScope,attrs,controller.instance,bindings,controllerDirective)}for(forEach(controllerDirectives,function(controllerDirective,name){var require=controllerDirective.require;controllerDirective.bindToController&&!isArray(require)&&isObject(require)&&extend(elementControllers[name].instance,getControllers(name,require,$element,elementControllers))}),forEach(elementControllers,function(controller){var controllerInstance=controller.instance;if(isFunction(controllerInstance.$onChanges))try{controllerInstance.$onChanges(controller.bindingInfo.initialChanges)}catch(e){$exceptionHandler(e)}if(isFunction(controllerInstance.$onInit))try{controllerInstance.$onInit()}catch(e){$exceptionHandler(e)}isFunction(controllerInstance.$doCheck)&&(controllerScope.$watch(function(){controllerInstance.$doCheck()}),controllerInstance.$doCheck()),isFunction(controllerInstance.$onDestroy)&&controllerScope.$on("$destroy",function(){controllerInstance.$onDestroy()})}),i=0,ii=preLinkFns.length;i<ii;i++)linkFn=preLinkFns[i],invokeLinkFn(linkFn,linkFn.isolateScope?isolateScope:scope,$element,attrs,linkFn.require&&getControllers(linkFn.directiveName,linkFn.require,$element,elementControllers),transcludeFn);var scopeToChild=scope;for(newIsolateScopeDirective&&(newIsolateScopeDirective.template||null===newIsolateScopeDirective.templateUrl)&&(scopeToChild=isolateScope),childLinkFn&&childLinkFn(scopeToChild,linkNode.childNodes,void 0,boundTranscludeFn),i=postLinkFns.length-1;i>=0;i--)linkFn=postLinkFns[i],invokeLinkFn(linkFn,linkFn.isolateScope?isolateScope:scope,$element,attrs,linkFn.require&&getControllers(linkFn.directiveName,linkFn.require,$element,elementControllers),transcludeFn);forEach(elementControllers,function(controller){var controllerInstance=controller.instance;isFunction(controllerInstance.$postLink)&&controllerInstance.$postLink()})}previousCompileContext=previousCompileContext||{};for(var directive,directiveName,$template,linkFn,directiveValue,terminalPriority=-Number.MAX_VALUE,newScopeDirective=previousCompileContext.newScopeDirective,controllerDirectives=previousCompileContext.controllerDirectives,newIsolateScopeDirective=previousCompileContext.newIsolateScopeDirective,templateDirective=previousCompileContext.templateDirective,nonTlbTranscludeDirective=previousCompileContext.nonTlbTranscludeDirective,hasTranscludeDirective=!1,hasTemplate=!1,hasElementTranscludeDirective=previousCompileContext.hasElementTranscludeDirective,$compileNode=templateAttrs.$$element=jqLite(compileNode),replaceDirective=originalReplaceDirective,childTranscludeFn=transcludeFn,didScanForMultipleTransclusion=!1,mightHaveMultipleTransclusionError=!1,i=0,ii=directives.length;i<ii;i++){directive=directives[i];var attrStart=directive.$$start,attrEnd=directive.$$end;if(attrStart&&($compileNode=groupScan(compileNode,attrStart,attrEnd)),$template=void 0,terminalPriority>directive.priority)break;if(directiveValue=directive.scope,directiveValue&&(directive.templateUrl||(isObject(directiveValue)?(assertNoDuplicate("new/isolated scope",newIsolateScopeDirective||newScopeDirective,directive,$compileNode),newIsolateScopeDirective=directive):assertNoDuplicate("new/isolated scope",newIsolateScopeDirective,directive,$compileNode)),newScopeDirective=newScopeDirective||directive),directiveName=directive.name,!didScanForMultipleTransclusion&&(directive.replace&&(directive.templateUrl||directive.template)||directive.transclude&&!directive.$$tlb)){for(var candidateDirective,scanningIndex=i+1;candidateDirective=directives[scanningIndex++];)if(candidateDirective.transclude&&!candidateDirective.$$tlb||candidateDirective.replace&&(candidateDirective.templateUrl||candidateDirective.template)){mightHaveMultipleTransclusionError=!0;break}didScanForMultipleTransclusion=!0}if(!directive.templateUrl&&directive.controller&&(controllerDirectives=controllerDirectives||createMap(),assertNoDuplicate("'"+directiveName+"' controller",controllerDirectives[directiveName],directive,$compileNode),controllerDirectives[directiveName]=directive),directiveValue=directive.transclude)if(hasTranscludeDirective=!0,directive.$$tlb||(assertNoDuplicate("transclusion",nonTlbTranscludeDirective,directive,$compileNode),nonTlbTranscludeDirective=directive),"element"===directiveValue)hasElementTranscludeDirective=!0,terminalPriority=directive.priority,$template=$compileNode,$compileNode=templateAttrs.$$element=jqLite(compile.$$createComment(directiveName,templateAttrs[directiveName])),compileNode=$compileNode[0],replaceWith(jqCollection,sliceArgs($template),compileNode),$template[0].$$parentNode=$template[0].parentNode,childTranscludeFn=compilationGenerator(mightHaveMultipleTransclusionError,$template,transcludeFn,terminalPriority,replaceDirective&&replaceDirective.name,{nonTlbTranscludeDirective:nonTlbTranscludeDirective});else{var slots=createMap();if(isObject(directiveValue)){$template=[];var slotMap=createMap(),filledSlots=createMap();forEach(directiveValue,function(elementSelector,slotName){var optional="?"===elementSelector.charAt(0);elementSelector=optional?elementSelector.substring(1):elementSelector,slotMap[elementSelector]=slotName,slots[slotName]=null,filledSlots[slotName]=optional}),forEach($compileNode.contents(),function(node){var slotName=slotMap[directiveNormalize(nodeName_(node))];slotName?(filledSlots[slotName]=!0,slots[slotName]=slots[slotName]||[],slots[slotName].push(node)):$template.push(node)}),forEach(filledSlots,function(filled,slotName){if(!filled)throw $compileMinErr("reqslot","Required transclusion slot `{0}` was not filled.",slotName)});for(var slotName in slots)slots[slotName]&&(slots[slotName]=compilationGenerator(mightHaveMultipleTransclusionError,slots[slotName],transcludeFn))}else $template=jqLite(jqLiteClone(compileNode)).contents();$compileNode.empty(),childTranscludeFn=compilationGenerator(mightHaveMultipleTransclusionError,$template,transcludeFn,void 0,void 0,{needsNewScope:directive.$$isolateScope||directive.$$newScope}),childTranscludeFn.$$slots=slots}if(directive.template)if(hasTemplate=!0,assertNoDuplicate("template",templateDirective,directive,$compileNode),templateDirective=directive,directiveValue=isFunction(directive.template)?directive.template($compileNode,templateAttrs):directive.template,directiveValue=denormalizeTemplate(directiveValue),directive.replace){if(replaceDirective=directive,$template=jqLiteIsTextNode(directiveValue)?[]:removeComments(wrapTemplate(directive.templateNamespace,trim(directiveValue))),compileNode=$template[0],1!==$template.length||compileNode.nodeType!==NODE_TYPE_ELEMENT)throw $compileMinErr("tplrt","Template for directive '{0}' must have exactly one root element. {1}",directiveName,"");replaceWith(jqCollection,$compileNode,compileNode);var newTemplateAttrs={$attr:{}},templateDirectives=collectDirectives(compileNode,[],newTemplateAttrs),unprocessedDirectives=directives.splice(i+1,directives.length-(i+1));(newIsolateScopeDirective||newScopeDirective)&&markDirectiveScope(templateDirectives,newIsolateScopeDirective,newScopeDirective),directives=directives.concat(templateDirectives).concat(unprocessedDirectives),mergeTemplateAttributes(templateAttrs,newTemplateAttrs),ii=directives.length}else $compileNode.html(directiveValue);if(directive.templateUrl)hasTemplate=!0,assertNoDuplicate("template",templateDirective,directive,$compileNode),templateDirective=directive,directive.replace&&(replaceDirective=directive),nodeLinkFn=compileTemplateUrl(directives.splice(i,directives.length-i),$compileNode,templateAttrs,jqCollection,hasTranscludeDirective&&childTranscludeFn,preLinkFns,postLinkFns,{controllerDirectives:controllerDirectives,newScopeDirective:newScopeDirective!==directive&&newScopeDirective,newIsolateScopeDirective:newIsolateScopeDirective,templateDirective:templateDirective,nonTlbTranscludeDirective:nonTlbTranscludeDirective}),ii=directives.length;else if(directive.compile)try{linkFn=directive.compile($compileNode,templateAttrs,childTranscludeFn);var context=directive.$$originalDirective||directive;isFunction(linkFn)?addLinkFns(null,bind(context,linkFn),attrStart,attrEnd):linkFn&&addLinkFns(bind(context,linkFn.pre),bind(context,linkFn.post),attrStart,attrEnd)}catch(e){$exceptionHandler(e,startingTag($compileNode))}directive.terminal&&(nodeLinkFn.terminal=!0,terminalPriority=Math.max(terminalPriority,directive.priority))}return nodeLinkFn.scope=newScopeDirective&&!0===newScopeDirective.scope,nodeLinkFn.transcludeOnThisElement=hasTranscludeDirective,nodeLinkFn.templateOnThisElement=hasTemplate,nodeLinkFn.transclude=childTranscludeFn,previousCompileContext.hasElementTranscludeDirective=hasElementTranscludeDirective,nodeLinkFn}function getControllers(directiveName,require,$element,elementControllers){var value;if(isString(require)){var match=require.match(REQUIRE_PREFIX_REGEXP),name=require.substring(match[0].length),inheritType=match[1]||match[3],optional="?"===match[2];if("^^"===inheritType?$element=$element.parent():(value=elementControllers&&elementControllers[name],value=value&&value.instance),!value){var dataName="$"+name+"Controller";value=inheritType?$element.inheritedData(dataName):$element.data(dataName)}if(!value&&!optional)throw $compileMinErr("ctreq","Controller '{0}', required by directive '{1}', can't be found!",name,directiveName)}else if(isArray(require)){value=[];for(var i=0,ii=require.length;i<ii;i++)value[i]=getControllers(directiveName,require[i],$element,elementControllers)}else isObject(require)&&(value={},forEach(require,function(controller,property){value[property]=getControllers(directiveName,controller,$element,elementControllers)}));return value||null}function setupControllers($element,attrs,transcludeFn,controllerDirectives,isolateScope,scope,newIsolateScopeDirective){var elementControllers=createMap();for(var controllerKey in controllerDirectives){var directive=controllerDirectives[controllerKey],locals={$scope:directive===newIsolateScopeDirective||directive.$$isolateScope?isolateScope:scope,$element:$element,$attrs:attrs,$transclude:transcludeFn},controller=directive.controller;"@"===controller&&(controller=attrs[directive.name]);var controllerInstance=$controller(controller,locals,!0,directive.controllerAs);elementControllers[directive.name]=controllerInstance,$element.data("$"+directive.name+"Controller",controllerInstance.instance)}return elementControllers}function markDirectiveScope(directives,isolateScope,newScope){for(var j=0,jj=directives.length;j<jj;j++)directives[j]=inherit(directives[j],{$$isolateScope:isolateScope,$$newScope:newScope})}function addDirective(tDirectives,name,location,maxPriority,ignoreDirective,startAttrName,endAttrName){if(name===ignoreDirective)return null;var match=null;if(hasDirectives.hasOwnProperty(name))for(var directive,directives=$injector.get(name+Suffix),i=0,ii=directives.length;i<ii;i++)if(directive=directives[i],(isUndefined(maxPriority)||maxPriority>directive.priority)&&-1!==directive.restrict.indexOf(location)){if(startAttrName&&(directive=inherit(directive,{$$start:startAttrName,$$end:endAttrName})),!directive.$$bindings){var bindings=directive.$$bindings=parseDirectiveBindings(directive,directive.name);isObject(bindings.isolateScope)&&(directive.$$isolateBindings=bindings.isolateScope)}tDirectives.push(directive),match=directive}return match}function directiveIsMultiElement(name){if(hasDirectives.hasOwnProperty(name))for(var directive,directives=$injector.get(name+Suffix),i=0,ii=directives.length;i<ii;i++)if(directive=directives[i],directive.multiElement)return!0;return!1}function mergeTemplateAttributes(dst,src){var srcAttr=src.$attr,dstAttr=dst.$attr;forEach(dst,function(value,key){"$"!==key.charAt(0)&&(src[key]&&src[key]!==value&&(value.length?value+=("style"===key?";":" ")+src[key]:value=src[key]),dst.$set(key,value,!0,srcAttr[key]))}),forEach(src,function(value,key){dst.hasOwnProperty(key)||"$"===key.charAt(0)||(dst[key]=value,"class"!==key&&"style"!==key&&(dstAttr[key]=srcAttr[key]))})}function compileTemplateUrl(directives,$compileNode,tAttrs,$rootElement,childTranscludeFn,preLinkFns,postLinkFns,previousCompileContext){var afterTemplateNodeLinkFn,afterTemplateChildLinkFn,linkQueue=[],beforeTemplateCompileNode=$compileNode[0],origAsyncDirective=directives.shift(),derivedSyncDirective=inherit(origAsyncDirective,{templateUrl:null,transclude:null,replace:null,$$originalDirective:origAsyncDirective}),templateUrl=isFunction(origAsyncDirective.templateUrl)?origAsyncDirective.templateUrl($compileNode,tAttrs):origAsyncDirective.templateUrl,templateNamespace=origAsyncDirective.templateNamespace;return $compileNode.empty(),$templateRequest(templateUrl).then(function(content){var compileNode,tempTemplateAttrs,$template,childBoundTranscludeFn;if(content=denormalizeTemplate(content),origAsyncDirective.replace){if($template=jqLiteIsTextNode(content)?[]:removeComments(wrapTemplate(templateNamespace,trim(content))),compileNode=$template[0],1!==$template.length||compileNode.nodeType!==NODE_TYPE_ELEMENT)throw $compileMinErr("tplrt","Template for directive '{0}' must have exactly one root element. {1}",origAsyncDirective.name,templateUrl);tempTemplateAttrs={$attr:{}},replaceWith($rootElement,$compileNode,compileNode);var templateDirectives=collectDirectives(compileNode,[],tempTemplateAttrs);isObject(origAsyncDirective.scope)&&markDirectiveScope(templateDirectives,!0),directives=templateDirectives.concat(directives),mergeTemplateAttributes(tAttrs,tempTemplateAttrs)}else compileNode=beforeTemplateCompileNode,$compileNode.html(content);for(directives.unshift(derivedSyncDirective),afterTemplateNodeLinkFn=applyDirectivesToNode(directives,compileNode,tAttrs,childTranscludeFn,$compileNode,origAsyncDirective,preLinkFns,postLinkFns,previousCompileContext),forEach($rootElement,function(node,i){node===compileNode&&($rootElement[i]=$compileNode[0])}),afterTemplateChildLinkFn=compileNodes($compileNode[0].childNodes,childTranscludeFn);linkQueue.length;){var scope=linkQueue.shift(),beforeTemplateLinkNode=linkQueue.shift(),linkRootElement=linkQueue.shift(),boundTranscludeFn=linkQueue.shift(),linkNode=$compileNode[0];if(!scope.$$destroyed){if(beforeTemplateLinkNode!==beforeTemplateCompileNode){var oldClasses=beforeTemplateLinkNode.className;previousCompileContext.hasElementTranscludeDirective&&origAsyncDirective.replace||(linkNode=jqLiteClone(compileNode)),replaceWith(linkRootElement,jqLite(beforeTemplateLinkNode),linkNode),safeAddClass(jqLite(linkNode),oldClasses)}childBoundTranscludeFn=afterTemplateNodeLinkFn.transcludeOnThisElement?createBoundTranscludeFn(scope,afterTemplateNodeLinkFn.transclude,boundTranscludeFn):boundTranscludeFn,afterTemplateNodeLinkFn(afterTemplateChildLinkFn,scope,linkNode,$rootElement,childBoundTranscludeFn)}}linkQueue=null}).catch(function(error){error instanceof Error&&$exceptionHandler(error)}),function(ignoreChildLinkFn,scope,node,rootElement,boundTranscludeFn){var childBoundTranscludeFn=boundTranscludeFn;scope.$$destroyed||(linkQueue?linkQueue.push(scope,node,rootElement,childBoundTranscludeFn):(afterTemplateNodeLinkFn.transcludeOnThisElement&&(childBoundTranscludeFn=createBoundTranscludeFn(scope,afterTemplateNodeLinkFn.transclude,boundTranscludeFn)),afterTemplateNodeLinkFn(afterTemplateChildLinkFn,scope,node,rootElement,childBoundTranscludeFn)))}}function byPriority(a,b){var diff=b.priority-a.priority;return 0!==diff?diff:a.name!==b.name?a.name<b.name?-1:1:a.index-b.index}function assertNoDuplicate(what,previousDirective,directive,element){function wrapModuleNameIfDefined(moduleName){return moduleName?" (module: "+moduleName+")":""}if(previousDirective)throw $compileMinErr("multidir","Multiple directives [{0}{1}, {2}{3}] asking for {4} on: {5}",previousDirective.name,wrapModuleNameIfDefined(previousDirective.$$moduleName),directive.name,wrapModuleNameIfDefined(directive.$$moduleName),what,startingTag(element))}function addTextInterpolateDirective(directives,text){var interpolateFn=$interpolate(text,!0);interpolateFn&&directives.push({priority:0,compile:function(templateNode){var templateNodeParent=templateNode.parent(),hasCompileParent=!!templateNodeParent.length;return hasCompileParent&&compile.$$addBindingClass(templateNodeParent),function(scope,node){var parent=node.parent();hasCompileParent||compile.$$addBindingClass(parent),compile.$$addBindingInfo(parent,interpolateFn.expressions),scope.$watch(interpolateFn,function(value){node[0].nodeValue=value})}}})}function wrapTemplate(type,template){switch(type=lowercase(type||"html")){case"svg":case"math":var wrapper=window.document.createElement("div");return wrapper.innerHTML="<"+type+">"+template+"</"+type+">",wrapper.childNodes[0].childNodes;default:return template}}function getTrustedContext(node,attrNormalizedName){if("srcdoc"===attrNormalizedName)return $sce.HTML;var tag=nodeName_(node);if("src"===attrNormalizedName||"ngSrc"===attrNormalizedName){if(-1===["img","video","audio","source","track"].indexOf(tag))return $sce.RESOURCE_URL}else if("xlinkHref"===attrNormalizedName||"form"===tag&&"action"===attrNormalizedName||"link"===tag&&"href"===attrNormalizedName)return $sce.RESOURCE_URL}function addAttrInterpolateDirective(node,directives,value,name,isNgAttr){var trustedContext=getTrustedContext(node,name),mustHaveExpression=!isNgAttr,allOrNothing=ALL_OR_NOTHING_ATTRS[name]||isNgAttr,interpolateFn=$interpolate(value,mustHaveExpression,trustedContext,allOrNothing);if(interpolateFn){if("multiple"===name&&"select"===nodeName_(node))throw $compileMinErr("selmulti","Binding to the 'multiple' attribute is not supported. Element: {0}",startingTag(node));if(EVENT_HANDLER_ATTR_REGEXP.test(name))throw $compileMinErr("nodomevents","Interpolations for HTML DOM event attributes are disallowed.  Please use the ng- versions (such as ng-click instead of onclick) instead.");directives.push({priority:100,compile:function(){return{pre:function(scope,element,attr){var $$observers=attr.$$observers||(attr.$$observers=createMap()),newValue=attr[name];newValue!==value&&(interpolateFn=newValue&&$interpolate(newValue,!0,trustedContext,allOrNothing),value=newValue),interpolateFn&&(attr[name]=interpolateFn(scope),($$observers[name]||($$observers[name]=[])).$$inter=!0,(attr.$$observers&&attr.$$observers[name].$$scope||scope).$watch(interpolateFn,function(newValue,oldValue){"class"===name&&newValue!==oldValue?attr.$updateClass(newValue,oldValue):attr.$set(name,newValue)}))}}}})}}function replaceWith($rootElement,elementsToRemove,newNode){var i,ii,firstElementToRemove=elementsToRemove[0],removeCount=elementsToRemove.length,parent=firstElementToRemove.parentNode;if($rootElement)for(i=0,ii=$rootElement.length;i<ii;i++)if($rootElement[i]===firstElementToRemove){$rootElement[i++]=newNode;for(var j=i,j2=j+removeCount-1,jj=$rootElement.length;j<jj;j++,j2++)j2<jj?$rootElement[j]=$rootElement[j2]:delete $rootElement[j];$rootElement.length-=removeCount-1,$rootElement.context===firstElementToRemove&&($rootElement.context=newNode);break}parent&&parent.replaceChild(newNode,firstElementToRemove);var fragment=window.document.createDocumentFragment();for(i=0;i<removeCount;i++)fragment.appendChild(elementsToRemove[i]);for(jqLite.hasData(firstElementToRemove)&&(jqLite.data(newNode,jqLite.data(firstElementToRemove)),jqLite(firstElementToRemove).off("$destroy")),jqLite.cleanData(fragment.querySelectorAll("*")),i=1;i<removeCount;i++)delete elementsToRemove[i];elementsToRemove[0]=newNode,elementsToRemove.length=1}function cloneAndAnnotateFn(fn,annotation){return extend(function(){return fn.apply(null,arguments)},fn,annotation)}function invokeLinkFn(linkFn,scope,$element,attrs,controllers,transcludeFn){try{linkFn(scope,$element,attrs,controllers,transcludeFn)}catch(e){$exceptionHandler(e,startingTag($element))}}function initializeDirectiveBindings(scope,attrs,destination,bindings,directive){function recordChanges(key,currentValue,previousValue){isFunction(destination.$onChanges)&&!simpleCompare(currentValue,previousValue)&&(onChangesQueue||(scope.$$postDigest(flushOnChangesQueue),onChangesQueue=[]),changes||(changes={},onChangesQueue.push(triggerOnChangesHook)),changes[key]&&(previousValue=changes[key].previousValue),changes[key]=new SimpleChange(previousValue,currentValue))}function triggerOnChangesHook(){destination.$onChanges(changes),changes=void 0}var changes,removeWatchCollection=[],initialChanges={};return forEach(bindings,function(definition,scopeName){var lastValue,parentGet,parentSet,compare,removeWatch,attrName=definition.attrName,optional=definition.optional,mode=definition.mode;switch(mode){case"@":optional||hasOwnProperty.call(attrs,attrName)||(destination[scopeName]=attrs[attrName]=void 0),removeWatch=attrs.$observe(attrName,function(value){if(isString(value)||isBoolean(value)){var oldValue=destination[scopeName];recordChanges(scopeName,value,oldValue),destination[scopeName]=value}}),attrs.$$observers[attrName].$$scope=scope,lastValue=attrs[attrName],isString(lastValue)?destination[scopeName]=$interpolate(lastValue)(scope):isBoolean(lastValue)&&(destination[scopeName]=lastValue),initialChanges[scopeName]=new SimpleChange(_UNINITIALIZED_VALUE,destination[scopeName]),removeWatchCollection.push(removeWatch);break;case"=":if(!hasOwnProperty.call(attrs,attrName)){if(optional)break;attrs[attrName]=void 0}if(optional&&!attrs[attrName])break;parentGet=$parse(attrs[attrName]),compare=parentGet.literal?equals:simpleCompare,parentSet=parentGet.assign||function(){throw lastValue=destination[scopeName]=parentGet(scope),$compileMinErr("nonassign","Expression '{0}' in attribute '{1}' used with directive '{2}' is non-assignable!",attrs[attrName],attrName,directive.name)},lastValue=destination[scopeName]=parentGet(scope);var parentValueWatch=function(parentValue){return compare(parentValue,destination[scopeName])||(compare(parentValue,lastValue)?parentSet(scope,parentValue=destination[scopeName]):destination[scopeName]=parentValue),lastValue=parentValue};parentValueWatch.$stateful=!0,removeWatch=definition.collection?scope.$watchCollection(attrs[attrName],parentValueWatch):scope.$watch($parse(attrs[attrName],parentValueWatch),null,parentGet.literal),removeWatchCollection.push(removeWatch);break;case"<":if(!hasOwnProperty.call(attrs,attrName)){if(optional)break;attrs[attrName]=void 0}if(optional&&!attrs[attrName])break;parentGet=$parse(attrs[attrName]);var deepWatch=parentGet.literal,initialValue=destination[scopeName]=parentGet(scope);initialChanges[scopeName]=new SimpleChange(_UNINITIALIZED_VALUE,destination[scopeName]),removeWatch=scope.$watch(parentGet,function(newValue,oldValue){if(oldValue===newValue){if(oldValue===initialValue||deepWatch&&equals(oldValue,initialValue))return;oldValue=initialValue}recordChanges(scopeName,newValue,oldValue),destination[scopeName]=newValue},deepWatch),removeWatchCollection.push(removeWatch);break;case"&":if((parentGet=attrs.hasOwnProperty(attrName)?$parse(attrs[attrName]):noop)===noop&&optional)break;destination[scopeName]=function(locals){return parentGet(scope,locals)}}}),{initialChanges:initialChanges,removeWatches:removeWatchCollection.length&&function(){for(var i=0,ii=removeWatchCollection.length;i<ii;++i)removeWatchCollection[i]()}}}var onChangesQueue,SIMPLE_ATTR_NAME=/^\w/,specialAttrHolder=window.document.createElement("div"),commentDirectivesEnabled=commentDirectivesEnabledConfig,cssClassDirectivesEnabled=cssClassDirectivesEnabledConfig,onChangesTtl=TTL;Attributes.prototype={$normalize:directiveNormalize,$addClass:function(classVal){classVal&&classVal.length>0&&$animate.addClass(this.$$element,classVal)},$removeClass:function(classVal){classVal&&classVal.length>0&&$animate.removeClass(this.$$element,classVal)},$updateClass:function(newClasses,oldClasses){var toAdd=tokenDifference(newClasses,oldClasses);toAdd&&toAdd.length&&$animate.addClass(this.$$element,toAdd);var toRemove=tokenDifference(oldClasses,newClasses);toRemove&&toRemove.length&&$animate.removeClass(this.$$element,toRemove)},$set:function(key,value,writeAttr,attrName){var nodeName,node=this.$$element[0],booleanKey=getBooleanAttrName(node,key),aliasedKey=getAliasedAttrName(key),observer=key;if(booleanKey?(this.$$element.prop(key,value),attrName=booleanKey):aliasedKey&&(this[aliasedKey]=value,observer=aliasedKey),this[key]=value,attrName?this.$attr[key]=attrName:(attrName=this.$attr[key])||(this.$attr[key]=attrName=snake_case(key,"-")),"a"===(nodeName=nodeName_(this.$$element))&&("href"===key||"xlinkHref"===key)||"img"===nodeName&&"src"===key)this[key]=value=$$sanitizeUri(value,"src"===key);else if("img"===nodeName&&"srcset"===key&&isDefined(value)){for(var result="",trimmedSrcset=trim(value),srcPattern=/(\s+\d+x\s*,|\s+\d+w\s*,|\s+,|,\s+)/,pattern=/\s/.test(trimmedSrcset)?srcPattern:/(,)/,rawUris=trimmedSrcset.split(pattern),nbrUrisWith2parts=Math.floor(rawUris.length/2),i=0;i<nbrUrisWith2parts;i++){var innerIdx=2*i;result+=$$sanitizeUri(trim(rawUris[innerIdx]),!0),result+=" "+trim(rawUris[innerIdx+1])}var lastTuple=trim(rawUris[2*i]).split(/\s/);result+=$$sanitizeUri(trim(lastTuple[0]),!0),2===lastTuple.length&&(result+=" "+trim(lastTuple[1])),this[key]=value=result}!1!==writeAttr&&(null===value||isUndefined(value)?this.$$element.removeAttr(attrName):SIMPLE_ATTR_NAME.test(attrName)?this.$$element.attr(attrName,value):setSpecialAttr(this.$$element[0],attrName,value));var $$observers=this.$$observers;$$observers&&forEach($$observers[observer],function(fn){try{fn(value)}catch(e){$exceptionHandler(e)}})},$observe:function(key,fn){var attrs=this,$$observers=attrs.$$observers||(attrs.$$observers=createMap()),listeners=$$observers[key]||($$observers[key]=[]);return listeners.push(fn),$rootScope.$evalAsync(function(){listeners.$$inter||!attrs.hasOwnProperty(key)||isUndefined(attrs[key])||fn(attrs[key])}),function(){arrayRemove(listeners,fn)}}};var startSymbol=$interpolate.startSymbol(),endSymbol=$interpolate.endSymbol(),denormalizeTemplate="{{"===startSymbol&&"}}"===endSymbol?identity:function(template){return template.replace(/\{\{/g,startSymbol).replace(/}}/g,endSymbol)},NG_ATTR_BINDING=/^ngAttr[A-Z]/,MULTI_ELEMENT_DIR_RE=/^(.+)Start$/;return compile.$$addBindingInfo=debugInfoEnabled?function($element,binding){var bindings=$element.data("$binding")||[];isArray(binding)?bindings=bindings.concat(binding):bindings.push(binding),$element.data("$binding",bindings)}:noop,compile.$$addBindingClass=debugInfoEnabled?function($element){safeAddClass($element,"ng-binding")}:noop,compile.$$addScopeInfo=debugInfoEnabled?function($element,scope,isolated,noTemplate){var dataName=isolated?noTemplate?"$isolateScopeNoTemplate":"$isolateScope":"$scope";$element.data(dataName,scope)}:noop,compile.$$addScopeClass=debugInfoEnabled?function($element,isolated){safeAddClass($element,isolated?"ng-isolate-scope":"ng-scope")}:noop,compile.$$createComment=function(directiveName,comment){var content="";return debugInfoEnabled&&(content=" "+(directiveName||"")+": ",comment&&(content+=comment+" ")),window.document.createComment(content)},compile}]}function SimpleChange(previous,current){this.previousValue=previous,this.currentValue=current}function directiveNormalize(name){return name.replace(PREFIX_REGEXP,"").replace(SPECIAL_CHARS_REGEXP,fnCamelCaseReplace)}function tokenDifference(str1,str2){var values="",tokens1=str1.split(/\s+/),tokens2=str2.split(/\s+/);outer:for(var i=0;i<tokens1.length;i++){for(var token=tokens1[i],j=0;j<tokens2.length;j++)if(token===tokens2[j])continue outer;values+=(values.length>0?" ":"")+token}return values}function removeComments(jqNodes){jqNodes=jqLite(jqNodes);var i=jqNodes.length;if(i<=1)return jqNodes;for(;i--;){var node=jqNodes[i];(node.nodeType===NODE_TYPE_COMMENT||node.nodeType===NODE_TYPE_TEXT&&""===node.nodeValue.trim())&&splice.call(jqNodes,i,1)}return jqNodes}function identifierForController(controller,ident){if(ident&&isString(ident))return ident;if(isString(controller)){var match=CNTRL_REG.exec(controller);if(match)return match[3]}}function $ControllerProvider(){var controllers={},globals=!1;this.has=function(name){return controllers.hasOwnProperty(name)},this.register=function(name,constructor){assertNotHasOwnProperty(name,"controller"),isObject(name)?extend(controllers,name):controllers[name]=constructor},this.allowGlobals=function(){globals=!0},this.$get=["$injector","$window",function($injector,$window){function addIdentifier(locals,identifier,instance,name){if(!locals||!isObject(locals.$scope))throw minErr("$controller")("noscp","Cannot export controller '{0}' as '{1}'! No $scope object provided via `locals`.",name,identifier);locals.$scope[identifier]=instance}return function(expression,locals,later,ident){var instance,match,constructor,identifier;if(later=!0===later,ident&&isString(ident)&&(identifier=ident),isString(expression)){if(!(match=expression.match(CNTRL_REG)))throw $controllerMinErr("ctrlfmt","Badly formed controller string '{0}'. Must match `__name__ as __id__` or `__name__`.",expression);if(constructor=match[1],identifier=identifier||match[3],!(expression=controllers.hasOwnProperty(constructor)?controllers[constructor]:getter(locals.$scope,constructor,!0)||(globals?getter($window,constructor,!0):void 0)))throw $controllerMinErr("ctrlreg","The controller with the name '{0}' is not registered.",constructor)
;assertArgFn(expression,constructor,!0)}if(later){var controllerPrototype=(isArray(expression)?expression[expression.length-1]:expression).prototype;return instance=Object.create(controllerPrototype||null),identifier&&addIdentifier(locals,identifier,instance,constructor||expression.name),extend(function(){var result=$injector.invoke(expression,instance,locals,constructor);return result!==instance&&(isObject(result)||isFunction(result))&&(instance=result,identifier&&addIdentifier(locals,identifier,instance,constructor||expression.name)),instance},{instance:instance,identifier:identifier})}return instance=$injector.instantiate(expression,locals,constructor),identifier&&addIdentifier(locals,identifier,instance,constructor||expression.name),instance}}]}function $DocumentProvider(){this.$get=["$window",function(window){return jqLite(window.document)}]}function $$IsDocumentHiddenProvider(){this.$get=["$document","$rootScope",function($document,$rootScope){function changeListener(){hidden=doc.hidden}var doc=$document[0],hidden=doc&&doc.hidden;return $document.on("visibilitychange",changeListener),$rootScope.$on("$destroy",function(){$document.off("visibilitychange",changeListener)}),function(){return hidden}}]}function $ExceptionHandlerProvider(){this.$get=["$log",function($log){return function(exception,cause){$log.error.apply($log,arguments)}}]}function serializeValue(v){return isObject(v)?isDate(v)?v.toISOString():toJson(v):v}function $HttpParamSerializerProvider(){this.$get=function(){return function(params){if(!params)return"";var parts=[];return forEachSorted(params,function(value,key){null===value||isUndefined(value)||(isArray(value)?forEach(value,function(v){parts.push(encodeUriQuery(key)+"="+encodeUriQuery(serializeValue(v)))}):parts.push(encodeUriQuery(key)+"="+encodeUriQuery(serializeValue(value))))}),parts.join("&")}}}function $HttpParamSerializerJQLikeProvider(){this.$get=function(){return function(params){function serialize(toSerialize,prefix,topLevel){null===toSerialize||isUndefined(toSerialize)||(isArray(toSerialize)?forEach(toSerialize,function(value,index){serialize(value,prefix+"["+(isObject(value)?index:"")+"]")}):isObject(toSerialize)&&!isDate(toSerialize)?forEachSorted(toSerialize,function(value,key){serialize(value,prefix+(topLevel?"":"[")+key+(topLevel?"":"]"))}):parts.push(encodeUriQuery(prefix)+"="+encodeUriQuery(serializeValue(toSerialize))))}if(!params)return"";var parts=[];return serialize(params,"",!0),parts.join("&")}}}function defaultHttpResponseTransform(data,headers){if(isString(data)){var tempData=data.replace(JSON_PROTECTION_PREFIX,"").trim();if(tempData){var contentType=headers("Content-Type");if(contentType&&0===contentType.indexOf(APPLICATION_JSON)||isJsonLike(tempData))try{data=fromJson(tempData)}catch(e){throw $httpMinErr("baddata",'Data must be a valid JSON object. Received: "{0}". Parse error: "{1}"',data,e)}}}return data}function isJsonLike(str){var jsonStart=str.match(JSON_START);return jsonStart&&JSON_ENDS[jsonStart[0]].test(str)}function parseHeaders(headers){function fillInParsed(key,val){key&&(parsed[key]=parsed[key]?parsed[key]+", "+val:val)}var i,parsed=createMap();return isString(headers)?forEach(headers.split("\n"),function(line){i=line.indexOf(":"),fillInParsed(lowercase(trim(line.substr(0,i))),trim(line.substr(i+1)))}):isObject(headers)&&forEach(headers,function(headerVal,headerKey){fillInParsed(lowercase(headerKey),trim(headerVal))}),parsed}function headersGetter(headers){var headersObj;return function(name){if(headersObj||(headersObj=parseHeaders(headers)),name){var value=headersObj[lowercase(name)];return void 0===value&&(value=null),value}return headersObj}}function transformData(data,headers,status,fns){return isFunction(fns)?fns(data,headers,status):(forEach(fns,function(fn){data=fn(data,headers,status)}),data)}function isSuccess(status){return 200<=status&&status<300}function $HttpProvider(){var defaults=this.defaults={transformResponse:[defaultHttpResponseTransform],transformRequest:[function(d){return!isObject(d)||isFile(d)||isBlob(d)||isFormData(d)?d:toJson(d)}],headers:{common:{Accept:"application/json, text/plain, */*"},post:shallowCopy(CONTENT_TYPE_APPLICATION_JSON),put:shallowCopy(CONTENT_TYPE_APPLICATION_JSON),patch:shallowCopy(CONTENT_TYPE_APPLICATION_JSON)},xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",paramSerializer:"$httpParamSerializer",jsonpCallbackParam:"callback"},useApplyAsync=!1;this.useApplyAsync=function(value){return isDefined(value)?(useApplyAsync=!!value,this):useApplyAsync};var interceptorFactories=this.interceptors=[];this.$get=["$browser","$httpBackend","$$cookieReader","$cacheFactory","$rootScope","$q","$injector","$sce",function($browser,$httpBackend,$$cookieReader,$cacheFactory,$rootScope,$q,$injector,$sce){function $http(requestConfig){function chainInterceptors(promise,interceptors){for(var i=0,ii=interceptors.length;i<ii;){var thenFn=interceptors[i++],rejectFn=interceptors[i++];promise=promise.then(thenFn,rejectFn)}return interceptors.length=0,promise}function completeOutstandingRequest(){$browser.$$completeOutstandingRequest(noop)}function executeHeaderFns(headers,config){var headerContent,processedHeaders={};return forEach(headers,function(headerFn,header){isFunction(headerFn)?null!=(headerContent=headerFn(config))&&(processedHeaders[header]=headerContent):processedHeaders[header]=headerFn}),processedHeaders}function mergeHeaders(config){var defHeaderName,lowercaseDefHeaderName,reqHeaderName,defHeaders=defaults.headers,reqHeaders=extend({},config.headers);defHeaders=extend({},defHeaders.common,defHeaders[lowercase(config.method)]);defaultHeadersIteration:for(defHeaderName in defHeaders){lowercaseDefHeaderName=lowercase(defHeaderName);for(reqHeaderName in reqHeaders)if(lowercase(reqHeaderName)===lowercaseDefHeaderName)continue defaultHeadersIteration;reqHeaders[defHeaderName]=defHeaders[defHeaderName]}return executeHeaderFns(reqHeaders,shallowCopy(config))}function serverRequest(config){var headers=config.headers,reqData=transformData(config.data,headersGetter(headers),void 0,config.transformRequest);return isUndefined(reqData)&&forEach(headers,function(value,header){"content-type"===lowercase(header)&&delete headers[header]}),isUndefined(config.withCredentials)&&!isUndefined(defaults.withCredentials)&&(config.withCredentials=defaults.withCredentials),sendReq(config,reqData).then(transformResponse,transformResponse)}function transformResponse(response){var resp=extend({},response);return resp.data=transformData(response.data,response.headers,response.status,config.transformResponse),isSuccess(response.status)?resp:$q.reject(resp)}if(!isObject(requestConfig))throw minErr("$http")("badreq","Http request configuration must be an object.  Received: {0}",requestConfig);if(!isString($sce.valueOf(requestConfig.url)))throw minErr("$http")("badreq","Http request configuration url must be a string or a $sce trusted object.  Received: {0}",requestConfig.url);var config=extend({method:"get",transformRequest:defaults.transformRequest,transformResponse:defaults.transformResponse,paramSerializer:defaults.paramSerializer,jsonpCallbackParam:defaults.jsonpCallbackParam},requestConfig);config.headers=mergeHeaders(requestConfig),config.method=uppercase(config.method),config.paramSerializer=isString(config.paramSerializer)?$injector.get(config.paramSerializer):config.paramSerializer,$browser.$$incOutstandingRequestCount();var requestInterceptors=[],responseInterceptors=[],promise=$q.resolve(config);return forEach(reversedInterceptors,function(interceptor){(interceptor.request||interceptor.requestError)&&requestInterceptors.unshift(interceptor.request,interceptor.requestError),(interceptor.response||interceptor.responseError)&&responseInterceptors.push(interceptor.response,interceptor.responseError)}),promise=chainInterceptors(promise,requestInterceptors),promise=promise.then(serverRequest),promise=chainInterceptors(promise,responseInterceptors),promise=promise.finally(completeOutstandingRequest)}function createShortMethods(names){forEach(arguments,function(name){$http[name]=function(url,config){return $http(extend({},config||{},{method:name,url:url}))}})}function createShortMethodsWithData(name){forEach(arguments,function(name){$http[name]=function(url,data,config){return $http(extend({},config||{},{method:name,url:url,data:data}))}})}function sendReq(config,reqData){function createApplyHandlers(eventHandlers){if(eventHandlers){var applyHandlers={};return forEach(eventHandlers,function(eventHandler,key){applyHandlers[key]=function(event){function callEventHandler(){eventHandler(event)}useApplyAsync?$rootScope.$applyAsync(callEventHandler):$rootScope.$$phase?callEventHandler():$rootScope.$apply(callEventHandler)}}),applyHandlers}}function done(status,response,headersString,statusText){function resolveHttpPromise(){resolvePromise(response,status,headersString,statusText)}cache&&(isSuccess(status)?cache.put(url,[status,response,parseHeaders(headersString),statusText]):cache.remove(url)),useApplyAsync?$rootScope.$applyAsync(resolveHttpPromise):(resolveHttpPromise(),$rootScope.$$phase||$rootScope.$apply())}function resolvePromise(response,status,headers,statusText){status=status>=-1?status:0,(isSuccess(status)?deferred.resolve:deferred.reject)({data:response,status:status,headers:headersGetter(headers),config:config,statusText:statusText})}function resolvePromiseWithResult(result){resolvePromise(result.data,result.status,shallowCopy(result.headers()),result.statusText)}function removePendingReq(){var idx=$http.pendingRequests.indexOf(config);-1!==idx&&$http.pendingRequests.splice(idx,1)}var cache,cachedResp,deferred=$q.defer(),promise=deferred.promise,reqHeaders=config.headers,isJsonp="jsonp"===lowercase(config.method),url=config.url;if(isJsonp?url=$sce.getTrustedResourceUrl(url):isString(url)||(url=$sce.valueOf(url)),url=buildUrl(url,config.paramSerializer(config.params)),isJsonp&&(url=sanitizeJsonpCallbackParam(url,config.jsonpCallbackParam)),$http.pendingRequests.push(config),promise.then(removePendingReq,removePendingReq),!config.cache&&!defaults.cache||!1===config.cache||"GET"!==config.method&&"JSONP"!==config.method||(cache=isObject(config.cache)?config.cache:isObject(defaults.cache)?defaults.cache:defaultCache),cache&&(cachedResp=cache.get(url),isDefined(cachedResp)?isPromiseLike(cachedResp)?cachedResp.then(resolvePromiseWithResult,resolvePromiseWithResult):isArray(cachedResp)?resolvePromise(cachedResp[1],cachedResp[0],shallowCopy(cachedResp[2]),cachedResp[3]):resolvePromise(cachedResp,200,{},"OK"):cache.put(url,promise)),isUndefined(cachedResp)){var xsrfValue=urlIsSameOrigin(config.url)?$$cookieReader()[config.xsrfCookieName||defaults.xsrfCookieName]:void 0;xsrfValue&&(reqHeaders[config.xsrfHeaderName||defaults.xsrfHeaderName]=xsrfValue),$httpBackend(config.method,url,reqData,done,reqHeaders,config.timeout,config.withCredentials,config.responseType,createApplyHandlers(config.eventHandlers),createApplyHandlers(config.uploadEventHandlers))}return promise}function buildUrl(url,serializedParams){return serializedParams.length>0&&(url+=(-1===url.indexOf("?")?"?":"&")+serializedParams),url}function sanitizeJsonpCallbackParam(url,key){if(/[&?][^=]+=JSON_CALLBACK/.test(url))throw $httpMinErr("badjsonp",'Illegal use of JSON_CALLBACK in url, "{0}"',url);if(new RegExp("[&?]"+key+"=").test(url))throw $httpMinErr("badjsonp",'Illegal use of callback param, "{0}", in url, "{1}"',key,url);return url+=(-1===url.indexOf("?")?"?":"&")+key+"=JSON_CALLBACK"}var defaultCache=$cacheFactory("$http");defaults.paramSerializer=isString(defaults.paramSerializer)?$injector.get(defaults.paramSerializer):defaults.paramSerializer;var reversedInterceptors=[];return forEach(interceptorFactories,function(interceptorFactory){reversedInterceptors.unshift(isString(interceptorFactory)?$injector.get(interceptorFactory):$injector.invoke(interceptorFactory))}),$http.pendingRequests=[],createShortMethods("get","delete","head","jsonp"),createShortMethodsWithData("post","put","patch"),$http.defaults=defaults,$http}]}function $xhrFactoryProvider(){this.$get=function(){return function(){return new window.XMLHttpRequest}}}function $HttpBackendProvider(){this.$get=["$browser","$jsonpCallbacks","$document","$xhrFactory",function($browser,$jsonpCallbacks,$document,$xhrFactory){return createHttpBackend($browser,$xhrFactory,$browser.defer,$jsonpCallbacks,$document[0])}]}function createHttpBackend($browser,createXhr,$browserDefer,callbacks,rawDocument){function jsonpReq(url,callbackPath,done){url=url.replace("JSON_CALLBACK",callbackPath);var script=rawDocument.createElement("script"),callback=null;return script.type="text/javascript",script.src=url,script.async=!0,callback=function(event){script.removeEventListener("load",callback),script.removeEventListener("error",callback),rawDocument.body.removeChild(script),script=null;var status=-1,text="unknown";event&&("load"!==event.type||callbacks.wasCalled(callbackPath)||(event={type:"error"}),text=event.type,status="error"===event.type?404:200),done&&done(status,text)},script.addEventListener("load",callback),script.addEventListener("error",callback),rawDocument.body.appendChild(script),callback}return function(method,url,post,callback,headers,timeout,withCredentials,responseType,eventHandlers,uploadEventHandlers){function timeoutRequest(){jsonpDone&&jsonpDone(),xhr&&xhr.abort()}function completeRequest(callback,status,response,headersString,statusText){isDefined(timeoutId)&&$browserDefer.cancel(timeoutId),jsonpDone=xhr=null,callback(status,response,headersString,statusText)}if(url=url||$browser.url(),"jsonp"===lowercase(method))var callbackPath=callbacks.createCallback(url),jsonpDone=jsonpReq(url,callbackPath,function(status,text){var response=200===status&&callbacks.getResponse(callbackPath);completeRequest(callback,status,response,"",text),callbacks.removeCallback(callbackPath)});else{var xhr=createXhr(method,url);xhr.open(method,url,!0),forEach(headers,function(value,key){isDefined(value)&&xhr.setRequestHeader(key,value)}),xhr.onload=function(){var statusText=xhr.statusText||"",response="response"in xhr?xhr.response:xhr.responseText,status=1223===xhr.status?204:xhr.status;0===status&&(status=response?200:"file"===urlResolve(url).protocol?404:0),completeRequest(callback,status,response,xhr.getAllResponseHeaders(),statusText)};var requestError=function(){completeRequest(callback,-1,null,null,"")};if(xhr.onerror=requestError,xhr.onabort=requestError,xhr.ontimeout=requestError,forEach(eventHandlers,function(value,key){xhr.addEventListener(key,value)}),forEach(uploadEventHandlers,function(value,key){xhr.upload.addEventListener(key,value)}),withCredentials&&(xhr.withCredentials=!0),responseType)try{xhr.responseType=responseType}catch(e){if("json"!==responseType)throw e}xhr.send(isUndefined(post)?null:post)}if(timeout>0)var timeoutId=$browserDefer(timeoutRequest,timeout);else isPromiseLike(timeout)&&timeout.then(timeoutRequest)}}function $InterpolateProvider(){var startSymbol="{{",endSymbol="}}";this.startSymbol=function(value){return value?(startSymbol=value,this):startSymbol},this.endSymbol=function(value){return value?(endSymbol=value,this):endSymbol},this.$get=["$parse","$exceptionHandler","$sce",function($parse,$exceptionHandler,$sce){function escape(ch){return"\\\\\\"+ch}function unescapeText(text){return text.replace(escapedStartRegexp,startSymbol).replace(escapedEndRegexp,endSymbol)}function constantWatchDelegate(scope,listener,objectEquality,constantInterp){var unwatch=scope.$watch(function(scope){return unwatch(),constantInterp(scope)},listener,objectEquality);return unwatch}function $interpolate(text,mustHaveExpression,trustedContext,allOrNothing){function parseStringifyInterceptor(value){try{return value=getValue(value),allOrNothing&&!isDefined(value)?value:stringify(value)}catch(err){$exceptionHandler($interpolateMinErr.interr(text,err))}}if(!text.length||-1===text.indexOf(startSymbol)){var constantInterp;if(!mustHaveExpression){constantInterp=valueFn(unescapeText(text)),constantInterp.exp=text,constantInterp.expressions=[],constantInterp.$$watchDelegate=constantWatchDelegate}return constantInterp}allOrNothing=!!allOrNothing;for(var startIndex,endIndex,exp,index=0,expressions=[],parseFns=[],textLength=text.length,concat=[],expressionPositions=[];index<textLength;){if(-1===(startIndex=text.indexOf(startSymbol,index))||-1===(endIndex=text.indexOf(endSymbol,startIndex+startSymbolLength))){index!==textLength&&concat.push(unescapeText(text.substring(index)));break}index!==startIndex&&concat.push(unescapeText(text.substring(index,startIndex))),exp=text.substring(startIndex+startSymbolLength,endIndex),expressions.push(exp),parseFns.push($parse(exp,parseStringifyInterceptor)),index=endIndex+endSymbolLength,expressionPositions.push(concat.length),concat.push("")}if(trustedContext&&concat.length>1&&$interpolateMinErr.throwNoconcat(text),!mustHaveExpression||expressions.length){var compute=function(values){for(var i=0,ii=expressions.length;i<ii;i++){if(allOrNothing&&isUndefined(values[i]))return;concat[expressionPositions[i]]=values[i]}return concat.join("")},getValue=function(value){return trustedContext?$sce.getTrusted(trustedContext,value):$sce.valueOf(value)};return extend(function(context){var i=0,ii=expressions.length,values=new Array(ii);try{for(;i<ii;i++)values[i]=parseFns[i](context);return compute(values)}catch(err){$exceptionHandler($interpolateMinErr.interr(text,err))}},{exp:text,expressions:expressions,$$watchDelegate:function(scope,listener){var lastValue;return scope.$watchGroup(parseFns,function(values,oldValues){var currValue=compute(values);isFunction(listener)&&listener.call(this,currValue,values!==oldValues?lastValue:currValue,scope),lastValue=currValue})}})}}var startSymbolLength=startSymbol.length,endSymbolLength=endSymbol.length,escapedStartRegexp=new RegExp(startSymbol.replace(/./g,escape),"g"),escapedEndRegexp=new RegExp(endSymbol.replace(/./g,escape),"g");return $interpolate.startSymbol=function(){return startSymbol},$interpolate.endSymbol=function(){return endSymbol},$interpolate}]}function $IntervalProvider(){this.$get=["$rootScope","$window","$q","$$q","$browser",function($rootScope,$window,$q,$$q,$browser){function interval(fn,delay,count,invokeApply){function callback(){hasParams?fn.apply(null,args):fn(iteration)}var hasParams=arguments.length>4,args=hasParams?sliceArgs(arguments,4):[],setInterval=$window.setInterval,clearInterval=$window.clearInterval,iteration=0,skipApply=isDefined(invokeApply)&&!invokeApply,deferred=(skipApply?$$q:$q).defer(),promise=deferred.promise;return count=isDefined(count)?count:0,promise.$$intervalId=setInterval(function(){skipApply?$browser.defer(callback):$rootScope.$evalAsync(callback),deferred.notify(iteration++),count>0&&iteration>=count&&(deferred.resolve(iteration),clearInterval(promise.$$intervalId),delete intervals[promise.$$intervalId]),skipApply||$rootScope.$apply()},delay),intervals[promise.$$intervalId]=deferred,promise}var intervals={};return interval.cancel=function(promise){return!!(promise&&promise.$$intervalId in intervals)&&(intervals[promise.$$intervalId].promise.catch(noop),intervals[promise.$$intervalId].reject("canceled"),$window.clearInterval(promise.$$intervalId),delete intervals[promise.$$intervalId],!0)},interval}]}function encodePath(path){for(var segments=path.split("/"),i=segments.length;i--;)segments[i]=encodeUriSegment(segments[i]);return segments.join("/")}function parseAbsoluteUrl(absoluteUrl,locationObj){var parsedUrl=urlResolve(absoluteUrl);locationObj.$$protocol=parsedUrl.protocol,locationObj.$$host=parsedUrl.hostname,locationObj.$$port=toInt(parsedUrl.port)||DEFAULT_PORTS[parsedUrl.protocol]||null}function parseAppUrl(url,locationObj){if(DOUBLE_SLASH_REGEX.test(url))throw $locationMinErr("badpath",'Invalid url "{0}".',url);var prefixed="/"!==url.charAt(0);prefixed&&(url="/"+url);var match=urlResolve(url);locationObj.$$path=decodeURIComponent(prefixed&&"/"===match.pathname.charAt(0)?match.pathname.substring(1):match.pathname),locationObj.$$search=parseKeyValue(match.search),locationObj.$$hash=decodeURIComponent(match.hash),locationObj.$$path&&"/"!==locationObj.$$path.charAt(0)&&(locationObj.$$path="/"+locationObj.$$path)}function startsWith(str,search){return str.slice(0,search.length)===search}function stripBaseUrl(base,url){if(startsWith(url,base))return url.substr(base.length)}function stripHash(url){var index=url.indexOf("#");return-1===index?url:url.substr(0,index)}function trimEmptyHash(url){return url.replace(/(#.+)|#$/,"$1")}function stripFile(url){return url.substr(0,stripHash(url).lastIndexOf("/")+1)}function serverBase(url){return url.substring(0,url.indexOf("/",url.indexOf("//")+2))}function LocationHtml5Url(appBase,appBaseNoFile,basePrefix){this.$$html5=!0,basePrefix=basePrefix||"",parseAbsoluteUrl(appBase,this),this.$$parse=function(url){var pathUrl=stripBaseUrl(appBaseNoFile,url);if(!isString(pathUrl))throw $locationMinErr("ipthprfx",'Invalid url "{0}", missing path prefix "{1}".',url,appBaseNoFile);parseAppUrl(pathUrl,this),this.$$path||(this.$$path="/"),this.$$compose()},this.$$compose=function(){var search=toKeyValue(this.$$search),hash=this.$$hash?"#"+encodeUriSegment(this.$$hash):"";this.$$url=encodePath(this.$$path)+(search?"?"+search:"")+hash,this.$$absUrl=appBaseNoFile+this.$$url.substr(1),this.$$urlUpdatedByLocation=!0},this.$$parseLinkUrl=function(url,relHref){if(relHref&&"#"===relHref[0])return this.hash(relHref.slice(1)),!0;var appUrl,prevAppUrl,rewrittenUrl;return isDefined(appUrl=stripBaseUrl(appBase,url))?(prevAppUrl=appUrl,rewrittenUrl=basePrefix&&isDefined(appUrl=stripBaseUrl(basePrefix,appUrl))?appBaseNoFile+(stripBaseUrl("/",appUrl)||appUrl):appBase+prevAppUrl):isDefined(appUrl=stripBaseUrl(appBaseNoFile,url))?rewrittenUrl=appBaseNoFile+appUrl:appBaseNoFile===url+"/"&&(rewrittenUrl=appBaseNoFile),rewrittenUrl&&this.$$parse(rewrittenUrl),!!rewrittenUrl}}function LocationHashbangUrl(appBase,appBaseNoFile,hashPrefix){parseAbsoluteUrl(appBase,this),this.$$parse=function(url){function removeWindowsDriveName(path,url,base){var firstPathSegmentMatch,windowsFilePathExp=/^\/[A-Z]:(\/.*)/;return startsWith(url,base)&&(url=url.replace(base,"")),windowsFilePathExp.exec(url)?path:(firstPathSegmentMatch=windowsFilePathExp.exec(path),firstPathSegmentMatch?firstPathSegmentMatch[1]:path)}var withoutHashUrl,withoutBaseUrl=stripBaseUrl(appBase,url)||stripBaseUrl(appBaseNoFile,url);isUndefined(withoutBaseUrl)||"#"!==withoutBaseUrl.charAt(0)?this.$$html5?withoutHashUrl=withoutBaseUrl:(withoutHashUrl="",isUndefined(withoutBaseUrl)&&(appBase=url,this.replace())):(withoutHashUrl=stripBaseUrl(hashPrefix,withoutBaseUrl),isUndefined(withoutHashUrl)&&(withoutHashUrl=withoutBaseUrl)),parseAppUrl(withoutHashUrl,this),this.$$path=removeWindowsDriveName(this.$$path,withoutHashUrl,appBase),this.$$compose()},this.$$compose=function(){var search=toKeyValue(this.$$search),hash=this.$$hash?"#"+encodeUriSegment(this.$$hash):"";this.$$url=encodePath(this.$$path)+(search?"?"+search:"")+hash,this.$$absUrl=appBase+(this.$$url?hashPrefix+this.$$url:""),this.$$urlUpdatedByLocation=!0},this.$$parseLinkUrl=function(url,relHref){return stripHash(appBase)===stripHash(url)&&(this.$$parse(url),!0)}}function LocationHashbangInHtml5Url(appBase,appBaseNoFile,hashPrefix){this.$$html5=!0,LocationHashbangUrl.apply(this,arguments),this.$$parseLinkUrl=function(url,relHref){if(relHref&&"#"===relHref[0])return this.hash(relHref.slice(1)),!0;var rewrittenUrl,appUrl;return appBase===stripHash(url)?rewrittenUrl=url:(appUrl=stripBaseUrl(appBaseNoFile,url))?rewrittenUrl=appBase+hashPrefix+appUrl:appBaseNoFile===url+"/"&&(rewrittenUrl=appBaseNoFile),rewrittenUrl&&this.$$parse(rewrittenUrl),!!rewrittenUrl},this.$$compose=function(){var search=toKeyValue(this.$$search),hash=this.$$hash?"#"+encodeUriSegment(this.$$hash):"";this.$$url=encodePath(this.$$path)+(search?"?"+search:"")+hash,this.$$absUrl=appBase+hashPrefix+this.$$url,this.$$urlUpdatedByLocation=!0}}function locationGetter(property){return function(){return this[property]}}function locationGetterSetter(property,preprocess){return function(value){return isUndefined(value)?this[property]:(this[property]=preprocess(value),this.$$compose(),this)}}function $LocationProvider(){var hashPrefix="!",html5Mode={enabled:!1,requireBase:!0,rewriteLinks:!0};this.hashPrefix=function(prefix){return isDefined(prefix)?(hashPrefix=prefix,this):hashPrefix},this.html5Mode=function(mode){return isBoolean(mode)?(html5Mode.enabled=mode,this):isObject(mode)?(isBoolean(mode.enabled)&&(html5Mode.enabled=mode.enabled),isBoolean(mode.requireBase)&&(html5Mode.requireBase=mode.requireBase),(isBoolean(mode.rewriteLinks)||isString(mode.rewriteLinks))&&(html5Mode.rewriteLinks=mode.rewriteLinks),this):html5Mode},this.$get=["$rootScope","$browser","$sniffer","$rootElement","$window",function($rootScope,$browser,$sniffer,$rootElement,$window){function setBrowserUrlWithFallback(url,replace,state){var oldUrl=$location.url(),oldState=$location.$$state;try{$browser.url(url,replace,state),$location.$$state=$browser.state()}catch(e){throw $location.url(oldUrl),$location.$$state=oldState,e}}function afterLocationChange(oldUrl,oldState){$rootScope.$broadcast("$locationChangeSuccess",$location.absUrl(),oldUrl,$location.$$state,oldState)}var $location,LocationMode,appBase,baseHref=$browser.baseHref(),initialUrl=$browser.url();if(html5Mode.enabled){if(!baseHref&&html5Mode.requireBase)throw $locationMinErr("nobase","$location in HTML5 mode requires a <base> tag to be present!");appBase=serverBase(initialUrl)+(baseHref||"/"),LocationMode=$sniffer.history?LocationHtml5Url:LocationHashbangInHtml5Url}else appBase=stripHash(initialUrl),LocationMode=LocationHashbangUrl;var appBaseNoFile=stripFile(appBase);$location=new LocationMode(appBase,appBaseNoFile,"#"+hashPrefix),$location.$$parseLinkUrl(initialUrl,initialUrl),$location.$$state=$browser.state();var IGNORE_URI_REGEXP=/^\s*(javascript|mailto):/i;$rootElement.on("click",function(event){var rewriteLinks=html5Mode.rewriteLinks;if(rewriteLinks&&!event.ctrlKey&&!event.metaKey&&!event.shiftKey&&2!==event.which&&2!==event.button){for(var elm=jqLite(event.target);"a"!==nodeName_(elm[0]);)if(elm[0]===$rootElement[0]||!(elm=elm.parent())[0])return;if(!isString(rewriteLinks)||!isUndefined(elm.attr(rewriteLinks))){var absHref=elm.prop("href"),relHref=elm.attr("href")||elm.attr("xlink:href");isObject(absHref)&&"[object SVGAnimatedString]"===absHref.toString()&&(absHref=urlResolve(absHref.animVal).href),IGNORE_URI_REGEXP.test(absHref)||!absHref||elm.attr("target")||event.isDefaultPrevented()||$location.$$parseLinkUrl(absHref,relHref)&&(event.preventDefault(),$location.absUrl()!==$browser.url()&&($rootScope.$apply(),$window.angular["ff-684208-preventDefault"]=!0))}}}),trimEmptyHash($location.absUrl())!==trimEmptyHash(initialUrl)&&$browser.url($location.absUrl(),!0);var initializing=!0;return $browser.onUrlChange(function(newUrl,newState){if(!startsWith(newUrl,appBaseNoFile))return void($window.location.href=newUrl);$rootScope.$evalAsync(function(){var defaultPrevented,oldUrl=$location.absUrl(),oldState=$location.$$state;newUrl=trimEmptyHash(newUrl),$location.$$parse(newUrl),$location.$$state=newState,defaultPrevented=$rootScope.$broadcast("$locationChangeStart",newUrl,oldUrl,newState,oldState).defaultPrevented,$location.absUrl()===newUrl&&(defaultPrevented?($location.$$parse(oldUrl),$location.$$state=oldState,setBrowserUrlWithFallback(oldUrl,!1,oldState)):(initializing=!1,afterLocationChange(oldUrl,oldState)))}),$rootScope.$$phase||$rootScope.$digest()}),$rootScope.$watch(function(){if(initializing||$location.$$urlUpdatedByLocation){$location.$$urlUpdatedByLocation=!1;var oldUrl=trimEmptyHash($browser.url()),newUrl=trimEmptyHash($location.absUrl()),oldState=$browser.state(),currentReplace=$location.$$replace,urlOrStateChanged=oldUrl!==newUrl||$location.$$html5&&$sniffer.history&&oldState!==$location.$$state;(initializing||urlOrStateChanged)&&(initializing=!1,$rootScope.$evalAsync(function(){var newUrl=$location.absUrl(),defaultPrevented=$rootScope.$broadcast("$locationChangeStart",newUrl,oldUrl,$location.$$state,oldState).defaultPrevented;$location.absUrl()===newUrl&&(defaultPrevented?($location.$$parse(oldUrl),$location.$$state=oldState):(urlOrStateChanged&&setBrowserUrlWithFallback(newUrl,currentReplace,oldState===$location.$$state?null:$location.$$state),afterLocationChange(oldUrl,oldState)))}))}$location.$$replace=!1}),$location}]}function $LogProvider(){var debug=!0,self=this;this.debugEnabled=function(flag){return isDefined(flag)?(debug=flag,this):debug},this.$get=["$window",function($window){function formatError(arg){return arg instanceof Error&&(arg.stack&&formatStackTrace?arg=arg.message&&-1===arg.stack.indexOf(arg.message)?"Error: "+arg.message+"\n"+arg.stack:arg.stack:arg.sourceURL&&(arg=arg.message+"\n"+arg.sourceURL+":"+arg.line)),arg}function consoleLog(type){var console=$window.console||{},logFn=console[type]||console.log||noop,hasApply=!1;try{hasApply=!!logFn.apply}catch(e){}return hasApply?function(){var args=[];return forEach(arguments,function(arg){args.push(formatError(arg))}),logFn.apply(console,args)}:function(arg1,arg2){logFn(arg1,null==arg2?"":arg2)}}var formatStackTrace=msie||/\bEdge\//.test($window.navigator&&$window.navigator.userAgent);return{log:consoleLog("log"),info:consoleLog("info"),warn:consoleLog("warn"),error:consoleLog("error"),debug:function(){var fn=consoleLog("debug");return function(){debug&&fn.apply(self,arguments)}}()}}]}function getStringValue(name){return name+""}function ifDefined(v,d){return void 0!==v?v:d}function plusFn(l,r){return void 0===l?r:void 0===r?l:l+r}function isStateless($filter,filterName){return!$filter(filterName).$stateful}function findConstantAndWatchExpressions(ast,$filter){var allConstants,argsToWatch,isStatelessFilter;switch(ast.type){case AST.Program:allConstants=!0,forEach(ast.body,function(expr){findConstantAndWatchExpressions(expr.expression,$filter),allConstants=allConstants&&expr.expression.constant}),ast.constant=allConstants;break;case AST.Literal:ast.constant=!0,ast.toWatch=[];break;case AST.UnaryExpression:findConstantAndWatchExpressions(ast.argument,$filter),ast.constant=ast.argument.constant,ast.toWatch=ast.argument.toWatch;break;case AST.BinaryExpression:findConstantAndWatchExpressions(ast.left,$filter),findConstantAndWatchExpressions(ast.right,$filter),ast.constant=ast.left.constant&&ast.right.constant,ast.toWatch=ast.left.toWatch.concat(ast.right.toWatch);break;case AST.LogicalExpression:findConstantAndWatchExpressions(ast.left,$filter),findConstantAndWatchExpressions(ast.right,$filter),ast.constant=ast.left.constant&&ast.right.constant,ast.toWatch=ast.constant?[]:[ast];break;case AST.ConditionalExpression:findConstantAndWatchExpressions(ast.test,$filter),findConstantAndWatchExpressions(ast.alternate,$filter),findConstantAndWatchExpressions(ast.consequent,$filter),ast.constant=ast.test.constant&&ast.alternate.constant&&ast.consequent.constant,ast.toWatch=ast.constant?[]:[ast];break;case AST.Identifier:ast.constant=!1,ast.toWatch=[ast];break;case AST.MemberExpression:findConstantAndWatchExpressions(ast.object,$filter),ast.computed&&findConstantAndWatchExpressions(ast.property,$filter),ast.constant=ast.object.constant&&(!ast.computed||ast.property.constant),ast.toWatch=[ast];break;case AST.CallExpression:isStatelessFilter=!!ast.filter&&isStateless($filter,ast.callee.name),allConstants=isStatelessFilter,argsToWatch=[],forEach(ast.arguments,function(expr){findConstantAndWatchExpressions(expr,$filter),allConstants=allConstants&&expr.constant,expr.constant||argsToWatch.push.apply(argsToWatch,expr.toWatch)}),ast.constant=allConstants,ast.toWatch=isStatelessFilter?argsToWatch:[ast];break;case AST.AssignmentExpression:findConstantAndWatchExpressions(ast.left,$filter),findConstantAndWatchExpressions(ast.right,$filter),
ast.constant=ast.left.constant&&ast.right.constant,ast.toWatch=[ast];break;case AST.ArrayExpression:allConstants=!0,argsToWatch=[],forEach(ast.elements,function(expr){findConstantAndWatchExpressions(expr,$filter),allConstants=allConstants&&expr.constant,expr.constant||argsToWatch.push.apply(argsToWatch,expr.toWatch)}),ast.constant=allConstants,ast.toWatch=argsToWatch;break;case AST.ObjectExpression:allConstants=!0,argsToWatch=[],forEach(ast.properties,function(property){findConstantAndWatchExpressions(property.value,$filter),allConstants=allConstants&&property.value.constant&&!property.computed,property.value.constant||argsToWatch.push.apply(argsToWatch,property.value.toWatch),property.computed&&(findConstantAndWatchExpressions(property.key,$filter),property.key.constant||argsToWatch.push.apply(argsToWatch,property.key.toWatch))}),ast.constant=allConstants,ast.toWatch=argsToWatch;break;case AST.ThisExpression:case AST.LocalsExpression:ast.constant=!1,ast.toWatch=[]}}function getInputs(body){if(1===body.length){var lastExpression=body[0].expression,candidate=lastExpression.toWatch;return 1!==candidate.length?candidate:candidate[0]!==lastExpression?candidate:void 0}}function isAssignable(ast){return ast.type===AST.Identifier||ast.type===AST.MemberExpression}function assignableAST(ast){if(1===ast.body.length&&isAssignable(ast.body[0].expression))return{type:AST.AssignmentExpression,left:ast.body[0].expression,right:{type:AST.NGValueParameter},operator:"="}}function isLiteral(ast){return 0===ast.body.length||1===ast.body.length&&(ast.body[0].expression.type===AST.Literal||ast.body[0].expression.type===AST.ArrayExpression||ast.body[0].expression.type===AST.ObjectExpression)}function isConstant(ast){return ast.constant}function ASTCompiler($filter){this.$filter=$filter}function ASTInterpreter($filter){this.$filter=$filter}function Parser(lexer,$filter,options){this.ast=new AST(lexer,options),this.astCompiler=options.csp?new ASTInterpreter($filter):new ASTCompiler($filter)}function getValueOf(value){return isFunction(value.valueOf)?value.valueOf():objectValueOf.call(value)}function $ParseProvider(){var identStart,identContinue,cache=createMap(),literals={true:!0,false:!1,null:null,undefined:void 0};this.addLiteral=function(literalName,literalValue){literals[literalName]=literalValue},this.setIdentifierFns=function(identifierStart,identifierContinue){return identStart=identifierStart,identContinue=identifierContinue,this},this.$get=["$filter",function($filter){function $parse(exp,interceptorFn){var parsedExpression,oneTime,cacheKey;switch(typeof exp){case"string":if(exp=exp.trim(),cacheKey=exp,!(parsedExpression=cache[cacheKey])){":"===exp.charAt(0)&&":"===exp.charAt(1)&&(oneTime=!0,exp=exp.substring(2));parsedExpression=new Parser(new Lexer($parseOptions),$filter,$parseOptions).parse(exp),parsedExpression.constant?parsedExpression.$$watchDelegate=constantWatchDelegate:oneTime?(parsedExpression.oneTime=!0,parsedExpression.$$watchDelegate=oneTimeWatchDelegate):parsedExpression.inputs&&(parsedExpression.$$watchDelegate=inputsWatchDelegate),cache[cacheKey]=parsedExpression}return addInterceptor(parsedExpression,interceptorFn);case"function":return addInterceptor(exp,interceptorFn);default:return addInterceptor(noop,interceptorFn)}}function expressionInputDirtyCheck(newValue,oldValueOfValue,compareObjectIdentity){return null==newValue||null==oldValueOfValue?newValue===oldValueOfValue:!("object"==typeof newValue&&"object"==typeof(newValue=getValueOf(newValue))&&!compareObjectIdentity)&&(newValue===oldValueOfValue||newValue!==newValue&&oldValueOfValue!==oldValueOfValue)}function inputsWatchDelegate(scope,listener,objectEquality,parsedExpression,prettyPrintExpression){var lastResult,inputExpressions=parsedExpression.inputs;if(1===inputExpressions.length){var oldInputValueOf=expressionInputDirtyCheck;return inputExpressions=inputExpressions[0],scope.$watch(function(scope){var newInputValue=inputExpressions(scope);return expressionInputDirtyCheck(newInputValue,oldInputValueOf,parsedExpression.literal)||(lastResult=parsedExpression(scope,void 0,void 0,[newInputValue]),oldInputValueOf=newInputValue&&getValueOf(newInputValue)),lastResult},listener,objectEquality,prettyPrintExpression)}for(var oldInputValueOfValues=[],oldInputValues=[],i=0,ii=inputExpressions.length;i<ii;i++)oldInputValueOfValues[i]=expressionInputDirtyCheck,oldInputValues[i]=null;return scope.$watch(function(scope){for(var changed=!1,i=0,ii=inputExpressions.length;i<ii;i++){var newInputValue=inputExpressions[i](scope);(changed||(changed=!expressionInputDirtyCheck(newInputValue,oldInputValueOfValues[i],parsedExpression.literal)))&&(oldInputValues[i]=newInputValue,oldInputValueOfValues[i]=newInputValue&&getValueOf(newInputValue))}return changed&&(lastResult=parsedExpression(scope,void 0,void 0,oldInputValues)),lastResult},listener,objectEquality,prettyPrintExpression)}function oneTimeWatchDelegate(scope,listener,objectEquality,parsedExpression,prettyPrintExpression){function oneTimeWatch(scope){return parsedExpression(scope)}function oneTimeListener(value,old,scope){lastValue=value,isFunction(listener)&&listener(value,old,scope),isDone(value)&&scope.$$postDigest(function(){isDone(lastValue)&&unwatch()})}var unwatch,lastValue,isDone=parsedExpression.literal?isAllDefined:isDefined;return unwatch=parsedExpression.inputs?inputsWatchDelegate(scope,oneTimeListener,objectEquality,parsedExpression,prettyPrintExpression):scope.$watch(oneTimeWatch,oneTimeListener,objectEquality)}function isAllDefined(value){var allDefined=!0;return forEach(value,function(val){isDefined(val)||(allDefined=!1)}),allDefined}function constantWatchDelegate(scope,listener,objectEquality,parsedExpression){var unwatch=scope.$watch(function(scope){return unwatch(),parsedExpression(scope)},listener,objectEquality);return unwatch}function addInterceptor(parsedExpression,interceptorFn){function regularInterceptedExpression(scope,locals,assign,inputs){var value=useInputs&&inputs?inputs[0]:parsedExpression(scope,locals,assign,inputs);return interceptorFn(value,scope,locals)}function oneTimeInterceptedExpression(scope,locals,assign,inputs){var value=useInputs&&inputs?inputs[0]:parsedExpression(scope,locals,assign,inputs),result=interceptorFn(value,scope,locals);return isDone(value)?result:value}if(!interceptorFn)return parsedExpression;var watchDelegate=parsedExpression.$$watchDelegate,useInputs=!1,isDone=parsedExpression.literal?isAllDefined:isDefined,fn=parsedExpression.oneTime?oneTimeInterceptedExpression:regularInterceptedExpression;return fn.literal=parsedExpression.literal,fn.oneTime=parsedExpression.oneTime,useInputs=!parsedExpression.inputs,watchDelegate&&watchDelegate!==inputsWatchDelegate?(fn.$$watchDelegate=watchDelegate,fn.inputs=parsedExpression.inputs):interceptorFn.$stateful||(fn.$$watchDelegate=inputsWatchDelegate,fn.inputs=parsedExpression.inputs?parsedExpression.inputs:[parsedExpression]),fn}var noUnsafeEval=csp().noUnsafeEval,$parseOptions={csp:noUnsafeEval,literals:copy(literals),isIdentifierStart:isFunction(identStart)&&identStart,isIdentifierContinue:isFunction(identContinue)&&identContinue};return $parse}]}function $QProvider(){var errorOnUnhandledRejections=!0;this.$get=["$rootScope","$exceptionHandler",function($rootScope,$exceptionHandler){return qFactory(function(callback){$rootScope.$evalAsync(callback)},$exceptionHandler,errorOnUnhandledRejections)}],this.errorOnUnhandledRejections=function(value){return isDefined(value)?(errorOnUnhandledRejections=value,this):errorOnUnhandledRejections}}function $$QProvider(){var errorOnUnhandledRejections=!0;this.$get=["$browser","$exceptionHandler",function($browser,$exceptionHandler){return qFactory(function(callback){$browser.defer(callback)},$exceptionHandler,errorOnUnhandledRejections)}],this.errorOnUnhandledRejections=function(value){return isDefined(value)?(errorOnUnhandledRejections=value,this):errorOnUnhandledRejections}}function qFactory(nextTick,exceptionHandler,errorOnUnhandledRejections){function defer(){return new Deferred}function Deferred(){var promise=this.promise=new Promise;this.resolve=function(val){resolvePromise(promise,val)},this.reject=function(reason){rejectPromise(promise,reason)},this.notify=function(progress){notifyPromise(promise,progress)}}function Promise(){this.$$state={status:0}}function processQueue(state){var fn,promise,pending;pending=state.pending,state.processScheduled=!1,state.pending=void 0;try{for(var i=0,ii=pending.length;i<ii;++i){state.pur=!0,promise=pending[i][0],fn=pending[i][state.status];try{isFunction(fn)?resolvePromise(promise,fn(state.value)):1===state.status?resolvePromise(promise,state.value):rejectPromise(promise,state.value)}catch(e){rejectPromise(promise,e)}}}finally{--queueSize,errorOnUnhandledRejections&&0===queueSize&&nextTick(processChecks)}}function processChecks(){for(;!queueSize&&checkQueue.length;){var toCheck=checkQueue.shift();if(!toCheck.pur){toCheck.pur=!0;var errorMessage="Possibly unhandled rejection: "+toDebugString(toCheck.value);toCheck.value instanceof Error?exceptionHandler(toCheck.value,errorMessage):exceptionHandler(errorMessage)}}}function scheduleProcessQueue(state){!errorOnUnhandledRejections||state.pending||2!==state.status||state.pur||(0===queueSize&&0===checkQueue.length&&nextTick(processChecks),checkQueue.push(state)),!state.processScheduled&&state.pending&&(state.processScheduled=!0,++queueSize,nextTick(function(){processQueue(state)}))}function resolvePromise(promise,val){promise.$$state.status||(val===promise?$$reject(promise,$qMinErr("qcycle","Expected promise to be resolved with value other than itself '{0}'",val)):$$resolve(promise,val))}function $$resolve(promise,val){function doResolve(val){done||(done=!0,$$resolve(promise,val))}function doReject(val){done||(done=!0,$$reject(promise,val))}function doNotify(progress){notifyPromise(promise,progress)}var then,done=!1;try{(isObject(val)||isFunction(val))&&(then=val.then),isFunction(then)?(promise.$$state.status=-1,then.call(val,doResolve,doReject,doNotify)):(promise.$$state.value=val,promise.$$state.status=1,scheduleProcessQueue(promise.$$state))}catch(e){doReject(e)}}function rejectPromise(promise,reason){promise.$$state.status||$$reject(promise,reason)}function $$reject(promise,reason){promise.$$state.value=reason,promise.$$state.status=2,scheduleProcessQueue(promise.$$state)}function notifyPromise(promise,progress){var callbacks=promise.$$state.pending;promise.$$state.status<=0&&callbacks&&callbacks.length&&nextTick(function(){for(var callback,result,i=0,ii=callbacks.length;i<ii;i++){result=callbacks[i][0],callback=callbacks[i][3];try{notifyPromise(result,isFunction(callback)?callback(progress):progress)}catch(e){exceptionHandler(e)}}})}function reject(reason){var result=new Promise;return rejectPromise(result,reason),result}function handleCallback(value,resolver,callback){var callbackOutput=null;try{isFunction(callback)&&(callbackOutput=callback())}catch(e){return reject(e)}return isPromiseLike(callbackOutput)?callbackOutput.then(function(){return resolver(value)},reject):resolver(value)}function when(value,callback,errback,progressBack){var result=new Promise;return resolvePromise(result,value),result.then(callback,errback,progressBack)}function all(promises){var result=new Promise,counter=0,results=isArray(promises)?[]:{};return forEach(promises,function(promise,key){counter++,when(promise).then(function(value){results[key]=value,--counter||resolvePromise(result,results)},function(reason){rejectPromise(result,reason)})}),0===counter&&resolvePromise(result,results),result}function race(promises){var deferred=defer();return forEach(promises,function(promise){when(promise).then(deferred.resolve,deferred.reject)}),deferred.promise}function $Q(resolver){function resolveFn(value){resolvePromise(promise,value)}function rejectFn(reason){rejectPromise(promise,reason)}if(!isFunction(resolver))throw $qMinErr("norslvr","Expected resolverFn, got '{0}'",resolver);var promise=new Promise;return resolver(resolveFn,rejectFn),promise}var $qMinErr=minErr("$q",TypeError),queueSize=0,checkQueue=[];extend(Promise.prototype,{then:function(onFulfilled,onRejected,progressBack){if(isUndefined(onFulfilled)&&isUndefined(onRejected)&&isUndefined(progressBack))return this;var result=new Promise;return this.$$state.pending=this.$$state.pending||[],this.$$state.pending.push([result,onFulfilled,onRejected,progressBack]),this.$$state.status>0&&scheduleProcessQueue(this.$$state),result},catch:function(callback){return this.then(null,callback)},finally:function(callback,progressBack){return this.then(function(value){return handleCallback(value,resolve,callback)},function(error){return handleCallback(error,reject,callback)},progressBack)}});var resolve=when;return $Q.prototype=Promise.prototype,$Q.defer=defer,$Q.reject=reject,$Q.when=when,$Q.resolve=resolve,$Q.all=all,$Q.race=race,$Q}function $$RAFProvider(){this.$get=["$window","$timeout",function($window,$timeout){var requestAnimationFrame=$window.requestAnimationFrame||$window.webkitRequestAnimationFrame,cancelAnimationFrame=$window.cancelAnimationFrame||$window.webkitCancelAnimationFrame||$window.webkitCancelRequestAnimationFrame,rafSupported=!!requestAnimationFrame,raf=rafSupported?function(fn){var id=requestAnimationFrame(fn);return function(){cancelAnimationFrame(id)}}:function(fn){var timer=$timeout(fn,16.66,!1);return function(){$timeout.cancel(timer)}};return raf.supported=rafSupported,raf}]}function $RootScopeProvider(){function createChildScopeClass(parent){function ChildScope(){this.$$watchers=this.$$nextSibling=this.$$childHead=this.$$childTail=null,this.$$listeners={},this.$$listenerCount={},this.$$watchersCount=0,this.$id=nextUid(),this.$$ChildScope=null}return ChildScope.prototype=parent,ChildScope}var TTL=10,$rootScopeMinErr=minErr("$rootScope"),lastDirtyWatch=null,applyAsyncId=null;this.digestTtl=function(value){return arguments.length&&(TTL=value),TTL},this.$get=["$exceptionHandler","$parse","$browser",function($exceptionHandler,$parse,$browser){function destroyChildScope($event){$event.currentScope.$$destroyed=!0}function cleanUpScope($scope){9===msie&&($scope.$$childHead&&cleanUpScope($scope.$$childHead),$scope.$$nextSibling&&cleanUpScope($scope.$$nextSibling)),$scope.$parent=$scope.$$nextSibling=$scope.$$prevSibling=$scope.$$childHead=$scope.$$childTail=$scope.$root=$scope.$$watchers=null}function Scope(){this.$id=nextUid(),this.$$phase=this.$parent=this.$$watchers=this.$$nextSibling=this.$$prevSibling=this.$$childHead=this.$$childTail=null,this.$root=this,this.$$destroyed=!1,this.$$listeners={},this.$$listenerCount={},this.$$watchersCount=0,this.$$isolateBindings=null}function beginPhase(phase){if($rootScope.$$phase)throw $rootScopeMinErr("inprog","{0} already in progress",$rootScope.$$phase);$rootScope.$$phase=phase}function clearPhase(){$rootScope.$$phase=null}function incrementWatchersCount(current,count){do{current.$$watchersCount+=count}while(current=current.$parent)}function decrementListenerCount(current,count,name){do{current.$$listenerCount[name]-=count,0===current.$$listenerCount[name]&&delete current.$$listenerCount[name]}while(current=current.$parent)}function initWatchVal(){}function flushApplyAsync(){for(;applyAsyncQueue.length;)try{applyAsyncQueue.shift()()}catch(e){$exceptionHandler(e)}applyAsyncId=null}function scheduleApplyAsync(){null===applyAsyncId&&(applyAsyncId=$browser.defer(function(){$rootScope.$apply(flushApplyAsync)}))}Scope.prototype={constructor:Scope,$new:function(isolate,parent){var child;return parent=parent||this,isolate?(child=new Scope,child.$root=this.$root):(this.$$ChildScope||(this.$$ChildScope=createChildScopeClass(this)),child=new this.$$ChildScope),child.$parent=parent,child.$$prevSibling=parent.$$childTail,parent.$$childHead?(parent.$$childTail.$$nextSibling=child,parent.$$childTail=child):parent.$$childHead=parent.$$childTail=child,(isolate||parent!==this)&&child.$on("$destroy",destroyChildScope),child},$watch:function(watchExp,listener,objectEquality,prettyPrintExpression){var get=$parse(watchExp);if(get.$$watchDelegate)return get.$$watchDelegate(this,listener,objectEquality,get,watchExp);var scope=this,array=scope.$$watchers,watcher={fn:listener,last:initWatchVal,get:get,exp:prettyPrintExpression||watchExp,eq:!!objectEquality};return lastDirtyWatch=null,isFunction(listener)||(watcher.fn=noop),array||(array=scope.$$watchers=[],array.$$digestWatchIndex=-1),array.unshift(watcher),array.$$digestWatchIndex++,incrementWatchersCount(this,1),function(){var index=arrayRemove(array,watcher);index>=0&&(incrementWatchersCount(scope,-1),index<array.$$digestWatchIndex&&array.$$digestWatchIndex--),lastDirtyWatch=null}},$watchGroup:function(watchExpressions,listener){function watchGroupAction(){changeReactionScheduled=!1,firstRun?(firstRun=!1,listener(newValues,newValues,self)):listener(newValues,oldValues,self)}var oldValues=new Array(watchExpressions.length),newValues=new Array(watchExpressions.length),deregisterFns=[],self=this,changeReactionScheduled=!1,firstRun=!0;if(!watchExpressions.length){var shouldCall=!0;return self.$evalAsync(function(){shouldCall&&listener(newValues,newValues,self)}),function(){shouldCall=!1}}return 1===watchExpressions.length?this.$watch(watchExpressions[0],function(value,oldValue,scope){newValues[0]=value,oldValues[0]=oldValue,listener(newValues,value===oldValue?newValues:oldValues,scope)}):(forEach(watchExpressions,function(expr,i){var unwatchFn=self.$watch(expr,function(value,oldValue){newValues[i]=value,oldValues[i]=oldValue,changeReactionScheduled||(changeReactionScheduled=!0,self.$evalAsync(watchGroupAction))});deregisterFns.push(unwatchFn)}),function(){for(;deregisterFns.length;)deregisterFns.shift()()})},$watchCollection:function(obj,listener){function $watchCollectionInterceptor(_value){newValue=_value;var newLength,key,newItem,oldItem;if(!isUndefined(newValue)){if(isObject(newValue))if(isArrayLike(newValue)){oldValue!==internalArray&&(oldValue=internalArray,oldLength=oldValue.length=0,changeDetected++),newLength=newValue.length,oldLength!==newLength&&(changeDetected++,oldValue.length=oldLength=newLength);for(var i=0;i<newLength;i++)oldItem=oldValue[i],newItem=newValue[i],oldItem!==oldItem&&newItem!==newItem||oldItem===newItem||(changeDetected++,oldValue[i]=newItem)}else{oldValue!==internalObject&&(oldValue=internalObject={},oldLength=0,changeDetected++),newLength=0;for(key in newValue)hasOwnProperty.call(newValue,key)&&(newLength++,newItem=newValue[key],oldItem=oldValue[key],key in oldValue?oldItem!==oldItem&&newItem!==newItem||oldItem===newItem||(changeDetected++,oldValue[key]=newItem):(oldLength++,oldValue[key]=newItem,changeDetected++));if(oldLength>newLength){changeDetected++;for(key in oldValue)hasOwnProperty.call(newValue,key)||(oldLength--,delete oldValue[key])}}else oldValue!==newValue&&(oldValue=newValue,changeDetected++);return changeDetected}}function $watchCollectionAction(){if(initRun?(initRun=!1,listener(newValue,newValue,self)):listener(newValue,veryOldValue,self),trackVeryOldValue)if(isObject(newValue))if(isArrayLike(newValue)){veryOldValue=new Array(newValue.length);for(var i=0;i<newValue.length;i++)veryOldValue[i]=newValue[i]}else{veryOldValue={};for(var key in newValue)hasOwnProperty.call(newValue,key)&&(veryOldValue[key]=newValue[key])}else veryOldValue=newValue}$watchCollectionInterceptor.$stateful=!0;var newValue,oldValue,veryOldValue,self=this,trackVeryOldValue=listener.length>1,changeDetected=0,changeDetector=$parse(obj,$watchCollectionInterceptor),internalArray=[],internalObject={},initRun=!0,oldLength=0;return this.$watch(changeDetector,$watchCollectionAction)},$digest:function(){var watch,value,last,fn,get,watchers,dirty,next,current,logIdx,asyncTask,ttl=TTL,target=this,watchLog=[];beginPhase("$digest"),$browser.$$checkUrlChange(),this===$rootScope&&null!==applyAsyncId&&($browser.defer.cancel(applyAsyncId),flushApplyAsync()),lastDirtyWatch=null;do{dirty=!1,current=target;for(var asyncQueuePosition=0;asyncQueuePosition<asyncQueue.length;asyncQueuePosition++){try{asyncTask=asyncQueue[asyncQueuePosition],fn=asyncTask.fn,fn(asyncTask.scope,asyncTask.locals)}catch(e){$exceptionHandler(e)}lastDirtyWatch=null}asyncQueue.length=0;traverseScopesLoop:do{if(watchers=current.$$watchers)for(watchers.$$digestWatchIndex=watchers.length;watchers.$$digestWatchIndex--;)try{if(watch=watchers[watchers.$$digestWatchIndex])if(get=watch.get,(value=get(current))===(last=watch.last)||(watch.eq?equals(value,last):isNumberNaN(value)&&isNumberNaN(last))){if(watch===lastDirtyWatch){dirty=!1;break traverseScopesLoop}}else dirty=!0,lastDirtyWatch=watch,watch.last=watch.eq?copy(value,null):value,fn=watch.fn,fn(value,last===initWatchVal?value:last,current),ttl<5&&(logIdx=4-ttl,watchLog[logIdx]||(watchLog[logIdx]=[]),watchLog[logIdx].push({msg:isFunction(watch.exp)?"fn: "+(watch.exp.name||watch.exp.toString()):watch.exp,newVal:value,oldVal:last}))}catch(e){$exceptionHandler(e)}if(!(next=current.$$watchersCount&&current.$$childHead||current!==target&&current.$$nextSibling))for(;current!==target&&!(next=current.$$nextSibling);)current=current.$parent}while(current=next);if((dirty||asyncQueue.length)&&!ttl--)throw clearPhase(),$rootScopeMinErr("infdig","{0} $digest() iterations reached. Aborting!\nWatchers fired in the last 5 iterations: {1}",TTL,watchLog)}while(dirty||asyncQueue.length);for(clearPhase();postDigestQueuePosition<postDigestQueue.length;)try{postDigestQueue[postDigestQueuePosition++]()}catch(e){$exceptionHandler(e)}postDigestQueue.length=postDigestQueuePosition=0,$browser.$$checkUrlChange()},$destroy:function(){if(!this.$$destroyed){var parent=this.$parent;this.$broadcast("$destroy"),this.$$destroyed=!0,this===$rootScope&&$browser.$$applicationDestroyed(),incrementWatchersCount(this,-this.$$watchersCount);for(var eventName in this.$$listenerCount)decrementListenerCount(this,this.$$listenerCount[eventName],eventName);parent&&parent.$$childHead===this&&(parent.$$childHead=this.$$nextSibling),parent&&parent.$$childTail===this&&(parent.$$childTail=this.$$prevSibling),this.$$prevSibling&&(this.$$prevSibling.$$nextSibling=this.$$nextSibling),this.$$nextSibling&&(this.$$nextSibling.$$prevSibling=this.$$prevSibling),this.$destroy=this.$digest=this.$apply=this.$evalAsync=this.$applyAsync=noop,this.$on=this.$watch=this.$watchGroup=function(){return noop},this.$$listeners={},this.$$nextSibling=null,cleanUpScope(this)}},$eval:function(expr,locals){return $parse(expr)(this,locals)},$evalAsync:function(expr,locals){$rootScope.$$phase||asyncQueue.length||$browser.defer(function(){asyncQueue.length&&$rootScope.$digest()}),asyncQueue.push({scope:this,fn:$parse(expr),locals:locals})},$$postDigest:function(fn){postDigestQueue.push(fn)},$apply:function(expr){try{beginPhase("$apply");try{return this.$eval(expr)}finally{clearPhase()}}catch(e){$exceptionHandler(e)}finally{try{$rootScope.$digest()}catch(e){throw $exceptionHandler(e),e}}},$applyAsync:function(expr){function $applyAsyncExpression(){scope.$eval(expr)}var scope=this;expr&&applyAsyncQueue.push($applyAsyncExpression),expr=$parse(expr),scheduleApplyAsync()},$on:function(name,listener){var namedListeners=this.$$listeners[name];namedListeners||(this.$$listeners[name]=namedListeners=[]),namedListeners.push(listener);var current=this;do{current.$$listenerCount[name]||(current.$$listenerCount[name]=0),current.$$listenerCount[name]++}while(current=current.$parent);var self=this;return function(){var indexOfListener=namedListeners.indexOf(listener);-1!==indexOfListener&&(namedListeners[indexOfListener]=null,decrementListenerCount(self,1,name))}},$emit:function(name,args){var namedListeners,i,length,empty=[],scope=this,stopPropagation=!1,event={name:name,targetScope:scope,stopPropagation:function(){stopPropagation=!0},preventDefault:function(){event.defaultPrevented=!0},defaultPrevented:!1},listenerArgs=concat([event],arguments,1);do{for(namedListeners=scope.$$listeners[name]||empty,event.currentScope=scope,i=0,length=namedListeners.length;i<length;i++)if(namedListeners[i])try{namedListeners[i].apply(null,listenerArgs)}catch(e){$exceptionHandler(e)}else namedListeners.splice(i,1),i--,length--;if(stopPropagation)return event.currentScope=null,event;scope=scope.$parent}while(scope);return event.currentScope=null,event},$broadcast:function(name,args){var target=this,current=target,next=target,event={name:name,targetScope:target,preventDefault:function(){event.defaultPrevented=!0},defaultPrevented:!1};if(!target.$$listenerCount[name])return event;for(var listeners,i,length,listenerArgs=concat([event],arguments,1);current=next;){for(event.currentScope=current,listeners=current.$$listeners[name]||[],i=0,length=listeners.length;i<length;i++)if(listeners[i])try{listeners[i].apply(null,listenerArgs)}catch(e){$exceptionHandler(e)}else listeners.splice(i,1),i--,length--;if(!(next=current.$$listenerCount[name]&&current.$$childHead||current!==target&&current.$$nextSibling))for(;current!==target&&!(next=current.$$nextSibling);)current=current.$parent}return event.currentScope=null,event}};var $rootScope=new Scope,asyncQueue=$rootScope.$$asyncQueue=[],postDigestQueue=$rootScope.$$postDigestQueue=[],applyAsyncQueue=$rootScope.$$applyAsyncQueue=[],postDigestQueuePosition=0;return $rootScope}]}function $$SanitizeUriProvider(){var aHrefSanitizationWhitelist=/^\s*(https?|ftp|mailto|tel|file):/,imgSrcSanitizationWhitelist=/^\s*((https?|ftp|file|blob):|data:image\/)/;this.aHrefSanitizationWhitelist=function(regexp){return isDefined(regexp)?(aHrefSanitizationWhitelist=regexp,this):aHrefSanitizationWhitelist},this.imgSrcSanitizationWhitelist=function(regexp){return isDefined(regexp)?(imgSrcSanitizationWhitelist=regexp,this):imgSrcSanitizationWhitelist},this.$get=function(){return function(uri,isImage){var normalizedVal,regex=isImage?imgSrcSanitizationWhitelist:aHrefSanitizationWhitelist;return normalizedVal=urlResolve(uri).href,""===normalizedVal||normalizedVal.match(regex)?uri:"unsafe:"+normalizedVal}}}function snakeToCamel(name){return name.replace(UNDERSCORE_LOWERCASE_REGEXP,fnCamelCaseReplace)}function adjustMatcher(matcher){if("self"===matcher)return matcher;if(isString(matcher)){if(matcher.indexOf("***")>-1)throw $sceMinErr("iwcard","Illegal sequence *** in string matcher.  String: {0}",matcher);return matcher=escapeForRegexp(matcher).replace(/\\\*\\\*/g,".*").replace(/\\\*/g,"[^:/.?&;]*"),new RegExp("^"+matcher+"$")}if(isRegExp(matcher))return new RegExp("^"+matcher.source+"$");throw $sceMinErr("imatcher",'Matchers may only be "self", string patterns or RegExp objects')}function adjustMatchers(matchers){var adjustedMatchers=[];return isDefined(matchers)&&forEach(matchers,function(matcher){adjustedMatchers.push(adjustMatcher(matcher))}),adjustedMatchers}function $SceDelegateProvider(){this.SCE_CONTEXTS=SCE_CONTEXTS;var resourceUrlWhitelist=["self"],resourceUrlBlacklist=[];this.resourceUrlWhitelist=function(value){return arguments.length&&(resourceUrlWhitelist=adjustMatchers(value)),resourceUrlWhitelist},this.resourceUrlBlacklist=function(value){return arguments.length&&(resourceUrlBlacklist=adjustMatchers(value)),resourceUrlBlacklist},this.$get=["$injector",function($injector){function matchUrl(matcher,parsedUrl){return"self"===matcher?urlIsSameOrigin(parsedUrl):!!matcher.exec(parsedUrl.href)}function isResourceUrlAllowedByPolicy(url){var i,n,parsedUrl=urlResolve(url.toString()),allowed=!1;for(i=0,n=resourceUrlWhitelist.length;i<n;i++)if(matchUrl(resourceUrlWhitelist[i],parsedUrl)){allowed=!0;break}if(allowed)for(i=0,n=resourceUrlBlacklist.length;i<n;i++)if(matchUrl(resourceUrlBlacklist[i],parsedUrl)){allowed=!1;break}return allowed}function generateHolderType(Base){var holderType=function(trustedValue){this.$$unwrapTrustedValue=function(){return trustedValue}};return Base&&(holderType.prototype=new Base),holderType.prototype.valueOf=function(){return this.$$unwrapTrustedValue()},holderType.prototype.toString=function(){return this.$$unwrapTrustedValue().toString()},holderType}function trustAs(type,trustedValue){var Constructor=byType.hasOwnProperty(type)?byType[type]:null;if(!Constructor)throw $sceMinErr("icontext","Attempted to trust a value in invalid context. Context: {0}; Value: {1}",type,trustedValue);if(null===trustedValue||isUndefined(trustedValue)||""===trustedValue)return trustedValue;if("string"!=typeof trustedValue)throw $sceMinErr("itype","Attempted to trust a non-string value in a content requiring a string: Context: {0}",type);return new Constructor(trustedValue)}function valueOf(maybeTrusted){return maybeTrusted instanceof trustedValueHolderBase?maybeTrusted.$$unwrapTrustedValue():maybeTrusted}function getTrusted(type,maybeTrusted){if(null===maybeTrusted||isUndefined(maybeTrusted)||""===maybeTrusted)return maybeTrusted;var constructor=byType.hasOwnProperty(type)?byType[type]:null;if(constructor&&maybeTrusted instanceof constructor)return maybeTrusted.$$unwrapTrustedValue();if(type===SCE_CONTEXTS.RESOURCE_URL){if(isResourceUrlAllowedByPolicy(maybeTrusted))return maybeTrusted;throw $sceMinErr("insecurl","Blocked loading resource from url not allowed by $sceDelegate policy.  URL: {0}",maybeTrusted.toString())}if(type===SCE_CONTEXTS.HTML)return htmlSanitizer(maybeTrusted);throw $sceMinErr("unsafe","Attempting to use an unsafe value in a safe context.")}var htmlSanitizer=function(html){throw $sceMinErr("unsafe","Attempting to use an unsafe value in a safe context.")};$injector.has("$sanitize")&&(htmlSanitizer=$injector.get("$sanitize"));var trustedValueHolderBase=generateHolderType(),byType={};return byType[SCE_CONTEXTS.HTML]=generateHolderType(trustedValueHolderBase),byType[SCE_CONTEXTS.CSS]=generateHolderType(trustedValueHolderBase),byType[SCE_CONTEXTS.URL]=generateHolderType(trustedValueHolderBase),byType[SCE_CONTEXTS.JS]=generateHolderType(trustedValueHolderBase),byType[SCE_CONTEXTS.RESOURCE_URL]=generateHolderType(byType[SCE_CONTEXTS.URL]),{trustAs:trustAs,getTrusted:getTrusted,valueOf:valueOf}}]}function $SceProvider(){var enabled=!0;this.enabled=function(value){return arguments.length&&(enabled=!!value),enabled},this.$get=["$parse","$sceDelegate",function($parse,$sceDelegate){if(enabled&&msie<8)throw $sceMinErr("iequirks","Strict Contextual Escaping does not support Internet Explorer version < 11 in quirks mode.  You can fix this by adding the text <!doctype html> to the top of your HTML document.  See http://docs.angularjs.org/api/ng.$sce for more information.");var sce=shallowCopy(SCE_CONTEXTS);sce.isEnabled=function(){return enabled},sce.trustAs=$sceDelegate.trustAs,sce.getTrusted=$sceDelegate.getTrusted,sce.valueOf=$sceDelegate.valueOf,enabled||(sce.trustAs=sce.getTrusted=function(type,value){return value},sce.valueOf=identity),sce.parseAs=function(type,expr){var parsed=$parse(expr);return parsed.literal&&parsed.constant?parsed:$parse(expr,function(value){return sce.getTrusted(type,value)})};var parse=sce.parseAs,getTrusted=sce.getTrusted,trustAs=sce.trustAs;return forEach(SCE_CONTEXTS,function(enumValue,name){var lName=lowercase(name);sce[snakeToCamel("parse_as_"+lName)]=function(expr){return parse(enumValue,expr)},sce[snakeToCamel("get_trusted_"+lName)]=function(value){return getTrusted(enumValue,value)},sce[snakeToCamel("trust_as_"+lName)]=function(value){return trustAs(enumValue,value)}}),sce}]}function $SnifferProvider(){this.$get=["$window","$document",function($window,$document){var eventSupport={},isNw=$window.nw&&$window.nw.process,isChromePackagedApp=!isNw&&$window.chrome&&($window.chrome.app&&$window.chrome.app.runtime||!$window.chrome.app&&$window.chrome.runtime&&$window.chrome.runtime.id),hasHistoryPushState=!isChromePackagedApp&&$window.history&&$window.history.pushState,android=toInt((/android (\d+)/.exec(lowercase(($window.navigator||{}).userAgent))||[])[1]),boxee=/Boxee/i.test(($window.navigator||{}).userAgent),document=$document[0]||{},bodyStyle=document.body&&document.body.style,transitions=!1,animations=!1
;return bodyStyle&&(transitions=!!("transition"in bodyStyle||"webkitTransition"in bodyStyle),animations=!!("animation"in bodyStyle||"webkitAnimation"in bodyStyle)),{history:!(!hasHistoryPushState||android<4||boxee),hasEvent:function(event){if("input"===event&&msie)return!1;if(isUndefined(eventSupport[event])){var divElm=document.createElement("div");eventSupport[event]="on"+event in divElm}return eventSupport[event]},csp:csp(),transitions:transitions,animations:animations,android:android}}]}function $TemplateRequestProvider(){var httpOptions;this.httpOptions=function(val){return val?(httpOptions=val,this):httpOptions},this.$get=["$exceptionHandler","$templateCache","$http","$q","$sce",function($exceptionHandler,$templateCache,$http,$q,$sce){function handleRequestFn(tpl,ignoreRequestError){function handleError(resp){return ignoreRequestError||(resp=$templateRequestMinErr("tpload","Failed to load template: {0} (HTTP status: {1} {2})",tpl,resp.status,resp.statusText),$exceptionHandler(resp)),$q.reject(resp)}handleRequestFn.totalPendingRequests++,isString(tpl)&&!isUndefined($templateCache.get(tpl))||(tpl=$sce.getTrustedResourceUrl(tpl));var transformResponse=$http.defaults&&$http.defaults.transformResponse;return isArray(transformResponse)?transformResponse=transformResponse.filter(function(transformer){return transformer!==defaultHttpResponseTransform}):transformResponse===defaultHttpResponseTransform&&(transformResponse=null),$http.get(tpl,extend({cache:$templateCache,transformResponse:transformResponse},httpOptions)).finally(function(){handleRequestFn.totalPendingRequests--}).then(function(response){return $templateCache.put(tpl,response.data),response.data},handleError)}return handleRequestFn.totalPendingRequests=0,handleRequestFn}]}function $$TestabilityProvider(){this.$get=["$rootScope","$browser","$location",function($rootScope,$browser,$location){var testability={};return testability.findBindings=function(element,expression,opt_exactMatch){var bindings=element.getElementsByClassName("ng-binding"),matches=[];return forEach(bindings,function(binding){var dataBinding=angular.element(binding).data("$binding");dataBinding&&forEach(dataBinding,function(bindingName){if(opt_exactMatch){new RegExp("(^|\\s)"+escapeForRegexp(expression)+"(\\s|\\||$)").test(bindingName)&&matches.push(binding)}else-1!==bindingName.indexOf(expression)&&matches.push(binding)})}),matches},testability.findModels=function(element,expression,opt_exactMatch){for(var prefixes=["ng-","data-ng-","ng\\:"],p=0;p<prefixes.length;++p){var attributeEquals=opt_exactMatch?"=":"*=",selector="["+prefixes[p]+"model"+attributeEquals+'"'+expression+'"]',elements=element.querySelectorAll(selector);if(elements.length)return elements}},testability.getLocation=function(){return $location.url()},testability.setLocation=function(url){url!==$location.url()&&($location.url(url),$rootScope.$digest())},testability.whenStable=function(callback){$browser.notifyWhenNoOutstandingRequests(callback)},testability}]}function $TimeoutProvider(){this.$get=["$rootScope","$browser","$q","$$q","$exceptionHandler",function($rootScope,$browser,$q,$$q,$exceptionHandler){function timeout(fn,delay,invokeApply){isFunction(fn)||(invokeApply=delay,delay=fn,fn=noop);var timeoutId,args=sliceArgs(arguments,3),skipApply=isDefined(invokeApply)&&!invokeApply,deferred=(skipApply?$$q:$q).defer(),promise=deferred.promise;return timeoutId=$browser.defer(function(){try{deferred.resolve(fn.apply(null,args))}catch(e){deferred.reject(e),$exceptionHandler(e)}finally{delete deferreds[promise.$$timeoutId]}skipApply||$rootScope.$apply()},delay),promise.$$timeoutId=timeoutId,deferreds[timeoutId]=deferred,promise}var deferreds={};return timeout.cancel=function(promise){return!!(promise&&promise.$$timeoutId in deferreds)&&(deferreds[promise.$$timeoutId].promise.catch(noop),deferreds[promise.$$timeoutId].reject("canceled"),delete deferreds[promise.$$timeoutId],$browser.defer.cancel(promise.$$timeoutId))},timeout}]}function urlResolve(url){var href=url;return msie&&(urlParsingNode.setAttribute("href",href),href=urlParsingNode.href),urlParsingNode.setAttribute("href",href),{href:urlParsingNode.href,protocol:urlParsingNode.protocol?urlParsingNode.protocol.replace(/:$/,""):"",host:urlParsingNode.host,search:urlParsingNode.search?urlParsingNode.search.replace(/^\?/,""):"",hash:urlParsingNode.hash?urlParsingNode.hash.replace(/^#/,""):"",hostname:urlParsingNode.hostname,port:urlParsingNode.port,pathname:"/"===urlParsingNode.pathname.charAt(0)?urlParsingNode.pathname:"/"+urlParsingNode.pathname}}function urlIsSameOrigin(requestUrl){var parsed=isString(requestUrl)?urlResolve(requestUrl):requestUrl;return parsed.protocol===originUrl.protocol&&parsed.host===originUrl.host}function $WindowProvider(){this.$get=valueFn(window)}function $$CookieReader($document){function safeGetCookie(rawDocument){try{return rawDocument.cookie||""}catch(e){return""}}function safeDecodeURIComponent(str){try{return decodeURIComponent(str)}catch(e){return str}}var rawDocument=$document[0]||{},lastCookies={},lastCookieString="";return function(){var cookieArray,cookie,i,index,name,currentCookieString=safeGetCookie(rawDocument);if(currentCookieString!==lastCookieString)for(lastCookieString=currentCookieString,cookieArray=lastCookieString.split("; "),lastCookies={},i=0;i<cookieArray.length;i++)cookie=cookieArray[i],(index=cookie.indexOf("="))>0&&(name=safeDecodeURIComponent(cookie.substring(0,index)),isUndefined(lastCookies[name])&&(lastCookies[name]=safeDecodeURIComponent(cookie.substring(index+1))));return lastCookies}}function $$CookieReaderProvider(){this.$get=$$CookieReader}function $FilterProvider($provide){function register(name,factory){if(isObject(name)){var filters={};return forEach(name,function(filter,key){filters[key]=register(key,filter)}),filters}return $provide.factory(name+suffix,factory)}var suffix="Filter";this.register=register,this.$get=["$injector",function($injector){return function(name){return $injector.get(name+suffix)}}],register("currency",currencyFilter),register("date",dateFilter),register("filter",filterFilter),register("json",jsonFilter),register("limitTo",limitToFilter),register("lowercase",lowercaseFilter),register("number",numberFilter),register("orderBy",orderByFilter),register("uppercase",uppercaseFilter)}function filterFilter(){return function(array,expression,comparator,anyPropertyKey){if(!isArrayLike(array)){if(null==array)return array;throw minErr("filter")("notarray","Expected array but received: {0}",array)}anyPropertyKey=anyPropertyKey||"$";var predicateFn,matchAgainstAnyProp,expressionType=getTypeForFilter(expression);switch(expressionType){case"function":predicateFn=expression;break;case"boolean":case"null":case"number":case"string":matchAgainstAnyProp=!0;case"object":predicateFn=createPredicateFn(expression,comparator,anyPropertyKey,matchAgainstAnyProp);break;default:return array}return Array.prototype.filter.call(array,predicateFn)}}function createPredicateFn(expression,comparator,anyPropertyKey,matchAgainstAnyProp){var shouldMatchPrimitives=isObject(expression)&&anyPropertyKey in expression;return!0===comparator?comparator=equals:isFunction(comparator)||(comparator=function(actual,expected){return!isUndefined(actual)&&(null===actual||null===expected?actual===expected:!(isObject(expected)||isObject(actual)&&!hasCustomToString(actual))&&(actual=lowercase(""+actual),expected=lowercase(""+expected),-1!==actual.indexOf(expected)))}),function(item){return shouldMatchPrimitives&&!isObject(item)?deepCompare(item,expression[anyPropertyKey],comparator,anyPropertyKey,!1):deepCompare(item,expression,comparator,anyPropertyKey,matchAgainstAnyProp)}}function deepCompare(actual,expected,comparator,anyPropertyKey,matchAgainstAnyProp,dontMatchWholeObject){var actualType=getTypeForFilter(actual),expectedType=getTypeForFilter(expected);if("string"===expectedType&&"!"===expected.charAt(0))return!deepCompare(actual,expected.substring(1),comparator,anyPropertyKey,matchAgainstAnyProp);if(isArray(actual))return actual.some(function(item){return deepCompare(item,expected,comparator,anyPropertyKey,matchAgainstAnyProp)});switch(actualType){case"object":var key;if(matchAgainstAnyProp){for(key in actual)if(key.charAt&&"$"!==key.charAt(0)&&deepCompare(actual[key],expected,comparator,anyPropertyKey,!0))return!0;return!dontMatchWholeObject&&deepCompare(actual,expected,comparator,anyPropertyKey,!1)}if("object"===expectedType){for(key in expected){var expectedVal=expected[key];if(!isFunction(expectedVal)&&!isUndefined(expectedVal)){var matchAnyProperty=key===anyPropertyKey;if(!deepCompare(matchAnyProperty?actual:actual[key],expectedVal,comparator,anyPropertyKey,matchAnyProperty,matchAnyProperty))return!1}}return!0}return comparator(actual,expected);case"function":return!1;default:return comparator(actual,expected)}}function getTypeForFilter(val){return null===val?"null":typeof val}function currencyFilter($locale){var formats=$locale.NUMBER_FORMATS;return function(amount,currencySymbol,fractionSize){return isUndefined(currencySymbol)&&(currencySymbol=formats.CURRENCY_SYM),isUndefined(fractionSize)&&(fractionSize=formats.PATTERNS[1].maxFrac),null==amount?amount:formatNumber(amount,formats.PATTERNS[1],formats.GROUP_SEP,formats.DECIMAL_SEP,fractionSize).replace(/\u00A4/g,currencySymbol)}}function numberFilter($locale){var formats=$locale.NUMBER_FORMATS;return function(number,fractionSize){return null==number?number:formatNumber(number,formats.PATTERNS[0],formats.GROUP_SEP,formats.DECIMAL_SEP,fractionSize)}}function parse(numStr){var digits,numberOfIntegerDigits,i,j,zeros,exponent=0;for((numberOfIntegerDigits=numStr.indexOf(DECIMAL_SEP))>-1&&(numStr=numStr.replace(DECIMAL_SEP,"")),(i=numStr.search(/e/i))>0?(numberOfIntegerDigits<0&&(numberOfIntegerDigits=i),numberOfIntegerDigits+=+numStr.slice(i+1),numStr=numStr.substring(0,i)):numberOfIntegerDigits<0&&(numberOfIntegerDigits=numStr.length),i=0;numStr.charAt(i)===ZERO_CHAR;i++);if(i===(zeros=numStr.length))digits=[0],numberOfIntegerDigits=1;else{for(zeros--;numStr.charAt(zeros)===ZERO_CHAR;)zeros--;for(numberOfIntegerDigits-=i,digits=[],j=0;i<=zeros;i++,j++)digits[j]=+numStr.charAt(i)}return numberOfIntegerDigits>MAX_DIGITS&&(digits=digits.splice(0,MAX_DIGITS-1),exponent=numberOfIntegerDigits-1,numberOfIntegerDigits=1),{d:digits,e:exponent,i:numberOfIntegerDigits}}function roundNumber(parsedNumber,fractionSize,minFrac,maxFrac){var digits=parsedNumber.d,fractionLen=digits.length-parsedNumber.i;fractionSize=isUndefined(fractionSize)?Math.min(Math.max(minFrac,fractionLen),maxFrac):+fractionSize;var roundAt=fractionSize+parsedNumber.i,digit=digits[roundAt];if(roundAt>0){digits.splice(Math.max(parsedNumber.i,roundAt));for(var j=roundAt;j<digits.length;j++)digits[j]=0}else{fractionLen=Math.max(0,fractionLen),parsedNumber.i=1,digits.length=Math.max(1,roundAt=fractionSize+1),digits[0]=0;for(var i=1;i<roundAt;i++)digits[i]=0}if(digit>=5)if(roundAt-1<0){for(var k=0;k>roundAt;k--)digits.unshift(0),parsedNumber.i++;digits.unshift(1),parsedNumber.i++}else digits[roundAt-1]++;for(;fractionLen<Math.max(0,fractionSize);fractionLen++)digits.push(0);var carry=digits.reduceRight(function(carry,d,i,digits){return d+=carry,digits[i]=d%10,Math.floor(d/10)},0);carry&&(digits.unshift(carry),parsedNumber.i++)}function formatNumber(number,pattern,groupSep,decimalSep,fractionSize){if(!isString(number)&&!isNumber(number)||isNaN(number))return"";var parsedNumber,isInfinity=!isFinite(number),isZero=!1,numStr=Math.abs(number)+"",formattedText="";if(isInfinity)formattedText="∞";else{parsedNumber=parse(numStr),roundNumber(parsedNumber,fractionSize,pattern.minFrac,pattern.maxFrac);var digits=parsedNumber.d,integerLen=parsedNumber.i,exponent=parsedNumber.e,decimals=[];for(isZero=digits.reduce(function(isZero,d){return isZero&&!d},!0);integerLen<0;)digits.unshift(0),integerLen++;integerLen>0?decimals=digits.splice(integerLen,digits.length):(decimals=digits,digits=[0]);var groups=[];for(digits.length>=pattern.lgSize&&groups.unshift(digits.splice(-pattern.lgSize,digits.length).join(""));digits.length>pattern.gSize;)groups.unshift(digits.splice(-pattern.gSize,digits.length).join(""));digits.length&&groups.unshift(digits.join("")),formattedText=groups.join(groupSep),decimals.length&&(formattedText+=decimalSep+decimals.join("")),exponent&&(formattedText+="e+"+exponent)}return number<0&&!isZero?pattern.negPre+formattedText+pattern.negSuf:pattern.posPre+formattedText+pattern.posSuf}function padNumber(num,digits,trim,negWrap){var neg="";for((num<0||negWrap&&num<=0)&&(negWrap?num=1-num:(num=-num,neg="-")),num=""+num;num.length<digits;)num=ZERO_CHAR+num;return trim&&(num=num.substr(num.length-digits)),neg+num}function dateGetter(name,size,offset,trim,negWrap){return offset=offset||0,function(date){var value=date["get"+name]();return(offset>0||value>-offset)&&(value+=offset),0===value&&-12===offset&&(value=12),padNumber(value,size,trim,negWrap)}}function dateStrGetter(name,shortForm,standAlone){return function(date,formats){var value=date["get"+name]();return formats[uppercase((standAlone?"STANDALONE":"")+(shortForm?"SHORT":"")+name)][value]}}function timeZoneGetter(date,formats,offset){var zone=-1*offset,paddedZone=zone>=0?"+":"";return paddedZone+=padNumber(Math[zone>0?"floor":"ceil"](zone/60),2)+padNumber(Math.abs(zone%60),2)}function getFirstThursdayOfYear(year){var dayOfWeekOnFirst=new Date(year,0,1).getDay();return new Date(year,0,(dayOfWeekOnFirst<=4?5:12)-dayOfWeekOnFirst)}function getThursdayThisWeek(datetime){return new Date(datetime.getFullYear(),datetime.getMonth(),datetime.getDate()+(4-datetime.getDay()))}function weekGetter(size){return function(date){var firstThurs=getFirstThursdayOfYear(date.getFullYear()),thisThurs=getThursdayThisWeek(date),diff=+thisThurs-+firstThurs;return padNumber(1+Math.round(diff/6048e5),size)}}function ampmGetter(date,formats){return date.getHours()<12?formats.AMPMS[0]:formats.AMPMS[1]}function eraGetter(date,formats){return date.getFullYear()<=0?formats.ERAS[0]:formats.ERAS[1]}function longEraGetter(date,formats){return date.getFullYear()<=0?formats.ERANAMES[0]:formats.ERANAMES[1]}function dateFilter($locale){function jsonStringToDate(string){var match;if(match=string.match(R_ISO8601_STR)){var date=new Date(0),tzHour=0,tzMin=0,dateSetter=match[8]?date.setUTCFullYear:date.setFullYear,timeSetter=match[8]?date.setUTCHours:date.setHours;match[9]&&(tzHour=toInt(match[9]+match[10]),tzMin=toInt(match[9]+match[11])),dateSetter.call(date,toInt(match[1]),toInt(match[2])-1,toInt(match[3]));var h=toInt(match[4]||0)-tzHour,m=toInt(match[5]||0)-tzMin,s=toInt(match[6]||0),ms=Math.round(1e3*parseFloat("0."+(match[7]||0)));return timeSetter.call(date,h,m,s,ms),date}return string}var R_ISO8601_STR=/^(\d{4})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/;return function(date,format,timezone){var fn,match,text="",parts=[];if(format=format||"mediumDate",format=$locale.DATETIME_FORMATS[format]||format,isString(date)&&(date=NUMBER_STRING.test(date)?toInt(date):jsonStringToDate(date)),isNumber(date)&&(date=new Date(date)),!isDate(date)||!isFinite(date.getTime()))return date;for(;format;)match=DATE_FORMATS_SPLIT.exec(format),match?(parts=concat(parts,match,1),format=parts.pop()):(parts.push(format),format=null);var dateTimezoneOffset=date.getTimezoneOffset();return timezone&&(dateTimezoneOffset=timezoneToOffset(timezone,dateTimezoneOffset),date=convertTimezoneToLocal(date,timezone,!0)),forEach(parts,function(value){fn=DATE_FORMATS[value],text+=fn?fn(date,$locale.DATETIME_FORMATS,dateTimezoneOffset):"''"===value?"'":value.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),text}}function jsonFilter(){return function(object,spacing){return isUndefined(spacing)&&(spacing=2),toJson(object,spacing)}}function limitToFilter(){return function(input,limit,begin){return limit=Math.abs(Number(limit))===1/0?Number(limit):toInt(limit),isNumberNaN(limit)?input:(isNumber(input)&&(input=input.toString()),isArrayLike(input)?(begin=!begin||isNaN(begin)?0:toInt(begin),begin=begin<0?Math.max(0,input.length+begin):begin,limit>=0?sliceFn(input,begin,begin+limit):0===begin?sliceFn(input,limit,input.length):sliceFn(input,Math.max(0,begin+limit),begin)):input)}}function sliceFn(input,begin,end){return isString(input)?input.slice(begin,end):slice.call(input,begin,end)}function orderByFilter($parse){function processPredicates(sortPredicates){return sortPredicates.map(function(predicate){var descending=1,get=identity;if(isFunction(predicate))get=predicate;else if(isString(predicate)&&("+"!==predicate.charAt(0)&&"-"!==predicate.charAt(0)||(descending="-"===predicate.charAt(0)?-1:1,predicate=predicate.substring(1)),""!==predicate&&(get=$parse(predicate),get.constant))){var key=get();get=function(value){return value[key]}}return{get:get,descending:descending}})}function isPrimitive(value){switch(typeof value){case"number":case"boolean":case"string":return!0;default:return!1}}function objectValue(value){return isFunction(value.valueOf)&&(value=value.valueOf(),isPrimitive(value))?value:(hasCustomToString(value)&&(value=value.toString(),isPrimitive(value)),value)}function getPredicateValue(value,index){var type=typeof value;return null===value?(type="string",value="null"):"object"===type&&(value=objectValue(value)),{value:value,type:type,index:index}}function defaultCompare(v1,v2){var result=0,type1=v1.type,type2=v2.type;if(type1===type2){var value1=v1.value,value2=v2.value;"string"===type1?(value1=value1.toLowerCase(),value2=value2.toLowerCase()):"object"===type1&&(isObject(value1)&&(value1=v1.index),isObject(value2)&&(value2=v2.index)),value1!==value2&&(result=value1<value2?-1:1)}else result=type1<type2?-1:1;return result}return function(array,sortPredicate,reverseOrder,compareFn){function getComparisonObject(value,index){return{value:value,tieBreaker:{value:index,type:"number",index:index},predicateValues:predicates.map(function(predicate){return getPredicateValue(predicate.get(value),index)})}}function doComparison(v1,v2){for(var i=0,ii=predicates.length;i<ii;i++){var result=compare(v1.predicateValues[i],v2.predicateValues[i]);if(result)return result*predicates[i].descending*descending}return compare(v1.tieBreaker,v2.tieBreaker)*descending}if(null==array)return array;if(!isArrayLike(array))throw minErr("orderBy")("notarray","Expected array but received: {0}",array);isArray(sortPredicate)||(sortPredicate=[sortPredicate]),0===sortPredicate.length&&(sortPredicate=["+"]);var predicates=processPredicates(sortPredicate),descending=reverseOrder?-1:1,compare=isFunction(compareFn)?compareFn:defaultCompare,compareValues=Array.prototype.map.call(array,getComparisonObject);return compareValues.sort(doComparison),array=compareValues.map(function(item){return item.value})}}function ngDirective(directive){return isFunction(directive)&&(directive={link:directive}),directive.restrict=directive.restrict||"AC",valueFn(directive)}function nullFormRenameControl(control,name){control.$name=name}function FormController($element,$attrs,$scope,$animate,$interpolate){this.$$controls=[],this.$error={},this.$$success={},this.$pending=void 0,this.$name=$interpolate($attrs.name||$attrs.ngForm||"")($scope),this.$dirty=!1,this.$pristine=!0,this.$valid=!0,this.$invalid=!1,this.$submitted=!1,this.$$parentForm=nullFormCtrl,this.$$element=$element,this.$$animate=$animate,setupValidity(this)}function setupValidity(instance){instance.$$classCache={},instance.$$classCache[INVALID_CLASS]=!(instance.$$classCache[VALID_CLASS]=instance.$$element.hasClass(VALID_CLASS))}function addSetValidityMethod(context){function createAndSet(ctrl,name,value,controller){ctrl[name]||(ctrl[name]={}),set(ctrl[name],value,controller)}function unsetAndCleanup(ctrl,name,value,controller){ctrl[name]&&unset(ctrl[name],value,controller),isObjectEmpty(ctrl[name])&&(ctrl[name]=void 0)}function cachedToggleClass(ctrl,className,switchValue){switchValue&&!ctrl.$$classCache[className]?(ctrl.$$animate.addClass(ctrl.$$element,className),ctrl.$$classCache[className]=!0):!switchValue&&ctrl.$$classCache[className]&&(ctrl.$$animate.removeClass(ctrl.$$element,className),ctrl.$$classCache[className]=!1)}function toggleValidationCss(ctrl,validationErrorKey,isValid){validationErrorKey=validationErrorKey?"-"+snake_case(validationErrorKey,"-"):"",cachedToggleClass(ctrl,VALID_CLASS+validationErrorKey,!0===isValid),cachedToggleClass(ctrl,INVALID_CLASS+validationErrorKey,!1===isValid)}var clazz=context.clazz,set=context.set,unset=context.unset;clazz.prototype.$setValidity=function(validationErrorKey,state,controller){isUndefined(state)?createAndSet(this,"$pending",validationErrorKey,controller):unsetAndCleanup(this,"$pending",validationErrorKey,controller),isBoolean(state)?state?(unset(this.$error,validationErrorKey,controller),set(this.$$success,validationErrorKey,controller)):(set(this.$error,validationErrorKey,controller),unset(this.$$success,validationErrorKey,controller)):(unset(this.$error,validationErrorKey,controller),unset(this.$$success,validationErrorKey,controller)),this.$pending?(cachedToggleClass(this,PENDING_CLASS,!0),this.$valid=this.$invalid=void 0,toggleValidationCss(this,"",null)):(cachedToggleClass(this,PENDING_CLASS,!1),this.$valid=isObjectEmpty(this.$error),this.$invalid=!this.$valid,toggleValidationCss(this,"",this.$valid));var combinedState;combinedState=this.$pending&&this.$pending[validationErrorKey]?void 0:!this.$error[validationErrorKey]&&(!!this.$$success[validationErrorKey]||null),toggleValidationCss(this,validationErrorKey,combinedState),this.$$parentForm.$setValidity(validationErrorKey,combinedState,this)}}function isObjectEmpty(obj){if(obj)for(var prop in obj)if(obj.hasOwnProperty(prop))return!1;return!0}function stringBasedInputType(ctrl){ctrl.$formatters.push(function(value){return ctrl.$isEmpty(value)?value:value.toString()})}function textInputType(scope,element,attr,ctrl,$sniffer,$browser){baseInputType(scope,element,attr,ctrl,$sniffer,$browser),stringBasedInputType(ctrl)}function baseInputType(scope,element,attr,ctrl,$sniffer,$browser){var type=lowercase(element[0].type);if(!$sniffer.android){var composing=!1;element.on("compositionstart",function(){composing=!0}),element.on("compositionend",function(){composing=!1,listener()})}var timeout,listener=function(ev){if(timeout&&($browser.defer.cancel(timeout),timeout=null),!composing){var value=element.val(),event=ev&&ev.type;"password"===type||attr.ngTrim&&"false"===attr.ngTrim||(value=trim(value)),(ctrl.$viewValue!==value||""===value&&ctrl.$$hasNativeValidators)&&ctrl.$setViewValue(value,event)}};if($sniffer.hasEvent("input"))element.on("input",listener);else{var deferListener=function(ev,input,origValue){timeout||(timeout=$browser.defer(function(){timeout=null,input&&input.value===origValue||listener(ev)}))};element.on("keydown",function(event){var key=event.keyCode;91===key||15<key&&key<19||37<=key&&key<=40||deferListener(event,this,this.value)}),$sniffer.hasEvent("paste")&&element.on("paste cut",deferListener)}element.on("change",listener),PARTIAL_VALIDATION_TYPES[type]&&ctrl.$$hasNativeValidators&&type===attr.type&&element.on(PARTIAL_VALIDATION_EVENTS,function(ev){if(!timeout){var validity=this[VALIDITY_STATE_PROPERTY],origBadInput=validity.badInput,origTypeMismatch=validity.typeMismatch;timeout=$browser.defer(function(){timeout=null,validity.badInput===origBadInput&&validity.typeMismatch===origTypeMismatch||listener(ev)})}}),ctrl.$render=function(){var value=ctrl.$isEmpty(ctrl.$viewValue)?"":ctrl.$viewValue;element.val()!==value&&element.val(value)}}function weekParser(isoWeek,existingDate){if(isDate(isoWeek))return isoWeek;if(isString(isoWeek)){WEEK_REGEXP.lastIndex=0;var parts=WEEK_REGEXP.exec(isoWeek);if(parts){var year=+parts[1],week=+parts[2],hours=0,minutes=0,seconds=0,milliseconds=0,firstThurs=getFirstThursdayOfYear(year),addDays=7*(week-1);return existingDate&&(hours=existingDate.getHours(),minutes=existingDate.getMinutes(),seconds=existingDate.getSeconds(),milliseconds=existingDate.getMilliseconds()),new Date(year,0,firstThurs.getDate()+addDays,hours,minutes,seconds,milliseconds)}}return NaN}function createDateParser(regexp,mapping){return function(iso,date){var parts,map;if(isDate(iso))return iso;if(isString(iso)){if('"'===iso.charAt(0)&&'"'===iso.charAt(iso.length-1)&&(iso=iso.substring(1,iso.length-1)),ISO_DATE_REGEXP.test(iso))return new Date(iso);if(regexp.lastIndex=0,parts=regexp.exec(iso))return parts.shift(),map=date?{yyyy:date.getFullYear(),MM:date.getMonth()+1,dd:date.getDate(),HH:date.getHours(),mm:date.getMinutes(),ss:date.getSeconds(),sss:date.getMilliseconds()/1e3}:{yyyy:1970,MM:1,dd:1,HH:0,mm:0,ss:0,sss:0},forEach(parts,function(part,index){index<mapping.length&&(map[mapping[index]]=+part)}),new Date(map.yyyy,map.MM-1,map.dd,map.HH,map.mm,map.ss||0,1e3*map.sss||0)}return NaN}}function createDateInputType(type,regexp,parseDate,format){return function(scope,element,attr,ctrl,$sniffer,$browser,$filter){function isValidDate(value){return value&&!(value.getTime&&value.getTime()!==value.getTime())}function parseObservedDateValue(val){return isDefined(val)&&!isDate(val)?parseDate(val)||void 0:val}badInputChecker(scope,element,attr,ctrl),baseInputType(scope,element,attr,ctrl,$sniffer,$browser);var previousDate,timezone=ctrl&&ctrl.$options.getOption("timezone");if(ctrl.$$parserName=type,ctrl.$parsers.push(function(value){if(ctrl.$isEmpty(value))return null;if(regexp.test(value)){var parsedDate=parseDate(value,previousDate);return timezone&&(parsedDate=convertTimezoneToLocal(parsedDate,timezone)),parsedDate}}),ctrl.$formatters.push(function(value){if(value&&!isDate(value))throw ngModelMinErr("datefmt","Expected `{0}` to be a date",value);return isValidDate(value)?(previousDate=value,previousDate&&timezone&&(previousDate=convertTimezoneToLocal(previousDate,timezone,!0)),$filter("date")(value,format,timezone)):(previousDate=null,"")}),isDefined(attr.min)||attr.ngMin){var minVal;ctrl.$validators.min=function(value){return!isValidDate(value)||isUndefined(minVal)||parseDate(value)>=minVal},attr.$observe("min",function(val){minVal=parseObservedDateValue(val),ctrl.$validate()})}if(isDefined(attr.max)||attr.ngMax){var maxVal;ctrl.$validators.max=function(value){return!isValidDate(value)||isUndefined(maxVal)||parseDate(value)<=maxVal},attr.$observe("max",function(val){maxVal=parseObservedDateValue(val),ctrl.$validate()})}}}function badInputChecker(scope,element,attr,ctrl){var node=element[0];(ctrl.$$hasNativeValidators=isObject(node.validity))&&ctrl.$parsers.push(function(value){var validity=element.prop(VALIDITY_STATE_PROPERTY)||{};return validity.badInput||validity.typeMismatch?void 0:value})}function numberFormatterParser(ctrl){ctrl.$$parserName="number",ctrl.$parsers.push(function(value){return ctrl.$isEmpty(value)?null:NUMBER_REGEXP.test(value)?parseFloat(value):void 0}),ctrl.$formatters.push(function(value){if(!ctrl.$isEmpty(value)){if(!isNumber(value))throw ngModelMinErr("numfmt","Expected `{0}` to be a number",value);value=value.toString()}return value})}function parseNumberAttrVal(val){return isDefined(val)&&!isNumber(val)&&(val=parseFloat(val)),isNumberNaN(val)?void 0:val}function isNumberInteger(num){return(0|num)===num}function countDecimals(num){var numString=num.toString(),decimalSymbolIndex=numString.indexOf(".");if(-1===decimalSymbolIndex){if(-1<num&&num<1){var match=/e-(\d+)$/.exec(numString);if(match)return Number(match[1])}return 0}return numString.length-decimalSymbolIndex-1}function isValidForStep(viewValue,stepBase,step){var value=Number(viewValue),isNonIntegerValue=!isNumberInteger(value),isNonIntegerStepBase=!isNumberInteger(stepBase),isNonIntegerStep=!isNumberInteger(step);if(isNonIntegerValue||isNonIntegerStepBase||isNonIntegerStep){var valueDecimals=isNonIntegerValue?countDecimals(value):0,stepBaseDecimals=isNonIntegerStepBase?countDecimals(stepBase):0,stepDecimals=isNonIntegerStep?countDecimals(step):0,decimalCount=Math.max(valueDecimals,stepBaseDecimals,stepDecimals),multiplier=Math.pow(10,decimalCount);value*=multiplier,stepBase*=multiplier,step*=multiplier,isNonIntegerValue&&(value=Math.round(value)),isNonIntegerStepBase&&(stepBase=Math.round(stepBase)),isNonIntegerStep&&(step=Math.round(step))}return(value-stepBase)%step==0}function numberInputType(scope,element,attr,ctrl,$sniffer,$browser){badInputChecker(scope,element,attr,ctrl),numberFormatterParser(ctrl),baseInputType(scope,element,attr,ctrl,$sniffer,$browser);var minVal,maxVal;if((isDefined(attr.min)||attr.ngMin)&&(ctrl.$validators.min=function(value){return ctrl.$isEmpty(value)||isUndefined(minVal)||value>=minVal},attr.$observe("min",function(val){minVal=parseNumberAttrVal(val),ctrl.$validate()})),(isDefined(attr.max)||attr.ngMax)&&(ctrl.$validators.max=function(value){return ctrl.$isEmpty(value)||isUndefined(maxVal)||value<=maxVal},attr.$observe("max",function(val){maxVal=parseNumberAttrVal(val),ctrl.$validate()})),isDefined(attr.step)||attr.ngStep){var stepVal;ctrl.$validators.step=function(modelValue,viewValue){return ctrl.$isEmpty(viewValue)||isUndefined(stepVal)||isValidForStep(viewValue,minVal||0,stepVal)},attr.$observe("step",function(val){stepVal=parseNumberAttrVal(val),ctrl.$validate()})}}function rangeInputType(scope,element,attr,ctrl,$sniffer,$browser){function setInitialValueAndObserver(htmlAttrName,changeFn){element.attr(htmlAttrName,attr[htmlAttrName]),attr.$observe(htmlAttrName,changeFn)}function minChange(val){if(minVal=parseNumberAttrVal(val),!isNumberNaN(ctrl.$modelValue))if(supportsRange){var elVal=element.val();minVal>elVal&&(elVal=minVal,element.val(elVal)),ctrl.$setViewValue(elVal)}else ctrl.$validate()}function maxChange(val){if(maxVal=parseNumberAttrVal(val),!isNumberNaN(ctrl.$modelValue))if(supportsRange){var elVal=element.val();maxVal<elVal&&(element.val(maxVal),elVal=maxVal<minVal?minVal:maxVal),ctrl.$setViewValue(elVal)}else ctrl.$validate()}function stepChange(val){stepVal=parseNumberAttrVal(val),isNumberNaN(ctrl.$modelValue)||(supportsRange&&ctrl.$viewValue!==element.val()?ctrl.$setViewValue(element.val()):ctrl.$validate())}badInputChecker(scope,element,attr,ctrl),numberFormatterParser(ctrl),baseInputType(scope,element,attr,ctrl,$sniffer,$browser);var supportsRange=ctrl.$$hasNativeValidators&&"range"===element[0].type,minVal=supportsRange?0:void 0,maxVal=supportsRange?100:void 0,stepVal=supportsRange?1:void 0,validity=element[0].validity,hasMinAttr=isDefined(attr.min),hasMaxAttr=isDefined(attr.max),hasStepAttr=isDefined(attr.step),originalRender=ctrl.$render;ctrl.$render=supportsRange&&isDefined(validity.rangeUnderflow)&&isDefined(validity.rangeOverflow)?function(){originalRender(),ctrl.$setViewValue(element.val())}:originalRender,hasMinAttr&&(ctrl.$validators.min=supportsRange?function(){return!0}:function(modelValue,viewValue){return ctrl.$isEmpty(viewValue)||isUndefined(minVal)||viewValue>=minVal},setInitialValueAndObserver("min",minChange)),hasMaxAttr&&(ctrl.$validators.max=supportsRange?function(){return!0}:function(modelValue,viewValue){return ctrl.$isEmpty(viewValue)||isUndefined(maxVal)||viewValue<=maxVal},setInitialValueAndObserver("max",maxChange)),hasStepAttr&&(ctrl.$validators.step=supportsRange?function(){return!validity.stepMismatch}:function(modelValue,viewValue){return ctrl.$isEmpty(viewValue)||isUndefined(stepVal)||isValidForStep(viewValue,minVal||0,stepVal)},setInitialValueAndObserver("step",stepChange))}function urlInputType(scope,element,attr,ctrl,$sniffer,$browser){baseInputType(scope,element,attr,ctrl,$sniffer,$browser),stringBasedInputType(ctrl),ctrl.$$parserName="url",ctrl.$validators.url=function(modelValue,viewValue){var value=modelValue||viewValue;return ctrl.$isEmpty(value)||URL_REGEXP.test(value)}}function emailInputType(scope,element,attr,ctrl,$sniffer,$browser){baseInputType(scope,element,attr,ctrl,$sniffer,$browser),stringBasedInputType(ctrl),ctrl.$$parserName="email",ctrl.$validators.email=function(modelValue,viewValue){
var value=modelValue||viewValue;return ctrl.$isEmpty(value)||EMAIL_REGEXP.test(value)}}function radioInputType(scope,element,attr,ctrl){var doTrim=!attr.ngTrim||"false"!==trim(attr.ngTrim);isUndefined(attr.name)&&element.attr("name",nextUid());var listener=function(ev){var value;element[0].checked&&(value=attr.value,doTrim&&(value=trim(value)),ctrl.$setViewValue(value,ev&&ev.type))};element.on("click",listener),ctrl.$render=function(){var value=attr.value;doTrim&&(value=trim(value)),element[0].checked=value===ctrl.$viewValue},attr.$observe("value",ctrl.$render)}function parseConstantExpr($parse,context,name,expression,fallback){var parseFn;if(isDefined(expression)){if(parseFn=$parse(expression),!parseFn.constant)throw ngModelMinErr("constexpr","Expected constant expression for `{0}`, but saw `{1}`.",name,expression);return parseFn(context)}return fallback}function checkboxInputType(scope,element,attr,ctrl,$sniffer,$browser,$filter,$parse){var trueValue=parseConstantExpr($parse,scope,"ngTrueValue",attr.ngTrueValue,!0),falseValue=parseConstantExpr($parse,scope,"ngFalseValue",attr.ngFalseValue,!1),listener=function(ev){ctrl.$setViewValue(element[0].checked,ev&&ev.type)};element.on("click",listener),ctrl.$render=function(){element[0].checked=ctrl.$viewValue},ctrl.$isEmpty=function(value){return!1===value},ctrl.$formatters.push(function(value){return equals(value,trueValue)}),ctrl.$parsers.push(function(value){return value?trueValue:falseValue})}function classDirective(name,selector){function arrayDifference(tokens1,tokens2){if(!tokens1||!tokens1.length)return[];if(!tokens2||!tokens2.length)return tokens1;var values=[];outer:for(var i=0;i<tokens1.length;i++){for(var token=tokens1[i],j=0;j<tokens2.length;j++)if(token===tokens2[j])continue outer;values.push(token)}return values}function split(classString){return classString&&classString.split(" ")}function toClassString(classValue){var classString=classValue;return isArray(classValue)?classString=classValue.map(toClassString).join(" "):isObject(classValue)&&(classString=Object.keys(classValue).filter(function(key){return classValue[key]}).join(" ")),classString}name="ngClass"+name;var indexWatchExpression;return["$parse",function($parse){return{restrict:"AC",link:function(scope,element,attr){function addClasses(classString){classString=digestClassCounts(split(classString),1),attr.$addClass(classString)}function removeClasses(classString){classString=digestClassCounts(split(classString),-1),attr.$removeClass(classString)}function updateClasses(oldClassString,newClassString){var oldClassArray=split(oldClassString),newClassArray=split(newClassString),toRemoveArray=arrayDifference(oldClassArray,newClassArray),toAddArray=arrayDifference(newClassArray,oldClassArray),toRemoveString=digestClassCounts(toRemoveArray,-1),toAddString=digestClassCounts(toAddArray,1);attr.$addClass(toAddString),attr.$removeClass(toRemoveString)}function digestClassCounts(classArray,count){var classesToUpdate=[];return forEach(classArray,function(className){(count>0||classCounts[className])&&(classCounts[className]=(classCounts[className]||0)+count,classCounts[className]===+(count>0)&&classesToUpdate.push(className))}),classesToUpdate.join(" ")}function ngClassIndexWatchAction(newModulo){newModulo===selector?addClasses(oldClassString):removeClasses(oldClassString),oldModulo=newModulo}function ngClassWatchAction(newClassString){isString(newClassString)||(newClassString=toClassString(newClassString)),oldModulo===selector&&updateClasses(oldClassString,newClassString),oldClassString=newClassString}var oldClassString,classCounts=element.data("$classCounts"),oldModulo=!0;classCounts||(classCounts=createMap(),element.data("$classCounts",classCounts)),"ngClass"!==name&&(indexWatchExpression||(indexWatchExpression=$parse("$index",function($index){return 1&$index})),scope.$watch(indexWatchExpression,ngClassIndexWatchAction)),scope.$watch($parse(attr[name],toClassString),ngClassWatchAction)}}}]}function NgModelController($scope,$exceptionHandler,$attr,$element,$parse,$animate,$timeout,$q,$interpolate){this.$viewValue=Number.NaN,this.$modelValue=Number.NaN,this.$$rawModelValue=void 0,this.$validators={},this.$asyncValidators={},this.$parsers=[],this.$formatters=[],this.$viewChangeListeners=[],this.$untouched=!0,this.$touched=!1,this.$pristine=!0,this.$dirty=!1,this.$valid=!0,this.$invalid=!1,this.$error={},this.$$success={},this.$pending=void 0,this.$name=$interpolate($attr.name||"",!1)($scope),this.$$parentForm=nullFormCtrl,this.$options=defaultModelOptions,this.$$parsedNgModel=$parse($attr.ngModel),this.$$parsedNgModelAssign=this.$$parsedNgModel.assign,this.$$ngModelGet=this.$$parsedNgModel,this.$$ngModelSet=this.$$parsedNgModelAssign,this.$$pendingDebounce=null,this.$$parserValid=void 0,this.$$currentValidationRunId=0,Object.defineProperty(this,"$$scope",{value:$scope}),this.$$attr=$attr,this.$$element=$element,this.$$animate=$animate,this.$$timeout=$timeout,this.$$parse=$parse,this.$$q=$q,this.$$exceptionHandler=$exceptionHandler,setupValidity(this),setupModelWatcher(this)}function setupModelWatcher(ctrl){ctrl.$$scope.$watch(function(scope){var modelValue=ctrl.$$ngModelGet(scope);if(modelValue!==ctrl.$modelValue&&(ctrl.$modelValue===ctrl.$modelValue||modelValue===modelValue)){ctrl.$modelValue=ctrl.$$rawModelValue=modelValue,ctrl.$$parserValid=void 0;for(var formatters=ctrl.$formatters,idx=formatters.length,viewValue=modelValue;idx--;)viewValue=formatters[idx](viewValue);ctrl.$viewValue!==viewValue&&(ctrl.$$updateEmptyClasses(viewValue),ctrl.$viewValue=ctrl.$$lastCommittedViewValue=viewValue,ctrl.$render(),ctrl.$$runValidators(ctrl.$modelValue,ctrl.$viewValue,noop))}return modelValue})}function ModelOptions(options){this.$$options=options}function defaults(dst,src){forEach(src,function(value,key){isDefined(dst[key])||(dst[key]=value)})}function setOptionSelectedStatus(optionEl,value){optionEl.prop("selected",value),optionEl.attr("selected",value)}var REGEX_STRING_REGEXP=/^\/(.+)\/([a-z]*)$/,VALIDITY_STATE_PROPERTY="validity",hasOwnProperty=Object.prototype.hasOwnProperty,minErrConfig={objectMaxDepth:5},lowercase=function(string){return isString(string)?string.toLowerCase():string},uppercase=function(string){return isString(string)?string.toUpperCase():string},manualLowercase=function(s){return isString(s)?s.replace(/[A-Z]/g,function(ch){return String.fromCharCode(32|ch.charCodeAt(0))}):s},manualUppercase=function(s){return isString(s)?s.replace(/[a-z]/g,function(ch){return String.fromCharCode(-33&ch.charCodeAt(0))}):s};"i"!=="I".toLowerCase()&&(lowercase=manualLowercase,uppercase=manualUppercase);var msie,jqLite,jQuery,angularModule,slice=[].slice,splice=[].splice,push=[].push,toString=Object.prototype.toString,getPrototypeOf=Object.getPrototypeOf,ngMinErr=minErr("ng"),angular=window.angular||(window.angular={}),uid=0;msie=window.document.documentMode;var isNumberNaN=Number.isNaN||function(num){return num!==num};noop.$inject=[],identity.$inject=[];var isArray=Array.isArray,TYPED_ARRAY_REGEXP=/^\[object (?:Uint8|Uint8Clamped|Uint16|Uint32|Int8|Int16|Int32|Float32|Float64)Array]$/,trim=function(value){return isString(value)?value.trim():value},escapeForRegexp=function(s){return s.replace(/([-()[\]{}+?*.$^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08")},csp=function(){function noUnsafeEval(){try{return new Function(""),!1}catch(e){return!0}}if(!isDefined(csp.rules)){var ngCspElement=window.document.querySelector("[ng-csp]")||window.document.querySelector("[data-ng-csp]");if(ngCspElement){var ngCspAttribute=ngCspElement.getAttribute("ng-csp")||ngCspElement.getAttribute("data-ng-csp");csp.rules={noUnsafeEval:!ngCspAttribute||-1!==ngCspAttribute.indexOf("no-unsafe-eval"),noInlineStyle:!ngCspAttribute||-1!==ngCspAttribute.indexOf("no-inline-style")}}else csp.rules={noUnsafeEval:noUnsafeEval(),noInlineStyle:!1}}return csp.rules},jq=function(){if(isDefined(jq.name_))return jq.name_;var el,i,prefix,name,ii=ngAttrPrefixes.length;for(i=0;i<ii;++i)if(prefix=ngAttrPrefixes[i],el=window.document.querySelector("["+prefix.replace(":","\\:")+"jq]")){name=el.getAttribute(prefix+"jq");break}return jq.name_=name},ALL_COLONS=/:/g,ngAttrPrefixes=["ng-","data-ng-","ng:","x-ng-"],isAutoBootstrapAllowed=allowAutoBootstrap(window.document),SNAKE_CASE_REGEXP=/[A-Z]/g,bindJQueryFired=!1,NODE_TYPE_ELEMENT=1,NODE_TYPE_ATTRIBUTE=2,NODE_TYPE_TEXT=3,NODE_TYPE_COMMENT=8,NODE_TYPE_DOCUMENT=9,NODE_TYPE_DOCUMENT_FRAGMENT=11,version={full:"1.6.4",major:1,minor:6,dot:4,codeName:"phenomenal-footnote"};JQLite.expando="ng339";var jqCache=JQLite.cache={},jqId=1;JQLite._data=function(node){return this.cache[node[this.expando]]||{}};var DASH_LOWERCASE_REGEXP=/-([a-z])/g,MS_HACK_REGEXP=/^-ms-/,MOUSE_EVENT_MAP={mouseleave:"mouseout",mouseenter:"mouseover"},jqLiteMinErr=minErr("jqLite"),SINGLE_TAG_REGEXP=/^<([\w-]+)\s*\/?>(?:<\/\1>|)$/,HTML_REGEXP=/<|&#?\w+;/,TAG_NAME_REGEXP=/<([\w:-]+)/,XHTML_TAG_REGEXP=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:-]+)[^>]*)\/>/gi,wrapMap={option:[1,'<select multiple="multiple">',"</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};wrapMap.optgroup=wrapMap.option,wrapMap.tbody=wrapMap.tfoot=wrapMap.colgroup=wrapMap.caption=wrapMap.thead,wrapMap.th=wrapMap.td;var jqLiteContains=window.Node.prototype.contains||function(arg){return!!(16&this.compareDocumentPosition(arg))},JQLitePrototype=JQLite.prototype={ready:jqLiteReady,toString:function(){var value=[];return forEach(this,function(e){value.push(""+e)}),"["+value.join(", ")+"]"},eq:function(index){return jqLite(index>=0?this[index]:this[this.length+index])},length:0,push:push,sort:[].sort,splice:[].splice},BOOLEAN_ATTR={};forEach("multiple,selected,checked,disabled,readOnly,required,open".split(","),function(value){BOOLEAN_ATTR[lowercase(value)]=value});var BOOLEAN_ELEMENTS={};forEach("input,select,option,textarea,button,form,details".split(","),function(value){BOOLEAN_ELEMENTS[value]=!0});var ALIASED_ATTR={ngMinlength:"minlength",ngMaxlength:"maxlength",ngMin:"min",ngMax:"max",ngPattern:"pattern",ngStep:"step"};forEach({data:jqLiteData,removeData:jqLiteRemoveData,hasData:jqLiteHasData,cleanData:function(nodes){for(var i=0,ii=nodes.length;i<ii;i++)jqLiteRemoveData(nodes[i])}},function(fn,name){JQLite[name]=fn}),forEach({data:jqLiteData,inheritedData:jqLiteInheritedData,scope:function(element){return jqLite.data(element,"$scope")||jqLiteInheritedData(element.parentNode||element,["$isolateScope","$scope"])},isolateScope:function(element){return jqLite.data(element,"$isolateScope")||jqLite.data(element,"$isolateScopeNoTemplate")},controller:jqLiteController,injector:function(element){return jqLiteInheritedData(element,"$injector")},removeAttr:function(element,name){element.removeAttribute(name)},hasClass:jqLiteHasClass,css:function(element,name,value){if(name=cssKebabToCamel(name),!isDefined(value))return element.style[name];element.style[name]=value},attr:function(element,name,value){var ret,nodeType=element.nodeType;if(nodeType!==NODE_TYPE_TEXT&&nodeType!==NODE_TYPE_ATTRIBUTE&&nodeType!==NODE_TYPE_COMMENT&&element.getAttribute){var lowercasedName=lowercase(name),isBooleanAttr=BOOLEAN_ATTR[lowercasedName];if(!isDefined(value))return ret=element.getAttribute(name),isBooleanAttr&&null!==ret&&(ret=lowercasedName),null===ret?void 0:ret;null===value||!1===value&&isBooleanAttr?element.removeAttribute(name):element.setAttribute(name,isBooleanAttr?lowercasedName:value)}},prop:function(element,name,value){if(!isDefined(value))return element[name];element[name]=value},text:function(){function getText(element,value){if(isUndefined(value)){var nodeType=element.nodeType;return nodeType===NODE_TYPE_ELEMENT||nodeType===NODE_TYPE_TEXT?element.textContent:""}element.textContent=value}return getText.$dv="",getText}(),val:function(element,value){if(isUndefined(value)){if(element.multiple&&"select"===nodeName_(element)){var result=[];return forEach(element.options,function(option){option.selected&&result.push(option.value||option.text)}),result}return element.value}element.value=value},html:function(element,value){if(isUndefined(value))return element.innerHTML;jqLiteDealoc(element,!0),element.innerHTML=value},empty:jqLiteEmpty},function(fn,name){JQLite.prototype[name]=function(arg1,arg2){var i,key,nodeCount=this.length;if(fn!==jqLiteEmpty&&isUndefined(2===fn.length&&fn!==jqLiteHasClass&&fn!==jqLiteController?arg1:arg2)){if(isObject(arg1)){for(i=0;i<nodeCount;i++)if(fn===jqLiteData)fn(this[i],arg1);else for(key in arg1)fn(this[i],key,arg1[key]);return this}for(var value=fn.$dv,jj=isUndefined(value)?Math.min(nodeCount,1):nodeCount,j=0;j<jj;j++){var nodeValue=fn(this[j],arg1,arg2);value=value?value+nodeValue:nodeValue}return value}for(i=0;i<nodeCount;i++)fn(this[i],arg1,arg2);return this}}),forEach({removeData:jqLiteRemoveData,on:function(element,type,fn,unsupported){if(isDefined(unsupported))throw jqLiteMinErr("onargs","jqLite#on() does not support the `selector` or `eventData` parameters");if(jqLiteAcceptsData(element)){var expandoStore=jqLiteExpandoStore(element,!0),events=expandoStore.events,handle=expandoStore.handle;handle||(handle=expandoStore.handle=createEventHandler(element,events));for(var types=type.indexOf(" ")>=0?type.split(" "):[type],i=types.length,addHandler=function(type,specialHandlerWrapper,noEventListener){var eventFns=events[type];eventFns||(eventFns=events[type]=[],eventFns.specialHandlerWrapper=specialHandlerWrapper,"$destroy"===type||noEventListener||element.addEventListener(type,handle)),eventFns.push(fn)};i--;)type=types[i],MOUSE_EVENT_MAP[type]?(addHandler(MOUSE_EVENT_MAP[type],specialMouseHandlerWrapper),addHandler(type,void 0,!0)):addHandler(type)}},off:jqLiteOff,one:function(element,type,fn){element=jqLite(element),element.on(type,function onFn(){element.off(type,fn),element.off(type,onFn)}),element.on(type,fn)},replaceWith:function(element,replaceNode){var index,parent=element.parentNode;jqLiteDealoc(element),forEach(new JQLite(replaceNode),function(node){index?parent.insertBefore(node,index.nextSibling):parent.replaceChild(node,element),index=node})},children:function(element){var children=[];return forEach(element.childNodes,function(element){element.nodeType===NODE_TYPE_ELEMENT&&children.push(element)}),children},contents:function(element){return element.contentDocument||element.childNodes||[]},append:function(element,node){var nodeType=element.nodeType;if(nodeType===NODE_TYPE_ELEMENT||nodeType===NODE_TYPE_DOCUMENT_FRAGMENT){node=new JQLite(node);for(var i=0,ii=node.length;i<ii;i++){var child=node[i];element.appendChild(child)}}},prepend:function(element,node){if(element.nodeType===NODE_TYPE_ELEMENT){var index=element.firstChild;forEach(new JQLite(node),function(child){element.insertBefore(child,index)})}},wrap:function(element,wrapNode){jqLiteWrapNode(element,jqLite(wrapNode).eq(0).clone()[0])},remove:jqLiteRemove,detach:function(element){jqLiteRemove(element,!0)},after:function(element,newElement){var index=element,parent=element.parentNode;if(parent){newElement=new JQLite(newElement);for(var i=0,ii=newElement.length;i<ii;i++){var node=newElement[i];parent.insertBefore(node,index.nextSibling),index=node}}},addClass:jqLiteAddClass,removeClass:jqLiteRemoveClass,toggleClass:function(element,selector,condition){selector&&forEach(selector.split(" "),function(className){var classCondition=condition;isUndefined(classCondition)&&(classCondition=!jqLiteHasClass(element,className)),(classCondition?jqLiteAddClass:jqLiteRemoveClass)(element,className)})},parent:function(element){var parent=element.parentNode;return parent&&parent.nodeType!==NODE_TYPE_DOCUMENT_FRAGMENT?parent:null},next:function(element){return element.nextElementSibling},find:function(element,selector){return element.getElementsByTagName?element.getElementsByTagName(selector):[]},clone:jqLiteClone,triggerHandler:function(element,event,extraParameters){var dummyEvent,eventFnsCopy,handlerArgs,eventName=event.type||event,expandoStore=jqLiteExpandoStore(element),events=expandoStore&&expandoStore.events,eventFns=events&&events[eventName];eventFns&&(dummyEvent={preventDefault:function(){this.defaultPrevented=!0},isDefaultPrevented:function(){return!0===this.defaultPrevented},stopImmediatePropagation:function(){this.immediatePropagationStopped=!0},isImmediatePropagationStopped:function(){return!0===this.immediatePropagationStopped},stopPropagation:noop,type:eventName,target:element},event.type&&(dummyEvent=extend(dummyEvent,event)),eventFnsCopy=shallowCopy(eventFns),handlerArgs=extraParameters?[dummyEvent].concat(extraParameters):[dummyEvent],forEach(eventFnsCopy,function(fn){dummyEvent.isImmediatePropagationStopped()||fn.apply(element,handlerArgs)}))}},function(fn,name){JQLite.prototype[name]=function(arg1,arg2,arg3){for(var value,i=0,ii=this.length;i<ii;i++)isUndefined(value)?(value=fn(this[i],arg1,arg2,arg3),isDefined(value)&&(value=jqLite(value))):jqLiteAddNodes(value,fn(this[i],arg1,arg2,arg3));return isDefined(value)?value:this}}),JQLite.prototype.bind=JQLite.prototype.on,JQLite.prototype.unbind=JQLite.prototype.off;var nanKey=Object.create(null);NgMapShim.prototype={_idx:function(key){return key===this._lastKey?this._lastIndex:(this._lastKey=key,this._lastIndex=this._keys.indexOf(key),this._lastIndex)},_transformKey:function(key){return isNumberNaN(key)?nanKey:key},get:function(key){key=this._transformKey(key);var idx=this._idx(key);if(-1!==idx)return this._values[idx]},set:function(key,value){key=this._transformKey(key);var idx=this._idx(key);-1===idx&&(idx=this._lastIndex=this._keys.length),this._keys[idx]=key,this._values[idx]=value},delete:function(key){key=this._transformKey(key);var idx=this._idx(key);return-1!==idx&&(this._keys.splice(idx,1),this._values.splice(idx,1),this._lastKey=NaN,this._lastIndex=-1,!0)}};var NgMap=NgMapShim,$$MapProvider=[function(){this.$get=[function(){return NgMap}]}],ARROW_ARG=/^([^(]+?)=>/,FN_ARGS=/^[^(]*\(\s*([^)]*)\)/m,FN_ARG_SPLIT=/,/,FN_ARG=/^\s*(_?)(\S+?)\1\s*$/,STRIP_COMMENTS=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm,$injectorMinErr=minErr("$injector");createInjector.$$annotate=annotate;var $animateMinErr=minErr("$animate"),ELEMENT_NODE=1,NG_ANIMATE_CLASSNAME="ng-animate",$$CoreAnimateJsProvider=function(){this.$get=noop},$$CoreAnimateQueueProvider=function(){var postDigestQueue=new NgMap,postDigestElements=[];this.$get=["$$AnimateRunner","$rootScope",function($$AnimateRunner,$rootScope){function updateData(data,classes,value){var changed=!1;return classes&&(classes=isString(classes)?classes.split(" "):isArray(classes)?classes:[],forEach(classes,function(className){className&&(changed=!0,data[className]=value)})),changed}function handleCSSClassChanges(){forEach(postDigestElements,function(element){var data=postDigestQueue.get(element);if(data){var existing=splitClasses(element.attr("class")),toAdd="",toRemove="";forEach(data,function(status,className){status!==!!existing[className]&&(status?toAdd+=(toAdd.length?" ":"")+className:toRemove+=(toRemove.length?" ":"")+className)}),forEach(element,function(elm){toAdd&&jqLiteAddClass(elm,toAdd),toRemove&&jqLiteRemoveClass(elm,toRemove)}),postDigestQueue.delete(element)}}),postDigestElements.length=0}function addRemoveClassesPostDigest(element,add,remove){var data=postDigestQueue.get(element)||{},classesAdded=updateData(data,add,!0),classesRemoved=updateData(data,remove,!1);(classesAdded||classesRemoved)&&(postDigestQueue.set(element,data),postDigestElements.push(element),1===postDigestElements.length&&$rootScope.$$postDigest(handleCSSClassChanges))}return{enabled:noop,on:noop,off:noop,pin:noop,push:function(element,event,options,domOperation){domOperation&&domOperation(),options=options||{},options.from&&element.css(options.from),options.to&&element.css(options.to),(options.addClass||options.removeClass)&&addRemoveClassesPostDigest(element,options.addClass,options.removeClass);var runner=new $$AnimateRunner;return runner.complete(),runner}}}]},$AnimateProvider=["$provide",function($provide){var provider=this,classNameFilter=null;this.$$registeredAnimations=Object.create(null),this.register=function(name,factory){if(name&&"."!==name.charAt(0))throw $animateMinErr("notcsel","Expecting class selector starting with '.' got '{0}'.",name);var key=name+"-animation";provider.$$registeredAnimations[name.substr(1)]=key,$provide.factory(key,factory)},this.classNameFilter=function(expression){if(1===arguments.length&&(classNameFilter=expression instanceof RegExp?expression:null)){if(new RegExp("[(\\s|\\/)]"+NG_ANIMATE_CLASSNAME+"[(\\s|\\/)]").test(classNameFilter.toString()))throw classNameFilter=null,$animateMinErr("nongcls",'$animateProvider.classNameFilter(regex) prohibits accepting a regex value which matches/contains the "{0}" CSS class.',NG_ANIMATE_CLASSNAME)}return classNameFilter},this.$get=["$$animateQueue",function($$animateQueue){function domInsert(element,parentElement,afterElement){if(afterElement){var afterNode=extractElementNode(afterElement);!afterNode||afterNode.parentNode||afterNode.previousElementSibling||(afterElement=null)}afterElement?afterElement.after(element):parentElement.prepend(element)}return{on:$$animateQueue.on,off:$$animateQueue.off,pin:$$animateQueue.pin,enabled:$$animateQueue.enabled,cancel:function(runner){runner.end&&runner.end()},enter:function(element,parent,after,options){return parent=parent&&jqLite(parent),after=after&&jqLite(after),parent=parent||after.parent(),domInsert(element,parent,after),$$animateQueue.push(element,"enter",prepareAnimateOptions(options))},move:function(element,parent,after,options){return parent=parent&&jqLite(parent),after=after&&jqLite(after),parent=parent||after.parent(),domInsert(element,parent,after),$$animateQueue.push(element,"move",prepareAnimateOptions(options))},leave:function(element,options){return $$animateQueue.push(element,"leave",prepareAnimateOptions(options),function(){element.remove()})},addClass:function(element,className,options){return options=prepareAnimateOptions(options),options.addClass=mergeClasses(options.addclass,className),$$animateQueue.push(element,"addClass",options)},removeClass:function(element,className,options){return options=prepareAnimateOptions(options),options.removeClass=mergeClasses(options.removeClass,className),$$animateQueue.push(element,"removeClass",options)},setClass:function(element,add,remove,options){return options=prepareAnimateOptions(options),options.addClass=mergeClasses(options.addClass,add),options.removeClass=mergeClasses(options.removeClass,remove),$$animateQueue.push(element,"setClass",options)},animate:function(element,from,to,className,options){return options=prepareAnimateOptions(options),options.from=options.from?extend(options.from,from):from,options.to=options.to?extend(options.to,to):to,className=className||"ng-inline-animate",options.tempClasses=mergeClasses(options.tempClasses,className),$$animateQueue.push(element,"animate",options)}}}]}],$$AnimateAsyncRunFactoryProvider=function(){this.$get=["$$rAF",function($$rAF){function waitForTick(fn){waitQueue.push(fn),waitQueue.length>1||$$rAF(function(){for(var i=0;i<waitQueue.length;i++)waitQueue[i]();waitQueue=[]})}var waitQueue=[];return function(){var passed=!1;return waitForTick(function(){passed=!0}),function(callback){passed?callback():waitForTick(callback)}}}]},$$AnimateRunnerFactoryProvider=function(){this.$get=["$q","$sniffer","$$animateAsyncRun","$$isDocumentHidden","$timeout",function($q,$sniffer,$$animateAsyncRun,$$isDocumentHidden,$timeout){function AnimateRunner(host){this.setHost(host);var rafTick=$$animateAsyncRun(),timeoutTick=function(fn){$timeout(fn,0,!1)};this._doneCallbacks=[],this._tick=function(fn){$$isDocumentHidden()?timeoutTick(fn):rafTick(fn)},this._state=0}var DONE_COMPLETE_STATE=2;return AnimateRunner.chain=function(chain,callback){function next(){if(index===chain.length)return void callback(!0);chain[index](function(response){if(!1===response)return void callback(!1);index++,next()})}var index=0;next()},AnimateRunner.all=function(runners,callback){function onProgress(response){status=status&&response,++count===runners.length&&callback(status)}var count=0,status=!0;forEach(runners,function(runner){runner.done(onProgress)})},AnimateRunner.prototype={setHost:function(host){this.host=host||{}},done:function(fn){this._state===DONE_COMPLETE_STATE?fn():this._doneCallbacks.push(fn)},progress:noop,getPromise:function(){if(!this.promise){var self=this;this.promise=$q(function(resolve,reject){self.done(function(status){!1===status?reject():resolve()})})}return this.promise},then:function(resolveHandler,rejectHandler){return this.getPromise().then(resolveHandler,rejectHandler)},catch:function(handler){return this.getPromise().catch(handler)},finally:function(handler){return this.getPromise().finally(handler)},pause:function(){this.host.pause&&this.host.pause()},resume:function(){this.host.resume&&this.host.resume()},end:function(){this.host.end&&this.host.end(),this._resolve(!0)},cancel:function(){this.host.cancel&&this.host.cancel(),this._resolve(!1)},complete:function(response){var self=this;0===self._state&&(self._state=1,self._tick(function(){self._resolve(response)}))},_resolve:function(response){this._state!==DONE_COMPLETE_STATE&&(forEach(this._doneCallbacks,function(fn){fn(response)}),this._doneCallbacks.length=0,this._state=DONE_COMPLETE_STATE)}},AnimateRunner}]},$CoreAnimateCssProvider=function(){this.$get=["$$rAF","$q","$$AnimateRunner",function($$rAF,$q,$$AnimateRunner){return function(element,initialOptions){function run(){return $$rAF(function(){applyAnimationContents(),closed||runner.complete(),closed=!0}),runner}function applyAnimationContents(){options.addClass&&(element.addClass(options.addClass),options.addClass=null),options.removeClass&&(element.removeClass(options.removeClass),options.removeClass=null),options.to&&(element.css(options.to),options.to=null)}var options=initialOptions||{};options.$$prepared||(options=copy(options)),options.cleanupStyles&&(options.from=options.to=null),options.from&&(element.css(options.from),options.from=null);var closed,runner=new $$AnimateRunner;return{start:run,end:run}}}]},$compileMinErr=minErr("$compile"),_UNINITIALIZED_VALUE=new UNINITIALIZED_VALUE;$CompileProvider.$inject=["$provide","$$sanitizeUriProvider"],SimpleChange.prototype.isFirstChange=function(){return this.previousValue===_UNINITIALIZED_VALUE};var PREFIX_REGEXP=/^((?:x|data)[:\-_])/i,SPECIAL_CHARS_REGEXP=/[:\-_]+(.)/g,$controllerMinErr=minErr("$controller"),CNTRL_REG=/^(\S+)(\s+as\s+([\w$]+))?$/,$$ForceReflowProvider=function(){this.$get=["$document",function($document){return function(domNode){return domNode?!domNode.nodeType&&domNode instanceof jqLite&&(domNode=domNode[0]):domNode=$document[0].body,domNode.offsetWidth+1}}]},APPLICATION_JSON="application/json",CONTENT_TYPE_APPLICATION_JSON={"Content-Type":APPLICATION_JSON+";charset=utf-8"},JSON_START=/^\[|^\{(?!\{)/,JSON_ENDS={"[":/]$/,"{":/}$/},JSON_PROTECTION_PREFIX=/^\)]\}',?\n/,$httpMinErr=minErr("$http"),$interpolateMinErr=angular.$interpolateMinErr=minErr("$interpolate");$interpolateMinErr.throwNoconcat=function(text){throw $interpolateMinErr("noconcat","Error while interpolating: {0}\nStrict Contextual Escaping disallows interpolations that concatenate multiple expressions when a trusted value is required.  See http://docs.angularjs.org/api/ng.$sce",text)},$interpolateMinErr.interr=function(text,err){return $interpolateMinErr("interr","Can't interpolate: {0}\n{1}",text,err.toString())};var $jsonpCallbacksProvider=function(){this.$get=function(){function createCallback(callbackId){var callback=function(data){callback.data=data,callback.called=!0};return callback.id=callbackId,callback}var callbacks=angular.callbacks,callbackMap={};return{createCallback:function(url){var callbackId="_"+(callbacks.$$counter++).toString(36),callbackPath="angular.callbacks."+callbackId,callback=createCallback(callbackId);return callbackMap[callbackPath]=callbacks[callbackId]=callback,callbackPath},wasCalled:function(callbackPath){return callbackMap[callbackPath].called},getResponse:function(callbackPath){return callbackMap[callbackPath].data},removeCallback:function(callbackPath){var callback=callbackMap[callbackPath];delete callbacks[callback.id],delete callbackMap[callbackPath]}}}},PATH_MATCH=/^([^?#]*)(\?([^#]*))?(#(.*))?$/,DEFAULT_PORTS={http:80,https:443,ftp:21},$locationMinErr=minErr("$location"),DOUBLE_SLASH_REGEX=/^\s*[\\/]{2,}/,locationPrototype={$$absUrl:"",$$html5:!1,$$replace:!1,absUrl:locationGetter("$$absUrl"),url:function(url){if(isUndefined(url))return this.$$url;var match=PATH_MATCH.exec(url);return(match[1]||""===url)&&this.path(decodeURIComponent(match[1])),(match[2]||match[1]||""===url)&&this.search(match[3]||""),this.hash(match[5]||""),this},protocol:locationGetter("$$protocol"),host:locationGetter("$$host"),port:locationGetter("$$port"),path:locationGetterSetter("$$path",function(path){return path=null!==path?path.toString():"","/"===path.charAt(0)?path:"/"+path}),search:function(search,paramValue){switch(arguments.length){case 0:return this.$$search;case 1:if(isString(search)||isNumber(search))search=search.toString(),this.$$search=parseKeyValue(search);else{if(!isObject(search))throw $locationMinErr("isrcharg","The first argument of the `$location#search()` call must be a string or an object.");search=copy(search,{}),forEach(search,function(value,key){null==value&&delete search[key]}),this.$$search=search}break;default:isUndefined(paramValue)||null===paramValue?delete this.$$search[search]:this.$$search[search]=paramValue}return this.$$compose(),this},hash:locationGetterSetter("$$hash",function(hash){return null!==hash?hash.toString():""}),replace:function(){return this.$$replace=!0,this}};forEach([LocationHashbangInHtml5Url,LocationHashbangUrl,LocationHtml5Url],function(Location){Location.prototype=Object.create(locationPrototype),Location.prototype.state=function(state){if(!arguments.length)return this.$$state;if(Location!==LocationHtml5Url||!this.$$html5)throw $locationMinErr("nostate","History API state support is available only in HTML5 mode and only in browsers supporting HTML5 History API");return this.$$state=isUndefined(state)?null:state,this.$$urlUpdatedByLocation=!0,this}});var $parseMinErr=minErr("$parse"),objectValueOf={}.constructor.prototype.valueOf,OPERATORS=createMap();forEach("+ - * / % === !== == != < > <= >= && || ! = |".split(" "),function(operator){OPERATORS[operator]=!0});var ESCAPE={n:"\n",f:"\f",r:"\r",t:"\t",v:"\v","'":"'",'"':'"'},Lexer=function(options){this.options=options};Lexer.prototype={constructor:Lexer,lex:function(text){for(this.text=text,this.index=0,this.tokens=[];this.index<this.text.length;){var ch=this.text.charAt(this.index);if('"'===ch||"'"===ch)this.readString(ch);else if(this.isNumber(ch)||"."===ch&&this.isNumber(this.peek()))this.readNumber();else if(this.isIdentifierStart(this.peekMultichar()))this.readIdent();else if(this.is(ch,"(){}[].,;:?"))this.tokens.push({index:this.index,text:ch}),this.index++;else if(this.isWhitespace(ch))this.index++;else{var ch2=ch+this.peek(),ch3=ch2+this.peek(2),op1=OPERATORS[ch],op2=OPERATORS[ch2],op3=OPERATORS[ch3];if(op1||op2||op3){var token=op3?ch3:op2?ch2:ch;this.tokens.push({index:this.index,text:token,operator:!0}),this.index+=token.length}else this.throwError("Unexpected next character ",this.index,this.index+1)}}return this.tokens},is:function(ch,chars){return-1!==chars.indexOf(ch)},peek:function(i){var num=i||1;return this.index+num<this.text.length&&this.text.charAt(this.index+num)},isNumber:function(ch){return"0"<=ch&&ch<="9"&&"string"==typeof ch},isWhitespace:function(ch){return" "===ch||"\r"===ch||"\t"===ch||"\n"===ch||"\v"===ch||" "===ch},isIdentifierStart:function(ch){
return this.options.isIdentifierStart?this.options.isIdentifierStart(ch,this.codePointAt(ch)):this.isValidIdentifierStart(ch)},isValidIdentifierStart:function(ch){return"a"<=ch&&ch<="z"||"A"<=ch&&ch<="Z"||"_"===ch||"$"===ch},isIdentifierContinue:function(ch){return this.options.isIdentifierContinue?this.options.isIdentifierContinue(ch,this.codePointAt(ch)):this.isValidIdentifierContinue(ch)},isValidIdentifierContinue:function(ch,cp){return this.isValidIdentifierStart(ch,cp)||this.isNumber(ch)},codePointAt:function(ch){return 1===ch.length?ch.charCodeAt(0):(ch.charCodeAt(0)<<10)+ch.charCodeAt(1)-56613888},peekMultichar:function(){var ch=this.text.charAt(this.index),peek=this.peek();if(!peek)return ch;var cp1=ch.charCodeAt(0),cp2=peek.charCodeAt(0);return cp1>=55296&&cp1<=56319&&cp2>=56320&&cp2<=57343?ch+peek:ch},isExpOperator:function(ch){return"-"===ch||"+"===ch||this.isNumber(ch)},throwError:function(error,start,end){end=end||this.index;var colStr=isDefined(start)?"s "+start+"-"+this.index+" ["+this.text.substring(start,end)+"]":" "+end;throw $parseMinErr("lexerr","Lexer Error: {0} at column{1} in expression [{2}].",error,colStr,this.text)},readNumber:function(){for(var number="",start=this.index;this.index<this.text.length;){var ch=lowercase(this.text.charAt(this.index));if("."===ch||this.isNumber(ch))number+=ch;else{var peekCh=this.peek();if("e"===ch&&this.isExpOperator(peekCh))number+=ch;else if(this.isExpOperator(ch)&&peekCh&&this.isNumber(peekCh)&&"e"===number.charAt(number.length-1))number+=ch;else{if(!this.isExpOperator(ch)||peekCh&&this.isNumber(peekCh)||"e"!==number.charAt(number.length-1))break;this.throwError("Invalid exponent")}}this.index++}this.tokens.push({index:start,text:number,constant:!0,value:Number(number)})},readIdent:function(){var start=this.index;for(this.index+=this.peekMultichar().length;this.index<this.text.length;){var ch=this.peekMultichar();if(!this.isIdentifierContinue(ch))break;this.index+=ch.length}this.tokens.push({index:start,text:this.text.slice(start,this.index),identifier:!0})},readString:function(quote){var start=this.index;this.index++;for(var string="",rawString=quote,escape=!1;this.index<this.text.length;){var ch=this.text.charAt(this.index);if(rawString+=ch,escape){if("u"===ch){var hex=this.text.substring(this.index+1,this.index+5);hex.match(/[\da-f]{4}/i)||this.throwError("Invalid unicode escape [\\u"+hex+"]"),this.index+=4,string+=String.fromCharCode(parseInt(hex,16))}else{string+=ESCAPE[ch]||ch}escape=!1}else if("\\"===ch)escape=!0;else{if(ch===quote)return this.index++,void this.tokens.push({index:start,text:rawString,constant:!0,value:string});string+=ch}this.index++}this.throwError("Unterminated quote",start)}};var AST=function(lexer,options){this.lexer=lexer,this.options=options};AST.Program="Program",AST.ExpressionStatement="ExpressionStatement",AST.AssignmentExpression="AssignmentExpression",AST.ConditionalExpression="ConditionalExpression",AST.LogicalExpression="LogicalExpression",AST.BinaryExpression="BinaryExpression",AST.UnaryExpression="UnaryExpression",AST.CallExpression="CallExpression",AST.MemberExpression="MemberExpression",AST.Identifier="Identifier",AST.Literal="Literal",AST.ArrayExpression="ArrayExpression",AST.Property="Property",AST.ObjectExpression="ObjectExpression",AST.ThisExpression="ThisExpression",AST.LocalsExpression="LocalsExpression",AST.NGValueParameter="NGValueParameter",AST.prototype={ast:function(text){this.text=text,this.tokens=this.lexer.lex(text);var value=this.program();return 0!==this.tokens.length&&this.throwError("is an unexpected token",this.tokens[0]),value},program:function(){for(var body=[];;)if(this.tokens.length>0&&!this.peek("}",")",";","]")&&body.push(this.expressionStatement()),!this.expect(";"))return{type:AST.Program,body:body}},expressionStatement:function(){return{type:AST.ExpressionStatement,expression:this.filterChain()}},filterChain:function(){for(var left=this.expression();this.expect("|");)left=this.filter(left);return left},expression:function(){return this.assignment()},assignment:function(){var result=this.ternary();if(this.expect("=")){if(!isAssignable(result))throw $parseMinErr("lval","Trying to assign a value to a non l-value");result={type:AST.AssignmentExpression,left:result,right:this.assignment(),operator:"="}}return result},ternary:function(){var alternate,consequent,test=this.logicalOR();return this.expect("?")&&(alternate=this.expression(),this.consume(":"))?(consequent=this.expression(),{type:AST.ConditionalExpression,test:test,alternate:alternate,consequent:consequent}):test},logicalOR:function(){for(var left=this.logicalAND();this.expect("||");)left={type:AST.LogicalExpression,operator:"||",left:left,right:this.logicalAND()};return left},logicalAND:function(){for(var left=this.equality();this.expect("&&");)left={type:AST.LogicalExpression,operator:"&&",left:left,right:this.equality()};return left},equality:function(){for(var token,left=this.relational();token=this.expect("==","!=","===","!==");)left={type:AST.BinaryExpression,operator:token.text,left:left,right:this.relational()};return left},relational:function(){for(var token,left=this.additive();token=this.expect("<",">","<=",">=");)left={type:AST.BinaryExpression,operator:token.text,left:left,right:this.additive()};return left},additive:function(){for(var token,left=this.multiplicative();token=this.expect("+","-");)left={type:AST.BinaryExpression,operator:token.text,left:left,right:this.multiplicative()};return left},multiplicative:function(){for(var token,left=this.unary();token=this.expect("*","/","%");)left={type:AST.BinaryExpression,operator:token.text,left:left,right:this.unary()};return left},unary:function(){var token;return(token=this.expect("+","-","!"))?{type:AST.UnaryExpression,operator:token.text,prefix:!0,argument:this.unary()}:this.primary()},primary:function(){var primary;this.expect("(")?(primary=this.filterChain(),this.consume(")")):this.expect("[")?primary=this.arrayDeclaration():this.expect("{")?primary=this.object():this.selfReferential.hasOwnProperty(this.peek().text)?primary=copy(this.selfReferential[this.consume().text]):this.options.literals.hasOwnProperty(this.peek().text)?primary={type:AST.Literal,value:this.options.literals[this.consume().text]}:this.peek().identifier?primary=this.identifier():this.peek().constant?primary=this.constant():this.throwError("not a primary expression",this.peek());for(var next;next=this.expect("(","[",".");)"("===next.text?(primary={type:AST.CallExpression,callee:primary,arguments:this.parseArguments()},this.consume(")")):"["===next.text?(primary={type:AST.MemberExpression,object:primary,property:this.expression(),computed:!0},this.consume("]")):"."===next.text?primary={type:AST.MemberExpression,object:primary,property:this.identifier(),computed:!1}:this.throwError("IMPOSSIBLE");return primary},filter:function(baseExpression){for(var args=[baseExpression],result={type:AST.CallExpression,callee:this.identifier(),arguments:args,filter:!0};this.expect(":");)args.push(this.expression());return result},parseArguments:function(){var args=[];if(")"!==this.peekToken().text)do{args.push(this.filterChain())}while(this.expect(","));return args},identifier:function(){var token=this.consume();return token.identifier||this.throwError("is not a valid identifier",token),{type:AST.Identifier,name:token.text}},constant:function(){return{type:AST.Literal,value:this.consume().value}},arrayDeclaration:function(){var elements=[];if("]"!==this.peekToken().text)do{if(this.peek("]"))break;elements.push(this.expression())}while(this.expect(","));return this.consume("]"),{type:AST.ArrayExpression,elements:elements}},object:function(){var property,properties=[];if("}"!==this.peekToken().text)do{if(this.peek("}"))break;property={type:AST.Property,kind:"init"},this.peek().constant?(property.key=this.constant(),property.computed=!1,this.consume(":"),property.value=this.expression()):this.peek().identifier?(property.key=this.identifier(),property.computed=!1,this.peek(":")?(this.consume(":"),property.value=this.expression()):property.value=property.key):this.peek("[")?(this.consume("["),property.key=this.expression(),this.consume("]"),property.computed=!0,this.consume(":"),property.value=this.expression()):this.throwError("invalid key",this.peek()),properties.push(property)}while(this.expect(","));return this.consume("}"),{type:AST.ObjectExpression,properties:properties}},throwError:function(msg,token){throw $parseMinErr("syntax","Syntax Error: Token '{0}' {1} at column {2} of the expression [{3}] starting at [{4}].",token.text,msg,token.index+1,this.text,this.text.substring(token.index))},consume:function(e1){if(0===this.tokens.length)throw $parseMinErr("ueoe","Unexpected end of expression: {0}",this.text);var token=this.expect(e1);return token||this.throwError("is unexpected, expecting ["+e1+"]",this.peek()),token},peekToken:function(){if(0===this.tokens.length)throw $parseMinErr("ueoe","Unexpected end of expression: {0}",this.text);return this.tokens[0]},peek:function(e1,e2,e3,e4){return this.peekAhead(0,e1,e2,e3,e4)},peekAhead:function(i,e1,e2,e3,e4){if(this.tokens.length>i){var token=this.tokens[i],t=token.text;if(t===e1||t===e2||t===e3||t===e4||!e1&&!e2&&!e3&&!e4)return token}return!1},expect:function(e1,e2,e3,e4){var token=this.peek(e1,e2,e3,e4);return!!token&&(this.tokens.shift(),token)},selfReferential:{this:{type:AST.ThisExpression},$locals:{type:AST.LocalsExpression}}},ASTCompiler.prototype={compile:function(ast){var self=this;this.state={nextId:0,filters:{},fn:{vars:[],body:[],own:{}},assign:{vars:[],body:[],own:{}},inputs:[]},findConstantAndWatchExpressions(ast,self.$filter);var assignable,extra="";if(this.stage="assign",assignable=assignableAST(ast)){this.state.computing="assign";var result=this.nextId();this.recurse(assignable,result),this.return_(result),extra="fn.assign="+this.generateFunction("assign","s,v,l")}var toWatch=getInputs(ast.body);self.stage="inputs",forEach(toWatch,function(watch,key){var fnKey="fn"+key;self.state[fnKey]={vars:[],body:[],own:{}},self.state.computing=fnKey;var intoId=self.nextId();self.recurse(watch,intoId),self.return_(intoId),self.state.inputs.push(fnKey),watch.watchId=key}),this.state.computing="fn",this.stage="main",this.recurse(ast);var fnString='"'+this.USE+" "+this.STRICT+'";\n'+this.filterPrefix()+"var fn="+this.generateFunction("fn","s,l,a,i")+extra+this.watchFns()+"return fn;",fn=new Function("$filter","getStringValue","ifDefined","plus",fnString)(this.$filter,getStringValue,ifDefined,plusFn);return this.state=this.stage=void 0,fn},USE:"use",STRICT:"strict",watchFns:function(){var result=[],fns=this.state.inputs,self=this;return forEach(fns,function(name){result.push("var "+name+"="+self.generateFunction(name,"s"))}),fns.length&&result.push("fn.inputs=["+fns.join(",")+"];"),result.join("")},generateFunction:function(name,params){return"function("+params+"){"+this.varsPrefix(name)+this.body(name)+"};"},filterPrefix:function(){var parts=[],self=this;return forEach(this.state.filters,function(id,filter){parts.push(id+"=$filter("+self.escape(filter)+")")}),parts.length?"var "+parts.join(",")+";":""},varsPrefix:function(section){return this.state[section].vars.length?"var "+this.state[section].vars.join(",")+";":""},body:function(section){return this.state[section].body.join("")},recurse:function(ast,intoId,nameId,recursionFn,create,skipWatchIdCheck){var left,right,args,expression,computed,self=this;if(recursionFn=recursionFn||noop,!skipWatchIdCheck&&isDefined(ast.watchId))return intoId=intoId||this.nextId(),void this.if_("i",this.lazyAssign(intoId,this.computedMember("i",ast.watchId)),this.lazyRecurse(ast,intoId,nameId,recursionFn,create,!0));switch(ast.type){case AST.Program:forEach(ast.body,function(expression,pos){self.recurse(expression.expression,void 0,void 0,function(expr){right=expr}),pos!==ast.body.length-1?self.current().body.push(right,";"):self.return_(right)});break;case AST.Literal:expression=this.escape(ast.value),this.assign(intoId,expression),recursionFn(intoId||expression);break;case AST.UnaryExpression:this.recurse(ast.argument,void 0,void 0,function(expr){right=expr}),expression=ast.operator+"("+this.ifDefined(right,0)+")",this.assign(intoId,expression),recursionFn(expression);break;case AST.BinaryExpression:this.recurse(ast.left,void 0,void 0,function(expr){left=expr}),this.recurse(ast.right,void 0,void 0,function(expr){right=expr}),expression="+"===ast.operator?this.plus(left,right):"-"===ast.operator?this.ifDefined(left,0)+ast.operator+this.ifDefined(right,0):"("+left+")"+ast.operator+"("+right+")",this.assign(intoId,expression),recursionFn(expression);break;case AST.LogicalExpression:intoId=intoId||this.nextId(),self.recurse(ast.left,intoId),self.if_("&&"===ast.operator?intoId:self.not(intoId),self.lazyRecurse(ast.right,intoId)),recursionFn(intoId);break;case AST.ConditionalExpression:intoId=intoId||this.nextId(),self.recurse(ast.test,intoId),self.if_(intoId,self.lazyRecurse(ast.alternate,intoId),self.lazyRecurse(ast.consequent,intoId)),recursionFn(intoId);break;case AST.Identifier:intoId=intoId||this.nextId(),nameId&&(nameId.context="inputs"===self.stage?"s":this.assign(this.nextId(),this.getHasOwnProperty("l",ast.name)+"?l:s"),nameId.computed=!1,nameId.name=ast.name),self.if_("inputs"===self.stage||self.not(self.getHasOwnProperty("l",ast.name)),function(){self.if_("inputs"===self.stage||"s",function(){create&&1!==create&&self.if_(self.isNull(self.nonComputedMember("s",ast.name)),self.lazyAssign(self.nonComputedMember("s",ast.name),"{}")),self.assign(intoId,self.nonComputedMember("s",ast.name))})},intoId&&self.lazyAssign(intoId,self.nonComputedMember("l",ast.name))),recursionFn(intoId);break;case AST.MemberExpression:left=nameId&&(nameId.context=this.nextId())||this.nextId(),intoId=intoId||this.nextId(),self.recurse(ast.object,left,void 0,function(){self.if_(self.notNull(left),function(){ast.computed?(right=self.nextId(),self.recurse(ast.property,right),self.getStringValue(right),create&&1!==create&&self.if_(self.not(self.computedMember(left,right)),self.lazyAssign(self.computedMember(left,right),"{}")),expression=self.computedMember(left,right),self.assign(intoId,expression),nameId&&(nameId.computed=!0,nameId.name=right)):(create&&1!==create&&self.if_(self.isNull(self.nonComputedMember(left,ast.property.name)),self.lazyAssign(self.nonComputedMember(left,ast.property.name),"{}")),expression=self.nonComputedMember(left,ast.property.name),self.assign(intoId,expression),nameId&&(nameId.computed=!1,nameId.name=ast.property.name))},function(){self.assign(intoId,"undefined")}),recursionFn(intoId)},!!create);break;case AST.CallExpression:intoId=intoId||this.nextId(),ast.filter?(right=self.filter(ast.callee.name),args=[],forEach(ast.arguments,function(expr){var argument=self.nextId();self.recurse(expr,argument),args.push(argument)}),expression=right+"("+args.join(",")+")",self.assign(intoId,expression),recursionFn(intoId)):(right=self.nextId(),left={},args=[],self.recurse(ast.callee,right,left,function(){self.if_(self.notNull(right),function(){forEach(ast.arguments,function(expr){self.recurse(expr,ast.constant?void 0:self.nextId(),void 0,function(argument){args.push(argument)})}),expression=left.name?self.member(left.context,left.name,left.computed)+"("+args.join(",")+")":right+"("+args.join(",")+")",self.assign(intoId,expression)},function(){self.assign(intoId,"undefined")}),recursionFn(intoId)}));break;case AST.AssignmentExpression:right=this.nextId(),left={},this.recurse(ast.left,void 0,left,function(){self.if_(self.notNull(left.context),function(){self.recurse(ast.right,right),expression=self.member(left.context,left.name,left.computed)+ast.operator+right,self.assign(intoId,expression),recursionFn(intoId||expression)})},1);break;case AST.ArrayExpression:args=[],forEach(ast.elements,function(expr){self.recurse(expr,ast.constant?void 0:self.nextId(),void 0,function(argument){args.push(argument)})}),expression="["+args.join(",")+"]",this.assign(intoId,expression),recursionFn(intoId||expression);break;case AST.ObjectExpression:args=[],computed=!1,forEach(ast.properties,function(property){property.computed&&(computed=!0)}),computed?(intoId=intoId||this.nextId(),this.assign(intoId,"{}"),forEach(ast.properties,function(property){property.computed?(left=self.nextId(),self.recurse(property.key,left)):left=property.key.type===AST.Identifier?property.key.name:""+property.key.value,right=self.nextId(),self.recurse(property.value,right),self.assign(self.member(intoId,left,property.computed),right)})):(forEach(ast.properties,function(property){self.recurse(property.value,ast.constant?void 0:self.nextId(),void 0,function(expr){args.push(self.escape(property.key.type===AST.Identifier?property.key.name:""+property.key.value)+":"+expr)})}),expression="{"+args.join(",")+"}",this.assign(intoId,expression)),recursionFn(intoId||expression);break;case AST.ThisExpression:this.assign(intoId,"s"),recursionFn(intoId||"s");break;case AST.LocalsExpression:this.assign(intoId,"l"),recursionFn(intoId||"l");break;case AST.NGValueParameter:this.assign(intoId,"v"),recursionFn(intoId||"v")}},getHasOwnProperty:function(element,property){var key=element+"."+property,own=this.current().own;return own.hasOwnProperty(key)||(own[key]=this.nextId(!1,element+"&&("+this.escape(property)+" in "+element+")")),own[key]},assign:function(id,value){if(id)return this.current().body.push(id,"=",value,";"),id},filter:function(filterName){return this.state.filters.hasOwnProperty(filterName)||(this.state.filters[filterName]=this.nextId(!0)),this.state.filters[filterName]},ifDefined:function(id,defaultValue){return"ifDefined("+id+","+this.escape(defaultValue)+")"},plus:function(left,right){return"plus("+left+","+right+")"},return_:function(id){this.current().body.push("return ",id,";")},if_:function(test,alternate,consequent){if(!0===test)alternate();else{var body=this.current().body;body.push("if(",test,"){"),alternate(),body.push("}"),consequent&&(body.push("else{"),consequent(),body.push("}"))}},not:function(expression){return"!("+expression+")"},isNull:function(expression){return expression+"==null"},notNull:function(expression){return expression+"!=null"},nonComputedMember:function(left,right){var SAFE_IDENTIFIER=/^[$_a-zA-Z][$_a-zA-Z0-9]*$/,UNSAFE_CHARACTERS=/[^$_a-zA-Z0-9]/g;return SAFE_IDENTIFIER.test(right)?left+"."+right:left+'["'+right.replace(UNSAFE_CHARACTERS,this.stringEscapeFn)+'"]'},computedMember:function(left,right){return left+"["+right+"]"},member:function(left,right,computed){return computed?this.computedMember(left,right):this.nonComputedMember(left,right)},getStringValue:function(item){this.assign(item,"getStringValue("+item+")")},lazyRecurse:function(ast,intoId,nameId,recursionFn,create,skipWatchIdCheck){var self=this;return function(){self.recurse(ast,intoId,nameId,recursionFn,create,skipWatchIdCheck)}},lazyAssign:function(id,value){var self=this;return function(){self.assign(id,value)}},stringEscapeRegex:/[^ a-zA-Z0-9]/g,stringEscapeFn:function(c){return"\\u"+("0000"+c.charCodeAt(0).toString(16)).slice(-4)},escape:function(value){if(isString(value))return"'"+value.replace(this.stringEscapeRegex,this.stringEscapeFn)+"'";if(isNumber(value))return value.toString();if(!0===value)return"true";if(!1===value)return"false";if(null===value)return"null";if(void 0===value)return"undefined";throw $parseMinErr("esc","IMPOSSIBLE")},nextId:function(skip,init){var id="v"+this.state.nextId++;return skip||this.current().vars.push(id+(init?"="+init:"")),id},current:function(){return this.state[this.state.computing]}},ASTInterpreter.prototype={compile:function(ast){var self=this;findConstantAndWatchExpressions(ast,self.$filter);var assignable,assign;(assignable=assignableAST(ast))&&(assign=this.recurse(assignable));var inputs,toWatch=getInputs(ast.body);toWatch&&(inputs=[],forEach(toWatch,function(watch,key){var input=self.recurse(watch);watch.input=input,inputs.push(input),watch.watchId=key}));var expressions=[];forEach(ast.body,function(expression){expressions.push(self.recurse(expression.expression))});var fn=0===ast.body.length?noop:1===ast.body.length?expressions[0]:function(scope,locals){var lastValue;return forEach(expressions,function(exp){lastValue=exp(scope,locals)}),lastValue};return assign&&(fn.assign=function(scope,value,locals){return assign(scope,locals,value)}),inputs&&(fn.inputs=inputs),fn},recurse:function(ast,context,create){var left,right,args,self=this;if(ast.input)return this.inputs(ast.input,ast.watchId);switch(ast.type){case AST.Literal:return this.value(ast.value,context);case AST.UnaryExpression:return right=this.recurse(ast.argument),this["unary"+ast.operator](right,context);case AST.BinaryExpression:case AST.LogicalExpression:return left=this.recurse(ast.left),right=this.recurse(ast.right),this["binary"+ast.operator](left,right,context);case AST.ConditionalExpression:return this["ternary?:"](this.recurse(ast.test),this.recurse(ast.alternate),this.recurse(ast.consequent),context);case AST.Identifier:return self.identifier(ast.name,context,create);case AST.MemberExpression:return left=this.recurse(ast.object,!1,!!create),ast.computed||(right=ast.property.name),ast.computed&&(right=this.recurse(ast.property)),ast.computed?this.computedMember(left,right,context,create):this.nonComputedMember(left,right,context,create);case AST.CallExpression:return args=[],forEach(ast.arguments,function(expr){args.push(self.recurse(expr))}),ast.filter&&(right=this.$filter(ast.callee.name)),ast.filter||(right=this.recurse(ast.callee,!0)),ast.filter?function(scope,locals,assign,inputs){for(var values=[],i=0;i<args.length;++i)values.push(args[i](scope,locals,assign,inputs));var value=right.apply(void 0,values,inputs);return context?{context:void 0,name:void 0,value:value}:value}:function(scope,locals,assign,inputs){var value,rhs=right(scope,locals,assign,inputs);if(null!=rhs.value){for(var values=[],i=0;i<args.length;++i)values.push(args[i](scope,locals,assign,inputs));value=rhs.value.apply(rhs.context,values)}return context?{value:value}:value};case AST.AssignmentExpression:return left=this.recurse(ast.left,!0,1),right=this.recurse(ast.right),function(scope,locals,assign,inputs){var lhs=left(scope,locals,assign,inputs),rhs=right(scope,locals,assign,inputs);return lhs.context[lhs.name]=rhs,context?{value:rhs}:rhs};case AST.ArrayExpression:return args=[],forEach(ast.elements,function(expr){args.push(self.recurse(expr))}),function(scope,locals,assign,inputs){for(var value=[],i=0;i<args.length;++i)value.push(args[i](scope,locals,assign,inputs));return context?{value:value}:value};case AST.ObjectExpression:return args=[],forEach(ast.properties,function(property){property.computed?args.push({key:self.recurse(property.key),computed:!0,value:self.recurse(property.value)}):args.push({key:property.key.type===AST.Identifier?property.key.name:""+property.key.value,computed:!1,value:self.recurse(property.value)})}),function(scope,locals,assign,inputs){for(var value={},i=0;i<args.length;++i)args[i].computed?value[args[i].key(scope,locals,assign,inputs)]=args[i].value(scope,locals,assign,inputs):value[args[i].key]=args[i].value(scope,locals,assign,inputs);return context?{value:value}:value};case AST.ThisExpression:return function(scope){return context?{value:scope}:scope};case AST.LocalsExpression:return function(scope,locals){return context?{value:locals}:locals};case AST.NGValueParameter:return function(scope,locals,assign){return context?{value:assign}:assign}}},"unary+":function(argument,context){return function(scope,locals,assign,inputs){var arg=argument(scope,locals,assign,inputs);return arg=isDefined(arg)?+arg:0,context?{value:arg}:arg}},"unary-":function(argument,context){return function(scope,locals,assign,inputs){var arg=argument(scope,locals,assign,inputs);return arg=isDefined(arg)?-arg:-0,context?{value:arg}:arg}},"unary!":function(argument,context){return function(scope,locals,assign,inputs){var arg=!argument(scope,locals,assign,inputs);return context?{value:arg}:arg}},"binary+":function(left,right,context){return function(scope,locals,assign,inputs){var lhs=left(scope,locals,assign,inputs),rhs=right(scope,locals,assign,inputs),arg=plusFn(lhs,rhs);return context?{value:arg}:arg}},"binary-":function(left,right,context){return function(scope,locals,assign,inputs){var lhs=left(scope,locals,assign,inputs),rhs=right(scope,locals,assign,inputs),arg=(isDefined(lhs)?lhs:0)-(isDefined(rhs)?rhs:0);return context?{value:arg}:arg}},"binary*":function(left,right,context){return function(scope,locals,assign,inputs){var arg=left(scope,locals,assign,inputs)*right(scope,locals,assign,inputs);return context?{value:arg}:arg}},"binary/":function(left,right,context){return function(scope,locals,assign,inputs){var arg=left(scope,locals,assign,inputs)/right(scope,locals,assign,inputs);return context?{value:arg}:arg}},"binary%":function(left,right,context){return function(scope,locals,assign,inputs){var arg=left(scope,locals,assign,inputs)%right(scope,locals,assign,inputs);return context?{value:arg}:arg}},"binary===":function(left,right,context){return function(scope,locals,assign,inputs){var arg=left(scope,locals,assign,inputs)===right(scope,locals,assign,inputs);return context?{value:arg}:arg}},"binary!==":function(left,right,context){return function(scope,locals,assign,inputs){var arg=left(scope,locals,assign,inputs)!==right(scope,locals,assign,inputs);return context?{value:arg}:arg}},"binary==":function(left,right,context){return function(scope,locals,assign,inputs){var arg=left(scope,locals,assign,inputs)==right(scope,locals,assign,inputs);return context?{value:arg}:arg}},"binary!=":function(left,right,context){return function(scope,locals,assign,inputs){var arg=left(scope,locals,assign,inputs)!=right(scope,locals,assign,inputs);return context?{value:arg}:arg}},"binary<":function(left,right,context){return function(scope,locals,assign,inputs){var arg=left(scope,locals,assign,inputs)<right(scope,locals,assign,inputs);return context?{value:arg}:arg}},"binary>":function(left,right,context){return function(scope,locals,assign,inputs){var arg=left(scope,locals,assign,inputs)>right(scope,locals,assign,inputs);return context?{value:arg}:arg}},"binary<=":function(left,right,context){return function(scope,locals,assign,inputs){var arg=left(scope,locals,assign,inputs)<=right(scope,locals,assign,inputs);return context?{value:arg}:arg}},"binary>=":function(left,right,context){return function(scope,locals,assign,inputs){var arg=left(scope,locals,assign,inputs)>=right(scope,locals,assign,inputs);return context?{value:arg}:arg}},"binary&&":function(left,right,context){return function(scope,locals,assign,inputs){var arg=left(scope,locals,assign,inputs)&&right(scope,locals,assign,inputs);return context?{value:arg}:arg}},"binary||":function(left,right,context){return function(scope,locals,assign,inputs){var arg=left(scope,locals,assign,inputs)||right(scope,locals,assign,inputs);return context?{value:arg}:arg}},"ternary?:":function(test,alternate,consequent,context){return function(scope,locals,assign,inputs){var arg=test(scope,locals,assign,inputs)?alternate(scope,locals,assign,inputs):consequent(scope,locals,assign,inputs);return context?{value:arg}:arg}},value:function(value,context){return function(){return context?{context:void 0,name:void 0,value:value}:value}},identifier:function(name,context,create){return function(scope,locals,assign,inputs){var base=locals&&name in locals?locals:scope;create&&1!==create&&base&&null==base[name]&&(base[name]={});var value=base?base[name]:void 0;return context?{context:base,name:name,value:value}:value}},computedMember:function(left,right,context,create){return function(scope,locals,assign,inputs){var rhs,value,lhs=left(scope,locals,assign,inputs);return null!=lhs&&(rhs=right(scope,locals,assign,inputs),rhs=getStringValue(rhs),create&&1!==create&&lhs&&!lhs[rhs]&&(lhs[rhs]={}),value=lhs[rhs]),context?{context:lhs,name:rhs,value:value}:value}},nonComputedMember:function(left,right,context,create){return function(scope,locals,assign,inputs){var lhs=left(scope,locals,assign,inputs);create&&1!==create&&lhs&&null==lhs[right]&&(lhs[right]={});var value=null!=lhs?lhs[right]:void 0;return context?{context:lhs,name:right,value:value}:value}},inputs:function(input,watchId){return function(scope,value,locals,inputs){return inputs?inputs[watchId]:input(scope,value,locals)}}},Parser.prototype={constructor:Parser,parse:function(text){var ast=this.ast.ast(text),fn=this.astCompiler.compile(ast);return fn.literal=isLiteral(ast),fn.constant=isConstant(ast),fn}};var $sceMinErr=minErr("$sce"),SCE_CONTEXTS={HTML:"html",CSS:"css",URL:"url",RESOURCE_URL:"resourceUrl",JS:"js"},UNDERSCORE_LOWERCASE_REGEXP=/_([a-z])/g,$templateRequestMinErr=minErr("$compile"),urlParsingNode=window.document.createElement("a"),originUrl=urlResolve(window.location.href);$$CookieReader.$inject=["$document"],$FilterProvider.$inject=["$provide"];var MAX_DIGITS=22,DECIMAL_SEP=".",ZERO_CHAR="0";currencyFilter.$inject=["$locale"],numberFilter.$inject=["$locale"];var DATE_FORMATS={yyyy:dateGetter("FullYear",4,0,!1,!0),yy:dateGetter("FullYear",2,0,!0,!0),y:dateGetter("FullYear",1,0,!1,!0),MMMM:dateStrGetter("Month"),MMM:dateStrGetter("Month",!0),MM:dateGetter("Month",2,1),M:dateGetter("Month",1,1),LLLL:dateStrGetter("Month",!1,!0),dd:dateGetter("Date",2),d:dateGetter("Date",1),HH:dateGetter("Hours",2),H:dateGetter("Hours",1),hh:dateGetter("Hours",2,-12),h:dateGetter("Hours",1,-12),mm:dateGetter("Minutes",2),m:dateGetter("Minutes",1),ss:dateGetter("Seconds",2),s:dateGetter("Seconds",1),sss:dateGetter("Milliseconds",3),EEEE:dateStrGetter("Day"),EEE:dateStrGetter("Day",!0),a:ampmGetter,Z:timeZoneGetter,ww:weekGetter(2),w:weekGetter(1),G:eraGetter,GG:eraGetter,GGG:eraGetter,GGGG:longEraGetter},DATE_FORMATS_SPLIT=/((?:[^yMLdHhmsaZEwG']+)|(?:'(?:[^']|'')*')|(?:E+|y+|M+|L+|d+|H+|h+|m+|s+|a|Z|G+|w+))([\s\S]*)/,NUMBER_STRING=/^-?\d+$/;dateFilter.$inject=["$locale"];var lowercaseFilter=valueFn(lowercase),uppercaseFilter=valueFn(uppercase);orderByFilter.$inject=["$parse"];var htmlAnchorDirective=valueFn({restrict:"E",compile:function(element,attr){if(!attr.href&&!attr.xlinkHref)return function(scope,element){if("a"===element[0].nodeName.toLowerCase()){var href="[object SVGAnimatedString]"===toString.call(element.prop("href"))?"xlink:href":"href";element.on("click",function(event){element.attr(href)||event.preventDefault()})}}}}),ngAttributeAliasDirectives={};forEach(BOOLEAN_ATTR,function(propName,attrName){function defaultLinkFn(scope,element,attr){scope.$watch(attr[normalized],function(value){attr.$set(attrName,!!value)})}if("multiple"!==propName){var normalized=directiveNormalize("ng-"+attrName),linkFn=defaultLinkFn;"checked"===propName&&(linkFn=function(scope,element,attr){attr.ngModel!==attr[normalized]&&defaultLinkFn(scope,element,attr)}),ngAttributeAliasDirectives[normalized]=function(){return{restrict:"A",priority:100,link:linkFn}}}}),forEach(ALIASED_ATTR,function(htmlAttr,ngAttr){ngAttributeAliasDirectives[ngAttr]=function(){return{priority:100,link:function(scope,element,attr){if("ngPattern"===ngAttr&&"/"===attr.ngPattern.charAt(0)){var match=attr.ngPattern.match(REGEX_STRING_REGEXP);if(match)return void attr.$set("ngPattern",new RegExp(match[1],match[2]))}scope.$watch(attr[ngAttr],function(value){attr.$set(ngAttr,value)})}}}}),forEach(["src","srcset","href"],function(attrName){var normalized=directiveNormalize("ng-"+attrName);ngAttributeAliasDirectives[normalized]=function(){return{priority:99,link:function(scope,element,attr){var propName=attrName,name=attrName;"href"===attrName&&"[object SVGAnimatedString]"===toString.call(element.prop("href"))&&(name="xlinkHref",attr.$attr[name]="xlink:href",propName=null),attr.$observe(normalized,function(value){if(!value)return void("href"===attrName&&attr.$set(name,null));attr.$set(name,value),msie&&propName&&element.prop(propName,attr[name])})}}}});var nullFormCtrl={
$addControl:noop,$$renameControl:nullFormRenameControl,$removeControl:noop,$setValidity:noop,$setDirty:noop,$setPristine:noop,$setSubmitted:noop},PENDING_CLASS="ng-pending",SUBMITTED_CLASS="ng-submitted";FormController.$inject=["$element","$attrs","$scope","$animate","$interpolate"],FormController.prototype={$rollbackViewValue:function(){forEach(this.$$controls,function(control){control.$rollbackViewValue()})},$commitViewValue:function(){forEach(this.$$controls,function(control){control.$commitViewValue()})},$addControl:function(control){assertNotHasOwnProperty(control.$name,"input"),this.$$controls.push(control),control.$name&&(this[control.$name]=control),control.$$parentForm=this},$$renameControl:function(control,newName){var oldName=control.$name;this[oldName]===control&&delete this[oldName],this[newName]=control,control.$name=newName},$removeControl:function(control){control.$name&&this[control.$name]===control&&delete this[control.$name],forEach(this.$pending,function(value,name){this.$setValidity(name,null,control)},this),forEach(this.$error,function(value,name){this.$setValidity(name,null,control)},this),forEach(this.$$success,function(value,name){this.$setValidity(name,null,control)},this),arrayRemove(this.$$controls,control),control.$$parentForm=nullFormCtrl},$setDirty:function(){this.$$animate.removeClass(this.$$element,PRISTINE_CLASS),this.$$animate.addClass(this.$$element,DIRTY_CLASS),this.$dirty=!0,this.$pristine=!1,this.$$parentForm.$setDirty()},$setPristine:function(){this.$$animate.setClass(this.$$element,PRISTINE_CLASS,DIRTY_CLASS+" "+SUBMITTED_CLASS),this.$dirty=!1,this.$pristine=!0,this.$submitted=!1,forEach(this.$$controls,function(control){control.$setPristine()})},$setUntouched:function(){forEach(this.$$controls,function(control){control.$setUntouched()})},$setSubmitted:function(){this.$$animate.addClass(this.$$element,SUBMITTED_CLASS),this.$submitted=!0,this.$$parentForm.$setSubmitted()}},addSetValidityMethod({clazz:FormController,set:function(object,property,controller){var list=object[property];if(list){-1===list.indexOf(controller)&&list.push(controller)}else object[property]=[controller]},unset:function(object,property,controller){var list=object[property];list&&(arrayRemove(list,controller),0===list.length&&delete object[property])}});var formDirectiveFactory=function(isNgForm){return["$timeout","$parse",function($timeout,$parse){function getSetter(expression){return""===expression?$parse('this[""]').assign:$parse(expression).assign||noop}return{name:"form",restrict:isNgForm?"EAC":"E",require:["form","^^?form"],controller:FormController,compile:function(formElement,attr){formElement.addClass(PRISTINE_CLASS).addClass(VALID_CLASS);var nameAttr=attr.name?"name":!(!isNgForm||!attr.ngForm)&&"ngForm";return{pre:function(scope,formElement,attr,ctrls){var controller=ctrls[0];if(!("action"in attr)){var handleFormSubmission=function(event){scope.$apply(function(){controller.$commitViewValue(),controller.$setSubmitted()}),event.preventDefault()};formElement[0].addEventListener("submit",handleFormSubmission),formElement.on("$destroy",function(){$timeout(function(){formElement[0].removeEventListener("submit",handleFormSubmission)},0,!1)})}(ctrls[1]||controller.$$parentForm).$addControl(controller);var setter=nameAttr?getSetter(controller.$name):noop;nameAttr&&(setter(scope,controller),attr.$observe(nameAttr,function(newValue){controller.$name!==newValue&&(setter(scope,void 0),controller.$$parentForm.$$renameControl(controller,newValue),(setter=getSetter(controller.$name))(scope,controller))})),formElement.on("$destroy",function(){controller.$$parentForm.$removeControl(controller),setter(scope,void 0),extend(controller,nullFormCtrl)})}}}}}]},formDirective=formDirectiveFactory(),ngFormDirective=formDirectiveFactory(!0),ISO_DATE_REGEXP=/^\d{4,}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+(?:[+-][0-2]\d:[0-5]\d|Z)$/,URL_REGEXP=/^[a-z][a-z\d.+-]*:\/*(?:[^:@]+(?::[^@]+)?@)?(?:[^\s:\/?#]+|\[[a-f\d:]+])(?::\d+)?(?:\/[^?#]*)?(?:\?[^#]*)?(?:#.*)?$/i,EMAIL_REGEXP=/^(?=.{1,254}$)(?=.{1,64}@)[-!#$%&'*+\/0-9=?A-Z^_`a-z{|}~]+(\.[-!#$%&'*+\/0-9=?A-Z^_`a-z{|}~]+)*@[A-Za-z0-9]([A-Za-z0-9-]{0,61}[A-Za-z0-9])?(\.[A-Za-z0-9]([A-Za-z0-9-]{0,61}[A-Za-z0-9])?)*$/,NUMBER_REGEXP=/^\s*(-|\+)?(\d+|(\d*(\.\d*)))([eE][+-]?\d+)?\s*$/,DATE_REGEXP=/^(\d{4,})-(\d{2})-(\d{2})$/,DATETIMELOCAL_REGEXP=/^(\d{4,})-(\d\d)-(\d\d)T(\d\d):(\d\d)(?::(\d\d)(\.\d{1,3})?)?$/,WEEK_REGEXP=/^(\d{4,})-W(\d\d)$/,MONTH_REGEXP=/^(\d{4,})-(\d\d)$/,TIME_REGEXP=/^(\d\d):(\d\d)(?::(\d\d)(\.\d{1,3})?)?$/,PARTIAL_VALIDATION_EVENTS="keydown wheel mousedown",PARTIAL_VALIDATION_TYPES=createMap();forEach("date,datetime-local,month,time,week".split(","),function(type){PARTIAL_VALIDATION_TYPES[type]=!0});var inputType={text:textInputType,date:createDateInputType("date",DATE_REGEXP,createDateParser(DATE_REGEXP,["yyyy","MM","dd"]),"yyyy-MM-dd"),"datetime-local":createDateInputType("datetimelocal",DATETIMELOCAL_REGEXP,createDateParser(DATETIMELOCAL_REGEXP,["yyyy","MM","dd","HH","mm","ss","sss"]),"yyyy-MM-ddTHH:mm:ss.sss"),time:createDateInputType("time",TIME_REGEXP,createDateParser(TIME_REGEXP,["HH","mm","ss","sss"]),"HH:mm:ss.sss"),week:createDateInputType("week",WEEK_REGEXP,weekParser,"yyyy-Www"),month:createDateInputType("month",MONTH_REGEXP,createDateParser(MONTH_REGEXP,["yyyy","MM"]),"yyyy-MM"),number:numberInputType,url:urlInputType,email:emailInputType,radio:radioInputType,range:rangeInputType,checkbox:checkboxInputType,hidden:noop,button:noop,submit:noop,reset:noop,file:noop},inputDirective=["$browser","$sniffer","$filter","$parse",function($browser,$sniffer,$filter,$parse){return{restrict:"E",require:["?ngModel"],link:{pre:function(scope,element,attr,ctrls){ctrls[0]&&(inputType[lowercase(attr.type)]||inputType.text)(scope,element,attr,ctrls[0],$sniffer,$browser,$filter,$parse)}}}}],CONSTANT_VALUE_REGEXP=/^(true|false|\d+)$/,ngValueDirective=function(){function updateElementValue(element,attr,value){var propValue=isDefined(value)?value:9===msie?"":null;element.prop("value",propValue),attr.$set("value",value)}return{restrict:"A",priority:100,compile:function(tpl,tplAttr){return CONSTANT_VALUE_REGEXP.test(tplAttr.ngValue)?function(scope,elm,attr){updateElementValue(elm,attr,scope.$eval(attr.ngValue))}:function(scope,elm,attr){scope.$watch(attr.ngValue,function(value){updateElementValue(elm,attr,value)})}}}},ngBindDirective=["$compile",function($compile){return{restrict:"AC",compile:function(templateElement){return $compile.$$addBindingClass(templateElement),function(scope,element,attr){$compile.$$addBindingInfo(element,attr.ngBind),element=element[0],scope.$watch(attr.ngBind,function(value){element.textContent=stringify(value)})}}}}],ngBindTemplateDirective=["$interpolate","$compile",function($interpolate,$compile){return{compile:function(templateElement){return $compile.$$addBindingClass(templateElement),function(scope,element,attr){var interpolateFn=$interpolate(element.attr(attr.$attr.ngBindTemplate));$compile.$$addBindingInfo(element,interpolateFn.expressions),element=element[0],attr.$observe("ngBindTemplate",function(value){element.textContent=isUndefined(value)?"":value})}}}}],ngBindHtmlDirective=["$sce","$parse","$compile",function($sce,$parse,$compile){return{restrict:"A",compile:function(tElement,tAttrs){var ngBindHtmlGetter=$parse(tAttrs.ngBindHtml),ngBindHtmlWatch=$parse(tAttrs.ngBindHtml,function(val){return $sce.valueOf(val)});return $compile.$$addBindingClass(tElement),function(scope,element,attr){$compile.$$addBindingInfo(element,attr.ngBindHtml),scope.$watch(ngBindHtmlWatch,function(){var value=ngBindHtmlGetter(scope);element.html($sce.getTrustedHtml(value)||"")})}}}}],ngChangeDirective=valueFn({restrict:"A",require:"ngModel",link:function(scope,element,attr,ctrl){ctrl.$viewChangeListeners.push(function(){scope.$eval(attr.ngChange)})}}),ngClassDirective=classDirective("",!0),ngClassOddDirective=classDirective("Odd",0),ngClassEvenDirective=classDirective("Even",1),ngCloakDirective=ngDirective({compile:function(element,attr){attr.$set("ngCloak",void 0),element.removeClass("ng-cloak")}}),ngControllerDirective=[function(){return{restrict:"A",scope:!0,controller:"@",priority:500}}],ngEventDirectives={},forceAsyncEvents={blur:!0,focus:!0};forEach("click dblclick mousedown mouseup mouseover mouseout mousemove mouseenter mouseleave keydown keyup keypress submit focus blur copy cut paste".split(" "),function(eventName){var directiveName=directiveNormalize("ng-"+eventName);ngEventDirectives[directiveName]=["$parse","$rootScope",function($parse,$rootScope){return{restrict:"A",compile:function($element,attr){var fn=$parse(attr[directiveName]);return function(scope,element){element.on(eventName,function(event){var callback=function(){fn(scope,{$event:event})};forceAsyncEvents[eventName]&&$rootScope.$$phase?scope.$evalAsync(callback):scope.$apply(callback)})}}}}]});var ngIfDirective=["$animate","$compile",function($animate,$compile){return{multiElement:!0,transclude:"element",priority:600,terminal:!0,restrict:"A",$$tlb:!0,link:function($scope,$element,$attr,ctrl,$transclude){var block,childScope,previousElements;$scope.$watch($attr.ngIf,function(value){value?childScope||$transclude(function(clone,newScope){childScope=newScope,clone[clone.length++]=$compile.$$createComment("end ngIf",$attr.ngIf),block={clone:clone},$animate.enter(clone,$element.parent(),$element)}):(previousElements&&(previousElements.remove(),previousElements=null),childScope&&(childScope.$destroy(),childScope=null),block&&(previousElements=getBlockNodes(block.clone),$animate.leave(previousElements).done(function(response){!1!==response&&(previousElements=null)}),block=null))})}}}],ngIncludeDirective=["$templateRequest","$anchorScroll","$animate",function($templateRequest,$anchorScroll,$animate){return{restrict:"ECA",priority:400,terminal:!0,transclude:"element",controller:angular.noop,compile:function(element,attr){var srcExp=attr.ngInclude||attr.src,onloadExp=attr.onload||"",autoScrollExp=attr.autoscroll;return function(scope,$element,$attr,ctrl,$transclude){var currentScope,previousElement,currentElement,changeCounter=0,cleanupLastIncludeContent=function(){previousElement&&(previousElement.remove(),previousElement=null),currentScope&&(currentScope.$destroy(),currentScope=null),currentElement&&($animate.leave(currentElement).done(function(response){!1!==response&&(previousElement=null)}),previousElement=currentElement,currentElement=null)};scope.$watch(srcExp,function(src){var afterAnimation=function(response){!1===response||!isDefined(autoScrollExp)||autoScrollExp&&!scope.$eval(autoScrollExp)||$anchorScroll()},thisChangeId=++changeCounter;src?($templateRequest(src,!0).then(function(response){if(!scope.$$destroyed&&thisChangeId===changeCounter){var newScope=scope.$new();ctrl.template=response;var clone=$transclude(newScope,function(clone){cleanupLastIncludeContent(),$animate.enter(clone,null,$element).done(afterAnimation)});currentScope=newScope,currentElement=clone,currentScope.$emit("$includeContentLoaded",src),scope.$eval(onloadExp)}},function(){scope.$$destroyed||thisChangeId===changeCounter&&(cleanupLastIncludeContent(),scope.$emit("$includeContentError",src))}),scope.$emit("$includeContentRequested",src)):(cleanupLastIncludeContent(),ctrl.template=null)})}}}}],ngIncludeFillContentDirective=["$compile",function($compile){return{restrict:"ECA",priority:-400,require:"ngInclude",link:function(scope,$element,$attr,ctrl){if(toString.call($element[0]).match(/SVG/))return $element.empty(),void $compile(jqLiteBuildFragment(ctrl.template,window.document).childNodes)(scope,function(clone){$element.append(clone)},{futureParentElement:$element});$element.html(ctrl.template),$compile($element.contents())(scope)}}}],ngInitDirective=ngDirective({priority:450,compile:function(){return{pre:function(scope,element,attrs){scope.$eval(attrs.ngInit)}}}}),ngListDirective=function(){return{restrict:"A",priority:100,require:"ngModel",link:function(scope,element,attr,ctrl){var ngList=attr.ngList||", ",trimValues="false"!==attr.ngTrim,separator=trimValues?trim(ngList):ngList,parse=function(viewValue){if(!isUndefined(viewValue)){var list=[];return viewValue&&forEach(viewValue.split(separator),function(value){value&&list.push(trimValues?trim(value):value)}),list}};ctrl.$parsers.push(parse),ctrl.$formatters.push(function(value){if(isArray(value))return value.join(ngList)}),ctrl.$isEmpty=function(value){return!value||!value.length}}}},VALID_CLASS="ng-valid",INVALID_CLASS="ng-invalid",PRISTINE_CLASS="ng-pristine",DIRTY_CLASS="ng-dirty",UNTOUCHED_CLASS="ng-untouched",TOUCHED_CLASS="ng-touched",EMPTY_CLASS="ng-empty",NOT_EMPTY_CLASS="ng-not-empty",ngModelMinErr=minErr("ngModel");NgModelController.$inject=["$scope","$exceptionHandler","$attrs","$element","$parse","$animate","$timeout","$q","$interpolate"],NgModelController.prototype={$$initGetterSetters:function(){if(this.$options.getOption("getterSetter")){var invokeModelGetter=this.$$parse(this.$$attr.ngModel+"()"),invokeModelSetter=this.$$parse(this.$$attr.ngModel+"($$$p)");this.$$ngModelGet=function($scope){var modelValue=this.$$parsedNgModel($scope);return isFunction(modelValue)&&(modelValue=invokeModelGetter($scope)),modelValue},this.$$ngModelSet=function($scope,newValue){isFunction(this.$$parsedNgModel($scope))?invokeModelSetter($scope,{$$$p:newValue}):this.$$parsedNgModelAssign($scope,newValue)}}else if(!this.$$parsedNgModel.assign)throw ngModelMinErr("nonassign","Expression '{0}' is non-assignable. Element: {1}",this.$$attr.ngModel,startingTag(this.$$element))},$render:noop,$isEmpty:function(value){return isUndefined(value)||""===value||null===value||value!==value},$$updateEmptyClasses:function(value){this.$isEmpty(value)?(this.$$animate.removeClass(this.$$element,NOT_EMPTY_CLASS),this.$$animate.addClass(this.$$element,EMPTY_CLASS)):(this.$$animate.removeClass(this.$$element,EMPTY_CLASS),this.$$animate.addClass(this.$$element,NOT_EMPTY_CLASS))},$setPristine:function(){this.$dirty=!1,this.$pristine=!0,this.$$animate.removeClass(this.$$element,DIRTY_CLASS),this.$$animate.addClass(this.$$element,PRISTINE_CLASS)},$setDirty:function(){this.$dirty=!0,this.$pristine=!1,this.$$animate.removeClass(this.$$element,PRISTINE_CLASS),this.$$animate.addClass(this.$$element,DIRTY_CLASS),this.$$parentForm.$setDirty()},$setUntouched:function(){this.$touched=!1,this.$untouched=!0,this.$$animate.setClass(this.$$element,UNTOUCHED_CLASS,TOUCHED_CLASS)},$setTouched:function(){this.$touched=!0,this.$untouched=!1,this.$$animate.setClass(this.$$element,TOUCHED_CLASS,UNTOUCHED_CLASS)},$rollbackViewValue:function(){this.$$timeout.cancel(this.$$pendingDebounce),this.$viewValue=this.$$lastCommittedViewValue,this.$render()},$validate:function(){if(!isNumberNaN(this.$modelValue)){var viewValue=this.$$lastCommittedViewValue,modelValue=this.$$rawModelValue,prevValid=this.$valid,prevModelValue=this.$modelValue,allowInvalid=this.$options.getOption("allowInvalid"),that=this;this.$$runValidators(modelValue,viewValue,function(allValid){allowInvalid||prevValid===allValid||(that.$modelValue=allValid?modelValue:void 0,that.$modelValue!==prevModelValue&&that.$$writeModelToScope())})}},$$runValidators:function(modelValue,viewValue,doneCallback){function processParseErrors(){var errorKey=that.$$parserName||"parse";return isUndefined(that.$$parserValid)?(setValidity(errorKey,null),!0):(that.$$parserValid||(forEach(that.$validators,function(v,name){setValidity(name,null)}),forEach(that.$asyncValidators,function(v,name){setValidity(name,null)})),setValidity(errorKey,that.$$parserValid),that.$$parserValid)}function processSyncValidators(){var syncValidatorsValid=!0;return forEach(that.$validators,function(validator,name){var result=Boolean(validator(modelValue,viewValue));syncValidatorsValid=syncValidatorsValid&&result,setValidity(name,result)}),!!syncValidatorsValid||(forEach(that.$asyncValidators,function(v,name){setValidity(name,null)}),!1)}function processAsyncValidators(){var validatorPromises=[],allValid=!0;forEach(that.$asyncValidators,function(validator,name){var promise=validator(modelValue,viewValue);if(!isPromiseLike(promise))throw ngModelMinErr("nopromise","Expected asynchronous validator to return a promise but got '{0}' instead.",promise);setValidity(name,void 0),validatorPromises.push(promise.then(function(){setValidity(name,!0)},function(){allValid=!1,setValidity(name,!1)}))}),validatorPromises.length?that.$$q.all(validatorPromises).then(function(){validationDone(allValid)},noop):validationDone(!0)}function setValidity(name,isValid){localValidationRunId===that.$$currentValidationRunId&&that.$setValidity(name,isValid)}function validationDone(allValid){localValidationRunId===that.$$currentValidationRunId&&doneCallback(allValid)}this.$$currentValidationRunId++;var localValidationRunId=this.$$currentValidationRunId,that=this;return processParseErrors()&&processSyncValidators()?void processAsyncValidators():void validationDone(!1)},$commitViewValue:function(){var viewValue=this.$viewValue;this.$$timeout.cancel(this.$$pendingDebounce),(this.$$lastCommittedViewValue!==viewValue||""===viewValue&&this.$$hasNativeValidators)&&(this.$$updateEmptyClasses(viewValue),this.$$lastCommittedViewValue=viewValue,this.$pristine&&this.$setDirty(),this.$$parseAndValidate())},$$parseAndValidate:function(){function writeToModelIfNeeded(){that.$modelValue!==prevModelValue&&that.$$writeModelToScope()}var viewValue=this.$$lastCommittedViewValue,modelValue=viewValue,that=this;if(this.$$parserValid=!isUndefined(modelValue)||void 0,this.$$parserValid)for(var i=0;i<this.$parsers.length;i++)if(modelValue=this.$parsers[i](modelValue),isUndefined(modelValue)){this.$$parserValid=!1;break}isNumberNaN(this.$modelValue)&&(this.$modelValue=this.$$ngModelGet(this.$$scope));var prevModelValue=this.$modelValue,allowInvalid=this.$options.getOption("allowInvalid");this.$$rawModelValue=modelValue,allowInvalid&&(this.$modelValue=modelValue,writeToModelIfNeeded()),this.$$runValidators(modelValue,this.$$lastCommittedViewValue,function(allValid){allowInvalid||(that.$modelValue=allValid?modelValue:void 0,writeToModelIfNeeded())})},$$writeModelToScope:function(){this.$$ngModelSet(this.$$scope,this.$modelValue),forEach(this.$viewChangeListeners,function(listener){try{listener()}catch(e){this.$$exceptionHandler(e)}},this)},$setViewValue:function(value,trigger){this.$viewValue=value,this.$options.getOption("updateOnDefault")&&this.$$debounceViewValueCommit(trigger)},$$debounceViewValueCommit:function(trigger){var debounceDelay=this.$options.getOption("debounce");isNumber(debounceDelay[trigger])?debounceDelay=debounceDelay[trigger]:isNumber(debounceDelay.default)&&(debounceDelay=debounceDelay.default),this.$$timeout.cancel(this.$$pendingDebounce);var that=this;debounceDelay>0?this.$$pendingDebounce=this.$$timeout(function(){that.$commitViewValue()},debounceDelay):this.$$scope.$root.$$phase?this.$commitViewValue():this.$$scope.$apply(function(){that.$commitViewValue()})},$overrideModelOptions:function(options){this.$options=this.$options.createChild(options)}},addSetValidityMethod({clazz:NgModelController,set:function(object,property){object[property]=!0},unset:function(object,property){delete object[property]}});var defaultModelOptions,ngModelDirective=["$rootScope",function($rootScope){return{restrict:"A",require:["ngModel","^?form","^?ngModelOptions"],controller:NgModelController,priority:1,compile:function(element){return element.addClass(PRISTINE_CLASS).addClass(UNTOUCHED_CLASS).addClass(VALID_CLASS),{pre:function(scope,element,attr,ctrls){var modelCtrl=ctrls[0],formCtrl=ctrls[1]||modelCtrl.$$parentForm,optionsCtrl=ctrls[2];optionsCtrl&&(modelCtrl.$options=optionsCtrl.$options),modelCtrl.$$initGetterSetters(),formCtrl.$addControl(modelCtrl),attr.$observe("name",function(newValue){modelCtrl.$name!==newValue&&modelCtrl.$$parentForm.$$renameControl(modelCtrl,newValue)}),scope.$on("$destroy",function(){modelCtrl.$$parentForm.$removeControl(modelCtrl)})},post:function(scope,element,attr,ctrls){function setTouched(){modelCtrl.$setTouched()}var modelCtrl=ctrls[0];modelCtrl.$options.getOption("updateOn")&&element.on(modelCtrl.$options.getOption("updateOn"),function(ev){modelCtrl.$$debounceViewValueCommit(ev&&ev.type)}),element.on("blur",function(){modelCtrl.$touched||($rootScope.$$phase?scope.$evalAsync(setTouched):scope.$apply(setTouched))})}}}}}],DEFAULT_REGEXP=/(\s+|^)default(\s+|$)/;ModelOptions.prototype={getOption:function(name){return this.$$options[name]},createChild:function(options){var inheritAll=!1;return options=extend({},options),forEach(options,function(option,key){"$inherit"===option?"*"===key?inheritAll=!0:(options[key]=this.$$options[key],"updateOn"===key&&(options.updateOnDefault=this.$$options.updateOnDefault)):"updateOn"===key&&(options.updateOnDefault=!1,options[key]=trim(option.replace(DEFAULT_REGEXP,function(){return options.updateOnDefault=!0," "})))},this),inheritAll&&(delete options["*"],defaults(options,this.$$options)),defaults(options,defaultModelOptions.$$options),new ModelOptions(options)}},defaultModelOptions=new ModelOptions({updateOn:"",updateOnDefault:!0,debounce:0,getterSetter:!1,allowInvalid:!1,timezone:null});var ngModelOptionsDirective=function(){function NgModelOptionsController($attrs,$scope){this.$$attrs=$attrs,this.$$scope=$scope}return NgModelOptionsController.$inject=["$attrs","$scope"],NgModelOptionsController.prototype={$onInit:function(){var parentOptions=this.parentCtrl?this.parentCtrl.$options:defaultModelOptions,modelOptionsDefinition=this.$$scope.$eval(this.$$attrs.ngModelOptions);this.$options=parentOptions.createChild(modelOptionsDefinition)}},{restrict:"A",priority:10,require:{parentCtrl:"?^^ngModelOptions"},bindToController:!0,controller:NgModelOptionsController}},ngNonBindableDirective=ngDirective({terminal:!0,priority:1e3}),ngOptionsMinErr=minErr("ngOptions"),NG_OPTIONS_REGEXP=/^\s*([\s\S]+?)(?:\s+as\s+([\s\S]+?))?(?:\s+group\s+by\s+([\s\S]+?))?(?:\s+disable\s+when\s+([\s\S]+?))?\s+for\s+(?:([$\w][$\w]*)|(?:\(\s*([$\w][$\w]*)\s*,\s*([$\w][$\w]*)\s*\)))\s+in\s+([\s\S]+?)(?:\s+track\s+by\s+([\s\S]+?))?$/,ngOptionsDirective=["$compile","$document","$parse",function($compile,$document,$parse){function parseOptionsExpression(optionsExp,selectElement,scope){function Option(selectValue,viewValue,label,group,disabled){this.selectValue=selectValue,this.viewValue=viewValue,this.label=label,this.group=group,this.disabled=disabled}function getOptionValuesKeys(optionValues){var optionValuesKeys;if(!keyName&&isArrayLike(optionValues))optionValuesKeys=optionValues;else{optionValuesKeys=[];for(var itemKey in optionValues)optionValues.hasOwnProperty(itemKey)&&"$"!==itemKey.charAt(0)&&optionValuesKeys.push(itemKey)}return optionValuesKeys}var match=optionsExp.match(NG_OPTIONS_REGEXP);if(!match)throw ngOptionsMinErr("iexp","Expected expression in form of '_select_ (as _label_)? for (_key_,)?_value_ in _collection_' but got '{0}'. Element: {1}",optionsExp,startingTag(selectElement));var valueName=match[5]||match[7],keyName=match[6],selectAs=/ as /.test(match[0])&&match[1],trackBy=match[9],valueFn=$parse(match[2]?match[1]:valueName),selectAsFn=selectAs&&$parse(selectAs),viewValueFn=selectAsFn||valueFn,trackByFn=trackBy&&$parse(trackBy),getTrackByValueFn=trackBy?function(value,locals){return trackByFn(scope,locals)}:function(value){return hashKey(value)},getTrackByValue=function(value,key){return getTrackByValueFn(value,getLocals(value,key))},displayFn=$parse(match[2]||match[1]),groupByFn=$parse(match[3]||""),disableWhenFn=$parse(match[4]||""),valuesFn=$parse(match[8]),locals={},getLocals=keyName?function(value,key){return locals[keyName]=key,locals[valueName]=value,locals}:function(value){return locals[valueName]=value,locals};return{trackBy:trackBy,getTrackByValue:getTrackByValue,getWatchables:$parse(valuesFn,function(optionValues){var watchedArray=[];optionValues=optionValues||[];for(var optionValuesKeys=getOptionValuesKeys(optionValues),optionValuesLength=optionValuesKeys.length,index=0;index<optionValuesLength;index++){var key=optionValues===optionValuesKeys?index:optionValuesKeys[index],value=optionValues[key],locals=getLocals(value,key),selectValue=getTrackByValueFn(value,locals);if(watchedArray.push(selectValue),match[2]||match[1]){var label=displayFn(scope,locals);watchedArray.push(label)}if(match[4]){var disableWhen=disableWhenFn(scope,locals);watchedArray.push(disableWhen)}}return watchedArray}),getOptions:function(){for(var optionItems=[],selectValueMap={},optionValues=valuesFn(scope)||[],optionValuesKeys=getOptionValuesKeys(optionValues),optionValuesLength=optionValuesKeys.length,index=0;index<optionValuesLength;index++){var key=optionValues===optionValuesKeys?index:optionValuesKeys[index],value=optionValues[key],locals=getLocals(value,key),viewValue=viewValueFn(scope,locals),selectValue=getTrackByValueFn(viewValue,locals),label=displayFn(scope,locals),group=groupByFn(scope,locals),disabled=disableWhenFn(scope,locals),optionItem=new Option(selectValue,viewValue,label,group,disabled);optionItems.push(optionItem),selectValueMap[selectValue]=optionItem}return{items:optionItems,selectValueMap:selectValueMap,getOptionFromViewValue:function(value){return selectValueMap[getTrackByValue(value)]},getViewValueFromOption:function(option){return trackBy?copy(option.viewValue):option.viewValue}}}}}function ngOptionsPostLink(scope,selectElement,attr,ctrls){function addOptionElement(option,parent){var optionElement=optionTemplate.cloneNode(!1);parent.appendChild(optionElement),updateOptionElement(option,optionElement)}function getAndUpdateSelectedOption(viewValue){var option=options.getOptionFromViewValue(viewValue),element=option&&option.element;return element&&!element.selected&&(element.selected=!0),option}function updateOptionElement(option,element){option.element=element,element.disabled=option.disabled,option.label!==element.label&&(element.label=option.label,element.textContent=option.label),element.value=option.selectValue}function updateOptions(){var previousValue=options&&selectCtrl.readValue();if(options)for(var i=options.items.length-1;i>=0;i--){var option=options.items[i];jqLiteRemove(isDefined(option.group)?option.element.parentNode:option.element)}options=ngOptions.getOptions();var groupElementMap={};if(providedEmptyOption&&selectElement.prepend(selectCtrl.emptyOption),options.items.forEach(function(option){var groupElement;isDefined(option.group)?(groupElement=groupElementMap[option.group],groupElement||(groupElement=optGroupTemplate.cloneNode(!1),listFragment.appendChild(groupElement),groupElement.label=null===option.group?"null":option.group,groupElementMap[option.group]=groupElement),addOptionElement(option,groupElement)):addOptionElement(option,listFragment)}),selectElement[0].appendChild(listFragment),ngModelCtrl.$render(),!ngModelCtrl.$isEmpty(previousValue)){var nextValue=selectCtrl.readValue();(ngOptions.trackBy||multiple?equals(previousValue,nextValue):previousValue===nextValue)||(ngModelCtrl.$setViewValue(nextValue),ngModelCtrl.$render())}}for(var selectCtrl=ctrls[0],ngModelCtrl=ctrls[1],multiple=attr.multiple,i=0,children=selectElement.children(),ii=children.length;i<ii;i++)if(""===children[i].value){selectCtrl.hasEmptyOption=!0,selectCtrl.emptyOption=children.eq(i);break}var providedEmptyOption=!!selectCtrl.emptyOption;jqLite(optionTemplate.cloneNode(!1)).val("?");var options,ngOptions=parseOptionsExpression(attr.ngOptions,selectElement,scope),listFragment=$document[0].createDocumentFragment();selectCtrl.generateUnknownOptionValue=function(val){return"?"},multiple?(selectCtrl.writeValue=function(values){var selectedOptions=values&&values.map(getAndUpdateSelectedOption)||[];options.items.forEach(function(option){option.element.selected&&!includes(selectedOptions,option)&&(option.element.selected=!1)})},selectCtrl.readValue=function(){var selectedValues=selectElement.val()||[],selections=[];return forEach(selectedValues,function(value){var option=options.selectValueMap[value];option&&!option.disabled&&selections.push(options.getViewValueFromOption(option))}),selections},ngOptions.trackBy&&scope.$watchCollection(function(){if(isArray(ngModelCtrl.$viewValue))return ngModelCtrl.$viewValue.map(function(value){return ngOptions.getTrackByValue(value)})},function(){ngModelCtrl.$render()})):(selectCtrl.writeValue=function(value){var selectedOption=options.selectValueMap[selectElement.val()],option=options.getOptionFromViewValue(value);selectedOption&&selectedOption.element.removeAttribute("selected"),option?(selectElement[0].value!==option.selectValue&&(selectCtrl.removeUnknownOption(),selectCtrl.unselectEmptyOption(),selectElement[0].value=option.selectValue,option.element.selected=!0),option.element.setAttribute("selected","selected")):providedEmptyOption?selectCtrl.selectEmptyOption():selectCtrl.unknownOption.parent().length?selectCtrl.updateUnknownOption(value):selectCtrl.renderUnknownOption(value)},selectCtrl.readValue=function(){var selectedOption=options.selectValueMap[selectElement.val()];return selectedOption&&!selectedOption.disabled?(selectCtrl.unselectEmptyOption(),selectCtrl.removeUnknownOption(),options.getViewValueFromOption(selectedOption)):null},ngOptions.trackBy&&scope.$watch(function(){return ngOptions.getTrackByValue(ngModelCtrl.$viewValue)},function(){ngModelCtrl.$render()})),providedEmptyOption&&(selectCtrl.emptyOption.remove(),$compile(selectCtrl.emptyOption)(scope),selectCtrl.emptyOption[0].nodeType===NODE_TYPE_COMMENT?(selectCtrl.hasEmptyOption=!1,selectCtrl.registerOption=function(optionScope,optionEl){""===optionEl.val()&&(selectCtrl.hasEmptyOption=!0,selectCtrl.emptyOption=optionEl,selectCtrl.emptyOption.removeClass("ng-scope"),ngModelCtrl.$render(),optionEl.on("$destroy",function(){selectCtrl.hasEmptyOption=!1,selectCtrl.emptyOption=void 0}))}):selectCtrl.emptyOption.removeClass("ng-scope")),selectElement.empty(),updateOptions(),scope.$watchCollection(ngOptions.getWatchables,updateOptions)}var optionTemplate=window.document.createElement("option"),optGroupTemplate=window.document.createElement("optgroup");return{restrict:"A",terminal:!0,require:["select","ngModel"],link:{pre:function(scope,selectElement,attr,ctrls){ctrls[0].registerOption=noop},post:ngOptionsPostLink}}}],ngPluralizeDirective=["$locale","$interpolate","$log",function($locale,$interpolate,$log){var BRACE=/{}/g,IS_WHEN=/^when(Minus)?(.+)$/;return{link:function(scope,element,attr){function updateElementText(newText){element.text(newText||"")}var lastCount,numberExp=attr.count,whenExp=attr.$attr.when&&element.attr(attr.$attr.when),offset=attr.offset||0,whens=scope.$eval(whenExp)||{},whensExpFns={},startSymbol=$interpolate.startSymbol(),endSymbol=$interpolate.endSymbol(),braceReplacement=startSymbol+numberExp+"-"+offset+endSymbol,watchRemover=angular.noop;forEach(attr,function(expression,attributeName){var tmpMatch=IS_WHEN.exec(attributeName);if(tmpMatch){var whenKey=(tmpMatch[1]?"-":"")+lowercase(tmpMatch[2]);whens[whenKey]=element.attr(attr.$attr[attributeName])}}),forEach(whens,function(expression,key){whensExpFns[key]=$interpolate(expression.replace(BRACE,braceReplacement))}),scope.$watch(numberExp,function(newVal){var count=parseFloat(newVal),countIsNaN=isNumberNaN(count);if(countIsNaN||count in whens||(count=$locale.pluralCat(count-offset)),!(count===lastCount||countIsNaN&&isNumberNaN(lastCount))){watchRemover();var whenExpFn=whensExpFns[count];isUndefined(whenExpFn)?(null!=newVal&&$log.debug("ngPluralize: no rule defined for '"+count+"' in "+whenExp),watchRemover=noop,updateElementText()):watchRemover=scope.$watch(whenExpFn,updateElementText),lastCount=count}})}}}],ngRepeatDirective=["$parse","$animate","$compile",function($parse,$animate,$compile){var NG_REMOVED="$$NG_REMOVED",ngRepeatMinErr=minErr("ngRepeat"),updateScope=function(scope,index,valueIdentifier,value,keyIdentifier,key,arrayLength){scope[valueIdentifier]=value,keyIdentifier&&(scope[keyIdentifier]=key),
scope.$index=index,scope.$first=0===index,scope.$last=index===arrayLength-1,scope.$middle=!(scope.$first||scope.$last),scope.$odd=!(scope.$even=0==(1&index))},getBlockStart=function(block){return block.clone[0]},getBlockEnd=function(block){return block.clone[block.clone.length-1]};return{restrict:"A",multiElement:!0,transclude:"element",priority:1e3,terminal:!0,$$tlb:!0,compile:function($element,$attr){var expression=$attr.ngRepeat,ngRepeatEndComment=$compile.$$createComment("end ngRepeat",expression),match=expression.match(/^\s*([\s\S]+?)\s+in\s+([\s\S]+?)(?:\s+as\s+([\s\S]+?))?(?:\s+track\s+by\s+([\s\S]+?))?\s*$/);if(!match)throw ngRepeatMinErr("iexp","Expected expression in form of '_item_ in _collection_[ track by _id_]' but got '{0}'.",expression);var lhs=match[1],rhs=match[2],aliasAs=match[3],trackByExp=match[4];if(!(match=lhs.match(/^(?:(\s*[$\w]+)|\(\s*([$\w]+)\s*,\s*([$\w]+)\s*\))$/)))throw ngRepeatMinErr("iidexp","'_item_' in '_item_ in _collection_' should be an identifier or '(_key_, _value_)' expression, but got '{0}'.",lhs);var valueIdentifier=match[3]||match[1],keyIdentifier=match[2];if(aliasAs&&(!/^[$a-zA-Z_][$a-zA-Z0-9_]*$/.test(aliasAs)||/^(null|undefined|this|\$index|\$first|\$middle|\$last|\$even|\$odd|\$parent|\$root|\$id)$/.test(aliasAs)))throw ngRepeatMinErr("badident","alias '{0}' is invalid --- must be a valid JS identifier which is not a reserved name.",aliasAs);var trackByExpGetter,trackByIdExpFn,trackByIdArrayFn,trackByIdObjFn,hashFnLocals={$id:hashKey};return trackByExp?trackByExpGetter=$parse(trackByExp):(trackByIdArrayFn=function(key,value){return hashKey(value)},trackByIdObjFn=function(key){return key}),function($scope,$element,$attr,ctrl,$transclude){trackByExpGetter&&(trackByIdExpFn=function(key,value,index){return keyIdentifier&&(hashFnLocals[keyIdentifier]=key),hashFnLocals[valueIdentifier]=value,hashFnLocals.$index=index,trackByExpGetter($scope,hashFnLocals)});var lastBlockMap=createMap();$scope.$watchCollection(rhs,function(collection){var index,length,nextNode,collectionLength,key,value,trackById,trackByIdFn,collectionKeys,block,nextBlockOrder,elementsToRemove,previousNode=$element[0],nextBlockMap=createMap();if(aliasAs&&($scope[aliasAs]=collection),isArrayLike(collection))collectionKeys=collection,trackByIdFn=trackByIdExpFn||trackByIdArrayFn;else{trackByIdFn=trackByIdExpFn||trackByIdObjFn,collectionKeys=[];for(var itemKey in collection)hasOwnProperty.call(collection,itemKey)&&"$"!==itemKey.charAt(0)&&collectionKeys.push(itemKey)}for(collectionLength=collectionKeys.length,nextBlockOrder=new Array(collectionLength),index=0;index<collectionLength;index++)if(key=collection===collectionKeys?index:collectionKeys[index],value=collection[key],trackById=trackByIdFn(key,value,index),lastBlockMap[trackById])block=lastBlockMap[trackById],delete lastBlockMap[trackById],nextBlockMap[trackById]=block,nextBlockOrder[index]=block;else{if(nextBlockMap[trackById])throw forEach(nextBlockOrder,function(block){block&&block.scope&&(lastBlockMap[block.id]=block)}),ngRepeatMinErr("dupes","Duplicates in a repeater are not allowed. Use 'track by' expression to specify unique keys. Repeater: {0}, Duplicate key: {1}, Duplicate value: {2}",expression,trackById,value);nextBlockOrder[index]={id:trackById,scope:void 0,clone:void 0},nextBlockMap[trackById]=!0}for(var blockKey in lastBlockMap){if(block=lastBlockMap[blockKey],elementsToRemove=getBlockNodes(block.clone),$animate.leave(elementsToRemove),elementsToRemove[0].parentNode)for(index=0,length=elementsToRemove.length;index<length;index++)elementsToRemove[index][NG_REMOVED]=!0;block.scope.$destroy()}for(index=0;index<collectionLength;index++)if(key=collection===collectionKeys?index:collectionKeys[index],value=collection[key],block=nextBlockOrder[index],block.scope){nextNode=previousNode;do{nextNode=nextNode.nextSibling}while(nextNode&&nextNode[NG_REMOVED]);getBlockStart(block)!==nextNode&&$animate.move(getBlockNodes(block.clone),null,previousNode),previousNode=getBlockEnd(block),updateScope(block.scope,index,valueIdentifier,value,keyIdentifier,key,collectionLength)}else $transclude(function(clone,scope){block.scope=scope;var endNode=ngRepeatEndComment.cloneNode(!1);clone[clone.length++]=endNode,$animate.enter(clone,null,previousNode),previousNode=endNode,block.clone=clone,nextBlockMap[block.id]=block,updateScope(block.scope,index,valueIdentifier,value,keyIdentifier,key,collectionLength)});lastBlockMap=nextBlockMap})}}}}],NG_HIDE_CLASS="ng-hide",NG_HIDE_IN_PROGRESS_CLASS="ng-hide-animate",ngShowDirective=["$animate",function($animate){return{restrict:"A",multiElement:!0,link:function(scope,element,attr){scope.$watch(attr.ngShow,function(value){$animate[value?"removeClass":"addClass"](element,NG_HIDE_CLASS,{tempClasses:NG_HIDE_IN_PROGRESS_CLASS})})}}}],ngHideDirective=["$animate",function($animate){return{restrict:"A",multiElement:!0,link:function(scope,element,attr){scope.$watch(attr.ngHide,function(value){$animate[value?"addClass":"removeClass"](element,NG_HIDE_CLASS,{tempClasses:NG_HIDE_IN_PROGRESS_CLASS})})}}}],ngStyleDirective=ngDirective(function(scope,element,attr){scope.$watch(attr.ngStyle,function(newStyles,oldStyles){oldStyles&&newStyles!==oldStyles&&forEach(oldStyles,function(val,style){element.css(style,"")}),newStyles&&element.css(newStyles)},!0)}),ngSwitchDirective=["$animate","$compile",function($animate,$compile){return{require:"ngSwitch",controller:["$scope",function(){this.cases={}}],link:function(scope,element,attr,ngSwitchController){var watchExpr=attr.ngSwitch||attr.on,selectedTranscludes=[],selectedElements=[],previousLeaveAnimations=[],selectedScopes=[],spliceFactory=function(array,index){return function(response){!1!==response&&array.splice(index,1)}};scope.$watch(watchExpr,function(value){for(var i,ii;previousLeaveAnimations.length;)$animate.cancel(previousLeaveAnimations.pop());for(i=0,ii=selectedScopes.length;i<ii;++i){var selected=getBlockNodes(selectedElements[i].clone);selectedScopes[i].$destroy();(previousLeaveAnimations[i]=$animate.leave(selected)).done(spliceFactory(previousLeaveAnimations,i))}selectedElements.length=0,selectedScopes.length=0,(selectedTranscludes=ngSwitchController.cases["!"+value]||ngSwitchController.cases["?"])&&forEach(selectedTranscludes,function(selectedTransclude){selectedTransclude.transclude(function(caseElement,selectedScope){selectedScopes.push(selectedScope);var anchor=selectedTransclude.element;caseElement[caseElement.length++]=$compile.$$createComment("end ngSwitchWhen");var block={clone:caseElement};selectedElements.push(block),$animate.enter(caseElement,anchor.parent(),anchor)})})})}}}],ngSwitchWhenDirective=ngDirective({transclude:"element",priority:1200,require:"^ngSwitch",multiElement:!0,link:function(scope,element,attrs,ctrl,$transclude){forEach(attrs.ngSwitchWhen.split(attrs.ngSwitchWhenSeparator).sort().filter(function(element,index,array){return array[index-1]!==element}),function(whenCase){ctrl.cases["!"+whenCase]=ctrl.cases["!"+whenCase]||[],ctrl.cases["!"+whenCase].push({transclude:$transclude,element:element})})}}),ngSwitchDefaultDirective=ngDirective({transclude:"element",priority:1200,require:"^ngSwitch",multiElement:!0,link:function(scope,element,attr,ctrl,$transclude){ctrl.cases["?"]=ctrl.cases["?"]||[],ctrl.cases["?"].push({transclude:$transclude,element:element})}}),ngTranscludeMinErr=minErr("ngTransclude"),ngTranscludeDirective=["$compile",function($compile){return{restrict:"EAC",terminal:!0,compile:function(tElement){var fallbackLinkFn=$compile(tElement.contents());return tElement.empty(),function($scope,$element,$attrs,controller,$transclude){function ngTranscludeCloneAttachFn(clone,transcludedScope){clone.length&&notWhitespace(clone)?$element.append(clone):(useFallbackContent(),transcludedScope.$destroy())}function useFallbackContent(){fallbackLinkFn($scope,function(clone){$element.append(clone)})}function notWhitespace(nodes){for(var i=0,ii=nodes.length;i<ii;i++){var node=nodes[i];if(node.nodeType!==NODE_TYPE_TEXT||node.nodeValue.trim())return!0}}if(!$transclude)throw ngTranscludeMinErr("orphan","Illegal use of ngTransclude directive in the template! No parent directive that requires a transclusion found. Element: {0}",startingTag($element));$attrs.ngTransclude===$attrs.$attr.ngTransclude&&($attrs.ngTransclude="");var slotName=$attrs.ngTransclude||$attrs.ngTranscludeSlot;$transclude(ngTranscludeCloneAttachFn,null,slotName),slotName&&!$transclude.isSlotFilled(slotName)&&useFallbackContent()}}}}],scriptDirective=["$templateCache",function($templateCache){return{restrict:"E",terminal:!0,compile:function(element,attr){if("text/ng-template"===attr.type){var templateUrl=attr.id,text=element[0].text;$templateCache.put(templateUrl,text)}}}}],noopNgModelController={$setViewValue:noop,$render:noop},SelectController=["$element","$scope",function($element,$scope){function scheduleRender(){renderScheduled||(renderScheduled=!0,$scope.$$postDigest(function(){renderScheduled=!1,self.ngModelCtrl.$render()}))}function scheduleViewValueUpdate(renderAfter){updateScheduled||(updateScheduled=!0,$scope.$$postDigest(function(){$scope.$$destroyed||(updateScheduled=!1,self.ngModelCtrl.$setViewValue(self.readValue()),renderAfter&&self.ngModelCtrl.$render())}))}var self=this,optionsMap=new NgMap;self.selectValueMap={},self.ngModelCtrl=noopNgModelController,self.multiple=!1,self.unknownOption=jqLite(window.document.createElement("option")),self.hasEmptyOption=!1,self.emptyOption=void 0,self.renderUnknownOption=function(val){var unknownVal=self.generateUnknownOptionValue(val);self.unknownOption.val(unknownVal),$element.prepend(self.unknownOption),setOptionSelectedStatus(self.unknownOption,!0),$element.val(unknownVal)},self.updateUnknownOption=function(val){var unknownVal=self.generateUnknownOptionValue(val);self.unknownOption.val(unknownVal),setOptionSelectedStatus(self.unknownOption,!0),$element.val(unknownVal)},self.generateUnknownOptionValue=function(val){return"? "+hashKey(val)+" ?"},self.removeUnknownOption=function(){self.unknownOption.parent()&&self.unknownOption.remove()},self.selectEmptyOption=function(){self.emptyOption&&($element.val(""),setOptionSelectedStatus(self.emptyOption,!0))},self.unselectEmptyOption=function(){self.hasEmptyOption&&self.emptyOption.removeAttr("selected")},$scope.$on("$destroy",function(){self.renderUnknownOption=noop}),self.readValue=function(){var val=$element.val(),realVal=val in self.selectValueMap?self.selectValueMap[val]:val;return self.hasOption(realVal)?realVal:null},self.writeValue=function(value){var currentlySelectedOption=$element[0].options[$element[0].selectedIndex];if(currentlySelectedOption&&setOptionSelectedStatus(jqLite(currentlySelectedOption),!1),self.hasOption(value)){self.removeUnknownOption();var hashedVal=hashKey(value);$element.val(hashedVal in self.selectValueMap?hashedVal:value);var selectedOption=$element[0].options[$element[0].selectedIndex];setOptionSelectedStatus(jqLite(selectedOption),!0)}else null==value&&self.emptyOption?(self.removeUnknownOption(),self.selectEmptyOption()):self.unknownOption.parent().length?self.updateUnknownOption(value):self.renderUnknownOption(value)},self.addOption=function(value,element){if(element[0].nodeType!==NODE_TYPE_COMMENT){assertNotHasOwnProperty(value,'"option value"'),""===value&&(self.hasEmptyOption=!0,self.emptyOption=element);var count=optionsMap.get(value)||0;optionsMap.set(value,count+1),scheduleRender()}},self.removeOption=function(value){var count=optionsMap.get(value);count&&(1===count?(optionsMap.delete(value),""===value&&(self.hasEmptyOption=!1,self.emptyOption=void 0)):optionsMap.set(value,count-1))},self.hasOption=function(value){return!!optionsMap.get(value)};var renderScheduled=!1,updateScheduled=!1;self.registerOption=function(optionScope,optionElement,optionAttrs,interpolateValueFn,interpolateTextFn){if(optionAttrs.$attr.ngValue){var oldVal,hashedVal=NaN;optionAttrs.$observe("value",function(newVal){var removal,previouslySelected=optionElement.prop("selected");isDefined(hashedVal)&&(self.removeOption(oldVal),delete self.selectValueMap[hashedVal],removal=!0),hashedVal=hashKey(newVal),oldVal=newVal,self.selectValueMap[hashedVal]=newVal,self.addOption(newVal,optionElement),optionElement.attr("value",hashedVal),removal&&previouslySelected&&scheduleViewValueUpdate()})}else interpolateValueFn?optionAttrs.$observe("value",function(newVal){self.readValue();var removal,previouslySelected=optionElement.prop("selected");isDefined(oldVal)&&(self.removeOption(oldVal),removal=!0),oldVal=newVal,self.addOption(newVal,optionElement),removal&&previouslySelected&&scheduleViewValueUpdate()}):interpolateTextFn?optionScope.$watch(interpolateTextFn,function(newVal,oldVal){optionAttrs.$set("value",newVal);var previouslySelected=optionElement.prop("selected");oldVal!==newVal&&self.removeOption(oldVal),self.addOption(newVal,optionElement),oldVal&&previouslySelected&&scheduleViewValueUpdate()}):self.addOption(optionAttrs.value,optionElement);optionAttrs.$observe("disabled",function(newVal){("true"===newVal||newVal&&optionElement.prop("selected"))&&(self.multiple?scheduleViewValueUpdate(!0):(self.ngModelCtrl.$setViewValue(null),self.ngModelCtrl.$render()))}),optionElement.on("$destroy",function(){var currentValue=self.readValue(),removeValue=optionAttrs.value;self.removeOption(removeValue),scheduleRender(),(self.multiple&&currentValue&&-1!==currentValue.indexOf(removeValue)||currentValue===removeValue)&&scheduleViewValueUpdate(!0)})}}],selectDirective=function(){function selectPreLink(scope,element,attr,ctrls){var selectCtrl=ctrls[0],ngModelCtrl=ctrls[1];if(!ngModelCtrl)return void(selectCtrl.registerOption=noop);if(selectCtrl.ngModelCtrl=ngModelCtrl,element.on("change",function(){selectCtrl.removeUnknownOption(),scope.$apply(function(){ngModelCtrl.$setViewValue(selectCtrl.readValue())})}),attr.multiple){selectCtrl.multiple=!0,selectCtrl.readValue=function(){var array=[];return forEach(element.find("option"),function(option){if(option.selected&&!option.disabled){var val=option.value;array.push(val in selectCtrl.selectValueMap?selectCtrl.selectValueMap[val]:val)}}),array},selectCtrl.writeValue=function(value){forEach(element.find("option"),function(option){var shouldBeSelected=!!value&&(includes(value,option.value)||includes(value,selectCtrl.selectValueMap[option.value]));shouldBeSelected!==option.selected&&setOptionSelectedStatus(jqLite(option),shouldBeSelected)})};var lastView,lastViewRef=NaN;scope.$watch(function(){lastViewRef!==ngModelCtrl.$viewValue||equals(lastView,ngModelCtrl.$viewValue)||(lastView=shallowCopy(ngModelCtrl.$viewValue),ngModelCtrl.$render()),lastViewRef=ngModelCtrl.$viewValue}),ngModelCtrl.$isEmpty=function(value){return!value||0===value.length}}}function selectPostLink(scope,element,attrs,ctrls){var ngModelCtrl=ctrls[1];if(ngModelCtrl){var selectCtrl=ctrls[0];ngModelCtrl.$render=function(){selectCtrl.writeValue(ngModelCtrl.$viewValue)}}}return{restrict:"E",require:["select","?ngModel"],controller:SelectController,priority:1,link:{pre:selectPreLink,post:selectPostLink}}},optionDirective=["$interpolate",function($interpolate){return{restrict:"E",priority:100,compile:function(element,attr){var interpolateValueFn,interpolateTextFn;return isDefined(attr.ngValue)||(isDefined(attr.value)?interpolateValueFn=$interpolate(attr.value,!0):(interpolateTextFn=$interpolate(element.text(),!0))||attr.$set("value",element.text())),function(scope,element,attr){var selectCtrlName="$selectController",parent=element.parent(),selectCtrl=parent.data(selectCtrlName)||parent.parent().data(selectCtrlName);selectCtrl&&selectCtrl.registerOption(scope,element,attr,interpolateValueFn,interpolateTextFn)}}}}],requiredDirective=function(){return{restrict:"A",require:"?ngModel",link:function(scope,elm,attr,ctrl){ctrl&&(attr.required=!0,ctrl.$validators.required=function(modelValue,viewValue){return!attr.required||!ctrl.$isEmpty(viewValue)},attr.$observe("required",function(){ctrl.$validate()}))}}},patternDirective=function(){return{restrict:"A",require:"?ngModel",link:function(scope,elm,attr,ctrl){if(ctrl){var regexp,patternExp=attr.ngPattern||attr.pattern;attr.$observe("pattern",function(regex){if(isString(regex)&&regex.length>0&&(regex=new RegExp("^"+regex+"$")),regex&&!regex.test)throw minErr("ngPattern")("noregexp","Expected {0} to be a RegExp but was {1}. Element: {2}",patternExp,regex,startingTag(elm));regexp=regex||void 0,ctrl.$validate()}),ctrl.$validators.pattern=function(modelValue,viewValue){return ctrl.$isEmpty(viewValue)||isUndefined(regexp)||regexp.test(viewValue)}}}}},maxlengthDirective=function(){return{restrict:"A",require:"?ngModel",link:function(scope,elm,attr,ctrl){if(ctrl){var maxlength=-1;attr.$observe("maxlength",function(value){var intVal=toInt(value);maxlength=isNumberNaN(intVal)?-1:intVal,ctrl.$validate()}),ctrl.$validators.maxlength=function(modelValue,viewValue){return maxlength<0||ctrl.$isEmpty(viewValue)||viewValue.length<=maxlength}}}}},minlengthDirective=function(){return{restrict:"A",require:"?ngModel",link:function(scope,elm,attr,ctrl){if(ctrl){var minlength=0;attr.$observe("minlength",function(value){minlength=toInt(value)||0,ctrl.$validate()}),ctrl.$validators.minlength=function(modelValue,viewValue){return ctrl.$isEmpty(viewValue)||viewValue.length>=minlength}}}}};if(window.angular.bootstrap)return void(window.console&&console.log("WARNING: Tried to load angular more than once."));bindJQuery(),publishExternalAPI(angular),angular.module("ngLocale",[],["$provide",function($provide){function getDecimals(n){n+="";var i=n.indexOf(".");return-1==i?0:n.length-i-1}function getVF(n,opt_precision){var v=opt_precision;void 0===v&&(v=Math.min(getDecimals(n),3));var base=Math.pow(10,v);return{v:v,f:(n*base|0)%base}}var PLURAL_CATEGORY={ZERO:"zero",ONE:"one",TWO:"two",FEW:"few",MANY:"many",OTHER:"other"};$provide.value("$locale",{DATETIME_FORMATS:{AMPMS:["AM","PM"],DAY:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],ERANAMES:["Before Christ","Anno Domini"],ERAS:["BC","AD"],FIRSTDAYOFWEEK:6,MONTH:["January","February","March","April","May","June","July","August","September","October","November","December"],SHORTDAY:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],SHORTMONTH:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],STANDALONEMONTH:["January","February","March","April","May","June","July","August","September","October","November","December"],WEEKENDRANGE:[5,6],fullDate:"EEEE, MMMM d, y",longDate:"MMMM d, y",medium:"MMM d, y h:mm:ss a",mediumDate:"MMM d, y",mediumTime:"h:mm:ss a",short:"M/d/yy h:mm a",shortDate:"M/d/yy",shortTime:"h:mm a"},NUMBER_FORMATS:{CURRENCY_SYM:"$",DECIMAL_SEP:".",GROUP_SEP:",",PATTERNS:[{gSize:3,lgSize:3,maxFrac:3,minFrac:0,minInt:1,negPre:"-",negSuf:"",posPre:"",posSuf:""},{gSize:3,lgSize:3,maxFrac:2,minFrac:2,minInt:1,negPre:"-¤",negSuf:"",posPre:"¤",posSuf:""}]},id:"en-us",localeID:"en_US",pluralCat:function(n,opt_precision){var i=0|n,vf=getVF(n,opt_precision);return 1==i&&0==vf.v?PLURAL_CATEGORY.ONE:PLURAL_CATEGORY.OTHER}})}]),jqLite(function(){angularInit(window.document,bootstrap)})}(window),!window.angular.$$csp().noInlineStyle&&window.angular.element(document.head).prepend('<style type="text/css">@charset "UTF-8";[ng\\:cloak],[ng-cloak],[data-ng-cloak],[x-ng-cloak],.ng-cloak,.x-ng-cloak,.ng-hide:not(.ng-hide-animate){display:none !important;}ng\\:form{display:block;}.ng-animate-shim{visibility:hidden;}.ng-anchor{position:absolute;}</style>'),angular.module("ui.tinymce",[]).value("uiTinymceConfig",{}).directive("uiTinymce",["$rootScope","$compile","$timeout","$window","$sce","uiTinymceConfig","uiTinymceService",function($rootScope,$compile,$timeout,$window,$sce,uiTinymceConfig,uiTinymceService){return uiTinymceConfig=uiTinymceConfig||{},uiTinymceConfig.baseUrl&&(tinymce.baseURL=uiTinymceConfig.baseUrl),{require:["ngModel","^?form"],priority:599,link:function(scope,element,attrs,ctrls){function toggleDisable(disabled){disabled?(ensureInstance(),tinyInstance&&tinyInstance.getBody().setAttribute("contenteditable",!1)):(ensureInstance(),tinyInstance&&!tinyInstance.settings.readonly&&tinyInstance.getDoc()&&tinyInstance.getBody().setAttribute("contenteditable",!0))}function ensureInstance(){tinyInstance||(tinyInstance=tinymce.get(attrs.id))}if($window.tinymce){var expression,tinyInstance,ngModel=ctrls[0],form=ctrls[1]||null,options={debounce:!0},updateView=function(editor){var content=editor.getContent({format:options.format}).trim();content=$sce.trustAsHtml(content),ngModel.$setViewValue(content),$rootScope.$$phase||scope.$digest()},uniqueId=uiTinymceService.getUniqueId();attrs.$set("id",uniqueId),expression={},angular.extend(expression,scope.$eval(attrs.uiTinymce));var debouncedUpdate=function(debouncedUpdateDelay){var debouncedUpdateTimer;return function(ed){$timeout.cancel(debouncedUpdateTimer),debouncedUpdateTimer=$timeout(function(){return function(ed){ed.isDirty()&&(ed.save(),updateView(ed))}(ed)},debouncedUpdateDelay)}}(400),setupOptions={setup:function(ed){ed.on("init",function(){ngModel.$render(),ngModel.$setPristine(),ngModel.$setUntouched(),form&&form.$setPristine()}),ed.on("ExecCommand change NodeChange ObjectResized",function(){if(!options.debounce)return ed.save(),void updateView(ed);debouncedUpdate(ed)}),ed.on("blur",function(){element[0].blur(),ngModel.$setTouched(),$rootScope.$$phase||scope.$digest()}),ed.on("remove",function(){element.remove()}),uiTinymceConfig.setup&&uiTinymceConfig.setup(ed,{updateView:updateView}),expression.setup&&expression.setup(ed,{updateView:updateView})},format:expression.format||"html",selector:"#"+attrs.id};angular.extend(options,uiTinymceConfig,expression,setupOptions),$timeout(function(){options.baseURL&&(tinymce.baseURL=options.baseURL);var maybeInitPromise=tinymce.init(options);maybeInitPromise&&"function"==typeof maybeInitPromise.then?maybeInitPromise.then(function(){toggleDisable(scope.$eval(attrs.ngDisabled))}):toggleDisable(scope.$eval(attrs.ngDisabled))}),ngModel.$formatters.unshift(function(modelValue){return modelValue?$sce.trustAsHtml(modelValue):""}),ngModel.$parsers.unshift(function(viewValue){return viewValue?$sce.getTrustedHtml(viewValue):""}),ngModel.$render=function(){ensureInstance();var viewValue=ngModel.$viewValue?$sce.getTrustedHtml(ngModel.$viewValue):"";tinyInstance&&tinyInstance.getDoc()&&(tinyInstance.setContent(viewValue),tinyInstance.fire("change"))},attrs.$observe("disabled",toggleDisable);var unbindEventListener=scope.$on("$tinymce:refresh",function(e,id){var eid=attrs.id;if(angular.isUndefined(id)||id===eid){var parentElement=element.parent(),clonedElement=element.clone();clonedElement.removeAttr("id"),clonedElement.removeAttr("style"),clonedElement.removeAttr("aria-hidden"),tinymce.execCommand("mceRemoveEditor",!1,eid),parentElement.append($compile(clonedElement)(scope)),unbindEventListener()}});scope.$on("$destroy",function(){ensureInstance(),tinyInstance&&(tinyInstance.remove(),tinyInstance=null)})}}}}]).service("uiTinymceService",[function(){return new function(){var uniqueId=0;return{getUniqueId:function(){return"ui-tinymce-"+ ++uniqueId}}}}]),function(){"use strict";function a(a){return angular.isUndefined(a)||null===a}function b(){try{return require("moment")}catch(a){throw new Error("Please install moment via npm. Please reference to: https://github.com/urish/angular-moment")}}function c(c,d){if(void 0===d){if("function"!=typeof require)throw new Error("Moment cannot be found by angular-moment! Please reference to: https://github.com/urish/angular-moment");d=b()}return c.module("angularMoment",[]).constant("angularMomentConfig",{preprocess:null,timezone:null,format:null,statefulFilters:!0}).constant("moment",d).constant("amTimeAgoConfig",{withoutSuffix:!1,serverTime:null,titleFormat:null,fullDateThreshold:null,fullDateFormat:null,fullDateThresholdUnit:"day"}).directive("amTimeAgo",["$window","moment","amMoment","amTimeAgoConfig",function(b,d,e,f){return function(g,h,i){function j(){var a;if(p)a=p;else if(f.serverTime){var b=(new Date).getTime(),c=b-w+f.serverTime;a=d(c)}else a=d();return a}function k(){q&&(b.clearTimeout(q),q=null)}function l(a){var c=j().diff(a,v),d=t&&c>=t;if(d?h.text(a.format(u)):h.text(a.from(j(),r)),s&&z&&h.attr("title",a.format(s)),!d){var e=Math.abs(j().diff(a,"minute")),f=3600;e<1?f=1:e<60?f=30:e<180&&(f=300),q=b.setTimeout(function(){l(a)},1e3*f)}}function m(a){y&&h.attr("datetime",a)}function n(){if(k(),o){var a=e.preprocessDate(o);l(a),m(a.toISOString())}}var o,p,q=null,r=f.withoutSuffix,s=f.titleFormat,t=f.fullDateThreshold,u=f.fullDateFormat,v=f.fullDateThresholdUnit,w=(new Date).getTime(),x=i.amTimeAgo,y="TIME"===h[0].nodeName.toUpperCase(),z=!h.attr("title");g.$watch(x,function(b){return a(b)||""===b?(k(),void(o&&(h.text(""),m(""),o=null))):(o=b,void n())}),c.isDefined(i.amFrom)&&g.$watch(i.amFrom,function(b){p=a(b)||""===b?null:d(b),n()}),c.isDefined(i.amWithoutSuffix)&&g.$watch(i.amWithoutSuffix,function(a){"boolean"==typeof a?(r=a,n()):r=f.withoutSuffix}),i.$observe("amFullDateThreshold",function(a){t=a,n()}),i.$observe("amFullDateFormat",function(a){u=a,n()}),i.$observe("amFullDateThresholdUnit",function(a){v=a,n()}),g.$on("$destroy",function(){k()}),g.$on("amMoment:localeChanged",function(){n()})}}]).service("amMoment",["moment","$rootScope","$log","angularMomentConfig",function(a,b,d,e){var f=null;this.changeLocale=function(d,e){var f=a.locale(d,e);return c.isDefined(d)&&b.$broadcast("amMoment:localeChanged"),f},this.changeTimezone=function(c){a.tz&&a.tz.setDefault?(a.tz.setDefault(c),b.$broadcast("amMoment:timezoneChanged")):d.warn("angular-moment: changeTimezone() works only with moment-timezone.js v0.3.0 or greater."),e.timezone=c,f=c},this.preprocessDate=function(b){return f!==e.timezone&&this.changeTimezone(e.timezone),e.preprocess?e.preprocess(b):a(!isNaN(parseFloat(b))&&isFinite(b)?parseInt(b,10):b)}}]).filter("amParse",["moment",function(a){return function(b,c){return a(b,c)}}]).filter("amFromUnix",["moment",function(a){return function(b){return a.unix(b)}}]).filter("amUtc",["moment",function(a){return function(b){return a.utc(b)}}]).filter("amUtcOffset",["amMoment",function(a){function b(b,c){return a.preprocessDate(b).utcOffset(c)}return b}]).filter("amLocal",["moment",function(a){return function(b){return a.isMoment(b)?b.local():null}}]).filter("amTimezone",["amMoment","angularMomentConfig","$log",function(a,b,c){function d(b,d){var e=a.preprocessDate(b);return d?e.tz?e.tz(d):(c.warn("angular-moment: named timezone specified but moment.tz() is undefined. Did you forget to include moment-timezone.js ?"),e):e}return d}]).filter("amCalendar",["moment","amMoment","angularMomentConfig",function(b,c,d){function e(b,d,e){if(a(b))return"";var f=c.preprocessDate(b);return f.isValid()?f.calendar(d,e):""}return e.$stateful=d.statefulFilters,e}]).filter("amDifference",["moment","amMoment","angularMomentConfig",function(b,c,d){function e(d,e,f,g){if(a(d))return"";var h=c.preprocessDate(d),i=a(e)?b():c.preprocessDate(e);return h.isValid()&&i.isValid()?h.diff(i,f,g):""}return e.$stateful=d.statefulFilters,e}]).filter("amDateFormat",["moment","amMoment","angularMomentConfig",function(b,c,d){function e(b,d){if(a(b))return"";var e=c.preprocessDate(b);return e.isValid()?e.format(d):""}return e.$stateful=d.statefulFilters,e}]).filter("amDurationFormat",["moment","angularMomentConfig",function(b,c){function d(c,d,e){return a(c)?"":b.duration(c,d).humanize(e)}return d.$stateful=c.statefulFilters,d}]).filter("amTimeAgo",["moment","amMoment","angularMomentConfig",function(b,c,d){function e(d,e,f){var g,h;return a(d)?"":(d=c.preprocessDate(d),g=b(d),g.isValid()?(h=b(f),!a(f)&&h.isValid()?g.from(h,e):g.fromNow(e)):"")}return e.$stateful=d.statefulFilters,e}]).filter("amSubtract",["moment","angularMomentConfig",function(b,c){function d(c,d,e){return a(c)?"":b(c).subtract(parseInt(d,10),e)}return d.$stateful=c.statefulFilters,d}]).filter("amAdd",["moment","angularMomentConfig",function(b,c){function d(c,d,e){return a(c)?"":b(c).add(parseInt(d,10),e)}return d.$stateful=c.statefulFilters,d}]).filter("amStartOf",["moment","angularMomentConfig",function(b,c){function d(c,d){return a(c)?"":b(c).startOf(d)}return d.$stateful=c.statefulFilters,d}]).filter("amEndOf",["moment","angularMomentConfig",function(b,c){function d(c,d){return a(c)?"":b(c).endOf(d)}return d.$stateful=c.statefulFilters,d}]),"angularMoment"}var d=window&&window.process&&window.process.type;"function"==typeof define&&define.amd?define(["angular","moment"],c):"undefined"!=typeof module&&module&&module.exports&&"function"==typeof require&&!d?module.exports=c(require("angular"),require("moment")):c(angular,("undefined"!=typeof global?global:window).moment)}(),function(window,angular){"use strict";function $$CookieWriter($document,$log,$browser){function buildCookieString(name,value,options){var path,expires;options=options||{},expires=options.expires,path=angular.isDefined(options.path)?options.path:cookiePath,angular.isUndefined(value)&&(expires="Thu, 01 Jan 1970 00:00:00 GMT",value=""),angular.isString(expires)&&(expires=new Date(expires));var str=encodeURIComponent(name)+"="+encodeURIComponent(value);str+=path?";path="+path:"",str+=options.domain?";domain="+options.domain:"",str+=expires?";expires="+expires.toUTCString():"",str+=options.secure?";secure":"";var cookieLength=str.length+1;return cookieLength>4096&&$log.warn("Cookie '"+name+"' possibly not set or overflowed because it was too large ("+cookieLength+" > 4096 bytes)!"),str}var cookiePath=$browser.baseHref(),rawDocument=$document[0];return function(name,value,options){rawDocument.cookie=buildCookieString(name,value,options)}}angular.module("ngCookies",["ng"]).provider("$cookies",[function(){function calcOptions(options){return options?angular.extend({},defaults,options):defaults}var defaults=this.defaults={};this.$get=["$$cookieReader","$$cookieWriter",function($$cookieReader,$$cookieWriter){return{get:function(key){return $$cookieReader()[key]},getObject:function(key){var value=this.get(key);return value?angular.fromJson(value):value},getAll:function(){return $$cookieReader()},put:function(key,value,options){$$cookieWriter(key,value,calcOptions(options))},putObject:function(key,value,options){this.put(key,angular.toJson(value),options)},remove:function(key,options){$$cookieWriter(key,void 0,calcOptions(options))}}}]}]),angular.module("ngCookies").factory("$cookieStore",["$cookies",function($cookies){return{get:function(key){return $cookies.getObject(key)},put:function(key,value){$cookies.putObject(key,value)},remove:function(key){$cookies.remove(key)}}}]),$$CookieWriter.$inject=["$document","$log","$browser"],angular.module("ngCookies").provider("$$cookieWriter",function(){this.$get=$$CookieWriter})}(window,window.angular),function(window,angular){"use strict";function shallowCopy(src,dst){if(isArray(src)){dst=dst||[];for(var i=0,ii=src.length;i<ii;i++)dst[i]=src[i]}else if(isObject(src)){dst=dst||{};for(var key in src)"$"===key.charAt(0)&&"$"===key.charAt(1)||(dst[key]=src[key])}return dst||src}function $RouteProvider(){function inherit(parent,extra){return angular.extend(Object.create(parent),extra)}function pathRegExp(path,opts){var insensitive=opts.caseInsensitiveMatch,ret={originalPath:path,regexp:path},keys=ret.keys=[];return path=path.replace(/([().])/g,"\\$1").replace(/(\/)?:(\w+)(\*\?|[?*])?/g,function(_,slash,key,option){var optional="?"===option||"*?"===option?"?":null,star="*"===option||"*?"===option?"*":null;return keys.push({name:key,optional:!!optional}),slash=slash||"",(optional?"":slash)+"(?:"+(optional?slash:"")+(star&&"(.+?)"||"([^/]+)")+(optional||"")+")"+(optional||"")}).replace(/([\/$*])/g,"\\$1"),ret.regexp=new RegExp("^"+path+"$",insensitive?"i":""),ret}isArray=angular.isArray,isObject=angular.isObject,isDefined=angular.isDefined;var routes={};this.when=function(path,route){var routeCopy=shallowCopy(route)
;if(angular.isUndefined(routeCopy.reloadOnSearch)&&(routeCopy.reloadOnSearch=!0),angular.isUndefined(routeCopy.caseInsensitiveMatch)&&(routeCopy.caseInsensitiveMatch=this.caseInsensitiveMatch),routes[path]=angular.extend(routeCopy,path&&pathRegExp(path,routeCopy)),path){var redirectPath="/"===path[path.length-1]?path.substr(0,path.length-1):path+"/";routes[redirectPath]=angular.extend({redirectTo:path},pathRegExp(redirectPath,routeCopy))}return this},this.caseInsensitiveMatch=!1,this.otherwise=function(params){return"string"==typeof params&&(params={redirectTo:params}),this.when(null,params),this},isEagerInstantiationEnabled=!0,this.eagerInstantiationEnabled=function(enabled){return isDefined(enabled)?(isEagerInstantiationEnabled=enabled,this):isEagerInstantiationEnabled},this.$get=["$rootScope","$location","$routeParams","$q","$injector","$templateRequest","$sce",function($rootScope,$location,$routeParams,$q,$injector,$templateRequest,$sce){function switchRouteMatcher(on,route){var keys=route.keys,params={};if(!route.regexp)return null;var m=route.regexp.exec(on);if(!m)return null;for(var i=1,len=m.length;i<len;++i){var key=keys[i-1],val=m[i];key&&val&&(params[key.name]=val)}return params}function prepareRoute($locationEvent){var lastRoute=$route.current;preparedRoute=parseRoute(),(preparedRouteIsUpdateOnly=preparedRoute&&lastRoute&&preparedRoute.$$route===lastRoute.$$route&&angular.equals(preparedRoute.pathParams,lastRoute.pathParams)&&!preparedRoute.reloadOnSearch&&!forceReload)||!lastRoute&&!preparedRoute||$rootScope.$broadcast("$routeChangeStart",preparedRoute,lastRoute).defaultPrevented&&$locationEvent&&$locationEvent.preventDefault()}function commitRoute(){var lastRoute=$route.current,nextRoute=preparedRoute;if(preparedRouteIsUpdateOnly)lastRoute.params=nextRoute.params,angular.copy(lastRoute.params,$routeParams),$rootScope.$broadcast("$routeUpdate",lastRoute);else if(nextRoute||lastRoute){forceReload=!1,$route.current=nextRoute;var nextRoutePromise=$q.resolve(nextRoute);nextRoutePromise.then(getRedirectionData).then(handlePossibleRedirection).then(function(keepProcessingRoute){return keepProcessingRoute&&nextRoutePromise.then(resolveLocals).then(function(locals){nextRoute===$route.current&&(nextRoute&&(nextRoute.locals=locals,angular.copy(nextRoute.params,$routeParams)),$rootScope.$broadcast("$routeChangeSuccess",nextRoute,lastRoute))})}).catch(function(error){nextRoute===$route.current&&$rootScope.$broadcast("$routeChangeError",nextRoute,lastRoute,error)})}}function getRedirectionData(route){var data={route:route,hasRedirection:!1};if(route)if(route.redirectTo)if(angular.isString(route.redirectTo))data.path=interpolate(route.redirectTo,route.params),data.search=route.params,data.hasRedirection=!0;else{var oldPath=$location.path(),oldSearch=$location.search(),newUrl=route.redirectTo(route.pathParams,oldPath,oldSearch);angular.isDefined(newUrl)&&(data.url=newUrl,data.hasRedirection=!0)}else if(route.resolveRedirectTo)return $q.resolve($injector.invoke(route.resolveRedirectTo)).then(function(newUrl){return angular.isDefined(newUrl)&&(data.url=newUrl,data.hasRedirection=!0),data});return data}function handlePossibleRedirection(data){var keepProcessingRoute=!0;if(data.route!==$route.current)keepProcessingRoute=!1;else if(data.hasRedirection){var oldUrl=$location.url(),newUrl=data.url;newUrl?$location.url(newUrl).replace():newUrl=$location.path(data.path).search(data.search).replace().url(),newUrl!==oldUrl&&(keepProcessingRoute=!1)}return keepProcessingRoute}function resolveLocals(route){if(route){var locals=angular.extend({},route.resolve);angular.forEach(locals,function(value,key){locals[key]=angular.isString(value)?$injector.get(value):$injector.invoke(value,null,null,key)});var template=getTemplateFor(route);return angular.isDefined(template)&&(locals.$template=template),$q.all(locals)}}function getTemplateFor(route){var template,templateUrl;return angular.isDefined(template=route.template)?angular.isFunction(template)&&(template=template(route.params)):angular.isDefined(templateUrl=route.templateUrl)&&(angular.isFunction(templateUrl)&&(templateUrl=templateUrl(route.params)),angular.isDefined(templateUrl)&&(route.loadedTemplateUrl=$sce.valueOf(templateUrl),template=$templateRequest(templateUrl))),template}function parseRoute(){var params,match;return angular.forEach(routes,function(route,path){!match&&(params=switchRouteMatcher($location.path(),route))&&(match=inherit(route,{params:angular.extend({},$location.search(),params),pathParams:params}),match.$$route=route)}),match||routes[null]&&inherit(routes[null],{params:{},pathParams:{}})}function interpolate(string,params){var result=[];return angular.forEach((string||"").split(":"),function(segment,i){if(0===i)result.push(segment);else{var segmentMatch=segment.match(/(\w+)(?:[?*])?(.*)/),key=segmentMatch[1];result.push(params[key]),result.push(segmentMatch[2]||""),delete params[key]}}),result.join("")}var preparedRoute,preparedRouteIsUpdateOnly,forceReload=!1,$route={routes:routes,reload:function(){forceReload=!0;var fakeLocationEvent={defaultPrevented:!1,preventDefault:function(){this.defaultPrevented=!0,forceReload=!1}};$rootScope.$evalAsync(function(){prepareRoute(fakeLocationEvent),fakeLocationEvent.defaultPrevented||commitRoute()})},updateParams:function(newParams){if(!this.current||!this.current.$$route)throw $routeMinErr("norout","Tried updating route when with no current route");newParams=angular.extend({},this.current.params,newParams),$location.path(interpolate(this.current.$$route.originalPath,newParams)),$location.search(newParams)}};return $rootScope.$on("$locationChangeStart",prepareRoute),$rootScope.$on("$locationChangeSuccess",commitRoute),$route}]}function instantiateRoute($injector){isEagerInstantiationEnabled&&$injector.get("$route")}function $RouteParamsProvider(){this.$get=function(){return{}}}function ngViewFactory($route,$anchorScroll,$animate){return{restrict:"ECA",terminal:!0,priority:400,transclude:"element",link:function(scope,$element,attr,ctrl,$transclude){function cleanupLastView(){previousLeaveAnimation&&($animate.cancel(previousLeaveAnimation),previousLeaveAnimation=null),currentScope&&(currentScope.$destroy(),currentScope=null),currentElement&&(previousLeaveAnimation=$animate.leave(currentElement),previousLeaveAnimation.done(function(response){!1!==response&&(previousLeaveAnimation=null)}),currentElement=null)}function update(){var locals=$route.current&&$route.current.locals,template=locals&&locals.$template;if(angular.isDefined(template)){var newScope=scope.$new(),current=$route.current,clone=$transclude(newScope,function(clone){$animate.enter(clone,null,currentElement||$element).done(function(response){!1===response||!angular.isDefined(autoScrollExp)||autoScrollExp&&!scope.$eval(autoScrollExp)||$anchorScroll()}),cleanupLastView()});currentElement=clone,currentScope=current.scope=newScope,currentScope.$emit("$viewContentLoaded"),currentScope.$eval(onloadExp)}else cleanupLastView()}var currentScope,currentElement,previousLeaveAnimation,autoScrollExp=attr.autoscroll,onloadExp=attr.onload||"";scope.$on("$routeChangeSuccess",update),update()}}}function ngViewFillContentFactory($compile,$controller,$route){return{restrict:"ECA",priority:-400,link:function(scope,$element){var current=$route.current,locals=current.locals;$element.html(locals.$template);var link=$compile($element.contents());if(current.controller){locals.$scope=scope;var controller=$controller(current.controller,locals);current.controllerAs&&(scope[current.controllerAs]=controller),$element.data("$ngControllerController",controller),$element.children().data("$ngControllerController",controller)}scope[current.resolveAs||"$resolve"]=locals,link(scope)}}}var isArray,isObject,isDefined,isEagerInstantiationEnabled,ngRouteModule=angular.module("ngRoute",[]).provider("$route",$RouteProvider).run(instantiateRoute),$routeMinErr=angular.$$minErr("ngRoute");instantiateRoute.$inject=["$injector"],ngRouteModule.provider("$routeParams",$RouteParamsProvider),ngRouteModule.directive("ngView",ngViewFactory),ngRouteModule.directive("ngView",ngViewFillContentFactory),ngViewFactory.$inject=["$route","$anchorScroll","$animate"],ngViewFillContentFactory.$inject=["$compile","$controller","$route"]}(window,window.angular),function(window,angular){"use strict";function $SanitizeProvider(){function toMap(str,lowercaseKeys){var i,obj={},items=str.split(",");for(i=0;i<items.length;i++)obj[lowercaseKeys?lowercase(items[i]):items[i]]=!0;return obj}function htmlParserImpl(html,handler){null===html||void 0===html?html="":"string"!=typeof html&&(html=""+html),inertBodyElement.innerHTML=html;var mXSSAttempts=5;do{if(0===mXSSAttempts)throw $sanitizeMinErr("uinput","Failed to sanitize html because the input is unstable");mXSSAttempts--,window.document.documentMode&&stripCustomNsAttrs(inertBodyElement),html=inertBodyElement.innerHTML,inertBodyElement.innerHTML=html}while(html!==inertBodyElement.innerHTML);for(var node=inertBodyElement.firstChild;node;){switch(node.nodeType){case 1:handler.start(node.nodeName.toLowerCase(),attrToMap(node.attributes));break;case 3:handler.chars(node.textContent)}var nextNode;if(!((nextNode=node.firstChild)||(1===node.nodeType&&handler.end(node.nodeName.toLowerCase()),nextNode=node.nextSibling)))for(;null==nextNode&&(node=node.parentNode)!==inertBodyElement;)nextNode=node.nextSibling,1===node.nodeType&&handler.end(node.nodeName.toLowerCase());node=nextNode}for(;node=inertBodyElement.firstChild;)inertBodyElement.removeChild(node)}function attrToMap(attrs){for(var map={},i=0,ii=attrs.length;i<ii;i++){var attr=attrs[i];map[attr.name]=attr.value}return map}function encodeEntities(value){return value.replace(/&/g,"&amp;").replace(SURROGATE_PAIR_REGEXP,function(value){return"&#"+(1024*(value.charCodeAt(0)-55296)+(value.charCodeAt(1)-56320)+65536)+";"}).replace(NON_ALPHANUMERIC_REGEXP,function(value){return"&#"+value.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}function htmlSanitizeWriterImpl(buf,uriValidator){var ignoreCurrentElement=!1,out=bind(buf,buf.push);return{start:function(tag,attrs){tag=lowercase(tag),!ignoreCurrentElement&&blockedElements[tag]&&(ignoreCurrentElement=tag),ignoreCurrentElement||!0!==validElements[tag]||(out("<"),out(tag),forEach(attrs,function(value,key){var lkey=lowercase(key),isImage="img"===tag&&"src"===lkey||"background"===lkey;!0!==validAttrs[lkey]||!0===uriAttrs[lkey]&&!uriValidator(value,isImage)||(out(" "),out(key),out('="'),out(encodeEntities(value)),out('"'))}),out(">"))},end:function(tag){tag=lowercase(tag),ignoreCurrentElement||!0!==validElements[tag]||!0===voidElements[tag]||(out("</"),out(tag),out(">")),tag==ignoreCurrentElement&&(ignoreCurrentElement=!1)},chars:function(chars){ignoreCurrentElement||out(encodeEntities(chars))}}}function stripCustomNsAttrs(node){for(;node;){if(node.nodeType===window.Node.ELEMENT_NODE)for(var attrs=node.attributes,i=0,l=attrs.length;i<l;i++){var attrNode=attrs[i],attrName=attrNode.name.toLowerCase();"xmlns:ns1"!==attrName&&0!==attrName.lastIndexOf("ns1:",0)||(node.removeAttributeNode(attrNode),i--,l--)}var nextNode=node.firstChild;nextNode&&stripCustomNsAttrs(nextNode),node=node.nextSibling}}var svgEnabled=!1;this.$get=["$$sanitizeUri",function($$sanitizeUri){return svgEnabled&&extend(validElements,svgElements),function(html){var buf=[];return htmlParser(html,htmlSanitizeWriter(buf,function(uri,isImage){return!/^unsafe:/.test($$sanitizeUri(uri,isImage))})),buf.join("")}}],this.enableSvg=function(enableSvg){return isDefined(enableSvg)?(svgEnabled=enableSvg,this):svgEnabled},bind=angular.bind,extend=angular.extend,forEach=angular.forEach,isDefined=angular.isDefined,lowercase=angular.lowercase,noop=angular.noop,htmlParser=htmlParserImpl,htmlSanitizeWriter=htmlSanitizeWriterImpl;var inertBodyElement,SURROGATE_PAIR_REGEXP=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,NON_ALPHANUMERIC_REGEXP=/([^#-~ |!])/g,voidElements=toMap("area,br,col,hr,img,wbr"),optionalEndTagBlockElements=toMap("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),optionalEndTagInlineElements=toMap("rp,rt"),optionalEndTagElements=extend({},optionalEndTagInlineElements,optionalEndTagBlockElements),blockElements=extend({},optionalEndTagBlockElements,toMap("address,article,aside,blockquote,caption,center,del,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,map,menu,nav,ol,pre,section,table,ul")),inlineElements=extend({},optionalEndTagInlineElements,toMap("a,abbr,acronym,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,q,ruby,rp,rt,s,samp,small,span,strike,strong,sub,sup,time,tt,u,var")),svgElements=toMap("circle,defs,desc,ellipse,font-face,font-face-name,font-face-src,g,glyph,hkern,image,linearGradient,line,marker,metadata,missing-glyph,mpath,path,polygon,polyline,radialGradient,rect,stop,svg,switch,text,title,tspan"),blockedElements=toMap("script,style"),validElements=extend({},voidElements,blockElements,inlineElements,optionalEndTagElements),uriAttrs=toMap("background,cite,href,longdesc,src,xlink:href"),htmlAttrs=toMap("abbr,align,alt,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,coords,dir,face,headers,height,hreflang,hspace,ismap,lang,language,nohref,nowrap,rel,rev,rows,rowspan,rules,scope,scrolling,shape,size,span,start,summary,tabindex,target,title,type,valign,value,vspace,width"),svgAttrs=toMap("accent-height,accumulate,additive,alphabetic,arabic-form,ascent,baseProfile,bbox,begin,by,calcMode,cap-height,class,color,color-rendering,content,cx,cy,d,dx,dy,descent,display,dur,end,fill,fill-rule,font-family,font-size,font-stretch,font-style,font-variant,font-weight,from,fx,fy,g1,g2,glyph-name,gradientUnits,hanging,height,horiz-adv-x,horiz-origin-x,ideographic,k,keyPoints,keySplines,keyTimes,lang,marker-end,marker-mid,marker-start,markerHeight,markerUnits,markerWidth,mathematical,max,min,offset,opacity,orient,origin,overline-position,overline-thickness,panose-1,path,pathLength,points,preserveAspectRatio,r,refX,refY,repeatCount,repeatDur,requiredExtensions,requiredFeatures,restart,rotate,rx,ry,slope,stemh,stemv,stop-color,stop-opacity,strikethrough-position,strikethrough-thickness,stroke,stroke-dasharray,stroke-dashoffset,stroke-linecap,stroke-linejoin,stroke-miterlimit,stroke-opacity,stroke-width,systemLanguage,target,text-anchor,to,transform,type,u1,u2,underline-position,underline-thickness,unicode,unicode-range,units-per-em,values,version,viewBox,visibility,width,widths,x,x-height,x1,x2,xlink:actuate,xlink:arcrole,xlink:role,xlink:show,xlink:title,xlink:type,xml:base,xml:lang,xml:space,xmlns,xmlns:xlink,y,y1,y2,zoomAndPan",!0),validAttrs=extend({},uriAttrs,svgAttrs,htmlAttrs);!function(window){var doc;if(!window.document||!window.document.implementation)throw $sanitizeMinErr("noinert","Can't create an inert html document");doc=window.document.implementation.createHTMLDocument("inert");var docElement=doc.documentElement||doc.getDocumentElement(),bodyElements=docElement.getElementsByTagName("body");if(1===bodyElements.length)inertBodyElement=bodyElements[0];else{var html=doc.createElement("html");inertBodyElement=doc.createElement("body"),html.appendChild(inertBodyElement),doc.appendChild(html)}}(window)}function sanitizeText(chars){var buf=[];return htmlSanitizeWriter(buf,noop).chars(chars),buf.join("")}var bind,extend,forEach,isDefined,lowercase,noop,htmlParser,htmlSanitizeWriter,$sanitizeMinErr=angular.$$minErr("$sanitize");angular.module("ngSanitize",[]).provider("$sanitize",$SanitizeProvider),angular.module("ngSanitize").filter("linky",["$sanitize",function($sanitize){var LINKY_URL_REGEXP=/((ftp|https?):\/\/|(www\.)|(mailto:)?[A-Za-z0-9._%+-]+@)\S*[^\s.;,(){}<>"\u201d\u2019]/i,MAILTO_REGEXP=/^mailto:/i,linkyMinErr=angular.$$minErr("linky"),isDefined=angular.isDefined,isFunction=angular.isFunction,isObject=angular.isObject,isString=angular.isString;return function(text,target,attributes){function addText(text){text&&html.push(sanitizeText(text))}function addLink(url,text){var key,linkAttributes=attributesFn(url);html.push("<a ");for(key in linkAttributes)html.push(key+'="'+linkAttributes[key]+'" ');!isDefined(target)||"target"in linkAttributes||html.push('target="',target,'" '),html.push('href="',url.replace(/"/g,"&quot;"),'">'),addText(text),html.push("</a>")}if(null==text||""===text)return text;if(!isString(text))throw linkyMinErr("notstring","Expected string but received: {0}",text);for(var match,url,i,attributesFn=isFunction(attributes)?attributes:isObject(attributes)?function(){return attributes}:function(){return{}},raw=text,html=[];match=raw.match(LINKY_URL_REGEXP);)url=match[0],match[2]||match[4]||(url=(match[3]?"http://":"mailto:")+url),i=match.index,addText(raw.substr(0,i)),addLink(url,match[0].replace(MAILTO_REGEXP,"")),raw=raw.substring(i+match[0].length);return addText(raw),$sanitize(html.join(""))}}])}(window,window.angular),function(window,angular){"use strict";function isValidDottedPath(path){return null!=path&&""!==path&&"hasOwnProperty"!==path&&MEMBER_NAME_REGEX.test("."+path)}function lookupDottedPath(obj,path){if(!isValidDottedPath(path))throw $resourceMinErr("badmember",'Dotted member path "@{0}" is invalid.',path);for(var keys=path.split("."),i=0,ii=keys.length;i<ii&&angular.isDefined(obj);i++){var key=keys[i];obj=null!==obj?obj[key]:void 0}return obj}function shallowClearAndCopy(src,dst){dst=dst||{},angular.forEach(dst,function(value,key){delete dst[key]});for(var key in src)!src.hasOwnProperty(key)||"$"===key.charAt(0)&&"$"===key.charAt(1)||(dst[key]=src[key]);return dst}var $resourceMinErr=angular.$$minErr("$resource"),MEMBER_NAME_REGEX=/^(\.[a-zA-Z_$@][0-9a-zA-Z_$@]*)+$/;angular.module("ngResource",["ng"]).provider("$resource",function(){var PROTOCOL_AND_IPV6_REGEX=/^https?:\/\/\[[^\]]*][^\/]*/,provider=this;this.defaults={stripTrailingSlashes:!0,cancellable:!1,actions:{get:{method:"GET"},save:{method:"POST"},query:{method:"GET",isArray:!0},remove:{method:"DELETE"},delete:{method:"DELETE"}}},this.$get=["$http","$log","$q","$timeout",function($http,$log,$q,$timeout){function Route(template,defaults){this.template=template,this.defaults=extend({},provider.defaults,defaults),this.urlParams={}}function resourceFactory(url,paramDefaults,actions,options){function extractParams(data,actionParams){var ids={};return actionParams=extend({},paramDefaults,actionParams),forEach(actionParams,function(value,key){isFunction(value)&&(value=value(data)),ids[key]=value&&value.charAt&&"@"===value.charAt(0)?lookupDottedPath(data,value.substr(1)):value}),ids}function defaultResponseInterceptor(response){return response.resource}function Resource(value){shallowClearAndCopy(value||{},this)}var route=new Route(url,options);return actions=extend({},provider.defaults.actions,actions),Resource.prototype.toJSON=function(){var data=extend({},this);return delete data.$promise,delete data.$resolved,data},forEach(actions,function(action,name){var hasBody=/^(POST|PUT|PATCH)$/i.test(action.method),numericTimeout=action.timeout,cancellable=isDefined(action.cancellable)?action.cancellable:route.defaults.cancellable;numericTimeout&&!isNumber(numericTimeout)&&($log.debug("ngResource:\n  Only numeric values are allowed as `timeout`.\n  Promises are not supported in $resource, because the same value would be used for multiple requests. If you are looking for a way to cancel requests, you should use the `cancellable` option."),delete action.timeout,numericTimeout=null),Resource[name]=function(a1,a2,a3,a4){function cancelRequest(value){promise.catch(noop),timeoutDeferred.resolve(value)}var data,success,error,params={};switch(arguments.length){case 4:error=a4,success=a3;case 3:case 2:if(!isFunction(a2)){params=a1,data=a2,success=a3;break}if(isFunction(a1)){success=a1,error=a2;break}success=a2,error=a3;case 1:isFunction(a1)?success=a1:hasBody?data=a1:params=a1;break;case 0:break;default:throw $resourceMinErr("badargs","Expected up to 4 arguments [params, data, success, error], got {0} arguments",arguments.length)}var timeoutDeferred,numericTimeoutPromise,isInstanceCall=this instanceof Resource,value=isInstanceCall?data:action.isArray?[]:new Resource(data),httpConfig={},responseInterceptor=action.interceptor&&action.interceptor.response||defaultResponseInterceptor,responseErrorInterceptor=action.interceptor&&action.interceptor.responseError||void 0,hasError=!!error,hasResponseErrorInterceptor=!!responseErrorInterceptor;forEach(action,function(value,key){switch(key){default:httpConfig[key]=copy(value);break;case"params":case"isArray":case"interceptor":case"cancellable":}}),!isInstanceCall&&cancellable&&(timeoutDeferred=$q.defer(),httpConfig.timeout=timeoutDeferred.promise,numericTimeout&&(numericTimeoutPromise=$timeout(timeoutDeferred.resolve,numericTimeout))),hasBody&&(httpConfig.data=data),route.setUrlParams(httpConfig,extend({},extractParams(data,action.params||{}),params),action.url);var promise=$http(httpConfig).then(function(response){var data=response.data;if(data){if(isArray(data)!==!!action.isArray)throw $resourceMinErr("badcfg","Error in resource configuration for action `{0}`. Expected response to contain an {1} but got an {2} (Request: {3} {4})",name,action.isArray?"array":"object",isArray(data)?"array":"object",httpConfig.method,httpConfig.url);if(action.isArray)value.length=0,forEach(data,function(item){"object"==typeof item?value.push(new Resource(item)):value.push(item)});else{var promise=value.$promise;shallowClearAndCopy(data,value),value.$promise=promise}}return response.resource=value,response});return promise=promise.finally(function(){value.$resolved=!0,!isInstanceCall&&cancellable&&(value.$cancelRequest=noop,$timeout.cancel(numericTimeoutPromise),timeoutDeferred=numericTimeoutPromise=httpConfig.timeout=null)}),promise=promise.then(function(response){var value=responseInterceptor(response);return(success||noop)(value,response.headers,response.status,response.statusText),value},hasError||hasResponseErrorInterceptor?function(response){return hasError&&error(response),hasResponseErrorInterceptor?responseErrorInterceptor(response):$q.reject(response)}:void 0),hasError&&!hasResponseErrorInterceptor&&promise.catch(noop),isInstanceCall?promise:(value.$promise=promise,value.$resolved=!1,cancellable&&(value.$cancelRequest=cancelRequest),value)},Resource.prototype["$"+name]=function(params,success,error){isFunction(params)&&(error=success,success=params,params={});var result=Resource[name].call(this,params,this,success,error);return result.$promise||result}}),Resource.bind=function(additionalParamDefaults){var extendedParamDefaults=extend({},paramDefaults,additionalParamDefaults);return resourceFactory(url,extendedParamDefaults,actions,options)},Resource}var noop=angular.noop,forEach=angular.forEach,extend=angular.extend,copy=angular.copy,isArray=angular.isArray,isDefined=angular.isDefined,isFunction=angular.isFunction,isNumber=angular.isNumber,encodeUriQuery=angular.$$encodeUriQuery,encodeUriSegment=angular.$$encodeUriSegment;return Route.prototype={setUrlParams:function(config,params,actionUrl){var val,encodedVal,self=this,url=actionUrl||self.template,protocolAndIpv6="",urlParams=self.urlParams=Object.create(null);forEach(url.split(/\W/),function(param){if("hasOwnProperty"===param)throw $resourceMinErr("badname","hasOwnProperty is not a valid parameter name.");!new RegExp("^\\d+$").test(param)&&param&&new RegExp("(^|[^\\\\]):"+param+"(\\W|$)").test(url)&&(urlParams[param]={isQueryParamValue:new RegExp("\\?.*=:"+param+"(?:\\W|$)").test(url)})}),url=url.replace(/\\:/g,":"),url=url.replace(PROTOCOL_AND_IPV6_REGEX,function(match){return protocolAndIpv6=match,""}),params=params||{},forEach(self.urlParams,function(paramInfo,urlParam){val=params.hasOwnProperty(urlParam)?params[urlParam]:self.defaults[urlParam],isDefined(val)&&null!==val?(encodedVal=paramInfo.isQueryParamValue?encodeUriQuery(val,!0):encodeUriSegment(val),url=url.replace(new RegExp(":"+urlParam+"(\\W|$)","g"),function(match,p1){return encodedVal+p1})):url=url.replace(new RegExp("(/?):"+urlParam+"(\\W|$)","g"),function(match,leadingSlashes,tail){return"/"===tail.charAt(0)?tail:leadingSlashes+tail})}),self.defaults.stripTrailingSlashes&&(url=url.replace(/\/+$/,"")||"/"),url=url.replace(/\/\.(?=\w+($|\?))/,"."),config.url=protocolAndIpv6+url.replace(/\/\\\./,"/."),forEach(params,function(value,key){self.urlParams[key]||(config.params=config.params||{},config.params[key]=value)})}},resourceFactory}]})}(window,window.angular),function(global){var qq=function(element){"use strict";return{hide:function(){return element.style.display="none",this},attach:function(type,fn){return element.addEventListener?element.addEventListener(type,fn,!1):element.attachEvent&&element.attachEvent("on"+type,fn),function(){qq(element).detach(type,fn)}},detach:function(type,fn){return element.removeEventListener?element.removeEventListener(type,fn,!1):element.attachEvent&&element.detachEvent("on"+type,fn),this},contains:function(descendant){return!!descendant&&(element===descendant||(element.contains?element.contains(descendant):!!(8&descendant.compareDocumentPosition(element))))},insertBefore:function(elementB){return elementB.parentNode.insertBefore(element,elementB),this},remove:function(){return element.parentNode.removeChild(element),this},css:function(styles){if(null==element.style)throw new qq.Error("Can't apply style to node as it is not on the HTMLElement prototype chain!");return null!=styles.opacity&&"string"!=typeof element.style.opacity&&void 0!==element.filters&&(styles.filter="alpha(opacity="+Math.round(100*styles.opacity)+")"),qq.extend(element.style,styles),this},hasClass:function(name,considerParent){var re=new RegExp("(^| )"+name+"( |$)");return re.test(element.className)||!(!considerParent||!re.test(element.parentNode.className))},addClass:function(name){return qq(element).hasClass(name)||(element.className+=" "+name),this},removeClass:function(name){var re=new RegExp("(^| )"+name+"( |$)");return element.className=element.className.replace(re," ").replace(/^\s+|\s+$/g,""),this},getByClass:function(className,first){var candidates,result=[];return first&&element.querySelector?element.querySelector("."+className):element.querySelectorAll?element.querySelectorAll("."+className):(candidates=element.getElementsByTagName("*"),qq.each(candidates,function(idx,val){qq(val).hasClass(className)&&result.push(val)}),first?result[0]:result)},getFirstByClass:function(className){return qq(element).getByClass(className,!0)},children:function(){for(var children=[],child=element.firstChild;child;)1===child.nodeType&&children.push(child),child=child.nextSibling;return children},setText:function(text){return element.innerText=text,element.textContent=text,this},clearText:function(){return qq(element).setText("")},hasAttribute:function(attrName){var attrVal;return element.hasAttribute?!!element.hasAttribute(attrName)&&null==/^false$/i.exec(element.getAttribute(attrName)):void 0!==(attrVal=element[attrName])&&null==/^false$/i.exec(attrVal)}}};!function(){"use strict";qq.canvasToBlob=function(canvas,mime,quality){return qq.dataUriToBlob(canvas.toDataURL(mime,quality))},qq.dataUriToBlob=function(dataUri){var arrayBuffer,byteString,intArray,mimeString,createBlob=function(data,mime){var BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,blobBuilder=BlobBuilder&&new BlobBuilder;return blobBuilder?(blobBuilder.append(data),blobBuilder.getBlob(mime)):new Blob([data],{type:mime})};return byteString=dataUri.split(",")[0].indexOf("base64")>=0?atob(dataUri.split(",")[1]):decodeURI(dataUri.split(",")[1]),mimeString=dataUri.split(",")[0].split(":")[1].split(";")[0],arrayBuffer=new ArrayBuffer(byteString.length),intArray=new Uint8Array(arrayBuffer),qq.each(byteString,function(idx,character){intArray[idx]=character.charCodeAt(0)}),createBlob(arrayBuffer,mimeString)},qq.log=function(message,level){window.console&&(level&&"info"!==level?window.console[level]?window.console[level](message):window.console.log("<"+level+"> "+message):window.console.log(message))},qq.isObject=function(variable){return variable&&!variable.nodeType&&"[object Object]"===Object.prototype.toString.call(variable)},qq.isFunction=function(variable){return"function"==typeof variable},qq.isArray=function(value){return"[object Array]"===Object.prototype.toString.call(value)||value&&window.ArrayBuffer&&value.buffer&&value.buffer.constructor===ArrayBuffer},qq.isItemList=function(maybeItemList){return"[object DataTransferItemList]"===Object.prototype.toString.call(maybeItemList)},qq.isNodeList=function(maybeNodeList){return"[object NodeList]"===Object.prototype.toString.call(maybeNodeList)||maybeNodeList.item&&maybeNodeList.namedItem},qq.isString=function(maybeString){return"[object String]"===Object.prototype.toString.call(maybeString)},qq.trimStr=function(string){return String.prototype.trim?string.trim():string.replace(/^\s+|\s+$/g,"")},qq.format=function(str){var args=Array.prototype.slice.call(arguments,1),newStr=str,nextIdxToReplace=newStr.indexOf("{}");return qq.each(args,function(idx,val){var strBefore=newStr.substring(0,nextIdxToReplace),strAfter=newStr.substring(nextIdxToReplace+2);if(newStr=strBefore+val+strAfter,(nextIdxToReplace=newStr.indexOf("{}",nextIdxToReplace+val.length))<0)return!1}),newStr},qq.isFile=function(maybeFile){return window.File&&"[object File]"===Object.prototype.toString.call(maybeFile)},qq.isFileList=function(maybeFileList){return window.FileList&&"[object FileList]"===Object.prototype.toString.call(maybeFileList)},qq.isFileOrInput=function(maybeFileOrInput){return qq.isFile(maybeFileOrInput)||qq.isInput(maybeFileOrInput)},qq.isInput=function(maybeInput,notFile){var evaluateType=function(type){var normalizedType=type.toLowerCase();return notFile?"file"!==normalizedType:"file"===normalizedType};return!!(window.HTMLInputElement&&"[object HTMLInputElement]"===Object.prototype.toString.call(maybeInput)&&maybeInput.type&&evaluateType(maybeInput.type))||!!(maybeInput.tagName&&"input"===maybeInput.tagName.toLowerCase()&&maybeInput.type&&evaluateType(maybeInput.type))},qq.isBlob=function(maybeBlob){if(window.Blob&&"[object Blob]"===Object.prototype.toString.call(maybeBlob))return!0},qq.isXhrUploadSupported=function(){var input=document.createElement("input");return input.type="file",void 0!==input.multiple&&"undefined"!=typeof File&&"undefined"!=typeof FormData&&void 0!==qq.createXhrInstance().upload},qq.createXhrInstance=function(){if(window.XMLHttpRequest)return new XMLHttpRequest;try{return new ActiveXObject("MSXML2.XMLHTTP.3.0")}catch(error){return qq.log("Neither XHR or ActiveX are supported!","error"),null}},qq.isFolderDropSupported=function(dataTransfer){return dataTransfer.items&&dataTransfer.items.length>0&&dataTransfer.items[0].webkitGetAsEntry},qq.isFileChunkingSupported=function(){return!qq.androidStock()&&qq.isXhrUploadSupported()&&(void 0!==File.prototype.slice||void 0!==File.prototype.webkitSlice||void 0!==File.prototype.mozSlice)},qq.sliceBlob=function(fileOrBlob,start,end){return(fileOrBlob.slice||fileOrBlob.mozSlice||fileOrBlob.webkitSlice).call(fileOrBlob,start,end)},qq.arrayBufferToHex=function(buffer){var bytesAsHex="",bytes=new Uint8Array(buffer);return qq.each(bytes,function(idx,byt){var byteAsHexStr=byt.toString(16);byteAsHexStr.length<2&&(byteAsHexStr="0"+byteAsHexStr),bytesAsHex+=byteAsHexStr}),bytesAsHex},qq.readBlobToHex=function(blob,startOffset,length){var initialBlob=qq.sliceBlob(blob,startOffset,startOffset+length),fileReader=new FileReader,promise=new qq.Promise;return fileReader.onload=function(){promise.success(qq.arrayBufferToHex(fileReader.result))},fileReader.onerror=promise.failure,fileReader.readAsArrayBuffer(initialBlob),promise},qq.extend=function(first,second,extendNested){return qq.each(second,function(prop,val){extendNested&&qq.isObject(val)?(void 0===first[prop]&&(first[prop]={}),qq.extend(first[prop],val,!0)):first[prop]=val}),
first},qq.override=function(target,sourceFn){var super_={},source=sourceFn(super_);return qq.each(source,function(srcPropName,srcPropVal){void 0!==target[srcPropName]&&(super_[srcPropName]=target[srcPropName]),target[srcPropName]=srcPropVal}),target},qq.indexOf=function(arr,elt,from){if(arr.indexOf)return arr.indexOf(elt,from);from=from||0;var len=arr.length;for(from<0&&(from+=len);from<len;from+=1)if(arr.hasOwnProperty(from)&&arr[from]===elt)return from;return-1},qq.getUniqueId=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=16*Math.random()|0;return("x"==c?r:3&r|8).toString(16)})},qq.ie=function(){return-1!==navigator.userAgent.indexOf("MSIE")||-1!==navigator.userAgent.indexOf("Trident")},qq.ie7=function(){return-1!==navigator.userAgent.indexOf("MSIE 7")},qq.ie8=function(){return-1!==navigator.userAgent.indexOf("MSIE 8")},qq.ie10=function(){return-1!==navigator.userAgent.indexOf("MSIE 10")},qq.ie11=function(){return qq.ie()&&-1!==navigator.userAgent.indexOf("rv:11")},qq.edge=function(){return navigator.userAgent.indexOf("Edge")>=0},qq.safari=function(){return void 0!==navigator.vendor&&-1!==navigator.vendor.indexOf("Apple")},qq.chrome=function(){return void 0!==navigator.vendor&&-1!==navigator.vendor.indexOf("Google")},qq.opera=function(){return void 0!==navigator.vendor&&-1!==navigator.vendor.indexOf("Opera")},qq.firefox=function(){return!qq.edge()&&!qq.ie11()&&-1!==navigator.userAgent.indexOf("Mozilla")&&void 0!==navigator.vendor&&""===navigator.vendor},qq.windows=function(){return"Win32"===navigator.platform},qq.android=function(){return-1!==navigator.userAgent.toLowerCase().indexOf("android")},qq.androidStock=function(){return qq.android()&&navigator.userAgent.toLowerCase().indexOf("chrome")<0},qq.ios6=function(){return qq.ios()&&-1!==navigator.userAgent.indexOf(" OS 6_")},qq.ios7=function(){return qq.ios()&&-1!==navigator.userAgent.indexOf(" OS 7_")},qq.ios8=function(){return qq.ios()&&-1!==navigator.userAgent.indexOf(" OS 8_")},qq.ios800=function(){return qq.ios()&&-1!==navigator.userAgent.indexOf(" OS 8_0 ")},qq.ios=function(){return-1!==navigator.userAgent.indexOf("iPad")||-1!==navigator.userAgent.indexOf("iPod")||-1!==navigator.userAgent.indexOf("iPhone")},qq.iosChrome=function(){return qq.ios()&&-1!==navigator.userAgent.indexOf("CriOS")},qq.iosSafari=function(){return qq.ios()&&!qq.iosChrome()&&-1!==navigator.userAgent.indexOf("Safari")},qq.iosSafariWebView=function(){return qq.ios()&&!qq.iosChrome()&&!qq.iosSafari()},qq.preventDefault=function(e){e.preventDefault?e.preventDefault():e.returnValue=!1},qq.toElement=function(){var div=document.createElement("div");return function(html){div.innerHTML=html;var element=div.firstChild;return div.removeChild(element),element}}(),qq.each=function(iterableItem,callback){var keyOrIndex;if(iterableItem)if(window.Storage&&iterableItem.constructor===window.Storage)for(keyOrIndex=0;keyOrIndex<iterableItem.length&&!1!==callback(iterableItem.key(keyOrIndex),iterableItem.getItem(iterableItem.key(keyOrIndex)));keyOrIndex++);else if(qq.isArray(iterableItem)||qq.isItemList(iterableItem)||qq.isNodeList(iterableItem))for(keyOrIndex=0;keyOrIndex<iterableItem.length&&!1!==callback(keyOrIndex,iterableItem[keyOrIndex]);keyOrIndex++);else if(qq.isString(iterableItem))for(keyOrIndex=0;keyOrIndex<iterableItem.length&&!1!==callback(keyOrIndex,iterableItem.charAt(keyOrIndex));keyOrIndex++);else for(keyOrIndex in iterableItem)if(Object.prototype.hasOwnProperty.call(iterableItem,keyOrIndex)&&!1===callback(keyOrIndex,iterableItem[keyOrIndex]))break},qq.bind=function(oldFunc,context){if(qq.isFunction(oldFunc)){var args=Array.prototype.slice.call(arguments,2);return function(){var newArgs=qq.extend([],args);return arguments.length&&(newArgs=newArgs.concat(Array.prototype.slice.call(arguments))),oldFunc.apply(context,newArgs)}}throw new Error("first parameter must be a function!")},qq.obj2url=function(obj,temp,prefixDone){var uristrings=[],prefix="&",add=function(nextObj,i){var nextTemp=temp?/\[\]$/.test(temp)?temp:temp+"["+i+"]":i;"undefined"!==nextTemp&&"undefined"!==i&&uristrings.push("object"==typeof nextObj?qq.obj2url(nextObj,nextTemp,!0):"[object Function]"===Object.prototype.toString.call(nextObj)?encodeURIComponent(nextTemp)+"="+encodeURIComponent(nextObj()):encodeURIComponent(nextTemp)+"="+encodeURIComponent(nextObj))};return!prefixDone&&temp?(prefix=/\?/.test(temp)?/\?$/.test(temp)?"":"&":"?",uristrings.push(temp),uristrings.push(qq.obj2url(obj))):"[object Array]"===Object.prototype.toString.call(obj)&&void 0!==obj?qq.each(obj,function(idx,val){add(val,idx)}):void 0!==obj&&null!==obj&&"object"==typeof obj?qq.each(obj,function(prop,val){add(val,prop)}):uristrings.push(encodeURIComponent(temp)+"="+encodeURIComponent(obj)),temp?uristrings.join(prefix):uristrings.join(prefix).replace(/^&/,"").replace(/%20/g,"+")},qq.obj2FormData=function(obj,formData,arrayKeyName){return formData||(formData=new FormData),qq.each(obj,function(key,val){key=arrayKeyName?arrayKeyName+"["+key+"]":key,qq.isObject(val)?qq.obj2FormData(val,formData,key):qq.isFunction(val)?formData.append(key,val()):formData.append(key,val)}),formData},qq.obj2Inputs=function(obj,form){var input;return form||(form=document.createElement("form")),qq.obj2FormData(obj,{append:function(key,val){input=document.createElement("input"),input.setAttribute("name",key),input.setAttribute("value",val),form.appendChild(input)}}),form},qq.parseJson=function(json){return window.JSON&&qq.isFunction(JSON.parse)?JSON.parse(json):eval("("+json+")")},qq.getExtension=function(filename){var extIdx=filename.lastIndexOf(".")+1;if(extIdx>0)return filename.substr(extIdx,filename.length-extIdx)},qq.getFilename=function(blobOrFileInput){return qq.isInput(blobOrFileInput)?blobOrFileInput.value.replace(/.*(\/|\\)/,""):qq.isFile(blobOrFileInput)&&null!==blobOrFileInput.fileName&&void 0!==blobOrFileInput.fileName?blobOrFileInput.fileName:blobOrFileInput.name},qq.DisposeSupport=function(){var disposers=[];return{dispose:function(){var disposer;do{(disposer=disposers.shift())&&disposer()}while(disposer)},attach:function(){var args=arguments;this.addDisposer(qq(args[0]).attach.apply(this,Array.prototype.slice.call(arguments,1)))},addDisposer:function(disposeFunction){disposers.push(disposeFunction)}}}}(),function(){"use strict";"function"==typeof define&&define.amd?define(function(){return qq}):"undefined"!=typeof module&&module.exports?module.exports=qq:global.qq=qq}(),function(){"use strict";qq.Error=function(message){this.message="[Fine Uploader "+qq.version+"] "+message},qq.Error.prototype=new Error}(),qq.version="5.14.0",qq.supportedFeatures=function(){"use strict";function testSupportsFileInputElement(){var tempInput,supported=!0;try{tempInput=document.createElement("input"),tempInput.type="file",qq(tempInput).hide(),tempInput.disabled&&(supported=!1)}catch(ex){supported=!1}return supported}function isChrome21OrHigher(){return(qq.chrome()||qq.opera())&&void 0!==navigator.userAgent.match(/Chrome\/[2][1-9]|Chrome\/[3-9][0-9]/)}function isChrome14OrHigher(){return(qq.chrome()||qq.opera())&&void 0!==navigator.userAgent.match(/Chrome\/[1][4-9]|Chrome\/[2-9][0-9]/)}function isCrossOriginXhrSupported(){if(window.XMLHttpRequest){return void 0!==qq.createXhrInstance().withCredentials}return!1}function isXdrSupported(){return void 0!==window.XDomainRequest}function isCrossOriginAjaxSupported(){return!!isCrossOriginXhrSupported()||isXdrSupported()}function isFolderSelectionSupported(){return void 0!==document.createElement("input").webkitdirectory}function isLocalStorageSupported(){try{return!!window.localStorage&&qq.isFunction(window.localStorage.setItem)}catch(error){return!1}}function isDragAndDropSupported(){var span=document.createElement("span");return("draggable"in span||"ondragstart"in span&&"ondrop"in span)&&!qq.android()&&!qq.ios()}var supportsUploading,supportsUploadingBlobs,supportsFileDrop,supportsAjaxFileUploading,supportsFolderDrop,supportsChunking,supportsResume,supportsUploadViaPaste,supportsUploadCors,supportsDeleteFileXdr,supportsDeleteFileCorsXhr,supportsDeleteFileCors,supportsFolderSelection,supportsImagePreviews,supportsUploadProgress;return supportsUploading=testSupportsFileInputElement(),supportsAjaxFileUploading=supportsUploading&&qq.isXhrUploadSupported(),supportsUploadingBlobs=supportsAjaxFileUploading&&!qq.androidStock(),supportsFileDrop=supportsAjaxFileUploading&&isDragAndDropSupported(),supportsFolderDrop=supportsFileDrop&&isChrome21OrHigher(),supportsChunking=supportsAjaxFileUploading&&qq.isFileChunkingSupported(),supportsResume=supportsAjaxFileUploading&&supportsChunking&&isLocalStorageSupported(),supportsUploadViaPaste=supportsAjaxFileUploading&&isChrome14OrHigher(),supportsUploadCors=supportsUploading&&(void 0!==window.postMessage||supportsAjaxFileUploading),supportsDeleteFileCorsXhr=isCrossOriginXhrSupported(),supportsDeleteFileXdr=isXdrSupported(),supportsDeleteFileCors=isCrossOriginAjaxSupported(),supportsFolderSelection=isFolderSelectionSupported(),supportsImagePreviews=supportsAjaxFileUploading&&void 0!==window.FileReader,supportsUploadProgress=function(){return!!supportsAjaxFileUploading&&(!qq.androidStock()&&!qq.iosChrome())}(),{ajaxUploading:supportsAjaxFileUploading,blobUploading:supportsUploadingBlobs,canDetermineSize:supportsAjaxFileUploading,chunking:supportsChunking,deleteFileCors:supportsDeleteFileCors,deleteFileCorsXdr:supportsDeleteFileXdr,deleteFileCorsXhr:supportsDeleteFileCorsXhr,dialogElement:!!window.HTMLDialogElement,fileDrop:supportsFileDrop,folderDrop:supportsFolderDrop,folderSelection:supportsFolderSelection,imagePreviews:supportsImagePreviews,imageValidation:supportsImagePreviews,itemSizeValidation:supportsAjaxFileUploading,pause:supportsChunking,progressBar:supportsUploadProgress,resume:supportsResume,scaling:supportsImagePreviews&&supportsUploadingBlobs,tiffPreviews:qq.safari(),unlimitedScaledImageSize:!qq.ios(),uploading:supportsUploading,uploadCors:supportsUploadCors,uploadCustomHeaders:supportsAjaxFileUploading,uploadNonMultipart:supportsAjaxFileUploading,uploadViaPaste:supportsUploadViaPaste}}(),qq.isGenericPromise=function(maybePromise){"use strict";return!!(maybePromise&&maybePromise.then&&qq.isFunction(maybePromise.then))},qq.Promise=function(){"use strict";var successArgs,failureArgs,successCallbacks=[],failureCallbacks=[],doneCallbacks=[],state=0;qq.extend(this,{then:function(onSuccess,onFailure){return 0===state?(onSuccess&&successCallbacks.push(onSuccess),onFailure&&failureCallbacks.push(onFailure)):-1===state?onFailure&&onFailure.apply(null,failureArgs):onSuccess&&onSuccess.apply(null,successArgs),this},done:function(callback){return 0===state?doneCallbacks.push(callback):callback.apply(null,void 0===failureArgs?successArgs:failureArgs),this},success:function(){return state=1,successArgs=arguments,successCallbacks.length&&qq.each(successCallbacks,function(idx,callback){callback.apply(null,successArgs)}),doneCallbacks.length&&qq.each(doneCallbacks,function(idx,callback){callback.apply(null,successArgs)}),this},failure:function(){return state=-1,failureArgs=arguments,failureCallbacks.length&&qq.each(failureCallbacks,function(idx,callback){callback.apply(null,failureArgs)}),doneCallbacks.length&&qq.each(doneCallbacks,function(idx,callback){callback.apply(null,failureArgs)}),this}})},qq.BlobProxy=function(referenceBlob,onCreate){"use strict";qq.extend(this,{referenceBlob:referenceBlob,create:function(){return onCreate(referenceBlob)}})},qq.UploadButton=function(o){"use strict";function createInput(){var input=document.createElement("input");return input.setAttribute(qq.UploadButton.BUTTON_ID_ATTR_NAME,buttonId),input.setAttribute("title",options.title),self.setMultiple(options.multiple,input),options.folders&&qq.supportedFeatures.folderSelection&&input.setAttribute("webkitdirectory",""),options.acceptFiles&&input.setAttribute("accept",options.acceptFiles),input.setAttribute("type","file"),input.setAttribute("name",options.name),qq(input).css({position:"absolute",right:0,top:0,fontFamily:"Arial",fontSize:qq.ie()&&!qq.ie8()?"3500px":"118px",margin:0,padding:0,cursor:"pointer",opacity:0}),!qq.ie7()&&qq(input).css({height:"100%"}),options.element.appendChild(input),disposeSupport.attach(input,"change",function(){options.onChange(input)}),disposeSupport.attach(input,"mouseover",function(){qq(options.element).addClass(options.hoverClass)}),disposeSupport.attach(input,"mouseout",function(){qq(options.element).removeClass(options.hoverClass)}),disposeSupport.attach(input,"focus",function(){qq(options.element).addClass(options.focusClass)}),disposeSupport.attach(input,"blur",function(){qq(options.element).removeClass(options.focusClass)}),input}var input,buttonId,self=this,disposeSupport=new qq.DisposeSupport,options={acceptFiles:null,element:null,focusClass:"qq-upload-button-focus",folders:!1,hoverClass:"qq-upload-button-hover",ios8BrowserCrashWorkaround:!1,multiple:!1,name:"qqfile",onChange:function(input){},title:null};qq.extend(options,o),buttonId=qq.getUniqueId(),qq(options.element).css({position:"relative",overflow:"hidden",direction:"ltr"}),qq.extend(this,{getInput:function(){return input},getButtonId:function(){return buttonId},setMultiple:function(isMultiple,optInput){var input=optInput||this.getInput();options.ios8BrowserCrashWorkaround&&qq.ios8()&&(qq.iosChrome()||qq.iosSafariWebView())?input.setAttribute("multiple",""):isMultiple?input.setAttribute("multiple",""):input.removeAttribute("multiple")},setAcceptFiles:function(acceptFiles){acceptFiles!==options.acceptFiles&&input.setAttribute("accept",acceptFiles)},reset:function(){input.parentNode&&qq(input).remove(),qq(options.element).removeClass(options.focusClass),input=null,input=createInput()}}),input=createInput()},qq.UploadButton.BUTTON_ID_ATTR_NAME="qq-button-id",qq.UploadData=function(uploaderProxy){"use strict";function getDataByIds(idOrIds){if(qq.isArray(idOrIds)){var entries=[];return qq.each(idOrIds,function(idx,id){entries.push(data[id])}),entries}return data[idOrIds]}function getDataByUuids(uuids){if(qq.isArray(uuids)){var entries=[];return qq.each(uuids,function(idx,uuid){entries.push(data[byUuid[uuid]])}),entries}return data[byUuid[uuids]]}function getDataByStatus(status){var statusResults=[],statuses=[].concat(status);return qq.each(statuses,function(index,statusEnum){var statusResultIndexes=byStatus[statusEnum];void 0!==statusResultIndexes&&qq.each(statusResultIndexes,function(i,dataIndex){statusResults.push(data[dataIndex])})}),statusResults}var data=[],byUuid={},byStatus={},byProxyGroupId={},byBatchId={};qq.extend(this,{addFile:function(spec){var status=spec.status||qq.status.SUBMITTING,id=data.push({name:spec.name,originalName:spec.name,uuid:spec.uuid,size:null==spec.size?-1:spec.size,status:status})-1;return spec.batchId&&(data[id].batchId=spec.batchId,void 0===byBatchId[spec.batchId]&&(byBatchId[spec.batchId]=[]),byBatchId[spec.batchId].push(id)),spec.proxyGroupId&&(data[id].proxyGroupId=spec.proxyGroupId,void 0===byProxyGroupId[spec.proxyGroupId]&&(byProxyGroupId[spec.proxyGroupId]=[]),byProxyGroupId[spec.proxyGroupId].push(id)),data[id].id=id,byUuid[spec.uuid]=id,void 0===byStatus[status]&&(byStatus[status]=[]),byStatus[status].push(id),uploaderProxy.onStatusChange(id,null,status),id},retrieve:function(optionalFilter){return qq.isObject(optionalFilter)&&data.length?void 0!==optionalFilter.id?getDataByIds(optionalFilter.id):void 0!==optionalFilter.uuid?getDataByUuids(optionalFilter.uuid):optionalFilter.status?getDataByStatus(optionalFilter.status):void 0:qq.extend([],data,!0)},reset:function(){data=[],byUuid={},byStatus={},byBatchId={}},setStatus:function(id,newStatus){var oldStatus=data[id].status,byStatusOldStatusIndex=qq.indexOf(byStatus[oldStatus],id);byStatus[oldStatus].splice(byStatusOldStatusIndex,1),data[id].status=newStatus,void 0===byStatus[newStatus]&&(byStatus[newStatus]=[]),byStatus[newStatus].push(id),uploaderProxy.onStatusChange(id,oldStatus,newStatus)},uuidChanged:function(id,newUuid){var oldUuid=data[id].uuid;data[id].uuid=newUuid,byUuid[newUuid]=id,delete byUuid[oldUuid]},updateName:function(id,newName){data[id].name=newName},updateSize:function(id,newSize){data[id].size=newSize},setParentId:function(targetId,parentId){data[targetId].parentId=parentId},getIdsInProxyGroup:function(id){var proxyGroupId=data[id].proxyGroupId;return proxyGroupId?byProxyGroupId[proxyGroupId]:[]},getIdsInBatch:function(id){var batchId=data[id].batchId;return byBatchId[batchId]}})},qq.status={SUBMITTING:"submitting",SUBMITTED:"submitted",REJECTED:"rejected",QUEUED:"queued",CANCELED:"canceled",PAUSED:"paused",UPLOADING:"uploading",UPLOAD_RETRYING:"retrying upload",UPLOAD_SUCCESSFUL:"upload successful",UPLOAD_FAILED:"upload failed",DELETE_FAILED:"delete failed",DELETING:"deleting",DELETED:"deleted"},function(){"use strict";qq.basePublicApi={addBlobs:function(blobDataOrArray,params,endpoint){this.addFiles(blobDataOrArray,params,endpoint)},addInitialFiles:function(cannedFileList){var self=this;qq.each(cannedFileList,function(index,cannedFile){self._addCannedFile(cannedFile)})},addFiles:function(data,params,endpoint){this._maybeHandleIos8SafariWorkaround();var batchId=0===this._storedIds.length?qq.getUniqueId():this._currentBatchId,processBlob=qq.bind(function(blob){this._handleNewFile({blob:blob,name:this._options.blobs.defaultName},batchId,verifiedFiles)},this),processBlobData=qq.bind(function(blobData){this._handleNewFile(blobData,batchId,verifiedFiles)},this),processCanvas=qq.bind(function(canvas){var blob=qq.canvasToBlob(canvas);this._handleNewFile({blob:blob,name:this._options.blobs.defaultName+".png"},batchId,verifiedFiles)},this),processCanvasData=qq.bind(function(canvasData){var normalizedQuality=canvasData.quality&&canvasData.quality/100,blob=qq.canvasToBlob(canvasData.canvas,canvasData.type,normalizedQuality);this._handleNewFile({blob:blob,name:canvasData.name},batchId,verifiedFiles)},this),processFileOrInput=qq.bind(function(fileOrInput){if(qq.isInput(fileOrInput)&&qq.supportedFeatures.ajaxUploading){var files=Array.prototype.slice.call(fileOrInput.files),self=this;qq.each(files,function(idx,file){self._handleNewFile(file,batchId,verifiedFiles)})}else this._handleNewFile(fileOrInput,batchId,verifiedFiles)},this),normalizeData=function(){qq.isFileList(data)&&(data=Array.prototype.slice.call(data)),data=[].concat(data)},self=this,verifiedFiles=[];this._currentBatchId=batchId,data&&(normalizeData(),qq.each(data,function(idx,fileContainer){qq.isFileOrInput(fileContainer)?processFileOrInput(fileContainer):qq.isBlob(fileContainer)?processBlob(fileContainer):qq.isObject(fileContainer)?fileContainer.blob&&fileContainer.name?processBlobData(fileContainer):fileContainer.canvas&&fileContainer.name&&processCanvasData(fileContainer):fileContainer.tagName&&"canvas"===fileContainer.tagName.toLowerCase()?processCanvas(fileContainer):self.log(fileContainer+" is not a valid file container!  Ignoring!","warn")}),this.log("Received "+verifiedFiles.length+" files."),this._prepareItemsForUpload(verifiedFiles,params,endpoint))},cancel:function(id){this._handler.cancel(id)},cancelAll:function(){var storedIdsCopy=[],self=this;qq.extend(storedIdsCopy,this._storedIds),qq.each(storedIdsCopy,function(idx,storedFileId){self.cancel(storedFileId)}),this._handler.cancelAll()},clearStoredFiles:function(){this._storedIds=[]},continueUpload:function(id){var uploadData=this._uploadData.retrieve({id:id});return!(!qq.supportedFeatures.pause||!this._options.chunking.enabled)&&(uploadData.status===qq.status.PAUSED?(this.log(qq.format("Paused file ID {} ({}) will be continued.  Not paused.",id,this.getName(id))),this._uploadFile(id),!0):(this.log(qq.format("Ignoring continue for file ID {} ({}).  Not paused.",id,this.getName(id)),"error"),!1))},deleteFile:function(id){return this._onSubmitDelete(id)},doesExist:function(fileOrBlobId){return this._handler.isValid(fileOrBlobId)},drawThumbnail:function(fileId,imgOrCanvas,maxSize,fromServer,customResizeFunction){var fileOrUrl,options,promiseToReturn=new qq.Promise;return this._imageGenerator?(fileOrUrl=this._thumbnailUrls[fileId],options={customResizeFunction:customResizeFunction,maxSize:maxSize>0?maxSize:null,scale:maxSize>0},!fromServer&&qq.supportedFeatures.imagePreviews&&(fileOrUrl=this.getFile(fileId)),null==fileOrUrl?promiseToReturn.failure({container:imgOrCanvas,error:"File or URL not found."}):this._imageGenerator.generate(fileOrUrl,imgOrCanvas,options).then(function(modifiedContainer){promiseToReturn.success(modifiedContainer)},function(container,reason){promiseToReturn.failure({container:container,error:reason||"Problem generating thumbnail"})})):promiseToReturn.failure({container:imgOrCanvas,error:"Missing image generator module"}),promiseToReturn},getButton:function(fileId){return this._getButton(this._buttonIdsForFileIds[fileId])},getEndpoint:function(fileId){return this._endpointStore.get(fileId)},getFile:function(fileOrBlobId){return this._handler.getFile(fileOrBlobId)||null},getInProgress:function(){return this._uploadData.retrieve({status:[qq.status.UPLOADING,qq.status.UPLOAD_RETRYING,qq.status.QUEUED]}).length},getName:function(id){return this._uploadData.retrieve({id:id}).name},getParentId:function(id){var uploadDataEntry=this.getUploads({id:id}),parentId=null;return uploadDataEntry&&void 0!==uploadDataEntry.parentId&&(parentId=uploadDataEntry.parentId),parentId},getResumableFilesData:function(){return this._handler.getResumableFilesData()},getSize:function(id){return this._uploadData.retrieve({id:id}).size},getNetUploads:function(){return this._netUploaded},getRemainingAllowedItems:function(){var allowedItems=this._currentItemLimit;return allowedItems>0?allowedItems-this._netUploadedOrQueued:null},getUploads:function(optionalFilter){return this._uploadData.retrieve(optionalFilter)},getUuid:function(id){return this._uploadData.retrieve({id:id}).uuid},log:function(str,level){!this._options.debug||level&&"info"!==level?level&&"info"!==level&&qq.log("[Fine Uploader "+qq.version+"] "+str,level):qq.log("[Fine Uploader "+qq.version+"] "+str)},pauseUpload:function(id){var uploadData=this._uploadData.retrieve({id:id});if(!qq.supportedFeatures.pause||!this._options.chunking.enabled)return!1;if(qq.indexOf([qq.status.UPLOADING,qq.status.UPLOAD_RETRYING],uploadData.status)>=0){if(this._handler.pause(id))return this._uploadData.setStatus(id,qq.status.PAUSED),!0;this.log(qq.format("Unable to pause file ID {} ({}).",id,this.getName(id)),"error")}else this.log(qq.format("Ignoring pause for file ID {} ({}).  Not in progress.",id,this.getName(id)),"error");return!1},removeFileRef:function(id){this._handler.expunge(id)},reset:function(){this.log("Resetting uploader..."),this._handler.reset(),this._storedIds=[],this._autoRetries=[],this._retryTimeouts=[],this._preventRetries=[],this._thumbnailUrls=[],qq.each(this._buttons,function(idx,button){button.reset()}),this._paramsStore.reset(),this._endpointStore.reset(),this._netUploadedOrQueued=0,this._netUploaded=0,this._uploadData.reset(),this._buttonIdsForFileIds=[],this._pasteHandler&&this._pasteHandler.reset(),this._options.session.refreshOnReset&&this._refreshSessionData(),this._succeededSinceLastAllComplete=[],this._failedSinceLastAllComplete=[],this._totalProgress&&this._totalProgress.reset()},retry:function(id){return this._manualRetry(id)},scaleImage:function(id,specs){var self=this;return qq.Scaler.prototype.scaleImage(id,specs,{log:qq.bind(self.log,self),getFile:qq.bind(self.getFile,self),uploadData:self._uploadData})},setCustomHeaders:function(headers,id){this._customHeadersStore.set(headers,id)},setDeleteFileCustomHeaders:function(headers,id){this._deleteFileCustomHeadersStore.set(headers,id)},setDeleteFileEndpoint:function(endpoint,id){this._deleteFileEndpointStore.set(endpoint,id)},setDeleteFileParams:function(params,id){this._deleteFileParamsStore.set(params,id)},setEndpoint:function(endpoint,id){this._endpointStore.set(endpoint,id)},setForm:function(elementOrId){this._updateFormSupportAndParams(elementOrId)},setItemLimit:function(newItemLimit){this._currentItemLimit=newItemLimit},setName:function(id,newName){this._uploadData.updateName(id,newName)},setParams:function(params,id){this._paramsStore.set(params,id)},setUuid:function(id,newUuid){return this._uploadData.uuidChanged(id,newUuid)},setStatus:function(id,newStatus){if(!this.getUploads({id:id}))throw new qq.Error(id+" is not a valid file ID.");switch(newStatus){case qq.status.DELETED:this._onDeleteComplete(id,null,!1);break;case qq.status.DELETE_FAILED:this._onDeleteComplete(id,null,!0);break;default:var errorMessage="Method setStatus called on '"+name+"' not implemented yet for "+newStatus;throw this.log(errorMessage),new qq.Error(errorMessage)}},uploadStoredFiles:function(){0===this._storedIds.length?this._itemError("noFilesError"):this._uploadStoredFiles()}},qq.basePrivateApi={_addCannedFile:function(sessionData){var id=this._uploadData.addFile({uuid:sessionData.uuid,name:sessionData.name,size:sessionData.size,status:qq.status.UPLOAD_SUCCESSFUL});return sessionData.deleteFileEndpoint&&this.setDeleteFileEndpoint(sessionData.deleteFileEndpoint,id),sessionData.deleteFileParams&&this.setDeleteFileParams(sessionData.deleteFileParams,id),sessionData.thumbnailUrl&&(this._thumbnailUrls[id]=sessionData.thumbnailUrl),this._netUploaded++,this._netUploadedOrQueued++,id},_annotateWithButtonId:function(file,associatedInput){qq.isFile(file)&&(file.qqButtonId=this._getButtonId(associatedInput))},_batchError:function(message){this._options.callbacks.onError(null,null,message,void 0)},_createDeleteHandler:function(){var self=this;return new qq.DeleteFileAjaxRequester({method:this._options.deleteFile.method.toUpperCase(),maxConnections:this._options.maxConnections,uuidParamName:this._options.request.uuidName,customHeaders:this._deleteFileCustomHeadersStore,paramsStore:this._deleteFileParamsStore,endpointStore:this._deleteFileEndpointStore,cors:this._options.cors,log:qq.bind(self.log,self),onDelete:function(id){self._onDelete(id),self._options.callbacks.onDelete(id)},onDeleteComplete:function(id,xhrOrXdr,isError){self._onDeleteComplete(id,xhrOrXdr,isError),self._options.callbacks.onDeleteComplete(id,xhrOrXdr,isError)}})},_createPasteHandler:function(){var self=this;return new qq.PasteSupport({targetElement:this._options.paste.targetElement,callbacks:{log:qq.bind(self.log,self),pasteReceived:function(blob){self._handleCheckedCallback({name:"onPasteReceived",callback:qq.bind(self._options.callbacks.onPasteReceived,self,blob),onSuccess:qq.bind(self._handlePasteSuccess,self,blob),identifier:"pasted image"})}}})},_createStore:function(initialValue,_readOnlyValues_){var store={},catchall=initialValue,perIdReadOnlyValues={},readOnlyValues=_readOnlyValues_,copy=function(orig){return qq.isObject(orig)?qq.extend({},orig):orig},getReadOnlyValues=function(){return qq.isFunction(readOnlyValues)?readOnlyValues():readOnlyValues},includeReadOnlyValues=function(id,existing){readOnlyValues&&qq.isObject(existing)&&qq.extend(existing,getReadOnlyValues()),perIdReadOnlyValues[id]&&qq.extend(existing,perIdReadOnlyValues[id])};return{set:function(val,id){null==id?(store={},catchall=copy(val)):store[id]=copy(val)},get:function(id){var values;return values=null!=id&&store[id]?store[id]:copy(catchall),includeReadOnlyValues(id,values),copy(values)},addReadOnly:function(id,values){qq.isObject(store)&&(null===id?qq.isFunction(values)?readOnlyValues=values:(readOnlyValues=readOnlyValues||{},qq.extend(readOnlyValues,values)):(perIdReadOnlyValues[id]=perIdReadOnlyValues[id]||{},qq.extend(perIdReadOnlyValues[id],values)))},remove:function(fileId){return delete store[fileId]},reset:function(){store={},perIdReadOnlyValues={},catchall=initialValue}}},_createUploadDataTracker:function(){var self=this;return new qq.UploadData({getName:function(id){return self.getName(id)},getUuid:function(id){return self.getUuid(id)},getSize:function(id){return self.getSize(id)},onStatusChange:function(id,oldStatus,newStatus){self._onUploadStatusChange(id,oldStatus,newStatus),self._options.callbacks.onStatusChange(id,oldStatus,newStatus),self._maybeAllComplete(id,newStatus),self._totalProgress&&setTimeout(function(){self._totalProgress.onStatusChange(id,oldStatus,newStatus)},0)}})},_createUploadButton:function(spec){function allowMultiple(){return!!qq.supportedFeatures.ajaxUploading&&(!(self._options.workarounds.iosEmptyVideos&&qq.ios()&&!qq.ios6()&&self._isAllowedExtension(allowedExtensions,".mov"))&&(void 0===spec.multiple?self._options.multiple:spec.multiple))}var button,self=this,acceptFiles=spec.accept||this._options.validation.acceptFiles,allowedExtensions=spec.allowedExtensions||this._options.validation.allowedExtensions;return button=new qq.UploadButton({acceptFiles:acceptFiles,element:spec.element,focusClass:this._options.classes.buttonFocus,folders:spec.folders,hoverClass:this._options.classes.buttonHover,ios8BrowserCrashWorkaround:this._options.workarounds.ios8BrowserCrash,multiple:allowMultiple(),name:this._options.request.inputName,onChange:function(input){self._onInputChange(input)},title:null==spec.title?this._options.text.fileInputTitle:spec.title}),this._disposeSupport.addDisposer(function(){button.dispose()}),self._buttons.push(button),button},_createUploadHandler:function(additionalOptions,namespace){var self=this,lastOnProgress={},options={debug:this._options.debug,maxConnections:this._options.maxConnections,cors:this._options.cors,paramsStore:this._paramsStore,endpointStore:this._endpointStore,chunking:this._options.chunking,resume:this._options.resume,blobs:this._options.blobs,log:qq.bind(self.log,self),preventRetryParam:this._options.retry.preventRetryResponseProperty,onProgress:function(id,name,loaded,total){loaded<0||total<0||(lastOnProgress[id]?lastOnProgress[id].loaded===loaded&&lastOnProgress[id].total===total||(self._onProgress(id,name,loaded,total),self._options.callbacks.onProgress(id,name,loaded,total)):(self._onProgress(id,name,loaded,total),self._options.callbacks.onProgress(id,name,loaded,total)),lastOnProgress[id]={loaded:loaded,total:total})},onComplete:function(id,name,result,xhr){delete lastOnProgress[id];var retVal,status=self.getUploads({id:id}).status;status!==qq.status.UPLOAD_SUCCESSFUL&&status!==qq.status.UPLOAD_FAILED&&(retVal=self._onComplete(id,name,result,xhr),retVal instanceof qq.Promise?retVal.done(function(){self._options.callbacks.onComplete(id,name,result,xhr)}):self._options.callbacks.onComplete(id,name,result,xhr))},onCancel:function(id,name,cancelFinalizationEffort){var promise=new qq.Promise;return self._handleCheckedCallback({name:"onCancel",callback:qq.bind(self._options.callbacks.onCancel,self,id,name),onFailure:promise.failure,onSuccess:function(){cancelFinalizationEffort.then(function(){self._onCancel(id,name)}),promise.success()},identifier:id}),promise},onUploadPrep:qq.bind(this._onUploadPrep,this),onUpload:function(id,name){self._onUpload(id,name),self._options.callbacks.onUpload(id,name)},onUploadChunk:function(id,name,chunkData){self._onUploadChunk(id,chunkData),self._options.callbacks.onUploadChunk(id,name,chunkData)},onUploadChunkSuccess:function(id,chunkData,result,xhr){self._options.callbacks.onUploadChunkSuccess.apply(self,arguments)},onResume:function(id,name,chunkData){return self._options.callbacks.onResume(id,name,chunkData)},onAutoRetry:function(id,name,responseJSON,xhr){return self._onAutoRetry.apply(self,arguments)},onUuidChanged:function(id,newUuid){self.log("Server requested UUID change from '"+self.getUuid(id)+"' to '"+newUuid+"'"),self.setUuid(id,newUuid)},getName:qq.bind(self.getName,self),getUuid:qq.bind(self.getUuid,self),getSize:qq.bind(self.getSize,self),setSize:qq.bind(self._setSize,self),getDataByUuid:function(uuid){return self.getUploads({uuid:uuid})},isQueued:function(id){var status=self.getUploads({id:id}).status
;return status===qq.status.QUEUED||status===qq.status.SUBMITTED||status===qq.status.UPLOAD_RETRYING||status===qq.status.PAUSED},getIdsInProxyGroup:self._uploadData.getIdsInProxyGroup,getIdsInBatch:self._uploadData.getIdsInBatch};return qq.each(this._options.request,function(prop,val){options[prop]=val}),options.customHeaders=this._customHeadersStore,additionalOptions&&qq.each(additionalOptions,function(key,val){options[key]=val}),new qq.UploadHandlerController(options,namespace)},_fileOrBlobRejected:function(id){this._netUploadedOrQueued--,this._uploadData.setStatus(id,qq.status.REJECTED)},_formatSize:function(bytes){if(0===bytes)return bytes+this._options.text.sizeSymbols[0];var i=-1;do{bytes/=1e3,i++}while(bytes>999);return Math.max(bytes,.1).toFixed(1)+this._options.text.sizeSymbols[i]},_generateExtraButtonSpecs:function(){var self=this;this._extraButtonSpecs={},qq.each(this._options.extraButtons,function(idx,extraButtonOptionEntry){var multiple=extraButtonOptionEntry.multiple,validation=qq.extend({},self._options.validation,!0),extraButtonSpec=qq.extend({},extraButtonOptionEntry);void 0===multiple&&(multiple=self._options.multiple),extraButtonSpec.validation&&qq.extend(validation,extraButtonOptionEntry.validation,!0),qq.extend(extraButtonSpec,{multiple:multiple,validation:validation},!0),self._initExtraButton(extraButtonSpec)})},_getButton:function(buttonId){var extraButtonsSpec=this._extraButtonSpecs[buttonId];return extraButtonsSpec?extraButtonsSpec.element:buttonId===this._defaultButtonId?this._options.button:void 0},_getButtonId:function(buttonOrFileInputOrFile){var inputs,fileInput,fileBlobOrInput=buttonOrFileInputOrFile;if(fileBlobOrInput instanceof qq.BlobProxy&&(fileBlobOrInput=fileBlobOrInput.referenceBlob),fileBlobOrInput&&!qq.isBlob(fileBlobOrInput)){if(qq.isFile(fileBlobOrInput))return fileBlobOrInput.qqButtonId;if("input"===fileBlobOrInput.tagName.toLowerCase()&&"file"===fileBlobOrInput.type.toLowerCase())return fileBlobOrInput.getAttribute(qq.UploadButton.BUTTON_ID_ATTR_NAME);if(inputs=fileBlobOrInput.getElementsByTagName("input"),qq.each(inputs,function(idx,input){if("file"===input.getAttribute("type"))return fileInput=input,!1}),fileInput)return fileInput.getAttribute(qq.UploadButton.BUTTON_ID_ATTR_NAME)}},_getNotFinished:function(){return this._uploadData.retrieve({status:[qq.status.UPLOADING,qq.status.UPLOAD_RETRYING,qq.status.QUEUED,qq.status.SUBMITTING,qq.status.SUBMITTED,qq.status.PAUSED]}).length},_getValidationBase:function(buttonId){var extraButtonSpec=this._extraButtonSpecs[buttonId];return extraButtonSpec?extraButtonSpec.validation:this._options.validation},_getValidationDescriptor:function(fileWrapper){return fileWrapper.file instanceof qq.BlobProxy?{name:qq.getFilename(fileWrapper.file.referenceBlob),size:fileWrapper.file.referenceBlob.size}:{name:this.getUploads({id:fileWrapper.id}).name,size:this.getUploads({id:fileWrapper.id}).size}},_getValidationDescriptors:function(fileWrappers){var self=this,fileDescriptors=[];return qq.each(fileWrappers,function(idx,fileWrapper){fileDescriptors.push(self._getValidationDescriptor(fileWrapper))}),fileDescriptors},_handleCameraAccess:function(){if(this._options.camera.ios&&qq.ios()){var acceptIosCamera="image/*;capture=camera",button=this._options.camera.button,buttonId=button?this._getButtonId(button):this._defaultButtonId,optionRoot=this._options;buttonId&&buttonId!==this._defaultButtonId&&(optionRoot=this._extraButtonSpecs[buttonId]),optionRoot.multiple=!1,null===optionRoot.validation.acceptFiles?optionRoot.validation.acceptFiles=acceptIosCamera:optionRoot.validation.acceptFiles+=","+acceptIosCamera,qq.each(this._buttons,function(idx,button){if(button.getButtonId()===buttonId)return button.setMultiple(optionRoot.multiple),button.setAcceptFiles(optionRoot.acceptFiles),!1})}},_handleCheckedCallback:function(details){var self=this,callbackRetVal=details.callback();return qq.isGenericPromise(callbackRetVal)?(this.log(details.name+" - waiting for "+details.name+" promise to be fulfilled for "+details.identifier),callbackRetVal.then(function(successParam){self.log(details.name+" promise success for "+details.identifier),details.onSuccess(successParam)},function(){details.onFailure?(self.log(details.name+" promise failure for "+details.identifier),details.onFailure()):self.log(details.name+" promise failure for "+details.identifier)})):(!1!==callbackRetVal?details.onSuccess(callbackRetVal):details.onFailure?(this.log(details.name+" - return value was 'false' for "+details.identifier+".  Invoking failure callback."),details.onFailure()):this.log(details.name+" - return value was 'false' for "+details.identifier+".  Will not proceed."),callbackRetVal)},_handleNewFile:function(file,batchId,newFileWrapperList){var self=this,uuid=qq.getUniqueId(),size=-1,name=qq.getFilename(file),actualFile=file.blob||file,handler=this._customNewFileHandler?this._customNewFileHandler:qq.bind(self._handleNewFileGeneric,self);!qq.isInput(actualFile)&&actualFile.size>=0&&(size=actualFile.size),handler(actualFile,name,uuid,size,newFileWrapperList,batchId,this._options.request.uuidName,{uploadData:self._uploadData,paramsStore:self._paramsStore,addFileToHandler:function(id,file){self._handler.add(id,file),self._netUploadedOrQueued++,self._trackButton(id)}})},_handleNewFileGeneric:function(file,name,uuid,size,fileList,batchId){var id=this._uploadData.addFile({uuid:uuid,name:name,size:size,batchId:batchId});this._handler.add(id,file),this._trackButton(id),this._netUploadedOrQueued++,fileList.push({id:id,file:file})},_handlePasteSuccess:function(blob,extSuppliedName){var extension=blob.type.split("/")[1],name=extSuppliedName;null==name&&(name=this._options.paste.defaultName),name+="."+extension,this.addFiles({name:name,blob:blob})},_handleDeleteSuccess:function(id){if(this.getUploads({id:id}).status!==qq.status.DELETED){var name=this.getName(id);this._netUploadedOrQueued--,this._netUploaded--,this._handler.expunge(id),this._uploadData.setStatus(id,qq.status.DELETED),this.log("Delete request for '"+name+"' has succeeded.")}},_handleDeleteFailed:function(id,xhrOrXdr){var name=this.getName(id);this._uploadData.setStatus(id,qq.status.DELETE_FAILED),this.log("Delete request for '"+name+"' has failed.","error"),xhrOrXdr&&void 0!==xhrOrXdr.withCredentials?this._options.callbacks.onError(id,name,"Delete request failed with response code "+xhrOrXdr.status,xhrOrXdr):this._options.callbacks.onError(id,name,"Delete request failed",xhrOrXdr)},_initExtraButton:function(spec){var button=this._createUploadButton({accept:spec.validation.acceptFiles,allowedExtensions:spec.validation.allowedExtensions,element:spec.element,folders:spec.folders,multiple:spec.multiple,title:spec.fileInputTitle});this._extraButtonSpecs[button.getButtonId()]=spec},_initFormSupportAndParams:function(){this._formSupport=qq.FormSupport&&new qq.FormSupport(this._options.form,qq.bind(this.uploadStoredFiles,this),qq.bind(this.log,this)),this._formSupport&&this._formSupport.attachedToForm?(this._paramsStore=this._createStore(this._options.request.params,this._formSupport.getFormInputsAsObject),this._options.autoUpload=this._formSupport.newAutoUpload,this._formSupport.newEndpoint&&(this._options.request.endpoint=this._formSupport.newEndpoint)):this._paramsStore=this._createStore(this._options.request.params)},_isDeletePossible:function(){return!(!qq.DeleteFileAjaxRequester||!this._options.deleteFile.enabled)&&(!this._options.cors.expected||(!!qq.supportedFeatures.deleteFileCorsXhr||!(!qq.supportedFeatures.deleteFileCorsXdr||!this._options.cors.allowXdr)))},_isAllowedExtension:function(allowed,fileName){var valid=!1;return!allowed.length||(qq.each(allowed,function(idx,allowedExt){if(qq.isString(allowedExt)){var extRegex=new RegExp("\\."+allowedExt+"$","i");if(null!=fileName.match(extRegex))return valid=!0,!1}}),valid)},_itemError:function(code,maybeNameOrNames,item){function r(name,replacement){message=message.replace(name,replacement)}var extensionsForMessage,placeholderMatch,message=this._options.messages[code],allowedExtensions=[],names=[].concat(maybeNameOrNames),name=names[0],buttonId=this._getButtonId(item),validationBase=this._getValidationBase(buttonId);return qq.each(validationBase.allowedExtensions,function(idx,allowedExtension){qq.isString(allowedExtension)&&allowedExtensions.push(allowedExtension)}),extensionsForMessage=allowedExtensions.join(", ").toLowerCase(),r("{file}",this._options.formatFileName(name)),r("{extensions}",extensionsForMessage),r("{sizeLimit}",this._formatSize(validationBase.sizeLimit)),r("{minSizeLimit}",this._formatSize(validationBase.minSizeLimit)),placeholderMatch=message.match(/(\{\w+\})/g),null!==placeholderMatch&&qq.each(placeholderMatch,function(idx,placeholder){r(placeholder,names[idx])}),this._options.callbacks.onError(null,name,message,void 0),message},_manualRetry:function(id,callback){if(this._onBeforeManualRetry(id))return this._netUploadedOrQueued++,this._uploadData.setStatus(id,qq.status.UPLOAD_RETRYING),callback?callback(id):this._handler.retry(id),!0},_maybeAllComplete:function(id,status){var self=this,notFinished=this._getNotFinished();status===qq.status.UPLOAD_SUCCESSFUL?this._succeededSinceLastAllComplete.push(id):status===qq.status.UPLOAD_FAILED&&this._failedSinceLastAllComplete.push(id),0===notFinished&&(this._succeededSinceLastAllComplete.length||this._failedSinceLastAllComplete.length)&&setTimeout(function(){self._onAllComplete(self._succeededSinceLastAllComplete,self._failedSinceLastAllComplete)},0)},_maybeHandleIos8SafariWorkaround:function(){var self=this;if(this._options.workarounds.ios8SafariUploads&&qq.ios800()&&qq.iosSafari())throw setTimeout(function(){window.alert(self._options.messages.unsupportedBrowserIos8Safari)},0),new qq.Error(this._options.messages.unsupportedBrowserIos8Safari)},_maybeParseAndSendUploadError:function(id,name,response,xhr){if(!response.success)if(xhr&&200!==xhr.status&&!response.error)this._options.callbacks.onError(id,name,"XHR returned response code "+xhr.status,xhr);else{var errorReason=response.error?response.error:this._options.text.defaultResponseError;this._options.callbacks.onError(id,name,errorReason,xhr)}},_maybeProcessNextItemAfterOnValidateCallback:function(validItem,items,index,params,endpoint){var self=this;if(items.length>index)if(validItem||!this._options.validation.stopOnFirstInvalidFile)setTimeout(function(){var validationDescriptor=self._getValidationDescriptor(items[index]),buttonId=self._getButtonId(items[index].file),button=self._getButton(buttonId);self._handleCheckedCallback({name:"onValidate",callback:qq.bind(self._options.callbacks.onValidate,self,validationDescriptor,button),onSuccess:qq.bind(self._onValidateCallbackSuccess,self,items,index,params,endpoint),onFailure:qq.bind(self._onValidateCallbackFailure,self,items,index,params,endpoint),identifier:"Item '"+validationDescriptor.name+"', size: "+validationDescriptor.size})},0);else if(!validItem)for(;index<items.length;index++)self._fileOrBlobRejected(items[index].id)},_onAllComplete:function(successful,failed){this._totalProgress&&this._totalProgress.onAllComplete(successful,failed,this._preventRetries),this._options.callbacks.onAllComplete(qq.extend([],successful),qq.extend([],failed)),this._succeededSinceLastAllComplete=[],this._failedSinceLastAllComplete=[]},_onAutoRetry:function(id,name,responseJSON,xhr,callback){var self=this;if(self._preventRetries[id]=responseJSON[self._options.retry.preventRetryResponseProperty],self._shouldAutoRetry(id,name,responseJSON)){var retryWaitPeriod=1e3*self._options.retry.autoAttemptDelay;return self._maybeParseAndSendUploadError.apply(self,arguments),self._options.callbacks.onAutoRetry(id,name,self._autoRetries[id]),self._onBeforeAutoRetry(id,name),self._uploadData.setStatus(id,qq.status.UPLOAD_RETRYING),self._retryTimeouts[id]=setTimeout(function(){self.log("Starting retry for "+name+"..."),callback?callback(id):self._handler.retry(id)},retryWaitPeriod),!0}},_onBeforeAutoRetry:function(id,name){this.log("Waiting "+this._options.retry.autoAttemptDelay+" seconds before retrying "+name+"...")},_onBeforeManualRetry:function(id){var fileName,itemLimit=this._currentItemLimit;return this._preventRetries[id]?(this.log("Retries are forbidden for id "+id,"warn"),!1):this._handler.isValid(id)?(fileName=this.getName(id),!1!==this._options.callbacks.onManualRetry(id,fileName)&&(itemLimit>0&&this._netUploadedOrQueued+1>itemLimit?(this._itemError("retryFailTooManyItems"),!1):(this.log("Retrying upload for '"+fileName+"' (id: "+id+")..."),!0))):(this.log("'"+id+"' is not a valid file ID","error"),!1)},_onCancel:function(id,name){this._netUploadedOrQueued--,clearTimeout(this._retryTimeouts[id]);var storedItemIndex=qq.indexOf(this._storedIds,id);!this._options.autoUpload&&storedItemIndex>=0&&this._storedIds.splice(storedItemIndex,1),this._uploadData.setStatus(id,qq.status.CANCELED)},_onComplete:function(id,name,result,xhr){return result.success?(result.thumbnailUrl&&(this._thumbnailUrls[id]=result.thumbnailUrl),this._netUploaded++,this._uploadData.setStatus(id,qq.status.UPLOAD_SUCCESSFUL)):(this._netUploadedOrQueued--,this._uploadData.setStatus(id,qq.status.UPLOAD_FAILED),!0===result[this._options.retry.preventRetryResponseProperty]&&(this._preventRetries[id]=!0)),this._maybeParseAndSendUploadError(id,name,result,xhr),!!result.success},_onDelete:function(id){this._uploadData.setStatus(id,qq.status.DELETING)},_onDeleteComplete:function(id,xhrOrXdr,isError){this.getName(id);isError?this._handleDeleteFailed(id,xhrOrXdr):this._handleDeleteSuccess(id)},_onInputChange:function(input){var fileIndex;if(qq.supportedFeatures.ajaxUploading){for(fileIndex=0;fileIndex<input.files.length;fileIndex++)this._annotateWithButtonId(input.files[fileIndex],input);this.addFiles(input.files)}else input.value.length>0&&this.addFiles(input);qq.each(this._buttons,function(idx,button){button.reset()})},_onProgress:function(id,name,loaded,total){this._totalProgress&&this._totalProgress.onIndividualProgress(id,loaded,total)},_onSubmit:function(id,name){},_onSubmitCallbackSuccess:function(id,name){this._onSubmit.apply(this,arguments),this._uploadData.setStatus(id,qq.status.SUBMITTED),this._onSubmitted.apply(this,arguments),this._options.autoUpload?(this._options.callbacks.onSubmitted.apply(this,arguments),this._uploadFile(id)):(this._storeForLater(id),this._options.callbacks.onSubmitted.apply(this,arguments))},_onSubmitDelete:function(id,onSuccessCallback,additionalMandatedParams){var adjustedOnSuccessCallback,uuid=this.getUuid(id);return onSuccessCallback&&(adjustedOnSuccessCallback=qq.bind(onSuccessCallback,this,id,uuid,additionalMandatedParams)),this._isDeletePossible()?(this._handleCheckedCallback({name:"onSubmitDelete",callback:qq.bind(this._options.callbacks.onSubmitDelete,this,id),onSuccess:adjustedOnSuccessCallback||qq.bind(this._deleteHandler.sendDelete,this,id,uuid,additionalMandatedParams),identifier:id}),!0):(this.log("Delete request ignored for ID "+id+", delete feature is disabled or request not possible due to CORS on a user agent that does not support pre-flighting.","warn"),!1)},_onSubmitted:function(id){},_onTotalProgress:function(loaded,total){this._options.callbacks.onTotalProgress(loaded,total)},_onUploadPrep:function(id){},_onUpload:function(id,name){this._uploadData.setStatus(id,qq.status.UPLOADING)},_onUploadChunk:function(id,chunkData){},_onUploadStatusChange:function(id,oldStatus,newStatus){newStatus===qq.status.PAUSED&&clearTimeout(this._retryTimeouts[id])},_onValidateBatchCallbackFailure:function(fileWrappers){var self=this;qq.each(fileWrappers,function(idx,fileWrapper){self._fileOrBlobRejected(fileWrapper.id)})},_onValidateBatchCallbackSuccess:function(validationDescriptors,items,params,endpoint,button){var errorMessage,itemLimit=this._currentItemLimit,proposedNetFilesUploadedOrQueued=this._netUploadedOrQueued;0===itemLimit||proposedNetFilesUploadedOrQueued<=itemLimit?items.length>0?this._handleCheckedCallback({name:"onValidate",callback:qq.bind(this._options.callbacks.onValidate,this,validationDescriptors[0],button),onSuccess:qq.bind(this._onValidateCallbackSuccess,this,items,0,params,endpoint),onFailure:qq.bind(this._onValidateCallbackFailure,this,items,0,params,endpoint),identifier:"Item '"+items[0].file.name+"', size: "+items[0].file.size}):this._itemError("noFilesError"):(this._onValidateBatchCallbackFailure(items),errorMessage=this._options.messages.tooManyItemsError.replace(/\{netItems\}/g,proposedNetFilesUploadedOrQueued).replace(/\{itemLimit\}/g,itemLimit),this._batchError(errorMessage))},_onValidateCallbackFailure:function(items,index,params,endpoint){var nextIndex=index+1;this._fileOrBlobRejected(items[index].id,items[index].file.name),this._maybeProcessNextItemAfterOnValidateCallback(!1,items,nextIndex,params,endpoint)},_onValidateCallbackSuccess:function(items,index,params,endpoint){var self=this,nextIndex=index+1,validationDescriptor=this._getValidationDescriptor(items[index]);this._validateFileOrBlobData(items[index],validationDescriptor).then(function(){self._upload(items[index].id,params,endpoint),self._maybeProcessNextItemAfterOnValidateCallback(!0,items,nextIndex,params,endpoint)},function(){self._maybeProcessNextItemAfterOnValidateCallback(!1,items,nextIndex,params,endpoint)})},_prepareItemsForUpload:function(items,params,endpoint){if(0===items.length)return void this._itemError("noFilesError");var validationDescriptors=this._getValidationDescriptors(items),buttonId=this._getButtonId(items[0].file),button=this._getButton(buttonId);this._handleCheckedCallback({name:"onValidateBatch",callback:qq.bind(this._options.callbacks.onValidateBatch,this,validationDescriptors,button),onSuccess:qq.bind(this._onValidateBatchCallbackSuccess,this,validationDescriptors,items,params,endpoint,button),onFailure:qq.bind(this._onValidateBatchCallbackFailure,this,items),identifier:"batch validation"})},_preventLeaveInProgress:function(){var self=this;this._disposeSupport.attach(window,"beforeunload",function(e){if(self.getInProgress())return e=e||window.event,e.returnValue=self._options.messages.onLeave,self._options.messages.onLeave})},_refreshSessionData:function(){var self=this,options=this._options.session;qq.Session&&null!=this._options.session.endpoint&&(this._session||(qq.extend(options,{cors:this._options.cors}),options.log=qq.bind(this.log,this),options.addFileRecord=qq.bind(this._addCannedFile,this),this._session=new qq.Session(options)),setTimeout(function(){self._session.refresh().then(function(response,xhrOrXdr){self._sessionRequestComplete(),self._options.callbacks.onSessionRequestComplete(response,!0,xhrOrXdr)},function(response,xhrOrXdr){self._options.callbacks.onSessionRequestComplete(response,!1,xhrOrXdr)})},0))},_sessionRequestComplete:function(){},_setSize:function(id,newSize){this._uploadData.updateSize(id,newSize),this._totalProgress&&this._totalProgress.onNewSize(id)},_shouldAutoRetry:function(id,name,responseJSON){var uploadData=this._uploadData.retrieve({id:id});return!!(!this._preventRetries[id]&&this._options.retry.enableAuto&&uploadData.status!==qq.status.PAUSED&&(void 0===this._autoRetries[id]&&(this._autoRetries[id]=0),this._autoRetries[id]<this._options.retry.maxAutoAttempts))&&(this._autoRetries[id]+=1,!0)},_storeForLater:function(id){this._storedIds.push(id)},_trackButton:function(id){var buttonId;(buttonId=qq.supportedFeatures.ajaxUploading?this._handler.getFile(id).qqButtonId:this._getButtonId(this._handler.getInput(id)))&&(this._buttonIdsForFileIds[id]=buttonId)},_updateFormSupportAndParams:function(formElementOrId){this._options.form.element=formElementOrId,this._formSupport=qq.FormSupport&&new qq.FormSupport(this._options.form,qq.bind(this.uploadStoredFiles,this),qq.bind(this.log,this)),this._formSupport&&this._formSupport.attachedToForm&&(this._paramsStore.addReadOnly(null,this._formSupport.getFormInputsAsObject),this._options.autoUpload=this._formSupport.newAutoUpload,this._formSupport.newEndpoint&&this.setEndpoint(this._formSupport.newEndpoint))},_upload:function(id,params,endpoint){var name=this.getName(id);params&&this.setParams(params,id),endpoint&&this.setEndpoint(endpoint,id),this._handleCheckedCallback({name:"onSubmit",callback:qq.bind(this._options.callbacks.onSubmit,this,id,name),onSuccess:qq.bind(this._onSubmitCallbackSuccess,this,id,name),onFailure:qq.bind(this._fileOrBlobRejected,this,id,name),identifier:id})},_uploadFile:function(id){this._handler.upload(id)||this._uploadData.setStatus(id,qq.status.QUEUED)},_uploadStoredFiles:function(){for(var idToUpload,stillSubmitting,self=this;this._storedIds.length;)idToUpload=this._storedIds.shift(),this._uploadFile(idToUpload);(stillSubmitting=this.getUploads({status:qq.status.SUBMITTING}).length)&&(qq.log("Still waiting for "+stillSubmitting+" files to clear submit queue. Will re-parse stored IDs array shortly."),setTimeout(function(){self._uploadStoredFiles()},1e3))},_validateFileOrBlobData:function(fileWrapper,validationDescriptor){var self=this,file=function(){return fileWrapper.file instanceof qq.BlobProxy?fileWrapper.file.referenceBlob:fileWrapper.file}(),name=validationDescriptor.name,size=validationDescriptor.size,buttonId=this._getButtonId(fileWrapper.file),validationBase=this._getValidationBase(buttonId),validityChecker=new qq.Promise;return validityChecker.then(function(){},function(){self._fileOrBlobRejected(fileWrapper.id,name)}),qq.isFileOrInput(file)&&!this._isAllowedExtension(validationBase.allowedExtensions,name)?(this._itemError("typeError",name,file),validityChecker.failure()):this._options.validation.allowEmpty||0!==size?size>0&&validationBase.sizeLimit&&size>validationBase.sizeLimit?(this._itemError("sizeError",name,file),validityChecker.failure()):size>0&&size<validationBase.minSizeLimit?(this._itemError("minSizeError",name,file),validityChecker.failure()):(qq.ImageValidation&&qq.supportedFeatures.imagePreviews&&qq.isFile(file)?new qq.ImageValidation(file,qq.bind(self.log,self)).validate(validationBase.image).then(validityChecker.success,function(errorCode){self._itemError(errorCode+"ImageError",name,file),validityChecker.failure()}):validityChecker.success(),validityChecker):(this._itemError("emptyError",name,file),validityChecker.failure())},_wrapCallbacks:function(){var self,safeCallback,prop;self=this,safeCallback=function(name,callback,args){var errorMsg;try{return callback.apply(self,args)}catch(exception){errorMsg=exception.message||exception.toString(),self.log("Caught exception in '"+name+"' callback - "+errorMsg,"error")}};for(prop in this._options.callbacks)!function(){var callbackName,callbackFunc;callbackName=prop,callbackFunc=self._options.callbacks[callbackName],self._options.callbacks[callbackName]=function(){return safeCallback(callbackName,callbackFunc,arguments)}}()}}}(),function(){"use strict";qq.FineUploaderBasic=function(o){var self=this;this._options={debug:!1,button:null,multiple:!0,maxConnections:3,disableCancelForFormUploads:!1,autoUpload:!0,request:{customHeaders:{},endpoint:"/server/upload",filenameParam:"qqfilename",forceMultipart:!0,inputName:"qqfile",method:"POST",params:{},paramsInBody:!0,totalFileSizeName:"qqtotalfilesize",uuidName:"qquuid"},validation:{allowedExtensions:[],sizeLimit:0,minSizeLimit:0,itemLimit:0,stopOnFirstInvalidFile:!0,acceptFiles:null,image:{maxHeight:0,maxWidth:0,minHeight:0,minWidth:0},allowEmpty:!1},callbacks:{onSubmit:function(id,name){},onSubmitted:function(id,name){},onComplete:function(id,name,responseJSON,maybeXhr){},onAllComplete:function(successful,failed){},onCancel:function(id,name){},onUpload:function(id,name){},onUploadChunk:function(id,name,chunkData){},onUploadChunkSuccess:function(id,chunkData,responseJSON,xhr){},onResume:function(id,fileName,chunkData){},onProgress:function(id,name,loaded,total){},onTotalProgress:function(loaded,total){},onError:function(id,name,reason,maybeXhrOrXdr){},onAutoRetry:function(id,name,attemptNumber){},onManualRetry:function(id,name){},onValidateBatch:function(fileOrBlobData){},onValidate:function(fileOrBlobData){},onSubmitDelete:function(id){},onDelete:function(id){},onDeleteComplete:function(id,xhrOrXdr,isError){},onPasteReceived:function(blob){},onStatusChange:function(id,oldStatus,newStatus){},onSessionRequestComplete:function(response,success,xhrOrXdr){}},messages:{typeError:"{file} has an invalid extension. Valid extension(s): {extensions}.",sizeError:"{file} is too large, maximum file size is {sizeLimit}.",minSizeError:"{file} is too small, minimum file size is {minSizeLimit}.",emptyError:"{file} is empty, please select files again without it.",noFilesError:"No files to upload.",tooManyItemsError:"Too many items ({netItems}) would be uploaded.  Item limit is {itemLimit}.",maxHeightImageError:"Image is too tall.",maxWidthImageError:"Image is too wide.",minHeightImageError:"Image is not tall enough.",minWidthImageError:"Image is not wide enough.",retryFailTooManyItems:"Retry failed - you have reached your file limit.",onLeave:"The files are being uploaded, if you leave now the upload will be canceled.",unsupportedBrowserIos8Safari:"Unrecoverable error - this browser does not permit file uploading of any kind due to serious bugs in iOS8 Safari.  Please use iOS8 Chrome until Apple fixes these issues."},retry:{enableAuto:!1,maxAutoAttempts:3,autoAttemptDelay:5,preventRetryResponseProperty:"preventRetry"},classes:{buttonHover:"qq-upload-button-hover",buttonFocus:"qq-upload-button-focus"},chunking:{enabled:!1,concurrent:{enabled:!1},mandatory:!1,paramNames:{partIndex:"qqpartindex",partByteOffset:"qqpartbyteoffset",chunkSize:"qqchunksize",totalFileSize:"qqtotalfilesize",totalParts:"qqtotalparts"},partSize:2e6,success:{endpoint:null}},resume:{enabled:!1,recordsExpireIn:7,paramNames:{resuming:"qqresume"}},formatFileName:function(fileOrBlobName){return fileOrBlobName},text:{defaultResponseError:"Upload failure reason unknown",fileInputTitle:"file input",sizeSymbols:["kB","MB","GB","TB","PB","EB"]},deleteFile:{enabled:!1,method:"DELETE",endpoint:"/server/upload",customHeaders:{},params:{}},cors:{expected:!1,sendCredentials:!1,allowXdr:!1},blobs:{defaultName:"misc_data"},paste:{targetElement:null,defaultName:"pasted_image"},camera:{ios:!1,button:null},extraButtons:[],session:{endpoint:null,params:{},customHeaders:{},refreshOnReset:!0},form:{element:"qq-form",autoUpload:!1,interceptSubmit:!0},scaling:{customResizer:null,sendOriginal:!0,orient:!0,defaultType:null,defaultQuality:80,failureText:"Failed to scale",includeExif:!1,sizes:[]},workarounds:{iosEmptyVideos:!0,ios8SafariUploads:!0,ios8BrowserCrash:!1}},qq.extend(this._options,o,!0),this._buttons=[],this._extraButtonSpecs={},this._buttonIdsForFileIds=[],this._wrapCallbacks(),this._disposeSupport=new qq.DisposeSupport,this._storedIds=[],this._autoRetries=[],this._retryTimeouts=[],this._preventRetries=[],this._thumbnailUrls=[],this._netUploadedOrQueued=0,this._netUploaded=0,this._uploadData=this._createUploadDataTracker(),this._initFormSupportAndParams(),this._customHeadersStore=this._createStore(this._options.request.customHeaders),this._deleteFileCustomHeadersStore=this._createStore(this._options.deleteFile.customHeaders),this._deleteFileParamsStore=this._createStore(this._options.deleteFile.params),this._endpointStore=this._createStore(this._options.request.endpoint),this._deleteFileEndpointStore=this._createStore(this._options.deleteFile.endpoint),this._handler=this._createUploadHandler(),this._deleteHandler=qq.DeleteFileAjaxRequester&&this._createDeleteHandler(),this._options.button&&(this._defaultButtonId=this._createUploadButton({element:this._options.button,title:this._options.text.fileInputTitle}).getButtonId()),this._generateExtraButtonSpecs(),this._handleCameraAccess(),this._options.paste.targetElement&&(qq.PasteSupport?this._pasteHandler=this._createPasteHandler():this.log("Paste support module not found","error")),this._preventLeaveInProgress(),this._imageGenerator=qq.ImageGenerator&&new qq.ImageGenerator(qq.bind(this.log,this)),this._refreshSessionData(),this._succeededSinceLastAllComplete=[],this._failedSinceLastAllComplete=[],this._scaler=qq.Scaler&&new qq.Scaler(this._options.scaling,qq.bind(this.log,this))||{},this._scaler.enabled&&(this._customNewFileHandler=qq.bind(this._scaler.handleNewFile,this._scaler)),qq.TotalProgress&&qq.supportedFeatures.progressBar&&(this._totalProgress=new qq.TotalProgress(qq.bind(this._onTotalProgress,this),function(id){var entry=self._uploadData.retrieve({id:id});return entry&&entry.size||0})),this._currentItemLimit=this._options.validation.itemLimit},qq.FineUploaderBasic.prototype=qq.basePublicApi,qq.extend(qq.FineUploaderBasic.prototype,qq.basePrivateApi)}(),qq.AjaxRequester=function(o){"use strict";function isSimpleMethod(){return qq.indexOf(["GET","POST","HEAD"],options.method)>=0}function containsNonSimpleHeaders(headers){var containsNonSimple=!1;return qq.each(containsNonSimple,function(idx,header){if(qq.indexOf(["Accept","Accept-Language","Content-Language","Content-Type"],header)<0)return containsNonSimple=!0,!1}),containsNonSimple}function isXdr(xhr){return options.cors.expected&&void 0===xhr.withCredentials}function getCorsAjaxTransport(){var xhrOrXdr;return(window.XMLHttpRequest||window.ActiveXObject)&&(xhrOrXdr=qq.createXhrInstance(),void 0===xhrOrXdr.withCredentials&&(xhrOrXdr=new XDomainRequest,xhrOrXdr.onload=function(){},xhrOrXdr.onerror=function(){},xhrOrXdr.ontimeout=function(){},xhrOrXdr.onprogress=function(){})),xhrOrXdr}function getXhrOrXdr(id,suppliedXhr){var xhrOrXdr=requestData[id].xhr;return xhrOrXdr||(xhrOrXdr=suppliedXhr||(options.cors.expected?getCorsAjaxTransport():qq.createXhrInstance()),requestData[id].xhr=xhrOrXdr),xhrOrXdr}function dequeue(id){var nextId,i=qq.indexOf(queue,id),max=options.maxConnections;delete requestData[id],queue.splice(i,1),queue.length>=max&&i<max&&(nextId=queue[max-1],sendRequest(nextId))}function onComplete(id,xdrError){var xhr=getXhrOrXdr(id),method=options.method,isError=!0===xdrError;dequeue(id),isError?log(method+" request for "+id+" has failed","error"):isXdr(xhr)||isResponseSuccessful(xhr.status)||(isError=!0,log(method+" request for "+id+" has failed - response code "+xhr.status,"error")),options.onComplete(id,xhr,isError)}function getParams(id){var params,onDemandParams=requestData[id].additionalParams,mandatedParams=options.mandatedParams;return options.paramsStore.get&&(params=options.paramsStore.get(id)),onDemandParams&&qq.each(onDemandParams,function(name,val){params=params||{},params[name]=val}),mandatedParams&&qq.each(mandatedParams,function(name,val){params=params||{},params[name]=val}),params}function sendRequest(id,optXhr){var url,xhr=getXhrOrXdr(id,optXhr),method=options.method,params=getParams(id),payload=requestData[id].payload;return options.onSend(id),url=createUrl(id,params,requestData[id].additionalQueryParams),isXdr(xhr)?(xhr.onload=getXdrLoadHandler(id),xhr.onerror=getXdrErrorHandler(id)):xhr.onreadystatechange=getXhrReadyStateChangeHandler(id),registerForUploadProgress(id),xhr.open(method,url,!0),options.cors.expected&&options.cors.sendCredentials&&!isXdr(xhr)&&(xhr.withCredentials=!0),setHeaders(id),log("Sending "+method+" request for "+id),payload?xhr.send(payload):shouldParamsBeInQueryString||!params?xhr.send():params&&options.contentType&&options.contentType.toLowerCase().indexOf("application/x-www-form-urlencoded")>=0?xhr.send(qq.obj2url(params,"")):params&&options.contentType&&options.contentType.toLowerCase().indexOf("application/json")>=0?xhr.send(JSON.stringify(params)):xhr.send(params),xhr}function createUrl(id,params,additionalQueryParams){var endpoint=options.endpointStore.get(id),addToPath=requestData[id].addToPath;return void 0!=addToPath&&(endpoint+="/"+addToPath),shouldParamsBeInQueryString&&params&&(endpoint=qq.obj2url(params,endpoint)),additionalQueryParams&&(endpoint=qq.obj2url(additionalQueryParams,endpoint)),endpoint}function getXhrReadyStateChangeHandler(id){return function(){
4===getXhrOrXdr(id).readyState&&onComplete(id)}}function registerForUploadProgress(id){var onProgress=options.onProgress;onProgress&&(getXhrOrXdr(id).upload.onprogress=function(e){e.lengthComputable&&onProgress(id,e.loaded,e.total)})}function getXdrLoadHandler(id){return function(){onComplete(id)}}function getXdrErrorHandler(id){return function(){onComplete(id,!0)}}function setHeaders(id){var xhr=getXhrOrXdr(id),customHeaders=options.customHeaders,onDemandHeaders=requestData[id].additionalHeaders||{},method=options.method,allHeaders={};isXdr(xhr)||(options.acceptHeader&&xhr.setRequestHeader("Accept",options.acceptHeader),options.allowXRequestedWithAndCacheControl&&(options.cors.expected&&isSimpleMethod()&&!containsNonSimpleHeaders(customHeaders)||(xhr.setRequestHeader("X-Requested-With","XMLHttpRequest"),xhr.setRequestHeader("Cache-Control","no-cache"))),!options.contentType||"POST"!==method&&"PUT"!==method||xhr.setRequestHeader("Content-Type",options.contentType),qq.extend(allHeaders,qq.isFunction(customHeaders)?customHeaders(id):customHeaders),qq.extend(allHeaders,onDemandHeaders),qq.each(allHeaders,function(name,val){xhr.setRequestHeader(name,val)}))}function isResponseSuccessful(responseCode){return qq.indexOf(options.successfulResponseCodes[options.method],responseCode)>=0}function prepareToSend(id,optXhr,addToPath,additionalParams,additionalQueryParams,additionalHeaders,payload){if(requestData[id]={addToPath:addToPath,additionalParams:additionalParams,additionalQueryParams:additionalQueryParams,additionalHeaders:additionalHeaders,payload:payload},queue.push(id)<=options.maxConnections)return sendRequest(id,optXhr)}var log,shouldParamsBeInQueryString,queue=[],requestData={},options={acceptHeader:null,validMethods:["PATCH","POST","PUT"],method:"POST",contentType:"application/x-www-form-urlencoded",maxConnections:3,customHeaders:{},endpointStore:{},paramsStore:{},mandatedParams:{},allowXRequestedWithAndCacheControl:!0,successfulResponseCodes:{DELETE:[200,202,204],PATCH:[200,201,202,203,204],POST:[200,201,202,203,204],PUT:[200,201,202,203,204],GET:[200]},cors:{expected:!1,sendCredentials:!1},log:function(str,level){},onSend:function(id){},onComplete:function(id,xhrOrXdr,isError){},onProgress:null};if(qq.extend(options,o),log=options.log,qq.indexOf(options.validMethods,options.method)<0)throw new Error("'"+options.method+"' is not a supported method for this type of request!");shouldParamsBeInQueryString="GET"===options.method||"DELETE"===options.method,qq.extend(this,{initTransport:function(id){var path,params,headers,payload,cacheBuster,additionalQueryParams;return{withPath:function(appendToPath){return path=appendToPath,this},withParams:function(additionalParams){return params=additionalParams,this},withQueryParams:function(_additionalQueryParams_){return additionalQueryParams=_additionalQueryParams_,this},withHeaders:function(additionalHeaders){return headers=additionalHeaders,this},withPayload:function(thePayload){return payload=thePayload,this},withCacheBuster:function(){return cacheBuster=!0,this},send:function(optXhr){return cacheBuster&&qq.indexOf(["GET","DELETE"],options.method)>=0&&(params.qqtimestamp=(new Date).getTime()),prepareToSend(id,optXhr,path,params,additionalQueryParams,headers,payload)}}},canceled:function(id){dequeue(id)}})},qq.UploadHandler=function(spec){"use strict";var proxy=spec.proxy,fileState={},onCancel=proxy.onCancel,getName=proxy.getName;qq.extend(this,{add:function(id,fileItem){fileState[id]=fileItem,fileState[id].temp={}},cancel:function(id){var self=this,cancelFinalizationEffort=new qq.Promise;onCancel(id,getName(id),cancelFinalizationEffort).then(function(){self.isValid(id)&&(fileState[id].canceled=!0,self.expunge(id)),cancelFinalizationEffort.success()})},expunge:function(id){delete fileState[id]},getThirdPartyFileId:function(id){return fileState[id].key},isValid:function(id){return void 0!==fileState[id]},reset:function(){fileState={}},_getFileState:function(id){return fileState[id]},_setThirdPartyFileId:function(id,thirdPartyFileId){fileState[id].key=thirdPartyFileId},_wasCanceled:function(id){return!!fileState[id].canceled}})},qq.UploadHandlerController=function(o,namespace){"use strict";var preventRetryResponse,log,handler,controller=this,chunkingPossible=!1,concurrentChunkingPossible=!1,options={paramsStore:{},maxConnections:3,chunking:{enabled:!1,multiple:{enabled:!1}},log:function(str,level){},onProgress:function(id,fileName,loaded,total){},onComplete:function(id,fileName,response,xhr){},onCancel:function(id,fileName){},onUploadPrep:function(id){},onUpload:function(id,fileName){},onUploadChunk:function(id,fileName,chunkData){},onUploadChunkSuccess:function(id,chunkData,response,xhr){},onAutoRetry:function(id,fileName,response,xhr){},onResume:function(id,fileName,chunkData){},onUuidChanged:function(id,newUuid){},getName:function(id){},setSize:function(id,newSize){},isQueued:function(id){},getIdsInProxyGroup:function(id){},getIdsInBatch:function(id){}},chunked={done:function(id,chunkIdx,response,xhr){var chunkData=handler._getChunkData(id,chunkIdx);handler._getFileState(id).attemptingResume=!1,delete handler._getFileState(id).temp.chunkProgress[chunkIdx],handler._getFileState(id).loaded+=chunkData.size,options.onUploadChunkSuccess(id,handler._getChunkDataForCallback(chunkData),response,xhr)},finalize:function(id){var size=options.getSize(id),name=options.getName(id);log("All chunks have been uploaded for "+id+" - finalizing...."),handler.finalizeChunks(id).then(function(response,xhr){log("Finalize successful for "+id);var normaizedResponse=upload.normalizeResponse(response,!0);options.onProgress(id,name,size,size),handler._maybeDeletePersistedChunkData(id),upload.cleanup(id,normaizedResponse,xhr)},function(response,xhr){var normaizedResponse=upload.normalizeResponse(response,!1);log("Problem finalizing chunks for file ID "+id+" - "+normaizedResponse.error,"error"),normaizedResponse.reset&&chunked.reset(id),options.onAutoRetry(id,name,normaizedResponse,xhr)||upload.cleanup(id,normaizedResponse,xhr)})},handleFailure:function(chunkIdx,id,response,xhr){var name=options.getName(id);log("Chunked upload request failed for "+id+", chunk "+chunkIdx),handler.clearCachedChunk(id,chunkIdx);var inProgressIdx,responseToReport=upload.normalizeResponse(response,!1);responseToReport.reset?chunked.reset(id):(inProgressIdx=qq.indexOf(handler._getFileState(id).chunking.inProgress,chunkIdx))>=0&&(handler._getFileState(id).chunking.inProgress.splice(inProgressIdx,1),handler._getFileState(id).chunking.remaining.unshift(chunkIdx)),handler._getFileState(id).temp.ignoreFailure||(concurrentChunkingPossible&&(handler._getFileState(id).temp.ignoreFailure=!0,log(qq.format("Going to attempt to abort these chunks: {}. These are currently in-progress: {}.",JSON.stringify(Object.keys(handler._getXhrs(id))),JSON.stringify(handler._getFileState(id).chunking.inProgress))),qq.each(handler._getXhrs(id),function(ckid,ckXhr){log(qq.format("Attempting to abort file {}.{}. XHR readyState {}. ",id,ckid,ckXhr.readyState)),ckXhr.abort(),ckXhr._cancelled=!0}),handler.moveInProgressToRemaining(id),connectionManager.free(id,!0)),options.onAutoRetry(id,name,responseToReport,xhr)||upload.cleanup(id,responseToReport,xhr))},hasMoreParts:function(id){return!!handler._getFileState(id).chunking.remaining.length},nextPart:function(id){var nextIdx=handler._getFileState(id).chunking.remaining.shift();return nextIdx>=handler._getTotalChunks(id)&&(nextIdx=null),nextIdx},reset:function(id){log("Server or callback has ordered chunking effort to be restarted on next attempt for item ID "+id,"error"),handler._maybeDeletePersistedChunkData(id),handler.reevaluateChunking(id),handler._getFileState(id).loaded=0},sendNext:function(id){var size=options.getSize(id),name=options.getName(id),chunkIdx=chunked.nextPart(id),chunkData=handler._getChunkData(id,chunkIdx),resuming=handler._getFileState(id).attemptingResume,inProgressChunks=handler._getFileState(id).chunking.inProgress||[];null==handler._getFileState(id).loaded&&(handler._getFileState(id).loaded=0),resuming&&!1===options.onResume(id,name,chunkData)&&(chunked.reset(id),chunkIdx=chunked.nextPart(id),chunkData=handler._getChunkData(id,chunkIdx),resuming=!1),null==chunkIdx&&0===inProgressChunks.length?chunked.finalize(id):(log(qq.format("Sending chunked upload request for item {}.{}, bytes {}-{} of {}.",id,chunkIdx,chunkData.start+1,chunkData.end,size)),options.onUploadChunk(id,name,handler._getChunkDataForCallback(chunkData)),inProgressChunks.push(chunkIdx),handler._getFileState(id).chunking.inProgress=inProgressChunks,concurrentChunkingPossible&&connectionManager.open(id,chunkIdx),concurrentChunkingPossible&&connectionManager.available()&&handler._getFileState(id).chunking.remaining.length&&chunked.sendNext(id),0===chunkData.blob.size?(log(qq.format("Chunk {} for file {} will not be uploaded, zero sized chunk.",chunkIdx,id),"error"),chunked.handleFailure(chunkIdx,id,"File is no longer available",null)):handler.uploadChunk(id,chunkIdx,resuming).then(function(response,xhr){log("Chunked upload request succeeded for "+id+", chunk "+chunkIdx),handler.clearCachedChunk(id,chunkIdx);var inProgressChunks=handler._getFileState(id).chunking.inProgress||[],responseToReport=upload.normalizeResponse(response,!0),inProgressChunkIdx=qq.indexOf(inProgressChunks,chunkIdx);log(qq.format("Chunk {} for file {} uploaded successfully.",chunkIdx,id)),chunked.done(id,chunkIdx,responseToReport,xhr),inProgressChunkIdx>=0&&inProgressChunks.splice(inProgressChunkIdx,1),handler._maybePersistChunkedState(id),chunked.hasMoreParts(id)||0!==inProgressChunks.length?chunked.hasMoreParts(id)?chunked.sendNext(id):log(qq.format("File ID {} has no more chunks to send and these chunk indexes are still marked as in-progress: {}",id,JSON.stringify(inProgressChunks))):chunked.finalize(id)},function(response,xhr){chunked.handleFailure(chunkIdx,id,response,xhr)}).done(function(){handler.clearXhr(id,chunkIdx)}))}},connectionManager={_open:[],_openChunks:{},_waiting:[],available:function(){var max=options.maxConnections,openChunkEntriesCount=0,openChunksCount=0;return qq.each(connectionManager._openChunks,function(fileId,openChunkIndexes){openChunkEntriesCount++,openChunksCount+=openChunkIndexes.length}),max-(connectionManager._open.length-openChunkEntriesCount+openChunksCount)},free:function(id,dontAllowNext){var nextId,allowNext=!dontAllowNext,waitingIndex=qq.indexOf(connectionManager._waiting,id),connectionsIndex=qq.indexOf(connectionManager._open,id);delete connectionManager._openChunks[id],upload.getProxyOrBlob(id)instanceof qq.BlobProxy&&(log("Generated blob upload has ended for "+id+", disposing generated blob."),delete handler._getFileState(id).file),waitingIndex>=0?connectionManager._waiting.splice(waitingIndex,1):allowNext&&connectionsIndex>=0&&(connectionManager._open.splice(connectionsIndex,1),(nextId=connectionManager._waiting.shift())>=0&&(connectionManager._open.push(nextId),upload.start(nextId)))},getWaitingOrConnected:function(){var waitingOrConnected=[];return qq.each(connectionManager._openChunks,function(fileId,chunks){chunks&&chunks.length&&waitingOrConnected.push(parseInt(fileId))}),qq.each(connectionManager._open,function(idx,fileId){connectionManager._openChunks[fileId]||waitingOrConnected.push(parseInt(fileId))}),waitingOrConnected=waitingOrConnected.concat(connectionManager._waiting)},isUsingConnection:function(id){return qq.indexOf(connectionManager._open,id)>=0},open:function(id,chunkIdx){return null==chunkIdx&&connectionManager._waiting.push(id),!!connectionManager.available()&&(null==chunkIdx?(connectionManager._waiting.pop(),connectionManager._open.push(id)):function(){var openChunksEntry=connectionManager._openChunks[id]||[];openChunksEntry.push(chunkIdx),connectionManager._openChunks[id]=openChunksEntry}(),!0)},reset:function(){connectionManager._waiting=[],connectionManager._open=[]}},simple={send:function(id,name){handler._getFileState(id).loaded=0,log("Sending simple upload request for "+id),handler.uploadFile(id).then(function(response,optXhr){log("Simple upload request succeeded for "+id);var responseToReport=upload.normalizeResponse(response,!0),size=options.getSize(id);options.onProgress(id,name,size,size),upload.maybeNewUuid(id,responseToReport),upload.cleanup(id,responseToReport,optXhr)},function(response,optXhr){log("Simple upload request failed for "+id);var responseToReport=upload.normalizeResponse(response,!1);options.onAutoRetry(id,name,responseToReport,optXhr)||upload.cleanup(id,responseToReport,optXhr)})}},upload={cancel:function(id){log("Cancelling "+id),options.paramsStore.remove(id),connectionManager.free(id)},cleanup:function(id,response,optXhr){var name=options.getName(id);options.onComplete(id,name,response,optXhr),handler._getFileState(id)&&handler._clearXhrs&&handler._clearXhrs(id),connectionManager.free(id)},getProxyOrBlob:function(id){return handler.getProxy&&handler.getProxy(id)||handler.getFile&&handler.getFile(id)},initHandler:function(){var handlerType=namespace?qq[namespace]:qq.traditional,handlerModuleSubtype=qq.supportedFeatures.ajaxUploading?"Xhr":"Form";handler=new handlerType[handlerModuleSubtype+"UploadHandler"](options,{getDataByUuid:options.getDataByUuid,getName:options.getName,getSize:options.getSize,getUuid:options.getUuid,log:log,onCancel:options.onCancel,onProgress:options.onProgress,onUuidChanged:options.onUuidChanged}),handler._removeExpiredChunkingRecords&&handler._removeExpiredChunkingRecords()},isDeferredEligibleForUpload:function(id){return options.isQueued(id)},maybeDefer:function(id,blob){return blob&&!handler.getFile(id)&&blob instanceof qq.BlobProxy?(options.onUploadPrep(id),log("Attempting to generate a blob on-demand for "+id),blob.create().then(function(generatedBlob){log("Generated an on-demand blob for "+id),handler.updateBlob(id,generatedBlob),options.setSize(id,generatedBlob.size),handler.reevaluateChunking(id),upload.maybeSendDeferredFiles(id)},function(errorMessage){var errorResponse={};errorMessage&&(errorResponse.error=errorMessage),log(qq.format("Failed to generate blob for ID {}.  Error message: {}.",id,errorMessage),"error"),options.onComplete(id,options.getName(id),qq.extend(errorResponse,preventRetryResponse),null),upload.maybeSendDeferredFiles(id),connectionManager.free(id)}),!1):upload.maybeSendDeferredFiles(id)},maybeSendDeferredFiles:function(id){var idsInGroup=options.getIdsInProxyGroup(id),uploadedThisId=!1;return idsInGroup&&idsInGroup.length?(log("Maybe ready to upload proxy group file "+id),qq.each(idsInGroup,function(idx,idInGroup){if(upload.isDeferredEligibleForUpload(idInGroup)&&handler.getFile(idInGroup))uploadedThisId=idInGroup===id,upload.now(idInGroup);else if(upload.isDeferredEligibleForUpload(idInGroup))return!1})):(uploadedThisId=!0,upload.now(id)),uploadedThisId},maybeNewUuid:function(id,response){void 0!==response.newUuid&&options.onUuidChanged(id,response.newUuid)},normalizeResponse:function(originalResponse,successful){var response=originalResponse;return qq.isObject(originalResponse)||(response={},qq.isString(originalResponse)&&!successful&&(response.error=originalResponse)),response.success=successful,response},now:function(id){var name=options.getName(id);if(!controller.isValid(id))throw new qq.Error(id+" is not a valid file ID to upload!");options.onUpload(id,name),chunkingPossible&&handler._shouldChunkThisFile(id)?chunked.sendNext(id):simple.send(id,name)},start:function(id){var blobToUpload=upload.getProxyOrBlob(id);return blobToUpload?upload.maybeDefer(id,blobToUpload):(upload.now(id),!0)}};qq.extend(this,{add:function(id,file){handler.add.apply(this,arguments)},upload:function(id){return!!connectionManager.open(id)&&upload.start(id)},retry:function(id){return concurrentChunkingPossible&&(handler._getFileState(id).temp.ignoreFailure=!1),connectionManager.isUsingConnection(id)?upload.start(id):controller.upload(id)},cancel:function(id){var cancelRetVal=handler.cancel(id);qq.isGenericPromise(cancelRetVal)?cancelRetVal.then(function(){upload.cancel(id)}):!1!==cancelRetVal&&upload.cancel(id)},cancelAll:function(){var i,waitingOrConnected=connectionManager.getWaitingOrConnected();if(waitingOrConnected.length)for(i=waitingOrConnected.length-1;i>=0;i--)controller.cancel(waitingOrConnected[i]);connectionManager.reset()},getFile:function(id){return handler.getProxy&&handler.getProxy(id)?handler.getProxy(id).referenceBlob:handler.getFile&&handler.getFile(id)},isProxied:function(id){return!(!handler.getProxy||!handler.getProxy(id))},getInput:function(id){if(handler.getInput)return handler.getInput(id)},reset:function(){log("Resetting upload handler"),controller.cancelAll(),connectionManager.reset(),handler.reset()},expunge:function(id){if(controller.isValid(id))return handler.expunge(id)},isValid:function(id){return handler.isValid(id)},getResumableFilesData:function(){return handler.getResumableFilesData?handler.getResumableFilesData():[]},getThirdPartyFileId:function(id){if(controller.isValid(id))return handler.getThirdPartyFileId(id)},pause:function(id){return!!(controller.isResumable(id)&&handler.pause&&controller.isValid(id)&&handler.pause(id))&&(connectionManager.free(id),handler.moveInProgressToRemaining(id),!0)},isResumable:function(id){return!!handler.isResumable&&handler.isResumable(id)}}),qq.extend(options,o),log=options.log,chunkingPossible=options.chunking.enabled&&qq.supportedFeatures.chunking,concurrentChunkingPossible=chunkingPossible&&options.chunking.concurrent.enabled,preventRetryResponse=function(){var response={};return response[options.preventRetryParam]=!0,response}(),upload.initHandler()},qq.WindowReceiveMessage=function(o){"use strict";var options={log:function(message,level){}},callbackWrapperDetachers={};qq.extend(options,o),qq.extend(this,{receiveMessage:function(id,callback){var onMessageCallbackWrapper=function(event){callback(event.data)};window.postMessage?callbackWrapperDetachers[id]=qq(window).attach("message",onMessageCallbackWrapper):log("iframe message passing not supported in this browser!","error")},stopReceivingMessages:function(id){if(window.postMessage){var detacher=callbackWrapperDetachers[id];detacher&&detacher()}}})},qq.FormUploadHandler=function(spec){"use strict";function expungeFile(id){delete detachLoadEvents[id],isCors&&(clearTimeout(postMessageCallbackTimers[id]),delete postMessageCallbackTimers[id],corsMessageReceiver.stopReceivingMessages(id));var iframe=document.getElementById(handler._getIframeName(id));iframe&&(iframe.setAttribute("src","javascript:false;"),qq(iframe).remove())}function getFileIdForIframeName(iframeName){return iframeName.split("_")[0]}function initIframeForUpload(name){var iframe=qq.toElement("<iframe src='javascript:false;' name='"+name+"' />");return iframe.setAttribute("id",name),iframe.style.display="none",document.body.appendChild(iframe),iframe}function registerPostMessageCallback(iframe,callback){var iframeName=iframe.id,fileId=getFileIdForIframeName(iframeName),uuid=getUuid(fileId);onloadCallbacks[uuid]=callback,detachLoadEvents[fileId]=qq(iframe).attach("load",function(){handler.getInput(fileId)&&(log("Received iframe load event for CORS upload request (iframe name "+iframeName+")"),postMessageCallbackTimers[iframeName]=setTimeout(function(){var errorMessage="No valid message received from loaded iframe for iframe name "+iframeName;log(errorMessage,"error"),callback({error:errorMessage})},1e3))}),corsMessageReceiver.receiveMessage(iframeName,function(message){log("Received the following window message: '"+message+"'");var onloadCallback,response=(getFileIdForIframeName(iframeName),handler._parseJsonResponse(message)),uuid=response.uuid;uuid&&onloadCallbacks[uuid]?(log("Handling response for iframe name "+iframeName),clearTimeout(postMessageCallbackTimers[iframeName]),delete postMessageCallbackTimers[iframeName],handler._detachLoadEvent(iframeName),onloadCallback=onloadCallbacks[uuid],delete onloadCallbacks[uuid],corsMessageReceiver.stopReceivingMessages(iframeName),onloadCallback(response)):uuid||log("'"+message+"' does not contain a UUID - ignoring.")})}var options=spec.options,handler=this,proxy=spec.proxy,formHandlerInstanceId=qq.getUniqueId(),onloadCallbacks={},detachLoadEvents={},postMessageCallbackTimers={},isCors=options.isCors,inputName=options.inputName,getUuid=proxy.getUuid,log=proxy.log,corsMessageReceiver=new qq.WindowReceiveMessage({log:log});qq.extend(this,new qq.UploadHandler(spec)),qq.override(this,function(super_){return{add:function(id,fileInput){super_.add(id,{input:fileInput}),fileInput.setAttribute("name",inputName),fileInput.parentNode&&qq(fileInput).remove()},expunge:function(id){expungeFile(id),super_.expunge(id)},isValid:function(id){return super_.isValid(id)&&void 0!==handler._getFileState(id).input}}}),qq.extend(this,{getInput:function(id){return handler._getFileState(id).input},_attachLoadEvent:function(iframe,callback){var responseDescriptor;isCors?registerPostMessageCallback(iframe,callback):detachLoadEvents[iframe.id]=qq(iframe).attach("load",function(){if(log("Received response for "+iframe.id),iframe.parentNode){try{if(iframe.contentDocument&&iframe.contentDocument.body&&"false"==iframe.contentDocument.body.innerHTML)return}catch(error){log("Error when attempting to access iframe during handling of upload response ("+error.message+")","error"),responseDescriptor={success:!1}}callback(responseDescriptor)}})},_createIframe:function(id){return initIframeForUpload(handler._getIframeName(id))},_detachLoadEvent:function(id){void 0!==detachLoadEvents[id]&&(detachLoadEvents[id](),delete detachLoadEvents[id])},_getIframeName:function(fileId){return fileId+"_"+formHandlerInstanceId},_initFormForUpload:function(spec){var method=spec.method,endpoint=spec.endpoint,params=spec.params,paramsInBody=spec.paramsInBody,targetName=spec.targetName,form=qq.toElement("<form method='"+method+"' enctype='multipart/form-data'></form>"),url=endpoint;return paramsInBody?qq.obj2Inputs(params,form):url=qq.obj2url(params,endpoint),form.setAttribute("action",url),form.setAttribute("target",targetName),form.style.display="none",document.body.appendChild(form),form},_parseJsonResponse:function(innerHtmlOrMessage){var response={};try{response=qq.parseJson(innerHtmlOrMessage)}catch(error){log("Error when attempting to parse iframe upload response ("+error.message+")","error")}return response}})},qq.XhrUploadHandler=function(spec){"use strict";function abort(id){qq.each(handler._getXhrs(id),function(xhrId,xhr){var ajaxRequester=handler._getAjaxRequester(id,xhrId);xhr.onreadystatechange=null,xhr.upload.onprogress=null,xhr.abort(),ajaxRequester&&ajaxRequester.canceled&&ajaxRequester.canceled(id)})}var handler=this,namespace=spec.options.namespace,proxy=spec.proxy,chunking=spec.options.chunking,resume=spec.options.resume,chunkFiles=chunking&&spec.options.chunking.enabled&&qq.supportedFeatures.chunking,resumeEnabled=resume&&spec.options.resume.enabled&&chunkFiles&&qq.supportedFeatures.resume,getName=proxy.getName,getSize=proxy.getSize,getUuid=proxy.getUuid,getEndpoint=proxy.getEndpoint,getDataByUuid=proxy.getDataByUuid,onUuidChanged=proxy.onUuidChanged,onProgress=proxy.onProgress,log=proxy.log;qq.extend(this,new qq.UploadHandler(spec)),qq.override(this,function(super_){return{add:function(id,blobOrProxy){if(qq.isFile(blobOrProxy)||qq.isBlob(blobOrProxy))super_.add(id,{file:blobOrProxy});else{if(!(blobOrProxy instanceof qq.BlobProxy))throw new Error("Passed obj is not a File, Blob, or proxy");super_.add(id,{proxy:blobOrProxy})}handler._initTempState(id),resumeEnabled&&handler._maybePrepareForResume(id)},expunge:function(id){abort(id),handler._maybeDeletePersistedChunkData(id),handler._clearXhrs(id),super_.expunge(id)}}}),qq.extend(this,{clearCachedChunk:function(id,chunkIdx){delete handler._getFileState(id).temp.cachedChunks[chunkIdx]},clearXhr:function(id,chunkIdx){var tempState=handler._getFileState(id).temp;tempState.xhrs&&delete tempState.xhrs[chunkIdx],tempState.ajaxRequesters&&delete tempState.ajaxRequesters[chunkIdx]},finalizeChunks:function(id,responseParser){var lastChunkIdx=handler._getTotalChunks(id)-1,xhr=handler._getXhr(id,lastChunkIdx);return responseParser?(new qq.Promise).success(responseParser(xhr),xhr):(new qq.Promise).success({},xhr)},getFile:function(id){return handler.isValid(id)&&handler._getFileState(id).file},getProxy:function(id){return handler.isValid(id)&&handler._getFileState(id).proxy},getResumableFilesData:function(){var resumableFilesData=[];return handler._iterateResumeRecords(function(key,uploadData){handler.moveInProgressToRemaining(null,uploadData.chunking.inProgress,uploadData.chunking.remaining);var data={name:uploadData.name,remaining:uploadData.chunking.remaining,size:uploadData.size,uuid:uploadData.uuid};uploadData.key&&(data.key=uploadData.key),resumableFilesData.push(data)}),resumableFilesData},isResumable:function(id){return!!chunking&&handler.isValid(id)&&!handler._getFileState(id).notResumable},moveInProgressToRemaining:function(id,optInProgress,optRemaining){var inProgress=optInProgress||handler._getFileState(id).chunking.inProgress,remaining=optRemaining||handler._getFileState(id).chunking.remaining;inProgress&&(log(qq.format("Moving these chunks from in-progress {}, to remaining.",JSON.stringify(inProgress))),inProgress.reverse(),qq.each(inProgress,function(idx,chunkIdx){remaining.unshift(chunkIdx)}),inProgress.length=0)},pause:function(id){if(handler.isValid(id))return log(qq.format("Aborting XHR upload for {} '{}' due to pause instruction.",id,getName(id))),handler._getFileState(id).paused=!0,abort(id),!0},reevaluateChunking:function(id){if(chunking&&handler.isValid(id)){var totalChunks,i,state=handler._getFileState(id);if(delete state.chunking,state.chunking={},(totalChunks=handler._getTotalChunks(id))>1||chunking.mandatory){for(state.chunking.enabled=!0,state.chunking.parts=totalChunks,state.chunking.remaining=[],i=0;i<totalChunks;i++)state.chunking.remaining.push(i);handler._initTempState(id)}else state.chunking.enabled=!1}},updateBlob:function(id,newBlob){handler.isValid(id)&&(handler._getFileState(id).file=newBlob)},_clearXhrs:function(id){var tempState=handler._getFileState(id).temp;qq.each(tempState.ajaxRequesters,function(chunkId){delete tempState.ajaxRequesters[chunkId]}),qq.each(tempState.xhrs,function(chunkId){delete tempState.xhrs[chunkId]})},_createXhr:function(id,optChunkIdx){return handler._registerXhr(id,optChunkIdx,qq.createXhrInstance())},_getAjaxRequester:function(id,optChunkIdx){var chunkIdx=null==optChunkIdx?-1:optChunkIdx;return handler._getFileState(id).temp.ajaxRequesters[chunkIdx]},_getChunkData:function(id,chunkIndex){var chunkSize=chunking.partSize,fileSize=getSize(id),fileOrBlob=handler.getFile(id),startBytes=chunkSize*chunkIndex,endBytes=startBytes+chunkSize>=fileSize?fileSize:startBytes+chunkSize,totalChunks=handler._getTotalChunks(id),cachedChunks=this._getFileState(id).temp.cachedChunks,blob=cachedChunks[chunkIndex]||qq.sliceBlob(fileOrBlob,startBytes,endBytes);return cachedChunks[chunkIndex]=blob,{part:chunkIndex,start:startBytes,end:endBytes,count:totalChunks,blob:blob,size:endBytes-startBytes}},_getChunkDataForCallback:function(chunkData){return{partIndex:chunkData.part,startByte:chunkData.start+1,endByte:chunkData.end,totalParts:chunkData.count}},_getLocalStorageId:function(id){var name=getName(id),size=getSize(id),chunkSize=chunking.partSize,endpoint=getEndpoint(id);return qq.format("qq{}resume{}-{}-{}-{}-{}",namespace,"5.0",name,size,chunkSize,endpoint)},_getMimeType:function(id){return handler.getFile(id).type},_getPersistableData:function(id){return handler._getFileState(id).chunking},_getTotalChunks:function(id){if(chunking){var fileSize=getSize(id),chunkSize=chunking.partSize;return Math.ceil(fileSize/chunkSize)}},_getXhr:function(id,optChunkIdx){var chunkIdx=null==optChunkIdx?-1:optChunkIdx;return handler._getFileState(id).temp.xhrs[chunkIdx]},_getXhrs:function(id){return handler._getFileState(id).temp.xhrs},_iterateResumeRecords:function(callback){resumeEnabled&&qq.each(localStorage,function(key,item){if(0===key.indexOf(qq.format("qq{}resume",namespace))){var uploadData=JSON.parse(item);callback(key,uploadData)}})},_initTempState:function(id){handler._getFileState(id).temp={ajaxRequesters:{},chunkProgress:{},xhrs:{},cachedChunks:{}}},_markNotResumable:function(id){handler._getFileState(id).notResumable=!0},_maybeDeletePersistedChunkData:function(id){var localStorageId;return!!(resumeEnabled&&handler.isResumable(id)&&(localStorageId=handler._getLocalStorageId(id))&&localStorage.getItem(localStorageId))&&(localStorage.removeItem(localStorageId),!0)},_maybePrepareForResume:function(id){var localStorageId,persistedData,state=handler._getFileState(id);resumeEnabled&&void 0===state.key&&(localStorageId=handler._getLocalStorageId(id),(persistedData=localStorage.getItem(localStorageId))&&(persistedData=JSON.parse(persistedData),getDataByUuid(persistedData.uuid)?handler._markNotResumable(id):(log(qq.format("Identified file with ID {} and name of {} as resumable.",id,getName(id))),onUuidChanged(id,persistedData.uuid),state.key=persistedData.key,state.chunking=persistedData.chunking,state.loaded=persistedData.loaded,state.attemptingResume=!0,handler.moveInProgressToRemaining(id))))},_maybePersistChunkedState:function(id){var localStorageId,persistedData,state=handler._getFileState(id);if(resumeEnabled&&handler.isResumable(id)){localStorageId=handler._getLocalStorageId(id),persistedData={name:getName(id),size:getSize(id),uuid:getUuid(id),key:state.key,chunking:state.chunking,loaded:state.loaded,lastUpdated:Date.now()};try{localStorage.setItem(localStorageId,JSON.stringify(persistedData))}catch(error){log(qq.format("Unable to save resume data for '{}' due to error: '{}'.",id,error.toString()),"warn")}}},_registerProgressHandler:function(id,chunkIdx,chunkSize){var xhr=handler._getXhr(id,chunkIdx),name=getName(id),progressCalculator={simple:function(loaded,total){var fileSize=getSize(id);loaded===total?onProgress(id,name,fileSize,fileSize):onProgress(id,name,loaded>=fileSize?fileSize-1:loaded,fileSize)},chunked:function(loaded,total){var chunkProgress=handler._getFileState(id).temp.chunkProgress,totalSuccessfullyLoadedForFile=handler._getFileState(id).loaded,loadedForRequest=loaded,totalForRequest=total,totalFileSize=getSize(id),estActualChunkLoaded=loadedForRequest-(totalForRequest-chunkSize),totalLoadedForFile=totalSuccessfullyLoadedForFile;chunkProgress[chunkIdx]=estActualChunkLoaded,qq.each(chunkProgress,function(chunkIdx,chunkLoaded){totalLoadedForFile+=chunkLoaded}),onProgress(id,name,totalLoadedForFile,totalFileSize)}};xhr.upload.onprogress=function(e){if(e.lengthComputable){progressCalculator[null==chunkSize?"simple":"chunked"](e.loaded,e.total)}}},_registerXhr:function(id,optChunkIdx,xhr,optAjaxRequester){var xhrsId=null==optChunkIdx?-1:optChunkIdx,tempState=handler._getFileState(id).temp;return tempState.xhrs=tempState.xhrs||{},tempState.ajaxRequesters=tempState.ajaxRequesters||{},tempState.xhrs[xhrsId]=xhr,optAjaxRequester&&(tempState.ajaxRequesters[xhrsId]=optAjaxRequester),xhr},_removeExpiredChunkingRecords:function(){var expirationDays=resume.recordsExpireIn;handler._iterateResumeRecords(function(key,uploadData){var expirationDate=new Date(uploadData.lastUpdated);expirationDate.setDate(expirationDate.getDate()+expirationDays),expirationDate.getTime()<=Date.now()&&(log("Removing expired resume record with key "+key),localStorage.removeItem(key))})},_shouldChunkThisFile:function(id){var state=handler._getFileState(id);return state.chunking||handler.reevaluateChunking(id),state.chunking.enabled}})},qq.DeleteFileAjaxRequester=function(o){"use strict";function getMandatedParams(){return"POST"===options.method.toUpperCase()?{_method:"DELETE"}:{}}var requester,options={method:"DELETE",uuidParamName:"qquuid",endpointStore:{},maxConnections:3,customHeaders:function(id){return{}},paramsStore:{},cors:{expected:!1,
sendCredentials:!1},log:function(str,level){},onDelete:function(id){},onDeleteComplete:function(id,xhrOrXdr,isError){}};qq.extend(options,o),requester=qq.extend(this,new qq.AjaxRequester({acceptHeader:"application/json",validMethods:["POST","DELETE"],method:options.method,endpointStore:options.endpointStore,paramsStore:options.paramsStore,mandatedParams:getMandatedParams(),maxConnections:options.maxConnections,customHeaders:function(id){return options.customHeaders.get(id)},log:options.log,onSend:options.onDelete,onComplete:options.onDeleteComplete,cors:options.cors})),qq.extend(this,{sendDelete:function(id,uuid,additionalMandatedParams){var additionalOptions=additionalMandatedParams||{};options.log("Submitting delete file request for "+id),"DELETE"===options.method?requester.initTransport(id).withPath(uuid).withParams(additionalOptions).send():(additionalOptions[options.uuidParamName]=uuid,requester.initTransport(id).withParams(additionalOptions).send())}})},function(){function detectSubsampling(img){var ctx,iw=img.naturalWidth,ih=img.naturalHeight,canvas=document.createElement("canvas");return iw*ih>1048576&&(canvas.width=canvas.height=1,ctx=canvas.getContext("2d"),ctx.drawImage(img,1-iw,0),0===ctx.getImageData(0,0,1,1).data[3])}function detectVerticalSquash(img,iw,ih){var ctx,data,alpha,ratio,canvas=document.createElement("canvas"),sy=0,ey=ih,py=ih;for(canvas.width=1,canvas.height=ih,ctx=canvas.getContext("2d"),ctx.drawImage(img,0,0),data=ctx.getImageData(0,0,1,ih).data;py>sy;)alpha=data[4*(py-1)+3],0===alpha?ey=py:sy=py,py=ey+sy>>1;return ratio=py/ih,0===ratio?1:ratio}function renderImageToDataURL(img,blob,options,doSquash){var canvas=document.createElement("canvas"),mime=options.mime||"image/jpeg",promise=new qq.Promise;return renderImageToCanvas(img,blob,canvas,options,doSquash).then(function(){promise.success(canvas.toDataURL(mime,options.quality||.8))}),promise}function maybeCalculateDownsampledDimensions(spec){var maxPixels=5241e3;if(!qq.ios())throw new qq.Error("Downsampled dimensions can only be reliably calculated for iOS!");if(spec.origHeight*spec.origWidth>maxPixels)return{newHeight:Math.round(Math.sqrt(maxPixels*(spec.origHeight/spec.origWidth))),newWidth:Math.round(Math.sqrt(maxPixels*(spec.origWidth/spec.origHeight)))}}function renderImageToCanvas(img,blob,canvas,options,doSquash){var modifiedDimensions,iw=img.naturalWidth,ih=img.naturalHeight,width=options.width,height=options.height,ctx=canvas.getContext("2d"),promise=new qq.Promise;return ctx.save(),options.resize?renderImageToCanvasWithCustomResizer({blob:blob,canvas:canvas,image:img,imageHeight:ih,imageWidth:iw,orientation:options.orientation,resize:options.resize,targetHeight:height,targetWidth:width}):(qq.supportedFeatures.unlimitedScaledImageSize||(modifiedDimensions=maybeCalculateDownsampledDimensions({origWidth:width,origHeight:height}))&&(qq.log(qq.format("Had to reduce dimensions due to device limitations from {}w / {}h to {}w / {}h",width,height,modifiedDimensions.newWidth,modifiedDimensions.newHeight),"warn"),width=modifiedDimensions.newWidth,height=modifiedDimensions.newHeight),transformCoordinate(canvas,width,height,options.orientation),qq.ios()?function(){detectSubsampling(img)&&(iw/=2,ih/=2);var tmpCtx,sx,dx,d=1024,tmpCanvas=document.createElement("canvas"),vertSquashRatio=doSquash?detectVerticalSquash(img,iw,ih):1,dw=Math.ceil(d*width/iw),dh=Math.ceil(d*height/ih/vertSquashRatio),sy=0,dy=0;for(tmpCanvas.width=tmpCanvas.height=d,tmpCtx=tmpCanvas.getContext("2d");sy<ih;){for(sx=0,dx=0;sx<iw;)tmpCtx.clearRect(0,0,d,d),tmpCtx.drawImage(img,-sx,-sy),ctx.drawImage(tmpCanvas,0,0,d,d,dx,dy,dw,dh),sx+=d,dx+=dw;sy+=d,dy+=dh}ctx.restore(),tmpCanvas=tmpCtx=null}():ctx.drawImage(img,0,0,width,height),canvas.qqImageRendered&&canvas.qqImageRendered(),promise.success(),promise)}function renderImageToCanvasWithCustomResizer(resizeInfo){var blob=resizeInfo.blob,image=resizeInfo.image,imageHeight=resizeInfo.imageHeight,imageWidth=resizeInfo.imageWidth,orientation=resizeInfo.orientation,promise=new qq.Promise,resize=resizeInfo.resize,sourceCanvas=document.createElement("canvas"),sourceCanvasContext=sourceCanvas.getContext("2d"),targetCanvas=resizeInfo.canvas,targetHeight=resizeInfo.targetHeight,targetWidth=resizeInfo.targetWidth;return transformCoordinate(sourceCanvas,imageWidth,imageHeight,orientation),targetCanvas.height=targetHeight,targetCanvas.width=targetWidth,sourceCanvasContext.drawImage(image,0,0),resize({blob:blob,height:targetHeight,image:image,sourceCanvas:sourceCanvas,targetCanvas:targetCanvas,width:targetWidth}).then(function(){targetCanvas.qqImageRendered&&targetCanvas.qqImageRendered(),promise.success()},promise.failure),promise}function transformCoordinate(canvas,width,height,orientation){switch(orientation){case 5:case 6:case 7:case 8:canvas.width=height,canvas.height=width;break;default:canvas.width=width,canvas.height=height}var ctx=canvas.getContext("2d");switch(orientation){case 2:ctx.translate(width,0),ctx.scale(-1,1);break;case 3:ctx.translate(width,height),ctx.rotate(Math.PI);break;case 4:ctx.translate(0,height),ctx.scale(1,-1);break;case 5:ctx.rotate(.5*Math.PI),ctx.scale(1,-1);break;case 6:ctx.rotate(.5*Math.PI),ctx.translate(0,-height);break;case 7:ctx.rotate(.5*Math.PI),ctx.translate(width,-height),ctx.scale(-1,1);break;case 8:ctx.rotate(-.5*Math.PI),ctx.translate(-width,0)}}function MegaPixImage(srcImage,errorCallback){var self=this;window.Blob&&srcImage instanceof Blob&&function(){var img=new Image,URL=window.URL&&window.URL.createObjectURL?window.URL:window.webkitURL&&window.webkitURL.createObjectURL?window.webkitURL:null;if(!URL)throw Error("No createObjectURL function found to create blob url");img.src=URL.createObjectURL(srcImage),self.blob=srcImage,srcImage=img}(),srcImage.naturalWidth||srcImage.naturalHeight||(srcImage.onload=function(){var listeners=self.imageLoadListeners;listeners&&(self.imageLoadListeners=null,setTimeout(function(){for(var i=0,len=listeners.length;i<len;i++)listeners[i]()},0))},srcImage.onerror=errorCallback,this.imageLoadListeners=[]),this.srcImage=srcImage}MegaPixImage.prototype.render=function(target,options){options=options||{};var opt,self=this,imgWidth=this.srcImage.naturalWidth,imgHeight=this.srcImage.naturalHeight,width=options.width,height=options.height,maxWidth=options.maxWidth,maxHeight=options.maxHeight,doSquash=!this.blob||"image/jpeg"===this.blob.type,tagName=target.tagName.toLowerCase();if(this.imageLoadListeners)return void this.imageLoadListeners.push(function(){self.render(target,options)});width&&!height?height=imgHeight*width/imgWidth<<0:height&&!width?width=imgWidth*height/imgHeight<<0:(width=imgWidth,height=imgHeight),maxWidth&&width>maxWidth&&(width=maxWidth,height=imgHeight*width/imgWidth<<0),maxHeight&&height>maxHeight&&(height=maxHeight,width=imgWidth*height/imgHeight<<0),opt={width:width,height:height},qq.each(options,function(optionsKey,optionsValue){opt[optionsKey]=optionsValue}),"img"===tagName?function(){var oldTargetSrc=target.src;renderImageToDataURL(self.srcImage,self.blob,opt,doSquash).then(function(dataUri){target.src=dataUri,oldTargetSrc===target.src&&target.onload()})}():"canvas"===tagName&&renderImageToCanvas(this.srcImage,this.blob,target,opt,doSquash),"function"==typeof this.onrender&&this.onrender(target)},qq.MegaPixImage=MegaPixImage}(),qq.ImageGenerator=function(log){"use strict";function isImg(el){return"img"===el.tagName.toLowerCase()}function isCanvas(el){return"canvas"===el.tagName.toLowerCase()}function isImgCorsSupported(){return void 0!==(new Image).crossOrigin}function isCanvasSupported(){var canvas=document.createElement("canvas");return canvas.getContext&&canvas.getContext("2d")}function determineMimeOfFileName(nameWithPath){var pathSegments=nameWithPath.split("/"),name=pathSegments[pathSegments.length-1].split("?")[0],extension=qq.getExtension(name);switch(extension=extension&&extension.toLowerCase()){case"jpeg":case"jpg":return"image/jpeg";case"png":return"image/png";case"bmp":return"image/bmp";case"gif":return"image/gif";case"tiff":case"tif":return"image/tiff"}}function isCrossOrigin(url){var targetProtocol,targetHostname,targetPort,targetAnchor=document.createElement("a");return targetAnchor.href=url,targetProtocol=targetAnchor.protocol,targetPort=targetAnchor.port,targetHostname=targetAnchor.hostname,targetProtocol.toLowerCase()!==window.location.protocol.toLowerCase()||(targetHostname.toLowerCase()!==window.location.hostname.toLowerCase()||targetPort!==window.location.port&&!qq.ie())}function registerImgLoadListeners(img,promise){img.onload=function(){img.onload=null,img.onerror=null,promise.success(img)},img.onerror=function(){img.onload=null,img.onerror=null,log("Problem drawing thumbnail!","error"),promise.failure(img,"Problem drawing thumbnail!")}}function registerCanvasDrawImageListener(canvas,promise){canvas.qqImageRendered=function(){promise.success(canvas)}}function registerThumbnailRenderedListener(imgOrCanvas,promise){var registered=isImg(imgOrCanvas)||isCanvas(imgOrCanvas);return isImg(imgOrCanvas)?registerImgLoadListeners(imgOrCanvas,promise):isCanvas(imgOrCanvas)?registerCanvasDrawImageListener(imgOrCanvas,promise):(promise.failure(imgOrCanvas),log(qq.format("Element container of type {} is not supported!",imgOrCanvas.tagName),"error")),registered}function draw(fileOrBlob,container,options){var drawPreview=new qq.Promise,identifier=new qq.Identify(fileOrBlob,log),maxSize=options.maxSize,orient=null==options.orient||options.orient,megapixErrorHandler=function(){container.onerror=null,container.onload=null,log("Could not render preview, file may be too large!","error"),drawPreview.failure(container,"Browser cannot render image!")};return identifier.isPreviewable().then(function(mime){var dummyExif={parse:function(){return(new qq.Promise).success()}},exif=orient?new qq.Exif(fileOrBlob,log):dummyExif,mpImg=new qq.MegaPixImage(fileOrBlob,megapixErrorHandler);registerThumbnailRenderedListener(container,drawPreview)&&exif.parse().then(function(exif){var orientation=exif&&exif.Orientation;mpImg.render(container,{maxWidth:maxSize,maxHeight:maxSize,orientation:orientation,mime:mime,resize:options.customResizeFunction})},function(failureMsg){log(qq.format("EXIF data could not be parsed ({}).  Assuming orientation = 1.",failureMsg)),mpImg.render(container,{maxWidth:maxSize,maxHeight:maxSize,mime:mime,resize:options.customResizeFunction})})},function(){log("Not previewable"),drawPreview.failure(container,"Not previewable")}),drawPreview}function drawOnCanvasOrImgFromUrl(url,canvasOrImg,draw,maxSize,customResizeFunction){var tempImg=new Image,tempImgRender=new qq.Promise;registerThumbnailRenderedListener(tempImg,tempImgRender),isCrossOrigin(url)&&(tempImg.crossOrigin="anonymous"),tempImg.src=url,tempImgRender.then(function(){registerThumbnailRenderedListener(canvasOrImg,draw),new qq.MegaPixImage(tempImg).render(canvasOrImg,{maxWidth:maxSize,maxHeight:maxSize,mime:determineMimeOfFileName(url),resize:customResizeFunction})},draw.failure)}function drawOnImgFromUrlWithCssScaling(url,img,draw,maxSize){registerThumbnailRenderedListener(img,draw),qq(img).css({maxWidth:maxSize+"px",maxHeight:maxSize+"px"}),img.src=url}function drawFromUrl(url,container,options){var draw=new qq.Promise,scale=options.scale,maxSize=scale?options.maxSize:null;return scale&&isImg(container)?isCanvasSupported()?isCrossOrigin(url)&&!isImgCorsSupported()?drawOnImgFromUrlWithCssScaling(url,container,draw,maxSize):drawOnCanvasOrImgFromUrl(url,container,draw,maxSize):drawOnImgFromUrlWithCssScaling(url,container,draw,maxSize):isCanvas(container)?drawOnCanvasOrImgFromUrl(url,container,draw,maxSize):registerThumbnailRenderedListener(container,draw)&&(container.src=url),draw}qq.extend(this,{generate:function(fileBlobOrUrl,container,options){return qq.isString(fileBlobOrUrl)?(log("Attempting to update thumbnail based on server response."),drawFromUrl(fileBlobOrUrl,container,options||{})):(log("Attempting to draw client-side image preview."),draw(fileBlobOrUrl,container,options||{}))}}),this._testing={},this._testing.isImg=isImg,this._testing.isCanvas=isCanvas,this._testing.isCrossOrigin=isCrossOrigin,this._testing.determineMimeOfFileName=determineMimeOfFileName},qq.Exif=function(fileOrBlob,log){"use strict";function parseLittleEndian(hex){for(var result=0,pow=0;hex.length>0;)result+=parseInt(hex.substring(0,2),16)*Math.pow(2,pow),hex=hex.substring(2,hex.length),pow+=8;return result}function seekToApp1(offset,promise){var theOffset=offset,thePromise=promise;return void 0===theOffset&&(theOffset=2,thePromise=new qq.Promise),qq.readBlobToHex(fileOrBlob,theOffset,4).then(function(hex){var segmentLength,match=/^ffe([0-9])/.exec(hex);match?"1"!==match[1]?(segmentLength=parseInt(hex.slice(4,8),16),seekToApp1(theOffset+segmentLength+2,thePromise)):thePromise.success(theOffset):thePromise.failure("No EXIF header to be found!")}),thePromise}function getApp1Offset(){var promise=new qq.Promise;return qq.readBlobToHex(fileOrBlob,0,6).then(function(hex){0!==hex.indexOf("ffd8")?promise.failure("Not a valid JPEG!"):seekToApp1().then(function(offset){promise.success(offset)},function(error){promise.failure(error)})}),promise}function isLittleEndian(app1Start){var promise=new qq.Promise;return qq.readBlobToHex(fileOrBlob,app1Start+10,2).then(function(hex){promise.success("4949"===hex)}),promise}function getDirEntryCount(app1Start,littleEndian){var promise=new qq.Promise;return qq.readBlobToHex(fileOrBlob,app1Start+18,2).then(function(hex){if(littleEndian)return promise.success(parseLittleEndian(hex));promise.success(parseInt(hex,16))}),promise}function getIfd(app1Start,dirEntries){var offset=app1Start+20,bytes=12*dirEntries;return qq.readBlobToHex(fileOrBlob,offset,bytes)}function getDirEntries(ifdHex){for(var entries=[],offset=0;offset+24<=ifdHex.length;)entries.push(ifdHex.slice(offset,offset+24)),offset+=24;return entries}function getTagValues(littleEndian,dirEntries){var TAG_VAL_OFFSET=16,tagsToFind=qq.extend([],TAG_IDS),vals={};return qq.each(dirEntries,function(idx,entry){var tagValHex,tagName,tagValLength,idHex=entry.slice(0,4),id=littleEndian?parseLittleEndian(idHex):parseInt(idHex,16),tagsToFindIdx=tagsToFind.indexOf(id);if(tagsToFindIdx>=0&&(tagName=TAG_INFO[id].name,tagValLength=TAG_INFO[id].bytes,tagValHex=entry.slice(TAG_VAL_OFFSET,TAG_VAL_OFFSET+2*tagValLength),vals[tagName]=littleEndian?parseLittleEndian(tagValHex):parseInt(tagValHex,16),tagsToFind.splice(tagsToFindIdx,1)),0===tagsToFind.length)return!1}),vals}var TAG_IDS=[274],TAG_INFO={274:{name:"Orientation",bytes:2}};qq.extend(this,{parse:function(){var parser=new qq.Promise,onParseFailure=function(message){log(qq.format("EXIF header parse failed: '{}' ",message)),parser.failure(message)};return getApp1Offset().then(function(app1Offset){log(qq.format("Moving forward with EXIF header parsing for '{}'",void 0===fileOrBlob.name?"blob":fileOrBlob.name)),isLittleEndian(app1Offset).then(function(littleEndian){log(qq.format("EXIF Byte order is {} endian",littleEndian?"little":"big")),getDirEntryCount(app1Offset,littleEndian).then(function(dirEntryCount){log(qq.format("Found {} APP1 directory entries",dirEntryCount)),getIfd(app1Offset,dirEntryCount).then(function(ifdHex){var dirEntries=getDirEntries(ifdHex),tagValues=getTagValues(littleEndian,dirEntries);log("Successfully parsed some EXIF tags"),parser.success(tagValues)},onParseFailure)},onParseFailure)},onParseFailure)},onParseFailure),parser}}),this._testing={},this._testing.parseLittleEndian=parseLittleEndian},qq.Identify=function(fileOrBlob,log){"use strict";function isIdentifiable(magicBytes,questionableBytes){var identifiable=!1,magicBytesEntries=[].concat(magicBytes);return qq.each(magicBytesEntries,function(idx,magicBytesArrayEntry){if(0===questionableBytes.indexOf(magicBytesArrayEntry))return identifiable=!0,!1}),identifiable}qq.extend(this,{isPreviewable:function(){var self=this,identifier=new qq.Promise,previewable=!1,name=void 0===fileOrBlob.name?"blob":fileOrBlob.name;return log(qq.format("Attempting to determine if {} can be rendered in this browser",name)),log("First pass: check type attribute of blob object."),this.isPreviewableSync()?(log("Second pass: check for magic bytes in file header."),qq.readBlobToHex(fileOrBlob,0,4).then(function(hex){qq.each(self.PREVIEWABLE_MIME_TYPES,function(mime,bytes){if(isIdentifiable(bytes,hex))return("image/tiff"!==mime||qq.supportedFeatures.tiffPreviews)&&(previewable=!0,identifier.success(mime)),!1}),log(qq.format("'{}' is {} able to be rendered in this browser",name,previewable?"":"NOT")),previewable||identifier.failure()},function(){log("Error reading file w/ name '"+name+"'.  Not able to be rendered in this browser."),identifier.failure()})):identifier.failure(),identifier},isPreviewableSync:function(){var fileMime=fileOrBlob.type,isRecognizedImage=qq.indexOf(Object.keys(this.PREVIEWABLE_MIME_TYPES),fileMime)>=0,previewable=!1,name=void 0===fileOrBlob.name?"blob":fileOrBlob.name;return isRecognizedImage&&(previewable="image/tiff"!==fileMime||qq.supportedFeatures.tiffPreviews),!previewable&&log(name+" is not previewable in this browser per the blob's type attr"),previewable}})},qq.Identify.prototype.PREVIEWABLE_MIME_TYPES={"image/jpeg":"ffd8ff","image/gif":"474946","image/png":"89504e","image/bmp":"424d","image/tiff":["49492a00","4d4d002a"]},qq.ImageValidation=function(blob,log){"use strict";function hasNonZeroLimits(limits){var atLeastOne=!1;return qq.each(limits,function(limit,value){if(value>0)return atLeastOne=!0,!1}),atLeastOne}function getWidthHeight(){var sizeDetermination=new qq.Promise;return new qq.Identify(blob,log).isPreviewable().then(function(){var image=new Image,url=window.URL&&window.URL.createObjectURL?window.URL:window.webkitURL&&window.webkitURL.createObjectURL?window.webkitURL:null;url?(image.onerror=function(){log("Cannot determine dimensions for image.  May be too large.","error"),sizeDetermination.failure()},image.onload=function(){sizeDetermination.success({width:this.width,height:this.height})},image.src=url.createObjectURL(blob)):(log("No createObjectURL function available to generate image URL!","error"),sizeDetermination.failure())},sizeDetermination.failure),sizeDetermination}function getFailingLimit(limits,dimensions){var failingLimit;return qq.each(limits,function(limitName,limitValue){if(limitValue>0){var limitMatcher=/(max|min)(Width|Height)/.exec(limitName),dimensionPropName=limitMatcher[2].charAt(0).toLowerCase()+limitMatcher[2].slice(1),actualValue=dimensions[dimensionPropName];switch(limitMatcher[1]){case"min":if(actualValue<limitValue)return failingLimit=limitName,!1;break;case"max":if(actualValue>limitValue)return failingLimit=limitName,!1}}}),failingLimit}this.validate=function(limits){var validationEffort=new qq.Promise;return log("Attempting to validate image."),hasNonZeroLimits(limits)?getWidthHeight().then(function(dimensions){var failingLimit=getFailingLimit(limits,dimensions);failingLimit?validationEffort.failure(failingLimit):validationEffort.success()},validationEffort.success):validationEffort.success(),validationEffort}},qq.Session=function(spec){"use strict";function isJsonResponseValid(response){if(qq.isArray(response))return!0;options.log("Session response is not an array.","error")}function handleFileItems(fileItems,success,xhrOrXdr,promise){var someItemsIgnored=!1;success=success&&isJsonResponseValid(fileItems),success&&qq.each(fileItems,function(idx,fileItem){if(null==fileItem.uuid)someItemsIgnored=!0,options.log(qq.format("Session response item {} did not include a valid UUID - ignoring.",idx),"error");else if(null==fileItem.name)someItemsIgnored=!0,options.log(qq.format("Session response item {} did not include a valid name - ignoring.",idx),"error");else try{return options.addFileRecord(fileItem),!0}catch(err){someItemsIgnored=!0,options.log(err.message,"error")}return!1}),promise[success&&!someItemsIgnored?"success":"failure"](fileItems,xhrOrXdr)}var options={endpoint:null,params:{},customHeaders:{},cors:{},addFileRecord:function(sessionData){},log:function(message,level){}};qq.extend(options,spec,!0),this.refresh=function(){var refreshEffort=new qq.Promise,refreshCompleteCallback=function(response,success,xhrOrXdr){handleFileItems(response,success,xhrOrXdr,refreshEffort)},requesterOptions=qq.extend({},options);return new qq.SessionAjaxRequester(qq.extend(requesterOptions,{onComplete:refreshCompleteCallback})).queryServer(),refreshEffort}},qq.SessionAjaxRequester=function(spec){"use strict";function onComplete(id,xhrOrXdr,isError){var response=null;if(null!=xhrOrXdr.responseText)try{response=qq.parseJson(xhrOrXdr.responseText)}catch(err){options.log("Problem parsing session response: "+err.message,"error"),isError=!0}options.onComplete(response,!isError,xhrOrXdr)}var requester,options={endpoint:null,customHeaders:{},params:{},cors:{expected:!1,sendCredentials:!1},onComplete:function(response,success,xhrOrXdr){},log:function(str,level){}};qq.extend(options,spec),requester=qq.extend(this,new qq.AjaxRequester({acceptHeader:"application/json",validMethods:["GET"],method:"GET",endpointStore:{get:function(){return options.endpoint}},customHeaders:options.customHeaders,log:options.log,onComplete:onComplete,cors:options.cors})),qq.extend(this,{queryServer:function(){var params=qq.extend({},options.params);options.log("Session query request."),requester.initTransport("sessionRefresh").withParams(params).withCacheBuster().send()}})},qq.Scaler=function(spec,log){"use strict";var customResizeFunction=spec.customResizer,includeOriginal=spec.sendOriginal,orient=spec.orient,defaultType=spec.defaultType,defaultQuality=spec.defaultQuality/100,failedToScaleText=spec.failureText,includeExif=spec.includeExif,sizes=this._getSortedSizes(spec.sizes);qq.extend(this,{enabled:qq.supportedFeatures.scaling&&sizes.length>0,getFileRecords:function(originalFileUuid,originalFileName,originalBlobOrBlobData){var self=this,records=[],originalBlob=originalBlobOrBlobData.blob?originalBlobOrBlobData.blob:originalBlobOrBlobData;return new qq.Identify(originalBlob,log).isPreviewableSync()?(qq.each(sizes,function(idx,sizeRecord){var outputType=self._determineOutputType({defaultType:defaultType,requestedType:sizeRecord.type,refType:originalBlob.type});records.push({uuid:qq.getUniqueId(),name:self._getName(originalFileName,{name:sizeRecord.name,type:outputType,refType:originalBlob.type}),blob:new qq.BlobProxy(originalBlob,qq.bind(self._generateScaledImage,self,{customResizeFunction:customResizeFunction,maxSize:sizeRecord.maxSize,orient:orient,type:outputType,quality:defaultQuality,failedText:failedToScaleText,includeExif:includeExif,log:log}))})}),records.push({uuid:originalFileUuid,name:originalFileName,size:originalBlob.size,blob:includeOriginal?originalBlob:null})):records.push({uuid:originalFileUuid,name:originalFileName,size:originalBlob.size,blob:originalBlob}),records},handleNewFile:function(file,name,uuid,size,fileList,batchId,uuidParamName,api){var self=this,scaledIds=(file.qqButtonId||file.blob&&file.blob.qqButtonId,[]),originalId=null,addFileToHandler=api.addFileToHandler,uploadData=api.uploadData,paramsStore=api.paramsStore,proxyGroupId=qq.getUniqueId();qq.each(self.getFileRecords(uuid,name,file),function(idx,record){var id,blobSize=record.size;record.blob instanceof qq.BlobProxy&&(blobSize=-1),id=uploadData.addFile({uuid:record.uuid,name:record.name,size:blobSize,batchId:batchId,proxyGroupId:proxyGroupId}),record.blob instanceof qq.BlobProxy?scaledIds.push(id):originalId=id,record.blob?(addFileToHandler(id,record.blob),fileList.push({id:id,file:record.blob})):uploadData.setStatus(id,qq.status.REJECTED)}),null!==originalId&&(qq.each(scaledIds,function(idx,scaledId){var params={qqparentuuid:uploadData.retrieve({id:originalId}).uuid,qqparentsize:uploadData.retrieve({id:originalId}).size};params[uuidParamName]=uploadData.retrieve({id:scaledId}).uuid,uploadData.setParentId(scaledId,originalId),paramsStore.addReadOnly(scaledId,params)}),scaledIds.length&&function(){var param={};param[uuidParamName]=uploadData.retrieve({id:originalId}).uuid,paramsStore.addReadOnly(originalId,param)}())}})},qq.extend(qq.Scaler.prototype,{scaleImage:function(id,specs,api){"use strict";if(!qq.supportedFeatures.scaling)throw new qq.Error("Scaling is not supported in this browser!");var scalingEffort=new qq.Promise,log=api.log,file=api.getFile(id),uploadData=api.uploadData.retrieve({id:id}),name=uploadData&&uploadData.name,uuid=uploadData&&uploadData.uuid,scalingOptions={customResizer:specs.customResizer,sendOriginal:!1,orient:specs.orient,defaultType:specs.type||null,defaultQuality:specs.quality,failedToScaleText:"Unable to scale",sizes:[{name:"",maxSize:specs.maxSize}]},scaler=new qq.Scaler(scalingOptions,log);return qq.Scaler&&qq.supportedFeatures.imagePreviews&&file?qq.bind(function(){var record=scaler.getFileRecords(uuid,name,file)[0];record&&record.blob instanceof qq.BlobProxy?record.blob.create().then(scalingEffort.success,scalingEffort.failure):(log(id+" is not a scalable image!","error"),scalingEffort.failure())},this)():(scalingEffort.failure(),log("Could not generate requested scaled image for "+id+".  Scaling is either not possible in this browser, or the file could not be located.","error")),scalingEffort},_determineOutputType:function(spec){"use strict";var requestedType=spec.requestedType,defaultType=spec.defaultType,referenceType=spec.refType;return defaultType||requestedType?requestedType&&qq.indexOf(Object.keys(qq.Identify.prototype.PREVIEWABLE_MIME_TYPES),requestedType)>=0?"image/tiff"===requestedType?qq.supportedFeatures.tiffPreviews?requestedType:defaultType:requestedType:defaultType:"image/jpeg"!==referenceType?"image/png":referenceType},_getName:function(originalName,scaledVersionProperties){"use strict";var startOfExt=originalName.lastIndexOf("."),versionType=scaledVersionProperties.type||"image/png",referenceType=scaledVersionProperties.refType,scaledName="",scaledExt=qq.getExtension(originalName),nameAppendage="";return scaledVersionProperties.name&&scaledVersionProperties.name.trim().length&&(nameAppendage=" ("+scaledVersionProperties.name+")"),startOfExt>=0?(scaledName=originalName.substr(0,startOfExt),referenceType!==versionType&&(scaledExt=versionType.split("/")[1]),scaledName+=nameAppendage+"."+scaledExt):scaledName=originalName+nameAppendage,scaledName},_getSortedSizes:function(sizes){"use strict";return sizes=qq.extend([],sizes),sizes.sort(function(a,b){return a.maxSize>b.maxSize?1:a.maxSize<b.maxSize?-1:0})},_generateScaledImage:function(spec,sourceFile){"use strict";var self=this,customResizeFunction=spec.customResizeFunction,log=spec.log,maxSize=spec.maxSize,orient=spec.orient,type=spec.type,quality=spec.quality,failedText=spec.failedText,includeExif=spec.includeExif&&"image/jpeg"===sourceFile.type&&"image/jpeg"===type,scalingEffort=new qq.Promise,imageGenerator=new qq.ImageGenerator(log),canvas=document.createElement("canvas");return log("Attempting to generate scaled version for "+sourceFile.name),imageGenerator.generate(sourceFile,canvas,{maxSize:maxSize,orient:orient,customResizeFunction:customResizeFunction}).then(function(){var scaledImageDataUri=canvas.toDataURL(type,quality),signalSuccess=function(){log("Success generating scaled version for "+sourceFile.name);var blob=qq.dataUriToBlob(scaledImageDataUri);scalingEffort.success(blob)};includeExif?self._insertExifHeader(sourceFile,scaledImageDataUri,log).then(function(scaledImageDataUriWithExif){scaledImageDataUri=scaledImageDataUriWithExif,signalSuccess()},function(){log("Problem inserting EXIF header into scaled image.  Using scaled image w/out EXIF data.","error"),signalSuccess()}):signalSuccess()},function(){log("Failed attempt to generate scaled version for "+sourceFile.name,"error"),scalingEffort.failure(failedText)}),scalingEffort},_insertExifHeader:function(originalImage,scaledImageDataUri,log){"use strict";var reader=new FileReader,insertionEffort=new qq.Promise,originalImageDataUri="";return reader.onload=function(){originalImageDataUri=reader.result,insertionEffort.success(qq.ExifRestorer.restore(originalImageDataUri,scaledImageDataUri))},reader.onerror=function(){log("Problem reading "+originalImage.name+" during attempt to transfer EXIF data to scaled version.","error"),insertionEffort.failure()},reader.readAsDataURL(originalImage),insertionEffort},_dataUriToBlob:function(dataUri){"use strict";var byteString,mimeString,arrayBuffer,intArray;return byteString=dataUri.split(",")[0].indexOf("base64")>=0?atob(dataUri.split(",")[1]):decodeURI(dataUri.split(",")[1]),mimeString=dataUri.split(",")[0].split(":")[1].split(";")[0],arrayBuffer=new ArrayBuffer(byteString.length),intArray=new Uint8Array(arrayBuffer),qq.each(byteString,function(idx,character){intArray[idx]=character.charCodeAt(0)}),this._createBlob(arrayBuffer,mimeString)},_createBlob:function(data,mime){"use strict";var BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,blobBuilder=BlobBuilder&&new BlobBuilder;return blobBuilder?(blobBuilder.append(data),blobBuilder.getBlob(mime)):new Blob([data],{type:mime})}}),qq.ExifRestorer=function(){var ExifRestorer={};return ExifRestorer.KEY_STR="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",ExifRestorer.encode64=function(input){var chr1,chr2,enc1,enc2,enc3,output="",chr3="",enc4="",i=0;do{chr1=input[i++],chr2=input[i++],chr3=input[i++],enc1=chr1>>2,enc2=(3&chr1)<<4|chr2>>4,enc3=(15&chr2)<<2|chr3>>6,enc4=63&chr3,isNaN(chr2)?enc3=enc4=64:isNaN(chr3)&&(enc4=64),output=output+this.KEY_STR.charAt(enc1)+this.KEY_STR.charAt(enc2)+this.KEY_STR.charAt(enc3)+this.KEY_STR.charAt(enc4),chr1=chr2=chr3="",enc1=enc2=enc3=enc4=""}while(i<input.length);return output},ExifRestorer.restore=function(origFileBase64,resizedFileBase64){var expectedBase64Header="data:image/jpeg;base64,";if(!origFileBase64.match(expectedBase64Header))return resizedFileBase64;var rawImage=this.decode64(origFileBase64.replace(expectedBase64Header,"")),segments=this.slice2Segments(rawImage),image=this.exifManipulation(resizedFileBase64,segments);return expectedBase64Header+this.encode64(image)},ExifRestorer.exifManipulation=function(resizedFileBase64,segments){var exifArray=this.getExifArray(segments),newImageArray=this.insertExif(resizedFileBase64,exifArray);return new Uint8Array(newImageArray)},ExifRestorer.getExifArray=function(segments){for(var seg,x=0;x<segments.length;x++)if(seg=segments[x],255==seg[0]&225==seg[1])return seg;return[]},ExifRestorer.insertExif=function(resizedFileBase64,exifArray){var imageData=resizedFileBase64.replace("data:image/jpeg;base64,",""),buf=this.decode64(imageData),separatePoint=buf.indexOf(255,3),mae=buf.slice(0,separatePoint),ato=buf.slice(separatePoint),array=mae;return array=array.concat(exifArray),array=array.concat(ato)},ExifRestorer.slice2Segments=function(rawImageArray){for(var head=0,segments=[];;){if(255==rawImageArray[head]&218==rawImageArray[head+1])break;if(255==rawImageArray[head]&216==rawImageArray[head+1])head+=2;else{var length=256*rawImageArray[head+2]+rawImageArray[head+3],endPoint=head+length+2,seg=rawImageArray.slice(head,endPoint);segments.push(seg),head=endPoint}if(head>rawImageArray.length)break}return segments},ExifRestorer.decode64=function(input){var chr1,chr2,enc1,enc2,enc3,chr3="",enc4="",i=0,buf=[];if(/[^A-Za-z0-9\+\/\=]/g.exec(input))throw new Error("There were invalid base64 characters in the input text.  Valid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='");input=input.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{enc1=this.KEY_STR.indexOf(input.charAt(i++)),enc2=this.KEY_STR.indexOf(input.charAt(i++)),enc3=this.KEY_STR.indexOf(input.charAt(i++)),enc4=this.KEY_STR.indexOf(input.charAt(i++)),chr1=enc1<<2|enc2>>4,chr2=(15&enc2)<<4|enc3>>2,chr3=(3&enc3)<<6|enc4,buf.push(chr1),64!=enc3&&buf.push(chr2),64!=enc4&&buf.push(chr3),chr1=chr2=chr3="",enc1=enc2=enc3=enc4=""}while(i<input.length);return buf},
ExifRestorer}(),qq.TotalProgress=function(callback,getSize){"use strict";var perFileProgress={},totalLoaded=0,totalSize=0,lastLoadedSent=-1,lastTotalSent=-1,callbackProxy=function(loaded,total){loaded===lastLoadedSent&&total===lastTotalSent||callback(loaded,total),lastLoadedSent=loaded,lastTotalSent=total},noRetryableFiles=function(failed,retryable){var none=!0;return qq.each(failed,function(idx,failedId){if(qq.indexOf(retryable,failedId)>=0)return none=!1,!1}),none},onCancel=function(id){updateTotalProgress(id,-1,-1),delete perFileProgress[id]},onAllComplete=function(successful,failed,retryable){(0===failed.length||noRetryableFiles(failed,retryable))&&(callbackProxy(totalSize,totalSize),this.reset())},onNew=function(id){var size=getSize(id);size>0&&(updateTotalProgress(id,0,size),perFileProgress[id]={loaded:0,total:size})},updateTotalProgress=function(id,newLoaded,newTotal){var oldLoaded=perFileProgress[id]?perFileProgress[id].loaded:0,oldTotal=perFileProgress[id]?perFileProgress[id].total:0;-1===newLoaded&&-1===newTotal?(totalLoaded-=oldLoaded,totalSize-=oldTotal):(newLoaded&&(totalLoaded+=newLoaded-oldLoaded),newTotal&&(totalSize+=newTotal-oldTotal)),callbackProxy(totalLoaded,totalSize)};qq.extend(this,{onAllComplete:onAllComplete,onStatusChange:function(id,oldStatus,newStatus){newStatus===qq.status.CANCELED||newStatus===qq.status.REJECTED?onCancel(id):newStatus===qq.status.SUBMITTING&&onNew(id)},onIndividualProgress:function(id,loaded,total){updateTotalProgress(id,loaded,total),perFileProgress[id]={loaded:loaded,total:total}},onNewSize:function(id){onNew(id)},reset:function(){perFileProgress={},totalLoaded=0,totalSize=0}})},qq.PasteSupport=function(o){"use strict";function isImage(item){return item.type&&0===item.type.indexOf("image/")}function registerPasteHandler(){detachPasteHandler=qq(options.targetElement).attach("paste",function(event){var clipboardData=event.clipboardData;clipboardData&&qq.each(clipboardData.items,function(idx,item){if(isImage(item)){var blob=item.getAsFile();options.callbacks.pasteReceived(blob)}})})}function unregisterPasteHandler(){detachPasteHandler&&detachPasteHandler()}var options,detachPasteHandler;options={targetElement:null,callbacks:{log:function(message,level){},pasteReceived:function(blob){}}},qq.extend(options,o),registerPasteHandler(),qq.extend(this,{reset:function(){unregisterPasteHandler()}})},qq.FormSupport=function(options,startUpload,log){"use strict";function determineNewEndpoint(formEl){formEl.getAttribute("action")&&(self.newEndpoint=formEl.getAttribute("action"))}function validateForm(formEl,nativeSubmit){if(!formEl.checkValidity||formEl.checkValidity())return!0;log("Form did not pass validation checks - will not upload.","error"),nativeSubmit()}function maybeUploadOnSubmit(formEl){var nativeSubmit=formEl.submit;qq(formEl).attach("submit",function(event){event=event||window.event,event.preventDefault?event.preventDefault():event.returnValue=!1,validateForm(formEl,nativeSubmit)&&startUpload()}),formEl.submit=function(){validateForm(formEl,nativeSubmit)&&startUpload()}}function determineFormEl(formEl){return formEl&&(qq.isString(formEl)&&(formEl=document.getElementById(formEl)),formEl&&(log("Attaching to form element."),determineNewEndpoint(formEl),interceptSubmit&&maybeUploadOnSubmit(formEl))),formEl}var self=this,interceptSubmit=options.interceptSubmit,formEl=options.element,autoUpload=options.autoUpload;qq.extend(this,{newEndpoint:null,newAutoUpload:autoUpload,attachedToForm:!1,getFormInputsAsObject:function(){return null==formEl?null:self._form2Obj(formEl)}}),formEl=determineFormEl(formEl),this.attachedToForm=!!formEl},qq.extend(qq.FormSupport.prototype,{_form2Obj:function(form){"use strict";var obj={},notIrrelevantType=function(type){var irrelevantTypes=["button","image","reset","submit"];return qq.indexOf(irrelevantTypes,type.toLowerCase())<0},radioOrCheckbox=function(type){return qq.indexOf(["checkbox","radio"],type.toLowerCase())>=0},ignoreValue=function(el){return!(!radioOrCheckbox(el.type)||el.checked)||el.disabled&&"hidden"!==el.type.toLowerCase()},selectValue=function(select){var value=null;return qq.each(qq(select).children(),function(idx,child){if("option"===child.tagName.toLowerCase()&&child.selected)return value=child.value,!1}),value};return qq.each(form.elements,function(idx,el){if(!qq.isInput(el,!0)&&"textarea"!==el.tagName.toLowerCase()||!notIrrelevantType(el.type)||ignoreValue(el)){if("select"===el.tagName.toLowerCase()&&!ignoreValue(el)){var value=selectValue(el);null!==value&&(obj[el.name]=value)}}else obj[el.name]=el.value}),obj}}),qq.traditional=qq.traditional||{},qq.traditional.FormUploadHandler=function(options,proxy){"use strict";function getIframeContentJson(id,iframe){var response,doc,innerHtml;try{doc=iframe.contentDocument||iframe.contentWindow.document,innerHtml=doc.body.innerHTML,log("converting iframe's innerHTML to JSON"),log("innerHTML = "+innerHtml),innerHtml&&innerHtml.match(/^<pre/i)&&(innerHtml=doc.body.firstChild.firstChild.nodeValue),response=handler._parseJsonResponse(innerHtml)}catch(error){log("Error when attempting to parse form upload response ("+error.message+")","error"),response={success:!1}}return response}function createForm(id,iframe){var params=options.paramsStore.get(id),method="get"===options.method.toLowerCase()?"GET":"POST",endpoint=options.endpointStore.get(id),name=getName(id);return params[options.uuidName]=getUuid(id),params[options.filenameParam]=name,handler._initFormForUpload({method:method,endpoint:endpoint,params:params,paramsInBody:options.paramsInBody,targetName:iframe.name})}var handler=this,getName=proxy.getName,getUuid=proxy.getUuid,log=proxy.log;this.uploadFile=function(id){var form,input=handler.getInput(id),iframe=handler._createIframe(id),promise=new qq.Promise;return form=createForm(id,iframe),form.appendChild(input),handler._attachLoadEvent(iframe,function(responseFromMessage){log("iframe loaded");var response=responseFromMessage||getIframeContentJson(id,iframe);handler._detachLoadEvent(id),options.cors.expected||qq(iframe).remove(),response.success?promise.success(response):promise.failure(response)}),log("Sending upload request for "+id),form.submit(),qq(form).remove(),promise},qq.extend(this,new qq.FormUploadHandler({options:{isCors:options.cors.expected,inputName:options.inputName},proxy:{onCancel:options.onCancel,getName:getName,getUuid:getUuid,log:log}}))},qq.traditional=qq.traditional||{},qq.traditional.XhrUploadHandler=function(spec,proxy){"use strict";var handler=this,getName=proxy.getName,getSize=proxy.getSize,getUuid=proxy.getUuid,log=proxy.log,multipart=spec.forceMultipart||spec.paramsInBody,addChunkingSpecificParams=function(id,params,chunkData){var size=getSize(id),name=getName(id);params[spec.chunking.paramNames.partIndex]=chunkData.part,params[spec.chunking.paramNames.partByteOffset]=chunkData.start,params[spec.chunking.paramNames.chunkSize]=chunkData.size,params[spec.chunking.paramNames.totalParts]=chunkData.count,params[spec.totalFileSizeName]=size,multipart&&(params[spec.filenameParam]=name)},allChunksDoneRequester=new qq.traditional.AllChunksDoneAjaxRequester({cors:spec.cors,endpoint:spec.chunking.success.endpoint,log:log}),createReadyStateChangedHandler=function(id,xhr){var promise=new qq.Promise;return xhr.onreadystatechange=function(){if(4===xhr.readyState){var result=onUploadOrChunkComplete(id,xhr);result.success?promise.success(result.response,xhr):promise.failure(result.response,xhr)}},promise},getChunksCompleteParams=function(id){var params=spec.paramsStore.get(id),name=getName(id),size=getSize(id);return params[spec.uuidName]=getUuid(id),params[spec.filenameParam]=name,params[spec.totalFileSizeName]=size,params[spec.chunking.paramNames.totalParts]=handler._getTotalChunks(id),params},isErrorUploadResponse=function(xhr,response){return qq.indexOf([200,201,202,203,204],xhr.status)<0||!response.success||response.reset},onUploadOrChunkComplete=function(id,xhr){var response;return log("xhr - server response received for "+id),log("responseText = "+xhr.responseText),response=parseResponse(!0,xhr),{success:!isErrorUploadResponse(xhr,response),response:response}},parseResponse=function(upload,xhr){var response={};try{log(qq.format("Received response status {} with body: {}",xhr.status,xhr.responseText)),response=qq.parseJson(xhr.responseText)}catch(error){upload&&log("Error when attempting to parse xhr response text ("+error.message+")","error")}return response},sendChunksCompleteRequest=function(id){var promise=new qq.Promise;return allChunksDoneRequester.complete(id,handler._createXhr(id),getChunksCompleteParams(id),spec.customHeaders.get(id)).then(function(xhr){promise.success(parseResponse(!1,xhr),xhr)},function(xhr){promise.failure(parseResponse(!1,xhr),xhr)}),promise},setParamsAndGetEntityToSend=function(params,xhr,fileOrBlob,id){var formData=new FormData,method=spec.method,endpoint=spec.endpointStore.get(id),name=getName(id),size=getSize(id);return params[spec.uuidName]=getUuid(id),params[spec.filenameParam]=name,multipart&&(params[spec.totalFileSizeName]=size),spec.paramsInBody||(multipart||(params[spec.inputName]=name),endpoint=qq.obj2url(params,endpoint)),xhr.open(method,endpoint,!0),spec.cors.expected&&spec.cors.sendCredentials&&(xhr.withCredentials=!0),multipart?(spec.paramsInBody&&qq.obj2FormData(params,formData),formData.append(spec.inputName,fileOrBlob),formData):fileOrBlob},setUploadHeaders=function(id,xhr){var extraHeaders=spec.customHeaders.get(id),fileOrBlob=handler.getFile(id);xhr.setRequestHeader("Accept","application/json"),xhr.setRequestHeader("X-Requested-With","XMLHttpRequest"),xhr.setRequestHeader("Cache-Control","no-cache"),multipart||(xhr.setRequestHeader("Content-Type","application/octet-stream"),xhr.setRequestHeader("X-Mime-Type",fileOrBlob.type)),qq.each(extraHeaders,function(name,val){xhr.setRequestHeader(name,val)})};qq.extend(this,{uploadChunk:function(id,chunkIdx,resuming){var promise,toSend,params,chunkData=handler._getChunkData(id,chunkIdx),xhr=handler._createXhr(id,chunkIdx);getSize(id);return promise=createReadyStateChangedHandler(id,xhr),handler._registerProgressHandler(id,chunkIdx,chunkData.size),params=spec.paramsStore.get(id),addChunkingSpecificParams(id,params,chunkData),resuming&&(params[spec.resume.paramNames.resuming]=!0),toSend=setParamsAndGetEntityToSend(params,xhr,chunkData.blob,id),setUploadHeaders(id,xhr),xhr.send(toSend),promise},uploadFile:function(id){var promise,xhr,params,toSend,fileOrBlob=handler.getFile(id);return xhr=handler._createXhr(id),handler._registerProgressHandler(id),promise=createReadyStateChangedHandler(id,xhr),params=spec.paramsStore.get(id),toSend=setParamsAndGetEntityToSend(params,xhr,fileOrBlob,id),setUploadHeaders(id,xhr),xhr.send(toSend),promise}}),qq.extend(this,new qq.XhrUploadHandler({options:qq.extend({namespace:"traditional"},spec),proxy:qq.extend({getEndpoint:spec.endpointStore.get},proxy)})),qq.override(this,function(super_){return{finalizeChunks:function(id){return spec.chunking.success.endpoint?sendChunksCompleteRequest(id):super_.finalizeChunks(id,qq.bind(parseResponse,this,!0))}}})},qq.traditional.AllChunksDoneAjaxRequester=function(o){"use strict";var requester,method="POST",options={cors:{allowXdr:!1,expected:!1,sendCredentials:!1},endpoint:null,log:function(str,level){}},promises={},endpointHandler={get:function(id){return options.endpoint}};qq.extend(options,o),requester=qq.extend(this,new qq.AjaxRequester({acceptHeader:"application/json",validMethods:[method],method:method,endpointStore:endpointHandler,allowXRequestedWithAndCacheControl:!1,cors:options.cors,log:options.log,onComplete:function(id,xhr,isError){var promise=promises[id];delete promises[id],isError?promise.failure(xhr):promise.success(xhr)}})),qq.extend(this,{complete:function(id,xhr,params,headers){var promise=new qq.Promise;return options.log("Submitting All Chunks Done request for "+id),promises[id]=promise,requester.initTransport(id).withParams(params).withHeaders(headers).send(xhr),promise}})},qq.DragAndDrop=function(o){"use strict";function uploadDroppedFiles(files,uploadDropZone){var filesAsArray=Array.prototype.slice.call(files);options.callbacks.dropLog("Grabbed "+files.length+" dropped files."),uploadDropZone.dropDisabled(!1),options.callbacks.processingDroppedFilesComplete(filesAsArray,uploadDropZone.getElement())}function traverseFileTree(entry){var parseEntryPromise=new qq.Promise;return entry.isFile?entry.file(function(file){var name=entry.name,fullPath=entry.fullPath,indexOfNameInFullPath=fullPath.indexOf(name);fullPath=fullPath.substr(0,indexOfNameInFullPath),"/"===fullPath.charAt(0)&&(fullPath=fullPath.substr(1)),file.qqPath=fullPath,droppedFiles.push(file),parseEntryPromise.success()},function(fileError){options.callbacks.dropLog("Problem parsing '"+entry.fullPath+"'.  FileError code "+fileError.code+".","error"),parseEntryPromise.failure()}):entry.isDirectory&&getFilesInDirectory(entry).then(function(entries){var entriesLeft=entries.length;qq.each(entries,function(idx,entry){traverseFileTree(entry).done(function(){0===(entriesLeft-=1)&&parseEntryPromise.success()})}),entries.length||parseEntryPromise.success()},function(fileError){options.callbacks.dropLog("Problem parsing '"+entry.fullPath+"'.  FileError code "+fileError.code+".","error"),parseEntryPromise.failure()}),parseEntryPromise}function getFilesInDirectory(entry,reader,accumEntries,existingPromise){var promise=existingPromise||new qq.Promise,dirReader=reader||entry.createReader();return dirReader.readEntries(function(entries){var newEntries=accumEntries?accumEntries.concat(entries):entries;entries.length?setTimeout(function(){getFilesInDirectory(entry,dirReader,newEntries,promise)},0):promise.success(newEntries)},promise.failure),promise}function handleDataTransfer(dataTransfer,uploadDropZone){var pendingFolderPromises=[],handleDataTransferPromise=new qq.Promise;return options.callbacks.processingDroppedFiles(),uploadDropZone.dropDisabled(!0),dataTransfer.files.length>1&&!options.allowMultipleItems?(options.callbacks.processingDroppedFilesComplete([]),options.callbacks.dropError("tooManyFilesError",""),uploadDropZone.dropDisabled(!1),handleDataTransferPromise.failure()):(droppedFiles=[],qq.isFolderDropSupported(dataTransfer)?qq.each(dataTransfer.items,function(idx,item){var entry=item.webkitGetAsEntry();entry&&(entry.isFile?droppedFiles.push(item.getAsFile()):pendingFolderPromises.push(traverseFileTree(entry).done(function(){pendingFolderPromises.pop(),0===pendingFolderPromises.length&&handleDataTransferPromise.success()})))}):droppedFiles=dataTransfer.files,0===pendingFolderPromises.length&&handleDataTransferPromise.success()),handleDataTransferPromise}function setupDropzone(dropArea){var dropZone=new qq.UploadDropZone({HIDE_ZONES_EVENT_NAME:HIDE_ZONES_EVENT_NAME,element:dropArea,onEnter:function(e){qq(dropArea).addClass(options.classes.dropActive),e.stopPropagation()},onLeaveNotDescendants:function(e){qq(dropArea).removeClass(options.classes.dropActive)},onDrop:function(e){handleDataTransfer(e.dataTransfer,dropZone).then(function(){uploadDroppedFiles(droppedFiles,dropZone)},function(){options.callbacks.dropLog("Drop event DataTransfer parsing failed.  No files will be uploaded.","error")})}});return disposeSupport.addDisposer(function(){dropZone.dispose()}),qq(dropArea).hasAttribute(HIDE_BEFORE_ENTER_ATTR)&&qq(dropArea).hide(),uploadDropZones.push(dropZone),dropZone}function isFileDrag(dragEvent){var fileDrag;return qq.each(dragEvent.dataTransfer.types,function(key,val){if("Files"===val)return fileDrag=!0,!1}),fileDrag}function leavingDocumentOut(e){return qq.firefox()?!e.relatedTarget:qq.safari()?e.x<0||e.y<0:0===e.x&&0===e.y}function setupDragDrop(){var dropZones=options.dropZoneElements,maybeHideDropZones=function(){setTimeout(function(){qq.each(dropZones,function(idx,dropZone){qq(dropZone).hasAttribute(HIDE_BEFORE_ENTER_ATTR)&&qq(dropZone).hide(),qq(dropZone).removeClass(options.classes.dropActive)})},10)};qq.each(dropZones,function(idx,dropZone){var uploadDropZone=setupDropzone(dropZone);dropZones.length&&qq.supportedFeatures.fileDrop&&disposeSupport.attach(document,"dragenter",function(e){!uploadDropZone.dropDisabled()&&isFileDrag(e)&&qq.each(dropZones,function(idx,dropZone){dropZone instanceof HTMLElement&&qq(dropZone).hasAttribute(HIDE_BEFORE_ENTER_ATTR)&&qq(dropZone).css({display:"block"})})})}),disposeSupport.attach(document,"dragleave",function(e){leavingDocumentOut(e)&&maybeHideDropZones()}),disposeSupport.attach(qq(document).children()[0],"mouseenter",function(e){maybeHideDropZones()}),disposeSupport.attach(document,"drop",function(e){e.preventDefault(),maybeHideDropZones()}),disposeSupport.attach(document,HIDE_ZONES_EVENT_NAME,maybeHideDropZones)}var options,HIDE_ZONES_EVENT_NAME="qq-hidezones",HIDE_BEFORE_ENTER_ATTR="qq-hide-dropzone",uploadDropZones=[],droppedFiles=[],disposeSupport=new qq.DisposeSupport;options={dropZoneElements:[],allowMultipleItems:!0,classes:{dropActive:null},callbacks:new qq.DragAndDrop.callbacks},qq.extend(options,o,!0),setupDragDrop(),qq.extend(this,{setupExtraDropzone:function(element){options.dropZoneElements.push(element),setupDropzone(element)},removeDropzone:function(element){var i,dzs=options.dropZoneElements;for(i in dzs)if(dzs[i]===element)return dzs.splice(i,1)},dispose:function(){disposeSupport.dispose(),qq.each(uploadDropZones,function(idx,dropZone){dropZone.dispose()})}})},qq.DragAndDrop.callbacks=function(){"use strict";return{processingDroppedFiles:function(){},processingDroppedFilesComplete:function(files,targetEl){},dropError:function(code,errorSpecifics){qq.log("Drag & drop error code '"+code+" with these specifics: '"+errorSpecifics+"'","error")},dropLog:function(message,level){qq.log(message,level)}}},qq.UploadDropZone=function(o){"use strict";function dragoverShouldBeCanceled(){return qq.safari()||qq.firefox()&&qq.windows()}function disableDropOutside(e){dropOutsideDisabled||(dragoverShouldBeCanceled?disposeSupport.attach(document,"dragover",function(e){e.preventDefault()}):disposeSupport.attach(document,"dragover",function(e){e.dataTransfer&&(e.dataTransfer.dropEffect="none",e.preventDefault())}),dropOutsideDisabled=!0)}function isValidFileDrag(e){if(!qq.supportedFeatures.fileDrop)return!1;var effectTest,dt=e.dataTransfer,isSafari=qq.safari();return effectTest=!(!qq.ie()||!qq.supportedFeatures.fileDrop)||"none"!==dt.effectAllowed,dt&&effectTest&&(dt.files||!isSafari&&dt.types.contains&&dt.types.contains("Files"))}function isOrSetDropDisabled(isDisabled){return void 0!==isDisabled&&(preventDrop=isDisabled),preventDrop}function triggerHidezonesEvent(){function triggerUsingOldApi(){hideZonesEvent=document.createEvent("Event"),hideZonesEvent.initEvent(options.HIDE_ZONES_EVENT_NAME,!0,!0)}var hideZonesEvent;if(window.CustomEvent)try{hideZonesEvent=new CustomEvent(options.HIDE_ZONES_EVENT_NAME)}catch(err){triggerUsingOldApi()}else triggerUsingOldApi();document.dispatchEvent(hideZonesEvent)}function attachEvents(){disposeSupport.attach(element,"dragover",function(e){if(isValidFileDrag(e)){var effect=qq.ie()&&qq.supportedFeatures.fileDrop?null:e.dataTransfer.effectAllowed;e.dataTransfer.dropEffect="move"===effect||"linkMove"===effect?"move":"copy",e.stopPropagation(),e.preventDefault()}}),disposeSupport.attach(element,"dragenter",function(e){if(!isOrSetDropDisabled()){if(!isValidFileDrag(e))return;options.onEnter(e)}}),disposeSupport.attach(element,"dragleave",function(e){if(isValidFileDrag(e)){options.onLeave(e);var relatedTarget=document.elementFromPoint(e.clientX,e.clientY);qq(this).contains(relatedTarget)||options.onLeaveNotDescendants(e)}}),disposeSupport.attach(element,"drop",function(e){if(!isOrSetDropDisabled()){if(!isValidFileDrag(e))return;e.preventDefault(),e.stopPropagation(),options.onDrop(e),triggerHidezonesEvent()}})}var options,element,preventDrop,dropOutsideDisabled,disposeSupport=new qq.DisposeSupport;options={element:null,onEnter:function(e){},onLeave:function(e){},onLeaveNotDescendants:function(e){},onDrop:function(e){}},qq.extend(options,o),element=options.element,disableDropOutside(),attachEvents(),qq.extend(this,{dropDisabled:function(isDisabled){return isOrSetDropDisabled(isDisabled)},dispose:function(){disposeSupport.dispose()},getElement:function(){return element}})},function(){"use strict";qq.uiPublicApi={addInitialFiles:function(cannedFileList){this._parent.prototype.addInitialFiles.apply(this,arguments),this._templating.addCacheToDom()},clearStoredFiles:function(){this._parent.prototype.clearStoredFiles.apply(this,arguments),this._templating.clearFiles()},addExtraDropzone:function(element){this._dnd&&this._dnd.setupExtraDropzone(element)},removeExtraDropzone:function(element){if(this._dnd)return this._dnd.removeDropzone(element)},getItemByFileId:function(id){if(!this._templating.isHiddenForever(id))return this._templating.getFileContainer(id)},reset:function(){this._parent.prototype.reset.apply(this,arguments),this._templating.reset(),!this._options.button&&this._templating.getButton()&&(this._defaultButtonId=this._createUploadButton({element:this._templating.getButton(),title:this._options.text.fileInputTitle}).getButtonId()),this._dnd&&(this._dnd.dispose(),this._dnd=this._setupDragAndDrop()),this._totalFilesInBatch=0,this._filesInBatchAddedToUi=0,this._setupClickAndEditEventHandlers()},setName:function(id,newName){var formattedFilename=this._options.formatFileName(newName);this._parent.prototype.setName.apply(this,arguments),this._templating.updateFilename(id,formattedFilename)},pauseUpload:function(id){var paused=this._parent.prototype.pauseUpload.apply(this,arguments);return paused&&this._templating.uploadPaused(id),paused},continueUpload:function(id){var continued=this._parent.prototype.continueUpload.apply(this,arguments);return continued&&this._templating.uploadContinued(id),continued},getId:function(fileContainerOrChildEl){return this._templating.getFileId(fileContainerOrChildEl)},getDropTarget:function(fileId){return this.getFile(fileId).qqDropTarget}},qq.uiPrivateApi={_getButton:function(buttonId){var button=this._parent.prototype._getButton.apply(this,arguments);return button||buttonId===this._defaultButtonId&&(button=this._templating.getButton()),button},_removeFileItem:function(fileId){this._templating.removeFile(fileId)},_setupClickAndEditEventHandlers:function(){this._fileButtonsClickHandler=qq.FileButtonsClickHandler&&this._bindFileButtonsClickEvent(),this._focusinEventSupported=!qq.firefox(),this._isEditFilenameEnabled()&&(this._filenameClickHandler=this._bindFilenameClickEvent(),this._filenameInputFocusInHandler=this._bindFilenameInputFocusInEvent(),this._filenameInputFocusHandler=this._bindFilenameInputFocusEvent())},_setupDragAndDrop:function(){var self=this,dropZoneElements=this._options.dragAndDrop.extraDropzones,templating=this._templating,defaultDropZone=templating.getDropZone();return defaultDropZone&&dropZoneElements.push(defaultDropZone),new qq.DragAndDrop({dropZoneElements:dropZoneElements,allowMultipleItems:this._options.multiple,classes:{dropActive:this._options.classes.dropActive},callbacks:{processingDroppedFiles:function(){templating.showDropProcessing()},processingDroppedFilesComplete:function(files,targetEl){templating.hideDropProcessing(),qq.each(files,function(idx,file){file.qqDropTarget=targetEl}),files.length&&self.addFiles(files,null,null)},dropError:function(code,errorData){self._itemError(code,errorData)},dropLog:function(message,level){self.log(message,level)}}})},_bindFileButtonsClickEvent:function(){var self=this;return new qq.FileButtonsClickHandler({templating:this._templating,log:function(message,lvl){self.log(message,lvl)},onDeleteFile:function(fileId){self.deleteFile(fileId)},onCancel:function(fileId){self.cancel(fileId)},onRetry:function(fileId){self.retry(fileId)},onPause:function(fileId){self.pauseUpload(fileId)},onContinue:function(fileId){self.continueUpload(fileId)},onGetName:function(fileId){return self.getName(fileId)}})},_isEditFilenameEnabled:function(){return this._templating.isEditFilenamePossible()&&!this._options.autoUpload&&qq.FilenameClickHandler&&qq.FilenameInputFocusHandler&&qq.FilenameInputFocusHandler},_filenameEditHandler:function(){var self=this,templating=this._templating;return{templating:templating,log:function(message,lvl){self.log(message,lvl)},onGetUploadStatus:function(fileId){return self.getUploads({id:fileId}).status},onGetName:function(fileId){return self.getName(fileId)},onSetName:function(id,newName){self.setName(id,newName)},onEditingStatusChange:function(id,isEditing){var qqInput=qq(templating.getEditInput(id)),qqFileContainer=qq(templating.getFileContainer(id));isEditing?(qqInput.addClass("qq-editing"),templating.hideFilename(id),templating.hideEditIcon(id)):(qqInput.removeClass("qq-editing"),templating.showFilename(id),templating.showEditIcon(id)),qqFileContainer.addClass("qq-temp").removeClass("qq-temp")}}},_onUploadStatusChange:function(id,oldStatus,newStatus){this._parent.prototype._onUploadStatusChange.apply(this,arguments),this._isEditFilenameEnabled()&&this._templating.getFileContainer(id)&&newStatus!==qq.status.SUBMITTED&&(this._templating.markFilenameEditable(id),this._templating.hideEditIcon(id)),oldStatus===qq.status.UPLOAD_RETRYING&&newStatus===qq.status.UPLOADING?(this._templating.hideRetry(id),this._templating.setStatusText(id),qq(this._templating.getFileContainer(id)).removeClass(this._classes.retrying)):newStatus===qq.status.UPLOAD_FAILED&&this._templating.hidePause(id)},_bindFilenameInputFocusInEvent:function(){var spec=qq.extend({},this._filenameEditHandler());return new qq.FilenameInputFocusInHandler(spec)},_bindFilenameInputFocusEvent:function(){var spec=qq.extend({},this._filenameEditHandler());return new qq.FilenameInputFocusHandler(spec)},_bindFilenameClickEvent:function(){var spec=qq.extend({},this._filenameEditHandler());return new qq.FilenameClickHandler(spec)},_storeForLater:function(id){this._parent.prototype._storeForLater.apply(this,arguments),this._templating.hideSpinner(id)},_onAllComplete:function(successful,failed){this._parent.prototype._onAllComplete.apply(this,arguments),this._templating.resetTotalProgress()},_onSubmit:function(id,name){var file=this.getFile(id);file&&file.qqPath&&this._options.dragAndDrop.reportDirectoryPaths&&this._paramsStore.addReadOnly(id,{qqpath:file.qqPath}),this._parent.prototype._onSubmit.apply(this,arguments),this._addToList(id,name)},_onSubmitted:function(id){this._isEditFilenameEnabled()&&(this._templating.markFilenameEditable(id),this._templating.showEditIcon(id),this._focusinEventSupported||this._filenameInputFocusHandler.addHandler(this._templating.getEditInput(id)))},_onProgress:function(id,name,loaded,total){this._parent.prototype._onProgress.apply(this,arguments),this._templating.updateProgress(id,loaded,total),0===total||100===Math.round(loaded/total*100)?(this._templating.hideCancel(id),this._templating.hidePause(id),this._templating.hideProgress(id),this._templating.setStatusText(id,this._options.text.waitingForResponse),this._displayFileSize(id)):this._displayFileSize(id,loaded,total)},_onTotalProgress:function(loaded,total){this._parent.prototype._onTotalProgress.apply(this,arguments),this._templating.updateTotalProgress(loaded,total)},_onComplete:function(id,name,result,xhr){function completeUpload(result){fileContainer&&(templating.setStatusText(id),qq(fileContainer).removeClass(self._classes.retrying),templating.hideProgress(id),self.getUploads({id:id}).status!==qq.status.UPLOAD_FAILED&&templating.hideCancel(id),templating.hideSpinner(id),result.success?self._markFileAsSuccessful(id):(qq(fileContainer).addClass(self._classes.fail),templating.showCancel(id),templating.isRetryPossible()&&!self._preventRetries[id]&&(qq(fileContainer).addClass(self._classes.retryable),templating.showRetry(id)),self._controlFailureTextDisplay(id,result)))}var parentRetVal=this._parent.prototype._onComplete.apply(this,arguments),templating=this._templating,fileContainer=templating.getFileContainer(id),self=this;return parentRetVal instanceof qq.Promise?parentRetVal.done(function(newResult){completeUpload(newResult)}):completeUpload(result),parentRetVal},_markFileAsSuccessful:function(id){var templating=this._templating;this._isDeletePossible()&&templating.showDeleteButton(id),qq(templating.getFileContainer(id)).addClass(this._classes.success),this._maybeUpdateThumbnail(id)},_onUploadPrep:function(id){this._parent.prototype._onUploadPrep.apply(this,arguments),this._templating.showSpinner(id)},_onUpload:function(id,name){var parentRetVal=this._parent.prototype._onUpload.apply(this,arguments);return this._templating.showSpinner(id),parentRetVal},_onUploadChunk:function(id,chunkData){this._parent.prototype._onUploadChunk.apply(this,arguments),chunkData.partIndex>0&&this._handler.isResumable(id)&&this._templating.allowPause(id)},_onCancel:function(id,name){this._parent.prototype._onCancel.apply(this,arguments),this._removeFileItem(id),0===this._getNotFinished()&&this._templating.resetTotalProgress()},_onBeforeAutoRetry:function(id){var retryNumForDisplay,maxAuto,retryNote;this._parent.prototype._onBeforeAutoRetry.apply(this,arguments),this._showCancelLink(id),this._options.retry.showAutoRetryNote&&(retryNumForDisplay=this._autoRetries[id],maxAuto=this._options.retry.maxAutoAttempts,retryNote=this._options.retry.autoRetryNote.replace(/\{retryNum\}/g,retryNumForDisplay),retryNote=retryNote.replace(/\{maxAuto\}/g,maxAuto),this._templating.setStatusText(id,retryNote),qq(this._templating.getFileContainer(id)).addClass(this._classes.retrying))},_onBeforeManualRetry:function(id){return this._parent.prototype._onBeforeManualRetry.apply(this,arguments)?(this._templating.resetProgress(id),qq(this._templating.getFileContainer(id)).removeClass(this._classes.fail),this._templating.setStatusText(id),this._templating.showSpinner(id),this._showCancelLink(id),!0):(qq(this._templating.getFileContainer(id)).addClass(this._classes.retryable),this._templating.showRetry(id),!1)},_onSubmitDelete:function(id){var onSuccessCallback=qq.bind(this._onSubmitDeleteSuccess,this);this._parent.prototype._onSubmitDelete.call(this,id,onSuccessCallback)},_onSubmitDeleteSuccess:function(id,uuid,additionalMandatedParams){this._options.deleteFile.forceConfirm?this._showDeleteConfirm.apply(this,arguments):this._sendDeleteRequest.apply(this,arguments)},_onDeleteComplete:function(id,xhr,isError){this._parent.prototype._onDeleteComplete.apply(this,arguments),this._templating.hideSpinner(id),isError?(this._templating.setStatusText(id,this._options.deleteFile.deletingFailedText),this._templating.showDeleteButton(id)):this._removeFileItem(id)},_sendDeleteRequest:function(id,uuid,additionalMandatedParams){this._templating.hideDeleteButton(id),this._templating.showSpinner(id),this._templating.setStatusText(id,this._options.deleteFile.deletingStatusText),this._deleteHandler.sendDelete.apply(this,arguments)},_showDeleteConfirm:function(id,uuid,mandatedParams){var retVal,fileName=this.getName(id),confirmMessage=this._options.deleteFile.confirmMessage.replace(/\{filename\}/g,fileName),deleteRequestArgs=(this.getUuid(id),arguments),self=this;retVal=this._options.showConfirm(confirmMessage),qq.isGenericPromise(retVal)?retVal.then(function(){self._sendDeleteRequest.apply(self,deleteRequestArgs)}):!1!==retVal&&self._sendDeleteRequest.apply(self,deleteRequestArgs)},_addToList:function(id,name,canned){var prependData,record,prependIndex=0,dontDisplay=this._handler.isProxied(id)&&this._options.scaling.hideScaled;this._options.display.prependFiles&&(this._totalFilesInBatch>1&&this._filesInBatchAddedToUi>0&&(prependIndex=this._filesInBatchAddedToUi-1),prependData={index:prependIndex}),canned||(this._options.disableCancelForFormUploads&&!qq.supportedFeatures.ajaxUploading&&this._templating.disableCancel(),this._options.multiple||(record=this.getUploads({id:id}),this._handledProxyGroup=this._handledProxyGroup||record.proxyGroupId,
record.proxyGroupId===this._handledProxyGroup&&record.proxyGroupId||(this._handler.cancelAll(),this._clearList(),this._handledProxyGroup=null))),canned?(this._templating.addFileToCache(id,this._options.formatFileName(name),prependData,dontDisplay),this._templating.updateThumbnail(id,this._thumbnailUrls[id],!0,this._options.thumbnails.customResizer)):(this._templating.addFile(id,this._options.formatFileName(name),prependData,dontDisplay),this._templating.generatePreview(id,this.getFile(id),this._options.thumbnails.customResizer)),this._filesInBatchAddedToUi+=1,(canned||this._options.display.fileSizeOnSubmit&&qq.supportedFeatures.ajaxUploading)&&this._displayFileSize(id)},_clearList:function(){this._templating.clearFiles(),this.clearStoredFiles()},_displayFileSize:function(id,loadedSize,totalSize){var size=this.getSize(id),sizeForDisplay=this._formatSize(size);size>=0&&(void 0!==loadedSize&&void 0!==totalSize&&(sizeForDisplay=this._formatProgress(loadedSize,totalSize)),this._templating.updateSize(id,sizeForDisplay))},_formatProgress:function(uploadedSize,totalSize){function r(name,replacement){message=message.replace(name,replacement)}var message=this._options.text.formatProgress;return r("{percent}",Math.round(uploadedSize/totalSize*100)),r("{total_size}",this._formatSize(totalSize)),message},_controlFailureTextDisplay:function(id,response){var mode,responseProperty,failureReason;mode=this._options.failedUploadTextDisplay.mode,responseProperty=this._options.failedUploadTextDisplay.responseProperty,"custom"===mode?(failureReason=response[responseProperty],failureReason||(failureReason=this._options.text.failUpload),this._templating.setStatusText(id,failureReason),this._options.failedUploadTextDisplay.enableTooltip&&this._showTooltip(id,failureReason)):"default"===mode?this._templating.setStatusText(id,this._options.text.failUpload):"none"!==mode&&this.log("failedUploadTextDisplay.mode value of '"+mode+"' is not valid","warn")},_showTooltip:function(id,text){this._templating.getFileContainer(id).title=text},_showCancelLink:function(id){this._options.disableCancelForFormUploads&&!qq.supportedFeatures.ajaxUploading||this._templating.showCancel(id)},_itemError:function(code,name,item){var message=this._parent.prototype._itemError.apply(this,arguments);this._options.showMessage(message)},_batchError:function(message){this._parent.prototype._batchError.apply(this,arguments),this._options.showMessage(message)},_setupPastePrompt:function(){var self=this;this._options.callbacks.onPasteReceived=function(){var message=self._options.paste.namePromptMessage,defaultVal=self._options.paste.defaultName;return self._options.showPrompt(message,defaultVal)}},_fileOrBlobRejected:function(id,name){this._totalFilesInBatch-=1,this._parent.prototype._fileOrBlobRejected.apply(this,arguments)},_prepareItemsForUpload:function(items,params,endpoint){this._totalFilesInBatch=items.length,this._filesInBatchAddedToUi=0,this._parent.prototype._prepareItemsForUpload.apply(this,arguments)},_maybeUpdateThumbnail:function(fileId){var thumbnailUrl=this._thumbnailUrls[fileId];this.getUploads({id:fileId}).status===qq.status.DELETED||!thumbnailUrl&&!this._options.thumbnails.placeholders.waitUntilResponse&&qq.supportedFeatures.imagePreviews||this._templating.updateThumbnail(fileId,thumbnailUrl,this._options.thumbnails.customResizer)},_addCannedFile:function(sessionData){var id=this._parent.prototype._addCannedFile.apply(this,arguments);return this._addToList(id,this.getName(id),!0),this._templating.hideSpinner(id),this._templating.hideCancel(id),this._markFileAsSuccessful(id),id},_setSize:function(id,newSize){this._parent.prototype._setSize.apply(this,arguments),this._templating.updateSize(id,this._formatSize(newSize))},_sessionRequestComplete:function(){this._templating.addCacheToDom(),this._parent.prototype._sessionRequestComplete.apply(this,arguments)}}}(),qq.FineUploader=function(o,namespace){"use strict";var self=this;this._parent=namespace?qq[namespace].FineUploaderBasic:qq.FineUploaderBasic,this._parent.apply(this,arguments),qq.extend(this._options,{element:null,button:null,listElement:null,dragAndDrop:{extraDropzones:[],reportDirectoryPaths:!1},text:{formatProgress:"{percent}% of {total_size}",failUpload:"Upload failed",waitingForResponse:"Processing...",paused:"Paused"},template:"qq-template",classes:{retrying:"qq-upload-retrying",retryable:"qq-upload-retryable",success:"qq-upload-success",fail:"qq-upload-fail",editable:"qq-editable",hide:"qq-hide",dropActive:"qq-upload-drop-area-active"},failedUploadTextDisplay:{mode:"default",responseProperty:"error",enableTooltip:!0},messages:{tooManyFilesError:"You may only drop one file",unsupportedBrowser:"Unrecoverable error - this browser does not permit file uploading of any kind."},retry:{showAutoRetryNote:!0,autoRetryNote:"Retrying {retryNum}/{maxAuto}..."},deleteFile:{forceConfirm:!1,confirmMessage:"Are you sure you want to delete {filename}?",deletingStatusText:"Deleting...",deletingFailedText:"Delete failed"},display:{fileSizeOnSubmit:!1,prependFiles:!1},paste:{promptForName:!1,namePromptMessage:"Please name this image"},thumbnails:{customResizer:null,maxCount:0,placeholders:{waitUntilResponse:!1,notAvailablePath:null,waitingPath:null},timeBetweenThumbs:750},scaling:{hideScaled:!1},showMessage:function(message){if(self._templating.hasDialog("alert"))return self._templating.showDialog("alert",message);setTimeout(function(){window.alert(message)},0)},showConfirm:function(message){return self._templating.hasDialog("confirm")?self._templating.showDialog("confirm",message):window.confirm(message)},showPrompt:function(message,defaultValue){return self._templating.hasDialog("prompt")?self._templating.showDialog("prompt",message,defaultValue):window.prompt(message,defaultValue)}},!0),qq.extend(this._options,o,!0),this._templating=new qq.Templating({log:qq.bind(this.log,this),templateIdOrEl:this._options.template,containerEl:this._options.element,fileContainerEl:this._options.listElement,button:this._options.button,imageGenerator:this._imageGenerator,classes:{hide:this._options.classes.hide,editable:this._options.classes.editable},limits:{maxThumbs:this._options.thumbnails.maxCount,timeBetweenThumbs:this._options.thumbnails.timeBetweenThumbs},placeholders:{waitUntilUpdate:this._options.thumbnails.placeholders.waitUntilResponse,thumbnailNotAvailable:this._options.thumbnails.placeholders.notAvailablePath,waitingForThumbnail:this._options.thumbnails.placeholders.waitingPath},text:this._options.text}),this._options.workarounds.ios8SafariUploads&&qq.ios800()&&qq.iosSafari()?this._templating.renderFailure(this._options.messages.unsupportedBrowserIos8Safari):!qq.supportedFeatures.uploading||this._options.cors.expected&&!qq.supportedFeatures.uploadCors?this._templating.renderFailure(this._options.messages.unsupportedBrowser):(this._wrapCallbacks(),this._templating.render(),this._classes=this._options.classes,!this._options.button&&this._templating.getButton()&&(this._defaultButtonId=this._createUploadButton({element:this._templating.getButton(),title:this._options.text.fileInputTitle}).getButtonId()),this._setupClickAndEditEventHandlers(),qq.DragAndDrop&&qq.supportedFeatures.fileDrop&&(this._dnd=this._setupDragAndDrop()),this._options.paste.targetElement&&this._options.paste.promptForName&&(qq.PasteSupport?this._setupPastePrompt():this.log("Paste support module not found.","error")),this._totalFilesInBatch=0,this._filesInBatchAddedToUi=0)},qq.extend(qq.FineUploader.prototype,qq.basePublicApi),qq.extend(qq.FineUploader.prototype,qq.basePrivateApi),qq.extend(qq.FineUploader.prototype,qq.uiPublicApi),qq.extend(qq.FineUploader.prototype,qq.uiPrivateApi),qq.Templating=function(spec){"use strict";var log,isEditElementsExist,isRetryElementExist,templateHtml,container,fileList,showThumbnails,serverScale,FILE_ID_ATTR="qq-file-id",FILE_CLASS_PREFIX="qq-file-id-",THUMBNAIL_MAX_SIZE_ATTR="qq-max-size",THUMBNAIL_SERVER_SCALE_ATTR="qq-server-scale",HIDE_DROPZONE_ATTR="qq-hide-dropzone",DROPZPONE_TEXT_ATTR="qq-drop-area-text",IN_PROGRESS_CLASS="qq-in-progress",HIDDEN_FOREVER_CLASS="qq-hidden-forever",fileBatch={content:document.createDocumentFragment(),map:{}},isCancelDisabled=!1,generatedThumbnails=0,thumbnailQueueMonitorRunning=!1,thumbGenerationQueue=[],thumbnailMaxSize=-1,options={log:null,limits:{maxThumbs:0,timeBetweenThumbs:750},templateIdOrEl:"qq-template",containerEl:null,fileContainerEl:null,button:null,imageGenerator:null,classes:{hide:"qq-hide",editable:"qq-editable"},placeholders:{waitUntilUpdate:!1,thumbnailNotAvailable:null,waitingForThumbnail:null},text:{paused:"Paused"}},selectorClasses={button:"qq-upload-button-selector",alertDialog:"qq-alert-dialog-selector",dialogCancelButton:"qq-cancel-button-selector",confirmDialog:"qq-confirm-dialog-selector",dialogMessage:"qq-dialog-message-selector",dialogOkButton:"qq-ok-button-selector",promptDialog:"qq-prompt-dialog-selector",uploader:"qq-uploader-selector",drop:"qq-upload-drop-area-selector",list:"qq-upload-list-selector",progressBarContainer:"qq-progress-bar-container-selector",progressBar:"qq-progress-bar-selector",totalProgressBarContainer:"qq-total-progress-bar-container-selector",totalProgressBar:"qq-total-progress-bar-selector",file:"qq-upload-file-selector",spinner:"qq-upload-spinner-selector",size:"qq-upload-size-selector",cancel:"qq-upload-cancel-selector",pause:"qq-upload-pause-selector",continueButton:"qq-upload-continue-selector",deleteButton:"qq-upload-delete-selector",retry:"qq-upload-retry-selector",statusText:"qq-upload-status-text-selector",editFilenameInput:"qq-edit-filename-selector",editNameIcon:"qq-edit-filename-icon-selector",dropText:"qq-upload-drop-area-text-selector",dropProcessing:"qq-drop-processing-selector",dropProcessingSpinner:"qq-drop-processing-spinner-selector",thumbnail:"qq-thumbnail-selector"},previewGeneration={},cachedThumbnailNotAvailableImg=new qq.Promise,cachedWaitingForThumbnailImg=new qq.Promise,cacheThumbnailPlaceholders=function(){var notAvailableUrl=options.placeholders.thumbnailNotAvailable,waitingUrl=options.placeholders.waitingForThumbnail,spec={maxSize:thumbnailMaxSize,scale:serverScale};showThumbnails&&(notAvailableUrl?options.imageGenerator.generate(notAvailableUrl,new Image,spec).then(function(updatedImg){cachedThumbnailNotAvailableImg.success(updatedImg)},function(){cachedThumbnailNotAvailableImg.failure(),log("Problem loading 'not available' placeholder image at "+notAvailableUrl,"error")}):cachedThumbnailNotAvailableImg.failure(),waitingUrl?options.imageGenerator.generate(waitingUrl,new Image,spec).then(function(updatedImg){cachedWaitingForThumbnailImg.success(updatedImg)},function(){cachedWaitingForThumbnailImg.failure(),log("Problem loading 'waiting for thumbnail' placeholder image at "+waitingUrl,"error")}):cachedWaitingForThumbnailImg.failure())},displayWaitingImg=function(thumbnail){var waitingImgPlacement=new qq.Promise;return cachedWaitingForThumbnailImg.then(function(img){maybeScalePlaceholderViaCss(img,thumbnail),thumbnail.src?waitingImgPlacement.success():(thumbnail.src=img.src,thumbnail.onload=function(){thumbnail.onload=null,show(thumbnail),waitingImgPlacement.success()})},function(){hide(thumbnail),waitingImgPlacement.success()}),waitingImgPlacement},generateNewPreview=function(id,blob,spec){var thumbnail=getThumbnail(id);return log("Generating new thumbnail for "+id),blob.qqThumbnailId=id,options.imageGenerator.generate(blob,thumbnail,spec).then(function(){generatedThumbnails++,show(thumbnail),previewGeneration[id].success()},function(){previewGeneration[id].failure(),options.placeholders.waitUntilUpdate||maybeSetDisplayNotAvailableImg(id,thumbnail)})},generateNextQueuedPreview=function(){if(thumbGenerationQueue.length){thumbnailQueueMonitorRunning=!0;var queuedThumbRequest=thumbGenerationQueue.shift();queuedThumbRequest.update?processUpdateQueuedPreviewRequest(queuedThumbRequest):processNewQueuedPreviewRequest(queuedThumbRequest)}else thumbnailQueueMonitorRunning=!1},getCancel=function(id){return getTemplateEl(getFile(id),selectorClasses.cancel)},getContinue=function(id){return getTemplateEl(getFile(id),selectorClasses.continueButton)},getDialog=function(type){return getTemplateEl(container,selectorClasses[type+"Dialog"])},getDelete=function(id){return getTemplateEl(getFile(id),selectorClasses.deleteButton)},getDropProcessing=function(){return getTemplateEl(container,selectorClasses.dropProcessing)},getEditIcon=function(id){return getTemplateEl(getFile(id),selectorClasses.editNameIcon)},getFile=function(id){return fileBatch.map[id]||qq(fileList).getFirstByClass(FILE_CLASS_PREFIX+id)},getFilename=function(id){return getTemplateEl(getFile(id),selectorClasses.file)},getPause=function(id){return getTemplateEl(getFile(id),selectorClasses.pause)},getProgress=function(id){return null==id?getTemplateEl(container,selectorClasses.totalProgressBarContainer)||getTemplateEl(container,selectorClasses.totalProgressBar):getTemplateEl(getFile(id),selectorClasses.progressBarContainer)||getTemplateEl(getFile(id),selectorClasses.progressBar)},getRetry=function(id){return getTemplateEl(getFile(id),selectorClasses.retry)},getSize=function(id){return getTemplateEl(getFile(id),selectorClasses.size)},getSpinner=function(id){return getTemplateEl(getFile(id),selectorClasses.spinner)},getTemplateEl=function(context,cssClass){return context&&qq(context).getFirstByClass(cssClass)},getThumbnail=function(id){return showThumbnails&&getTemplateEl(getFile(id),selectorClasses.thumbnail)},hide=function(el){el&&qq(el).addClass(options.classes.hide)},maybeScalePlaceholderViaCss=function(placeholder,thumbnail){var maxWidth=placeholder.style.maxWidth,maxHeight=placeholder.style.maxHeight;maxHeight&&maxWidth&&!thumbnail.style.maxWidth&&!thumbnail.style.maxHeight&&qq(thumbnail).css({maxWidth:maxWidth,maxHeight:maxHeight})},maybeSetDisplayNotAvailableImg=function(id,thumbnail){var previewing=previewGeneration[id]||(new qq.Promise).failure(),notAvailableImgPlacement=new qq.Promise;return cachedThumbnailNotAvailableImg.then(function(img){previewing.then(function(){notAvailableImgPlacement.success()},function(){maybeScalePlaceholderViaCss(img,thumbnail),thumbnail.onload=function(){thumbnail.onload=null,notAvailableImgPlacement.success()},thumbnail.src=img.src,show(thumbnail)})}),notAvailableImgPlacement},parseAndGetTemplate=function(){var scriptEl,scriptHtml,fileListNode,tempTemplateEl,fileListHtml,defaultButton,dropArea,thumbnail,dropProcessing,dropTextEl,uploaderEl;if(log("Parsing template"),null==options.templateIdOrEl)throw new Error("You MUST specify either a template element or ID!");if(qq.isString(options.templateIdOrEl)){if(null===(scriptEl=document.getElementById(options.templateIdOrEl)))throw new Error(qq.format("Cannot find template script at ID '{}'!",options.templateIdOrEl));scriptHtml=scriptEl.innerHTML}else{if(void 0===options.templateIdOrEl.innerHTML)throw new Error("You have specified an invalid value for the template option!  It must be an ID or an Element.");scriptHtml=options.templateIdOrEl.innerHTML}if(scriptHtml=qq.trimStr(scriptHtml),tempTemplateEl=document.createElement("div"),tempTemplateEl.appendChild(qq.toElement(scriptHtml)),uploaderEl=qq(tempTemplateEl).getFirstByClass(selectorClasses.uploader),options.button&&(defaultButton=qq(tempTemplateEl).getFirstByClass(selectorClasses.button))&&qq(defaultButton).remove(),qq.DragAndDrop&&qq.supportedFeatures.fileDrop||(dropProcessing=qq(tempTemplateEl).getFirstByClass(selectorClasses.dropProcessing))&&qq(dropProcessing).remove(),dropArea=qq(tempTemplateEl).getFirstByClass(selectorClasses.drop),dropArea&&!qq.DragAndDrop&&(log("DnD module unavailable.","info"),qq(dropArea).remove()),qq.supportedFeatures.fileDrop?qq(uploaderEl).hasAttribute(DROPZPONE_TEXT_ATTR)&&dropArea&&(dropTextEl=qq(dropArea).getFirstByClass(selectorClasses.dropText))&&qq(dropTextEl).remove():(uploaderEl.removeAttribute(DROPZPONE_TEXT_ATTR),dropArea&&qq(dropArea).hasAttribute(HIDE_DROPZONE_ATTR)&&qq(dropArea).css({display:"none"})),thumbnail=qq(tempTemplateEl).getFirstByClass(selectorClasses.thumbnail),showThumbnails?thumbnail&&(thumbnailMaxSize=parseInt(thumbnail.getAttribute(THUMBNAIL_MAX_SIZE_ATTR)),thumbnailMaxSize=thumbnailMaxSize>0?thumbnailMaxSize:null,serverScale=qq(thumbnail).hasAttribute(THUMBNAIL_SERVER_SCALE_ATTR)):thumbnail&&qq(thumbnail).remove(),showThumbnails=showThumbnails&&thumbnail,isEditElementsExist=qq(tempTemplateEl).getByClass(selectorClasses.editFilenameInput).length>0,isRetryElementExist=qq(tempTemplateEl).getByClass(selectorClasses.retry).length>0,null==(fileListNode=qq(tempTemplateEl).getFirstByClass(selectorClasses.list)))throw new Error("Could not find the file list container in the template!");return fileListHtml=fileListNode.innerHTML,fileListNode.innerHTML="",tempTemplateEl.getElementsByTagName("DIALOG").length&&document.createElement("dialog"),log("Template parsing complete"),{template:qq.trimStr(tempTemplateEl.innerHTML),fileTemplate:qq.trimStr(fileListHtml)}},prependFile=function(el,index,fileList){var parentEl=fileList,beforeEl=parentEl.firstChild;index>0&&(beforeEl=qq(parentEl).children()[index].nextSibling),parentEl.insertBefore(el,beforeEl)},processNewQueuedPreviewRequest=function(queuedThumbRequest){var id=queuedThumbRequest.id,optFileOrBlob=queuedThumbRequest.optFileOrBlob,relatedThumbnailId=optFileOrBlob&&optFileOrBlob.qqThumbnailId,thumbnail=getThumbnail(id),spec={customResizeFunction:queuedThumbRequest.customResizeFunction,maxSize:thumbnailMaxSize,orient:!0,scale:!0};qq.supportedFeatures.imagePreviews?thumbnail?options.limits.maxThumbs&&options.limits.maxThumbs<=generatedThumbnails?(maybeSetDisplayNotAvailableImg(id,thumbnail),generateNextQueuedPreview()):displayWaitingImg(thumbnail).done(function(){previewGeneration[id]=new qq.Promise,previewGeneration[id].done(function(){setTimeout(generateNextQueuedPreview,options.limits.timeBetweenThumbs)}),null!=relatedThumbnailId?useCachedPreview(id,relatedThumbnailId):generateNewPreview(id,optFileOrBlob,spec)}):generateNextQueuedPreview():thumbnail&&(displayWaitingImg(thumbnail),generateNextQueuedPreview())},processUpdateQueuedPreviewRequest=function(queuedThumbRequest){var id=queuedThumbRequest.id,thumbnailUrl=queuedThumbRequest.thumbnailUrl,showWaitingImg=queuedThumbRequest.showWaitingImg,thumbnail=getThumbnail(id),spec={customResizeFunction:queuedThumbRequest.customResizeFunction,scale:serverScale,maxSize:thumbnailMaxSize};if(thumbnail)if(thumbnailUrl){if(!(options.limits.maxThumbs&&options.limits.maxThumbs<=generatedThumbnails))return showWaitingImg&&displayWaitingImg(thumbnail),options.imageGenerator.generate(thumbnailUrl,thumbnail,spec).then(function(){show(thumbnail),generatedThumbnails++,setTimeout(generateNextQueuedPreview,options.limits.timeBetweenThumbs)},function(){maybeSetDisplayNotAvailableImg(id,thumbnail),setTimeout(generateNextQueuedPreview,options.limits.timeBetweenThumbs)});maybeSetDisplayNotAvailableImg(id,thumbnail),generateNextQueuedPreview()}else maybeSetDisplayNotAvailableImg(id,thumbnail),generateNextQueuedPreview()},setProgressBarWidth=function(id,percent){var bar=getProgress(id),progressBarSelector=null==id?selectorClasses.totalProgressBar:selectorClasses.progressBar;bar&&!qq(bar).hasClass(progressBarSelector)&&(bar=qq(bar).getFirstByClass(progressBarSelector)),bar&&(qq(bar).css({width:percent+"%"}),bar.setAttribute("aria-valuenow",percent))},show=function(el){el&&qq(el).removeClass(options.classes.hide)},useCachedPreview=function(targetThumbnailId,cachedThumbnailId){var targetThumbnail=getThumbnail(targetThumbnailId),cachedThumbnail=getThumbnail(cachedThumbnailId);log(qq.format("ID {} is the same file as ID {}.  Will use generated thumbnail from ID {} instead.",targetThumbnailId,cachedThumbnailId,cachedThumbnailId)),previewGeneration[cachedThumbnailId].then(function(){generatedThumbnails++,previewGeneration[targetThumbnailId].success(),log(qq.format("Now using previously generated thumbnail created for ID {} on ID {}.",cachedThumbnailId,targetThumbnailId)),targetThumbnail.src=cachedThumbnail.src,show(targetThumbnail)},function(){previewGeneration[targetThumbnailId].failure(),options.placeholders.waitUntilUpdate||maybeSetDisplayNotAvailableImg(targetThumbnailId,targetThumbnail)})};qq.extend(options,spec),log=options.log,qq.supportedFeatures.imagePreviews||(options.limits.timeBetweenThumbs=0,options.limits.maxThumbs=0),container=options.containerEl,showThumbnails=void 0!==options.imageGenerator,templateHtml=parseAndGetTemplate(),cacheThumbnailPlaceholders(),qq.extend(this,{render:function(){log("Rendering template in DOM."),generatedThumbnails=0,container.innerHTML=templateHtml.template,hide(getDropProcessing()),this.hideTotalProgress(),fileList=options.fileContainerEl||getTemplateEl(container,selectorClasses.list),log("Template rendering complete")},renderFailure:function(message){var cantRenderEl=qq.toElement(message);container.innerHTML="",container.appendChild(cantRenderEl)},reset:function(){this.render()},clearFiles:function(){fileList.innerHTML=""},disableCancel:function(){isCancelDisabled=!0},addFile:function(id,name,prependInfo,hideForever,batch){var thumb,fileEl=qq.toElement(templateHtml.fileTemplate),fileNameEl=getTemplateEl(fileEl,selectorClasses.file),uploaderEl=getTemplateEl(container,selectorClasses.uploader),fileContainer=batch?fileBatch.content:fileList;batch&&(fileBatch.map[id]=fileEl),qq(fileEl).addClass(FILE_CLASS_PREFIX+id),uploaderEl.removeAttribute(DROPZPONE_TEXT_ATTR),fileNameEl&&(qq(fileNameEl).setText(name),fileNameEl.setAttribute("title",name)),fileEl.setAttribute(FILE_ID_ATTR,id),prependInfo?prependFile(fileEl,prependInfo.index,fileContainer):fileContainer.appendChild(fileEl),hideForever?(fileEl.style.display="none",qq(fileEl).addClass(HIDDEN_FOREVER_CLASS)):(hide(getProgress(id)),hide(getSize(id)),hide(getDelete(id)),hide(getRetry(id)),hide(getPause(id)),hide(getContinue(id)),isCancelDisabled&&this.hideCancel(id),(thumb=getThumbnail(id))&&!thumb.src&&cachedWaitingForThumbnailImg.then(function(waitingImg){thumb.src=waitingImg.src,waitingImg.style.maxHeight&&waitingImg.style.maxWidth&&qq(thumb).css({maxHeight:waitingImg.style.maxHeight,maxWidth:waitingImg.style.maxWidth}),show(thumb)}))},addFileToCache:function(id,name,prependInfo,hideForever){this.addFile(id,name,prependInfo,hideForever,!0)},addCacheToDom:function(){fileList.appendChild(fileBatch.content),fileBatch.content=document.createDocumentFragment(),fileBatch.map={}},removeFile:function(id){qq(getFile(id)).remove()},getFileId:function(el){var currentNode=el;if(currentNode){for(;null==currentNode.getAttribute(FILE_ID_ATTR);)currentNode=currentNode.parentNode;return parseInt(currentNode.getAttribute(FILE_ID_ATTR))}},getFileList:function(){return fileList},markFilenameEditable:function(id){var filename=getFilename(id);filename&&qq(filename).addClass(options.classes.editable)},updateFilename:function(id,name){var filenameEl=getFilename(id);filenameEl&&(qq(filenameEl).setText(name),filenameEl.setAttribute("title",name))},hideFilename:function(id){hide(getFilename(id))},showFilename:function(id){show(getFilename(id))},isFileName:function(el){return qq(el).hasClass(selectorClasses.file)},getButton:function(){return options.button||getTemplateEl(container,selectorClasses.button)},hideDropProcessing:function(){hide(getDropProcessing())},showDropProcessing:function(){show(getDropProcessing())},getDropZone:function(){return getTemplateEl(container,selectorClasses.drop)},isEditFilenamePossible:function(){return isEditElementsExist},hideRetry:function(id){hide(getRetry(id))},isRetryPossible:function(){return isRetryElementExist},showRetry:function(id){show(getRetry(id))},getFileContainer:function(id){return getFile(id)},showEditIcon:function(id){var icon=getEditIcon(id);icon&&qq(icon).addClass(options.classes.editable)},isHiddenForever:function(id){return qq(getFile(id)).hasClass(HIDDEN_FOREVER_CLASS)},hideEditIcon:function(id){var icon=getEditIcon(id);icon&&qq(icon).removeClass(options.classes.editable)},isEditIcon:function(el){return qq(el).hasClass(selectorClasses.editNameIcon,!0)},getEditInput:function(id){return getTemplateEl(getFile(id),selectorClasses.editFilenameInput)},isEditInput:function(el){return qq(el).hasClass(selectorClasses.editFilenameInput,!0)},updateProgress:function(id,loaded,total){var percent,bar=getProgress(id);bar&&total>0&&(percent=Math.round(loaded/total*100),100===percent?hide(bar):show(bar),setProgressBarWidth(id,percent))},updateTotalProgress:function(loaded,total){this.updateProgress(null,loaded,total)},hideProgress:function(id){var bar=getProgress(id);bar&&hide(bar)},hideTotalProgress:function(){this.hideProgress()},resetProgress:function(id){setProgressBarWidth(id,0),this.hideTotalProgress(id)},resetTotalProgress:function(){this.resetProgress()},showCancel:function(id){if(!isCancelDisabled){var cancel=getCancel(id);cancel&&qq(cancel).removeClass(options.classes.hide)}},hideCancel:function(id){hide(getCancel(id))},isCancel:function(el){return qq(el).hasClass(selectorClasses.cancel,!0)},allowPause:function(id){show(getPause(id)),hide(getContinue(id))},uploadPaused:function(id){this.setStatusText(id,options.text.paused),this.allowContinueButton(id),hide(getSpinner(id))},hidePause:function(id){hide(getPause(id))},isPause:function(el){return qq(el).hasClass(selectorClasses.pause,!0)},isContinueButton:function(el){return qq(el).hasClass(selectorClasses.continueButton,!0)},allowContinueButton:function(id){show(getContinue(id)),hide(getPause(id))},uploadContinued:function(id){this.setStatusText(id,""),this.allowPause(id),show(getSpinner(id))},showDeleteButton:function(id){show(getDelete(id))},hideDeleteButton:function(id){hide(getDelete(id))},isDeleteButton:function(el){return qq(el).hasClass(selectorClasses.deleteButton,!0)},isRetry:function(el){return qq(el).hasClass(selectorClasses.retry,!0)},updateSize:function(id,text){var size=getSize(id);size&&(show(size),qq(size).setText(text))},setStatusText:function(id,text){var textEl=getTemplateEl(getFile(id),selectorClasses.statusText);textEl&&(null==text?qq(textEl).clearText():qq(textEl).setText(text))},hideSpinner:function(id){qq(getFile(id)).removeClass(IN_PROGRESS_CLASS),hide(getSpinner(id))},showSpinner:function(id){qq(getFile(id)).addClass(IN_PROGRESS_CLASS),show(getSpinner(id))},generatePreview:function(id,optFileOrBlob,customResizeFunction){this.isHiddenForever(id)||(thumbGenerationQueue.push({id:id,customResizeFunction:customResizeFunction,optFileOrBlob:optFileOrBlob}),!thumbnailQueueMonitorRunning&&generateNextQueuedPreview())},updateThumbnail:function(id,thumbnailUrl,showWaitingImg,customResizeFunction){this.isHiddenForever(id)||(thumbGenerationQueue.push({customResizeFunction:customResizeFunction,update:!0,id:id,thumbnailUrl:thumbnailUrl,showWaitingImg:showWaitingImg}),!thumbnailQueueMonitorRunning&&generateNextQueuedPreview())},hasDialog:function(type){return qq.supportedFeatures.dialogElement&&!!getDialog(type)},showDialog:function(type,message,defaultValue){var dialog=getDialog(type),messageEl=getTemplateEl(dialog,selectorClasses.dialogMessage),inputEl=dialog.getElementsByTagName("INPUT")[0],cancelBtn=getTemplateEl(dialog,selectorClasses.dialogCancelButton),okBtn=getTemplateEl(dialog,selectorClasses.dialogOkButton),promise=new qq.Promise,closeHandler=function(){cancelBtn.removeEventListener("click",cancelClickHandler),okBtn&&okBtn.removeEventListener("click",okClickHandler),promise.failure()},cancelClickHandler=function(){cancelBtn.removeEventListener("click",cancelClickHandler),dialog.close()},okClickHandler=function(){dialog.removeEventListener("close",closeHandler),okBtn.removeEventListener("click",okClickHandler),dialog.close(),promise.success(inputEl&&inputEl.value)};return dialog.addEventListener("close",closeHandler),cancelBtn.addEventListener("click",cancelClickHandler),okBtn&&okBtn.addEventListener("click",okClickHandler),inputEl&&(inputEl.value=defaultValue),messageEl.textContent=message,dialog.showModal(),promise}})},qq.UiEventHandler=function(s,protectedApi){"use strict";function addHandler(element){disposer.attach(element,spec.eventType,function(event){event=event||window.event;var target=event.target||event.srcElement;spec.onHandled(target,event)})}var disposer=new qq.DisposeSupport,spec={eventType:"click",attachTo:null,onHandled:function(target,event){}};qq.extend(this,{addHandler:function(element){addHandler(element)},dispose:function(){disposer.dispose()}}),qq.extend(protectedApi,{getFileIdFromItem:function(item){return item.qqFileId},getDisposeSupport:function(){return disposer}}),qq.extend(spec,s),spec.attachTo&&addHandler(spec.attachTo)},qq.FileButtonsClickHandler=function(s){"use strict";function examineEvent(target,event){qq.each(buttonHandlers,function(buttonType,handler){var fileId,firstLetterCapButtonType=buttonType.charAt(0).toUpperCase()+buttonType.slice(1);if(spec.templating["is"+firstLetterCapButtonType](target))return fileId=spec.templating.getFileId(target),qq.preventDefault(event),spec.log(qq.format("Detected valid file button click event on file '{}', ID: {}.",spec.onGetName(fileId),fileId)),handler(fileId),!1})}var inheritedInternalApi={},spec={templating:null,log:function(message,lvl){},onDeleteFile:function(fileId){},onCancel:function(fileId){},onRetry:function(fileId){},onPause:function(fileId){},onContinue:function(fileId){},onGetName:function(fileId){}},buttonHandlers={cancel:function(id){spec.onCancel(id)},retry:function(id){spec.onRetry(id)},deleteButton:function(id){spec.onDeleteFile(id)},pause:function(id){spec.onPause(id)},continueButton:function(id){spec.onContinue(id)}};qq.extend(spec,s),spec.eventType="click",spec.onHandled=examineEvent,spec.attachTo=spec.templating.getFileList(),qq.extend(this,new qq.UiEventHandler(spec,inheritedInternalApi))},qq.FilenameClickHandler=function(s){"use strict";function examineEvent(target,event){if(spec.templating.isFileName(target)||spec.templating.isEditIcon(target)){var fileId=spec.templating.getFileId(target);spec.onGetUploadStatus(fileId)===qq.status.SUBMITTED&&(spec.log(qq.format("Detected valid filename click event on file '{}', ID: {}.",spec.onGetName(fileId),fileId)),qq.preventDefault(event),inheritedInternalApi.handleFilenameEdit(fileId,target,!0))}}var inheritedInternalApi={},spec={templating:null,log:function(message,lvl){},classes:{file:"qq-upload-file",editNameIcon:"qq-edit-filename-icon"},onGetUploadStatus:function(fileId){},onGetName:function(fileId){}};qq.extend(spec,s),spec.eventType="click",spec.onHandled=examineEvent,qq.extend(this,new qq.FilenameEditHandler(spec,inheritedInternalApi))},qq.FilenameInputFocusInHandler=function(s,inheritedInternalApi){"use strict";function handleInputFocus(target,event){if(spec.templating.isEditInput(target)){var fileId=spec.templating.getFileId(target);spec.onGetUploadStatus(fileId)===qq.status.SUBMITTED&&(spec.log(qq.format("Detected valid filename input focus event on file '{}', ID: {}.",spec.onGetName(fileId),fileId)),inheritedInternalApi.handleFilenameEdit(fileId,target))}}var spec={templating:null,onGetUploadStatus:function(fileId){},log:function(message,lvl){}};inheritedInternalApi||(inheritedInternalApi={}),spec.eventType="focusin",spec.onHandled=handleInputFocus,qq.extend(spec,s),qq.extend(this,new qq.FilenameEditHandler(spec,inheritedInternalApi))},qq.FilenameInputFocusHandler=function(spec){"use strict";spec.eventType="focus",spec.attachTo=null,qq.extend(this,new qq.FilenameInputFocusInHandler(spec,{}))},qq.FilenameEditHandler=function(s,inheritedInternalApi){"use strict";function getFilenameSansExtension(fileId){var filenameSansExt=spec.onGetName(fileId),extIdx=filenameSansExt.lastIndexOf(".");return extIdx>0&&(filenameSansExt=filenameSansExt.substr(0,extIdx)),filenameSansExt}function getOriginalExtension(fileId){var origName=spec.onGetName(fileId);return qq.getExtension(origName)}function handleNameUpdate(newFilenameInputEl,fileId){
var origExtension,newName=newFilenameInputEl.value;void 0!==newName&&qq.trimStr(newName).length>0&&(origExtension=getOriginalExtension(fileId),void 0!==origExtension&&(newName=newName+"."+origExtension),spec.onSetName(fileId,newName)),spec.onEditingStatusChange(fileId,!1)}function registerInputBlurHandler(inputEl,fileId){inheritedInternalApi.getDisposeSupport().attach(inputEl,"blur",function(){handleNameUpdate(inputEl,fileId)})}function registerInputEnterKeyHandler(inputEl,fileId){inheritedInternalApi.getDisposeSupport().attach(inputEl,"keyup",function(event){13===(event.keyCode||event.which)&&handleNameUpdate(inputEl,fileId)})}var spec={templating:null,log:function(message,lvl){},onGetUploadStatus:function(fileId){},onGetName:function(fileId){},onSetName:function(fileId,newName){},onEditingStatusChange:function(fileId,isEditing){}};qq.extend(spec,s),spec.attachTo=spec.templating.getFileList(),qq.extend(this,new qq.UiEventHandler(spec,inheritedInternalApi)),qq.extend(inheritedInternalApi,{handleFilenameEdit:function(id,target,focusInput){var newFilenameInputEl=spec.templating.getEditInput(id);spec.onEditingStatusChange(id,!0),newFilenameInputEl.value=getFilenameSansExtension(id),focusInput&&newFilenameInputEl.focus(),registerInputBlurHandler(newFilenameInputEl,id),registerInputEnterKeyHandler(newFilenameInputEl,id)}})},qq.CryptoJS=function(Math,undefined){var C={},C_lib=C.lib={},Base=C_lib.Base=function(){function F(){}return{extend:function(overrides){F.prototype=this;var subtype=new F;return overrides&&subtype.mixIn(overrides),subtype.hasOwnProperty("init")||(subtype.init=function(){subtype.$super.init.apply(this,arguments)}),subtype.init.prototype=subtype,subtype.$super=this,subtype},create:function(){var instance=this.extend();return instance.init.apply(instance,arguments),instance},init:function(){},mixIn:function(properties){for(var propertyName in properties)properties.hasOwnProperty(propertyName)&&(this[propertyName]=properties[propertyName]);properties.hasOwnProperty("toString")&&(this.toString=properties.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),WordArray=C_lib.WordArray=Base.extend({init:function(words,sigBytes){words=this.words=words||[],this.sigBytes=sigBytes!=undefined?sigBytes:4*words.length},toString:function(encoder){return(encoder||Hex).stringify(this)},concat:function(wordArray){var thisWords=this.words,thatWords=wordArray.words,thisSigBytes=this.sigBytes,thatSigBytes=wordArray.sigBytes;if(this.clamp(),thisSigBytes%4)for(var i=0;i<thatSigBytes;i++){var thatByte=thatWords[i>>>2]>>>24-i%4*8&255;thisWords[thisSigBytes+i>>>2]|=thatByte<<24-(thisSigBytes+i)%4*8}else if(thatWords.length>65535)for(var i=0;i<thatSigBytes;i+=4)thisWords[thisSigBytes+i>>>2]=thatWords[i>>>2];else thisWords.push.apply(thisWords,thatWords);return this.sigBytes+=thatSigBytes,this},clamp:function(){var words=this.words,sigBytes=this.sigBytes;words[sigBytes>>>2]&=4294967295<<32-sigBytes%4*8,words.length=Math.ceil(sigBytes/4)},clone:function(){var clone=Base.clone.call(this);return clone.words=this.words.slice(0),clone},random:function(nBytes){for(var words=[],i=0;i<nBytes;i+=4)words.push(4294967296*Math.random()|0);return new WordArray.init(words,nBytes)}}),C_enc=C.enc={},Hex=C_enc.Hex={stringify:function(wordArray){for(var words=wordArray.words,sigBytes=wordArray.sigBytes,hexChars=[],i=0;i<sigBytes;i++){var bite=words[i>>>2]>>>24-i%4*8&255;hexChars.push((bite>>>4).toString(16)),hexChars.push((15&bite).toString(16))}return hexChars.join("")},parse:function(hexStr){for(var hexStrLength=hexStr.length,words=[],i=0;i<hexStrLength;i+=2)words[i>>>3]|=parseInt(hexStr.substr(i,2),16)<<24-i%8*4;return new WordArray.init(words,hexStrLength/2)}},Latin1=C_enc.Latin1={stringify:function(wordArray){for(var words=wordArray.words,sigBytes=wordArray.sigBytes,latin1Chars=[],i=0;i<sigBytes;i++){var bite=words[i>>>2]>>>24-i%4*8&255;latin1Chars.push(String.fromCharCode(bite))}return latin1Chars.join("")},parse:function(latin1Str){for(var latin1StrLength=latin1Str.length,words=[],i=0;i<latin1StrLength;i++)words[i>>>2]|=(255&latin1Str.charCodeAt(i))<<24-i%4*8;return new WordArray.init(words,latin1StrLength)}},Utf8=C_enc.Utf8={stringify:function(wordArray){try{return decodeURIComponent(escape(Latin1.stringify(wordArray)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(utf8Str){return Latin1.parse(unescape(encodeURIComponent(utf8Str)))}},BufferedBlockAlgorithm=C_lib.BufferedBlockAlgorithm=Base.extend({reset:function(){this._data=new WordArray.init,this._nDataBytes=0},_append:function(data){"string"==typeof data&&(data=Utf8.parse(data)),this._data.concat(data),this._nDataBytes+=data.sigBytes},_process:function(doFlush){var data=this._data,dataWords=data.words,dataSigBytes=data.sigBytes,blockSize=this.blockSize,blockSizeBytes=4*blockSize,nBlocksReady=dataSigBytes/blockSizeBytes;nBlocksReady=doFlush?Math.ceil(nBlocksReady):Math.max((0|nBlocksReady)-this._minBufferSize,0);var nWordsReady=nBlocksReady*blockSize,nBytesReady=Math.min(4*nWordsReady,dataSigBytes);if(nWordsReady){for(var offset=0;offset<nWordsReady;offset+=blockSize)this._doProcessBlock(dataWords,offset);var processedWords=dataWords.splice(0,nWordsReady);data.sigBytes-=nBytesReady}return new WordArray.init(processedWords,nBytesReady)},clone:function(){var clone=Base.clone.call(this);return clone._data=this._data.clone(),clone},_minBufferSize:0}),C_algo=(C_lib.Hasher=BufferedBlockAlgorithm.extend({cfg:Base.extend(),init:function(cfg){this.cfg=this.cfg.extend(cfg),this.reset()},reset:function(){BufferedBlockAlgorithm.reset.call(this),this._doReset()},update:function(messageUpdate){return this._append(messageUpdate),this._process(),this},finalize:function(messageUpdate){return messageUpdate&&this._append(messageUpdate),this._doFinalize()},blockSize:16,_createHelper:function(hasher){return function(message,cfg){return new hasher.init(cfg).finalize(message)}},_createHmacHelper:function(hasher){return function(message,key){return new C_algo.HMAC.init(hasher,key).finalize(message)}}}),C.algo={});return C}(Math),function(){var C=qq.CryptoJS,C_lib=C.lib,WordArray=C_lib.WordArray,C_enc=C.enc;C_enc.Base64={stringify:function(wordArray){var words=wordArray.words,sigBytes=wordArray.sigBytes,map=this._map;wordArray.clamp();for(var base64Chars=[],i=0;i<sigBytes;i+=3)for(var byte1=words[i>>>2]>>>24-i%4*8&255,byte2=words[i+1>>>2]>>>24-(i+1)%4*8&255,byte3=words[i+2>>>2]>>>24-(i+2)%4*8&255,triplet=byte1<<16|byte2<<8|byte3,j=0;j<4&&i+.75*j<sigBytes;j++)base64Chars.push(map.charAt(triplet>>>6*(3-j)&63));var paddingChar=map.charAt(64);if(paddingChar)for(;base64Chars.length%4;)base64Chars.push(paddingChar);return base64Chars.join("")},parse:function(base64Str){var base64StrLength=base64Str.length,map=this._map,paddingChar=map.charAt(64);if(paddingChar){var paddingIndex=base64Str.indexOf(paddingChar);-1!=paddingIndex&&(base64StrLength=paddingIndex)}for(var words=[],nBytes=0,i=0;i<base64StrLength;i++)if(i%4){var bits1=map.indexOf(base64Str.charAt(i-1))<<i%4*2,bits2=map.indexOf(base64Str.charAt(i))>>>6-i%4*2;words[nBytes>>>2]|=(bits1|bits2)<<24-nBytes%4*8,nBytes++}return WordArray.create(words,nBytes)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),function(){var C=qq.CryptoJS,C_lib=C.lib,Base=C_lib.Base,C_enc=C.enc,Utf8=C_enc.Utf8,C_algo=C.algo;C_algo.HMAC=Base.extend({init:function(hasher,key){hasher=this._hasher=new hasher.init,"string"==typeof key&&(key=Utf8.parse(key));var hasherBlockSize=hasher.blockSize,hasherBlockSizeBytes=4*hasherBlockSize;key.sigBytes>hasherBlockSizeBytes&&(key=hasher.finalize(key)),key.clamp();for(var oKey=this._oKey=key.clone(),iKey=this._iKey=key.clone(),oKeyWords=oKey.words,iKeyWords=iKey.words,i=0;i<hasherBlockSize;i++)oKeyWords[i]^=1549556828,iKeyWords[i]^=909522486;oKey.sigBytes=iKey.sigBytes=hasherBlockSizeBytes,this.reset()},reset:function(){var hasher=this._hasher;hasher.reset(),hasher.update(this._iKey)},update:function(messageUpdate){return this._hasher.update(messageUpdate),this},finalize:function(messageUpdate){var hasher=this._hasher,innerHash=hasher.finalize(messageUpdate);return hasher.reset(),hasher.finalize(this._oKey.clone().concat(innerHash))}})}(),function(){var C=qq.CryptoJS,C_lib=C.lib,WordArray=C_lib.WordArray,Hasher=C_lib.Hasher,C_algo=C.algo,W=[],SHA1=C_algo.SHA1=Hasher.extend({_doReset:function(){this._hash=new WordArray.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(M,offset){for(var H=this._hash.words,a=H[0],b=H[1],c=H[2],d=H[3],e=H[4],i=0;i<80;i++){if(i<16)W[i]=0|M[offset+i];else{var n=W[i-3]^W[i-8]^W[i-14]^W[i-16];W[i]=n<<1|n>>>31}var t=(a<<5|a>>>27)+e+W[i];t+=i<20?1518500249+(b&c|~b&d):i<40?1859775393+(b^c^d):i<60?(b&c|b&d|c&d)-1894007588:(b^c^d)-899497514,e=d,d=c,c=b<<30|b>>>2,b=a,a=t}H[0]=H[0]+a|0,H[1]=H[1]+b|0,H[2]=H[2]+c|0,H[3]=H[3]+d|0,H[4]=H[4]+e|0},_doFinalize:function(){var data=this._data,dataWords=data.words,nBitsTotal=8*this._nDataBytes,nBitsLeft=8*data.sigBytes;return dataWords[nBitsLeft>>>5]|=128<<24-nBitsLeft%32,dataWords[14+(nBitsLeft+64>>>9<<4)]=Math.floor(nBitsTotal/4294967296),dataWords[15+(nBitsLeft+64>>>9<<4)]=nBitsTotal,data.sigBytes=4*dataWords.length,this._process(),this._hash},clone:function(){var clone=Hasher.clone.call(this);return clone._hash=this._hash.clone(),clone}});C.SHA1=Hasher._createHelper(SHA1),C.HmacSHA1=Hasher._createHmacHelper(SHA1)}(),function(Math){var C=qq.CryptoJS,C_lib=C.lib,WordArray=C_lib.WordArray,Hasher=C_lib.Hasher,C_algo=C.algo,H=[],K=[];!function(){function isPrime(n){for(var sqrtN=Math.sqrt(n),factor=2;factor<=sqrtN;factor++)if(!(n%factor))return!1;return!0}function getFractionalBits(n){return 4294967296*(n-(0|n))|0}for(var n=2,nPrime=0;nPrime<64;)isPrime(n)&&(nPrime<8&&(H[nPrime]=getFractionalBits(Math.pow(n,.5))),K[nPrime]=getFractionalBits(Math.pow(n,1/3)),nPrime++),n++}();var W=[],SHA256=C_algo.SHA256=Hasher.extend({_doReset:function(){this._hash=new WordArray.init(H.slice(0))},_doProcessBlock:function(M,offset){for(var H=this._hash.words,a=H[0],b=H[1],c=H[2],d=H[3],e=H[4],f=H[5],g=H[6],h=H[7],i=0;i<64;i++){if(i<16)W[i]=0|M[offset+i];else{var gamma0x=W[i-15],gamma0=(gamma0x<<25|gamma0x>>>7)^(gamma0x<<14|gamma0x>>>18)^gamma0x>>>3,gamma1x=W[i-2],gamma1=(gamma1x<<15|gamma1x>>>17)^(gamma1x<<13|gamma1x>>>19)^gamma1x>>>10;W[i]=gamma0+W[i-7]+gamma1+W[i-16]}var ch=e&f^~e&g,maj=a&b^a&c^b&c,sigma0=(a<<30|a>>>2)^(a<<19|a>>>13)^(a<<10|a>>>22),sigma1=(e<<26|e>>>6)^(e<<21|e>>>11)^(e<<7|e>>>25),t1=h+sigma1+ch+K[i]+W[i],t2=sigma0+maj;h=g,g=f,f=e,e=d+t1|0,d=c,c=b,b=a,a=t1+t2|0}H[0]=H[0]+a|0,H[1]=H[1]+b|0,H[2]=H[2]+c|0,H[3]=H[3]+d|0,H[4]=H[4]+e|0,H[5]=H[5]+f|0,H[6]=H[6]+g|0,H[7]=H[7]+h|0},_doFinalize:function(){var data=this._data,dataWords=data.words,nBitsTotal=8*this._nDataBytes,nBitsLeft=8*data.sigBytes;return dataWords[nBitsLeft>>>5]|=128<<24-nBitsLeft%32,dataWords[14+(nBitsLeft+64>>>9<<4)]=Math.floor(nBitsTotal/4294967296),dataWords[15+(nBitsLeft+64>>>9<<4)]=nBitsTotal,data.sigBytes=4*dataWords.length,this._process(),this._hash},clone:function(){var clone=Hasher.clone.call(this);return clone._hash=this._hash.clone(),clone}});C.SHA256=Hasher._createHelper(SHA256),C.HmacSHA256=Hasher._createHmacHelper(SHA256)}(Math),function(){if("function"==typeof ArrayBuffer){var C=qq.CryptoJS,C_lib=C.lib,WordArray=C_lib.WordArray,superInit=WordArray.init;(WordArray.init=function(typedArray){if(typedArray instanceof ArrayBuffer&&(typedArray=new Uint8Array(typedArray)),(typedArray instanceof Int8Array||typedArray instanceof Uint8ClampedArray||typedArray instanceof Int16Array||typedArray instanceof Uint16Array||typedArray instanceof Int32Array||typedArray instanceof Uint32Array||typedArray instanceof Float32Array||typedArray instanceof Float64Array)&&(typedArray=new Uint8Array(typedArray.buffer,typedArray.byteOffset,typedArray.byteLength)),typedArray instanceof Uint8Array){for(var typedArrayByteLength=typedArray.byteLength,words=[],i=0;i<typedArrayByteLength;i++)words[i>>>2]|=typedArray[i]<<24-i%4*8;superInit.call(this,words,typedArrayByteLength)}else superInit.apply(this,arguments)}).prototype=WordArray}}(),qq.s3=qq.s3||{},qq.s3.util=qq.s3.util||function(){"use strict";return{ALGORITHM_PARAM_NAME:"x-amz-algorithm",AWS_PARAM_PREFIX:"x-amz-meta-",CREDENTIAL_PARAM_NAME:"x-amz-credential",DATE_PARAM_NAME:"x-amz-date",REDUCED_REDUNDANCY_PARAM_NAME:"x-amz-storage-class",REDUCED_REDUNDANCY_PARAM_VALUE:"REDUCED_REDUNDANCY",SERVER_SIDE_ENCRYPTION_PARAM_NAME:"x-amz-server-side-encryption",SERVER_SIDE_ENCRYPTION_PARAM_VALUE:"AES256",SESSION_TOKEN_PARAM_NAME:"x-amz-security-token",V4_ALGORITHM_PARAM_VALUE:"AWS4-HMAC-SHA256",V4_SIGNATURE_PARAM_NAME:"x-amz-signature",CASE_SENSITIVE_PARAM_NAMES:["Cache-Control","Content-Disposition","Content-Encoding","Content-MD5"],UNSIGNABLE_REST_HEADER_NAMES:["Cache-Control","Content-Disposition","Content-Encoding","Content-MD5"],UNPREFIXED_PARAM_NAMES:["Cache-Control","Content-Disposition","Content-Encoding","Content-MD5","x-amz-server-side-encryption-customer-algorithm","x-amz-server-side-encryption-customer-key","x-amz-server-side-encryption-customer-key-MD5"],getBucket:function(endpoint){var bucket,patterns=[/^(?:https?:\/\/)?([a-z0-9.\-_]+)\.s3(?:-[a-z0-9\-]+)?\.amazonaws\.com/i,/^(?:https?:\/\/)?s3(?:-[a-z0-9\-]+)?\.amazonaws\.com\/([a-z0-9.\-_]+)/i,/^(?:https?:\/\/)?([a-z0-9.\-_]+)/i];return qq.each(patterns,function(idx,pattern){var match=pattern.exec(endpoint);if(match)return bucket=match[1],!1}),bucket},_getPrefixedParamName:function(name){return qq.indexOf(qq.s3.util.UNPREFIXED_PARAM_NAMES,name)>=0?name:qq.s3.util.AWS_PARAM_PREFIX+name},getPolicy:function(spec){var policy={},conditions=[],bucket=spec.bucket,date=spec.date,drift=spec.clockDrift,key=spec.key,accessKey=spec.accessKey,acl=spec.acl,type=spec.type,expectedStatus=spec.expectedStatus,sessionToken=spec.sessionToken,params=spec.params,successRedirectUrl=qq.s3.util.getSuccessRedirectAbsoluteUrl(spec.successRedirectUrl),minFileSize=spec.minFileSize,maxFileSize=spec.maxFileSize,reducedRedundancy=spec.reducedRedundancy,region=spec.region,serverSideEncryption=spec.serverSideEncryption,signatureVersion=spec.signatureVersion;return policy.expiration=qq.s3.util.getPolicyExpirationDate(date,drift),conditions.push({acl:acl}),conditions.push({bucket:bucket}),type&&conditions.push({"Content-Type":type}),expectedStatus&&conditions.push({success_action_status:expectedStatus.toString()}),successRedirectUrl&&conditions.push({success_action_redirect:successRedirectUrl}),reducedRedundancy&&(conditions.push({}),conditions[conditions.length-1][qq.s3.util.REDUCED_REDUNDANCY_PARAM_NAME]=qq.s3.util.REDUCED_REDUNDANCY_PARAM_VALUE),sessionToken&&(conditions.push({}),conditions[conditions.length-1][qq.s3.util.SESSION_TOKEN_PARAM_NAME]=sessionToken),serverSideEncryption&&(conditions.push({}),conditions[conditions.length-1][qq.s3.util.SERVER_SIDE_ENCRYPTION_PARAM_NAME]=qq.s3.util.SERVER_SIDE_ENCRYPTION_PARAM_VALUE),2===signatureVersion?conditions.push({key:key}):4===signatureVersion&&(conditions.push({}),conditions[conditions.length-1][qq.s3.util.ALGORITHM_PARAM_NAME]=qq.s3.util.V4_ALGORITHM_PARAM_VALUE,conditions.push({}),conditions[conditions.length-1].key=key,conditions.push({}),conditions[conditions.length-1][qq.s3.util.CREDENTIAL_PARAM_NAME]=qq.s3.util.getV4CredentialsString({date:date,key:accessKey,region:region}),conditions.push({}),conditions[conditions.length-1][qq.s3.util.DATE_PARAM_NAME]=qq.s3.util.getV4PolicyDate(date,drift)),qq.each(params,function(name,val){var awsParamName=qq.s3.util._getPrefixedParamName(name),param={};qq.indexOf(qq.s3.util.UNPREFIXED_PARAM_NAMES,awsParamName)>=0?param[awsParamName]=val:param[awsParamName]=encodeURIComponent(val),conditions.push(param)}),policy.conditions=conditions,qq.s3.util.enforceSizeLimits(policy,minFileSize,maxFileSize),policy},refreshPolicyCredentials:function(policy,newSessionToken){var sessionTokenFound=!1;qq.each(policy.conditions,function(oldCondIdx,oldCondObj){qq.each(oldCondObj,function(oldCondName,oldCondVal){oldCondName===qq.s3.util.SESSION_TOKEN_PARAM_NAME&&(oldCondObj[oldCondName]=newSessionToken,sessionTokenFound=!0)})}),sessionTokenFound||(policy.conditions.push({}),policy.conditions[policy.conditions.length-1][qq.s3.util.SESSION_TOKEN_PARAM_NAME]=newSessionToken)},generateAwsParams:function(spec,signPolicyCallback){var policyJson,awsParams={},customParams=spec.params,promise=new qq.Promise,sessionToken=spec.sessionToken,drift=spec.clockDrift,type=spec.type,key=spec.key,accessKey=spec.accessKey,acl=spec.acl,expectedStatus=spec.expectedStatus,successRedirectUrl=qq.s3.util.getSuccessRedirectAbsoluteUrl(spec.successRedirectUrl),reducedRedundancy=spec.reducedRedundancy,region=spec.region,serverSideEncryption=spec.serverSideEncryption,signatureVersion=spec.signatureVersion,now=new Date,log=spec.log;return spec.date=now,policyJson=qq.s3.util.getPolicy(spec),awsParams.key=key,type&&(awsParams["Content-Type"]=type),expectedStatus&&(awsParams.success_action_status=expectedStatus),successRedirectUrl&&(awsParams.success_action_redirect=successRedirectUrl),reducedRedundancy&&(awsParams[qq.s3.util.REDUCED_REDUNDANCY_PARAM_NAME]=qq.s3.util.REDUCED_REDUNDANCY_PARAM_VALUE),serverSideEncryption&&(awsParams[qq.s3.util.SERVER_SIDE_ENCRYPTION_PARAM_NAME]=qq.s3.util.SERVER_SIDE_ENCRYPTION_PARAM_VALUE),sessionToken&&(awsParams[qq.s3.util.SESSION_TOKEN_PARAM_NAME]=sessionToken),awsParams.acl=acl,qq.each(customParams,function(name,val){var awsParamName=qq.s3.util._getPrefixedParamName(name);qq.indexOf(qq.s3.util.UNPREFIXED_PARAM_NAMES,awsParamName)>=0?awsParams[awsParamName]=val:awsParams[awsParamName]=encodeURIComponent(val)}),2===signatureVersion?awsParams.AWSAccessKeyId=accessKey:4===signatureVersion&&(awsParams[qq.s3.util.ALGORITHM_PARAM_NAME]=qq.s3.util.V4_ALGORITHM_PARAM_VALUE,awsParams[qq.s3.util.CREDENTIAL_PARAM_NAME]=qq.s3.util.getV4CredentialsString({date:now,key:accessKey,region:region}),awsParams[qq.s3.util.DATE_PARAM_NAME]=qq.s3.util.getV4PolicyDate(now,drift)),signPolicyCallback(policyJson).then(function(policyAndSignature,updatedAccessKey,updatedSessionToken){awsParams.policy=policyAndSignature.policy,2===spec.signatureVersion?(awsParams.signature=policyAndSignature.signature,updatedAccessKey&&(awsParams.AWSAccessKeyId=updatedAccessKey)):4===spec.signatureVersion&&(awsParams[qq.s3.util.V4_SIGNATURE_PARAM_NAME]=policyAndSignature.signature),updatedSessionToken&&(awsParams[qq.s3.util.SESSION_TOKEN_PARAM_NAME]=updatedSessionToken),promise.success(awsParams)},function(errorMessage){errorMessage=errorMessage||"Can't continue further with request to S3 as we did not receive a valid signature and policy from the server.",log("Policy signing failed.  "+errorMessage,"error"),promise.failure(errorMessage)}),promise},enforceSizeLimits:function(policy,minSize,maxSize){var adjustedMinSize=minSize<0?0:minSize,adjustedMaxSize=maxSize<=0?9007199254740992:maxSize;(minSize>0||maxSize>0)&&policy.conditions.push(["content-length-range",adjustedMinSize.toString(),adjustedMaxSize.toString()])},getPolicyExpirationDate:function(date,drift){var adjustedDate=new Date(date.getTime()+drift);return qq.s3.util.getPolicyDate(adjustedDate,5)},getCredentialsDate:function(date){return date.getUTCFullYear()+""+("0"+(date.getUTCMonth()+1)).slice(-2)+("0"+date.getUTCDate()).slice(-2)},getPolicyDate:function(date,_minutesToAdd_){var pad,r,minutesToAdd=_minutesToAdd_||0;return date.setMinutes(date.getMinutes()+(minutesToAdd||0)),Date.prototype.toISOString?date.toISOString():(pad=function(number){return r=String(number),1===r.length&&(r="0"+r),r},date.getUTCFullYear()+"-"+pad(date.getUTCMonth()+1)+"-"+pad(date.getUTCDate())+"T"+pad(date.getUTCHours())+":"+pad(date.getUTCMinutes())+":"+pad(date.getUTCSeconds())+"."+String((date.getUTCMilliseconds()/1e3).toFixed(3)).slice(2,5)+"Z")},parseIframeResponse:function(iframe){var doc=iframe.contentDocument||iframe.contentWindow.document,queryString=doc.location.search,match=/bucket=(.+)&key=(.+)&etag=(.+)/.exec(queryString);if(match)return{bucket:match[1],key:match[2],etag:match[3].replace(/%22/g,"")}},getSuccessRedirectAbsoluteUrl:function(successRedirectUrl){if(successRedirectUrl){var targetAnchor,targetAnchorContainer=document.createElement("div");return qq.ie7()?(targetAnchorContainer.innerHTML="<a href='"+successRedirectUrl+"'></a>",targetAnchor=targetAnchorContainer.firstChild,targetAnchor.href):(targetAnchor=document.createElement("a"),targetAnchor.href=successRedirectUrl,targetAnchor.href=targetAnchor.href,targetAnchor.href)}},getV4CredentialsString:function(spec){return spec.key+"/"+qq.s3.util.getCredentialsDate(spec.date)+"/"+spec.region+"/s3/aws4_request"},getV4PolicyDate:function(date,drift){var adjustedDate=new Date(date.getTime()+drift);return qq.s3.util.getCredentialsDate(adjustedDate)+"T"+("0"+adjustedDate.getUTCHours()).slice(-2)+("0"+adjustedDate.getUTCMinutes()).slice(-2)+("0"+adjustedDate.getUTCSeconds()).slice(-2)+"Z"},encodeQueryStringParam:function(param){var percentEncoded=encodeURIComponent(param);return percentEncoded=percentEncoded.replace(/[!'()]/g,escape),percentEncoded=percentEncoded.replace(/\*/g,"%2A"),percentEncoded.replace(/%20/g,"+")},uriEscape:function(string){var output=encodeURIComponent(string);return output=output.replace(/[^A-Za-z0-9_.~\-%]+/g,escape),output=output.replace(/[*]/g,function(ch){return"%"+ch.charCodeAt(0).toString(16).toUpperCase()})},uriEscapePath:function(path){var parts=[];return qq.each(path.split("/"),function(idx,item){parts.push(qq.s3.util.uriEscape(item))}),parts.join("/")}}}(),function(){"use strict";qq.nonTraditionalBasePublicApi={setUploadSuccessParams:function(params,id){this._uploadSuccessParamsStore.set(params,id)},setUploadSuccessEndpoint:function(endpoint,id){this._uploadSuccessEndpointStore.set(endpoint,id)}},qq.nonTraditionalBasePrivateApi={_onComplete:function(id,name,result,xhr){var submitSuccessRequest,successAjaxRequester,success=!!result.success,self=this,onCompleteArgs=arguments,successEndpoint=this._uploadSuccessEndpointStore.get(id),successCustomHeaders=this._options.uploadSuccess.customHeaders,successMethod=this._options.uploadSuccess.method,cors=this._options.cors,promise=new qq.Promise,uploadSuccessParams=this._uploadSuccessParamsStore.get(id),fileParams=this._paramsStore.get(id),onSuccessFromServer=function(successRequestResult){delete self._failedSuccessRequestCallbacks[id],qq.extend(result,successRequestResult),qq.FineUploaderBasic.prototype._onComplete.apply(self,onCompleteArgs),promise.success(successRequestResult)},onFailureFromServer=function(successRequestResult){var callback=submitSuccessRequest;qq.extend(result,successRequestResult),result&&result.reset&&(callback=null),callback?self._failedSuccessRequestCallbacks[id]=callback:delete self._failedSuccessRequestCallbacks[id],self._onAutoRetry(id,name,result,xhr,callback)||(qq.FineUploaderBasic.prototype._onComplete.apply(self,onCompleteArgs),promise.failure(successRequestResult))};return success&&successEndpoint?(successAjaxRequester=new qq.UploadSuccessAjaxRequester({endpoint:successEndpoint,method:successMethod,customHeaders:successCustomHeaders,cors:cors,log:qq.bind(this.log,this)}),qq.extend(uploadSuccessParams,self._getEndpointSpecificParams(id,result,xhr),!0),fileParams&&qq.extend(uploadSuccessParams,fileParams,!0),submitSuccessRequest=qq.bind(function(){successAjaxRequester.sendSuccessRequest(id,uploadSuccessParams).then(onSuccessFromServer,onFailureFromServer)},self),submitSuccessRequest(),promise):qq.FineUploaderBasic.prototype._onComplete.apply(this,arguments)},_manualRetry:function(id){var successRequestCallback=this._failedSuccessRequestCallbacks[id];return qq.FineUploaderBasic.prototype._manualRetry.call(this,id,successRequestCallback)}}}(),function(){"use strict";qq.s3.FineUploaderBasic=function(o){var options={request:{accessKey:null,clockDrift:0},objectProperties:{acl:"private",bucket:qq.bind(function(id){return qq.s3.util.getBucket(this.getEndpoint(id))},this),host:qq.bind(function(id){return/(?:http|https):\/\/(.+)(?:\/.+)?/.exec(this._endpointStore.get(id))[1]},this),key:"uuid",reducedRedundancy:!1,region:"us-east-1",serverSideEncryption:!1},credentials:{accessKey:null,secretKey:null,expiration:null,sessionToken:null},signature:{customHeaders:{},endpoint:null,version:2},uploadSuccess:{endpoint:null,method:"POST",params:{},customHeaders:{}},iframeSupport:{localBlankPagePath:null},chunking:{partSize:5242880},cors:{allowXdr:!0},callbacks:{onCredentialsExpired:function(){}}};qq.extend(options,o,!0),this.setCredentials(options.credentials,!0)||(this._currentCredentials.accessKey=options.request.accessKey),this._aclStore=this._createStore(options.objectProperties.acl),qq.FineUploaderBasic.call(this,options),this._uploadSuccessParamsStore=this._createStore(this._options.uploadSuccess.params),this._uploadSuccessEndpointStore=this._createStore(this._options.uploadSuccess.endpoint),this._failedSuccessRequestCallbacks={},this._cannedKeys={},this._cannedBuckets={},this._buckets={},this._hosts={}},qq.extend(qq.s3.FineUploaderBasic.prototype,qq.basePublicApi),qq.extend(qq.s3.FineUploaderBasic.prototype,qq.basePrivateApi),qq.extend(qq.s3.FineUploaderBasic.prototype,qq.nonTraditionalBasePublicApi),qq.extend(qq.s3.FineUploaderBasic.prototype,qq.nonTraditionalBasePrivateApi),qq.extend(qq.s3.FineUploaderBasic.prototype,{getBucket:function(id){return null==this._cannedBuckets[id]?this._buckets[id]:this._cannedBuckets[id]},getKey:function(id){return null==this._cannedKeys[id]?this._handler.getThirdPartyFileId(id):this._cannedKeys[id]},reset:function(){qq.FineUploaderBasic.prototype.reset.call(this),this._failedSuccessRequestCallbacks=[],this._buckets={},this._hosts={}},setCredentials:function(credentials,ignoreEmpty){if(credentials&&credentials.secretKey){if(!credentials.accessKey)throw new qq.Error("Invalid credentials: no accessKey");if(!credentials.expiration)throw new qq.Error("Invalid credentials: no expiration");return this._currentCredentials=qq.extend({},credentials),qq.isString(credentials.expiration)&&(this._currentCredentials.expiration=new Date(credentials.expiration)),!0}if(!ignoreEmpty)throw new qq.Error("Invalid credentials parameter!");this._currentCredentials={}},setAcl:function(acl,id){this._aclStore.set(acl,id)},_createUploadHandler:function(){var self=this,additionalOptions={aclStore:this._aclStore,getBucket:qq.bind(this._determineBucket,this),getHost:qq.bind(this._determineHost,this),getKeyName:qq.bind(this._determineKeyName,this),iframeSupport:this._options.iframeSupport,objectProperties:this._options.objectProperties,signature:this._options.signature,clockDrift:this._options.request.clockDrift,validation:{minSizeLimit:this._options.validation.minSizeLimit,maxSizeLimit:this._options.validation.sizeLimit}};return qq.override(this._endpointStore,function(super_){return{get:function(id){var endpoint=super_.get(id);return endpoint.indexOf("http")<0?"http://"+endpoint:endpoint}}}),qq.override(this._paramsStore,function(super_){return{get:function(id){var oldParams=super_.get(id),modifiedParams={};return qq.each(oldParams,function(name,val){var paramName=name;qq.indexOf(qq.s3.util.CASE_SENSITIVE_PARAM_NAMES,paramName)<0&&(paramName=paramName.toLowerCase()),modifiedParams[paramName]=qq.isFunction(val)?val():val}),modifiedParams}}}),additionalOptions.signature.credentialsProvider={get:function(){return self._currentCredentials},onExpired:function(){var updateCredentials=new qq.Promise,callbackRetVal=self._options.callbacks.onCredentialsExpired();return qq.isGenericPromise(callbackRetVal)?callbackRetVal.then(function(credentials){try{self.setCredentials(credentials),updateCredentials.success()}catch(error){self.log("Invalid credentials returned from onCredentialsExpired callback! ("+error.message+")","error"),updateCredentials.failure("onCredentialsExpired did not return valid credentials.")}},function(errorMsg){self.log("onCredentialsExpired callback indicated failure! ("+errorMsg+")","error"),updateCredentials.failure("onCredentialsExpired callback failed.")}):(self.log("onCredentialsExpired callback did not return a promise!","error"),updateCredentials.failure("Unexpected return value for onCredentialsExpired.")),updateCredentials}},qq.FineUploaderBasic.prototype._createUploadHandler.call(this,additionalOptions,"s3")},_determineObjectPropertyValue:function(id,property){var maybe=this._options.objectProperties[property],promise=new qq.Promise,self=this;return qq.isFunction(maybe)?(maybe=maybe(id),qq.isGenericPromise(maybe)?promise=maybe:promise.success(maybe)):qq.isString(maybe)&&promise.success(maybe),promise.then(function(value){self["_"+property+"s"][id]=value},function(errorMsg){qq.log("Problem determining "+property+" for ID "+id+" ("+errorMsg+")","error")}),promise},_determineBucket:function(id){return this._determineObjectPropertyValue(id,"bucket")},_determineHost:function(id){return this._determineObjectPropertyValue(id,"host")},_determineKeyName:function(id,filename){var promise=new qq.Promise,keynameLogic=this._options.objectProperties.key,extension=qq.getExtension(filename),onGetKeynameFailure=promise.failure,onGetKeynameSuccess=function(keyname,extension){var keynameToUse=keyname;void 0!==extension&&(keynameToUse+="."+extension),promise.success(keynameToUse)};switch(keynameLogic){case"uuid":onGetKeynameSuccess(this.getUuid(id),extension);break;case"filename":onGetKeynameSuccess(filename);break;default:qq.isFunction(keynameLogic)?this._handleKeynameFunction(keynameLogic,id,onGetKeynameSuccess,onGetKeynameFailure):(this.log(keynameLogic+" is not a valid value for the s3.keyname option!","error"),onGetKeynameFailure())}return promise},_handleKeynameFunction:function(keynameFunc,id,successCallback,failureCallback){var self=this,onSuccess=function(keyname){successCallback(keyname)},onFailure=function(reason){self.log(qq.format("Failed to retrieve key name for {}.  Reason: {}",id,reason||"null"),"error"),failureCallback(reason)},keyname=keynameFunc.call(this,id);qq.isGenericPromise(keyname)?keyname.then(onSuccess,onFailure):null==keyname?onFailure():onSuccess(keyname)},_getEndpointSpecificParams:function(id,response,maybeXhr){var params={key:this.getKey(id),uuid:this.getUuid(id),name:this.getName(id),bucket:this.getBucket(id)};return maybeXhr&&maybeXhr.getResponseHeader("ETag")?params.etag=maybeXhr.getResponseHeader("ETag"):response.etag&&(params.etag=response.etag),params},_onSubmitDelete:function(id,onSuccessCallback){var additionalMandatedParams={key:this.getKey(id),bucket:this.getBucket(id)};return qq.FineUploaderBasic.prototype._onSubmitDelete.call(this,id,onSuccessCallback,additionalMandatedParams)},_addCannedFile:function(sessionData){var id;if(null==sessionData.s3Key)throw new qq.Error("Did not find s3Key property in server session response.  This is required!");return id=qq.FineUploaderBasic.prototype._addCannedFile.apply(this,arguments),this._cannedKeys[id]=sessionData.s3Key,this._cannedBuckets[id]=sessionData.s3Bucket,id}})}(),window.Uint8ClampedArray||(window.Uint8ClampedArray=function(){}),qq.s3.RequestSigner=function(o){"use strict";function handleSignatureReceived(id,xhrOrXdr,isError){var errorMessage,response,responseJson=xhrOrXdr.responseText,pendingSignatureData=pendingSignatures[id],promise=pendingSignatureData.promise,signatureConstructor=pendingSignatureData.signatureConstructor;if(delete pendingSignatures[id],responseJson)try{response=qq.parseJson(responseJson)}catch(error){options.log("Error attempting to parse signature response: "+error,"error")}response&&response.error?(isError=!0,errorMessage=response.error):response&&response.invalid?(isError=!0,errorMessage="Invalid policy document or request headers!"):response?options.expectingPolicy&&!response.policy?(isError=!0,errorMessage="Response does not include the base64 encoded policy!"):response.signature||(isError=!0,errorMessage="Response does not include the signature!"):(isError=!0,
errorMessage="Received an empty or invalid response from the server!"),isError?(errorMessage&&options.log(errorMessage,"error"),promise.failure(errorMessage)):signatureConstructor?generateHeaders(signatureConstructor,response.signature,promise):promise.success(response)}function getStringToSignArtifacts(id,version,requestInfo){var endOfUrl,signatureSpec,toSign,promise=new qq.Promise,method="POST",headerNames=[],headersStr="",now=new Date,generateStringToSign=function(requestInfo){var contentMd5,headerIndexesToRemove=[];return qq.each(requestInfo.headers,function(name){headerNames.push(name)}),headerNames.sort(),qq.each(headerNames,function(idx,headerName){qq.indexOf(qq.s3.util.UNSIGNABLE_REST_HEADER_NAMES,headerName)<0?headersStr+=headerName.toLowerCase()+":"+requestInfo.headers[headerName].trim()+"\n":"Content-MD5"===headerName?contentMd5=requestInfo.headers[headerName]:headerIndexesToRemove.unshift(idx)}),qq.each(headerIndexesToRemove,function(idx,headerIdx){headerNames.splice(headerIdx,1)}),signatureSpec={bucket:requestInfo.bucket,contentMd5:contentMd5,contentType:requestInfo.contentType,date:now,drift:options.signatureSpec.drift,endOfUrl:endOfUrl,hashedContent:requestInfo.hashedContent,headerNames:headerNames,headersStr:headersStr,method:method},toSign=2===version?v2.getStringToSign(signatureSpec):v4.getStringToSign(signatureSpec),{date:now,endOfUrl:endOfUrl,signedHeaders:4===version?v4.getSignedHeaders(signatureSpec.headerNames):null,toSign:4===version?toSign.hashed:toSign,toSignRaw:4===version?toSign.raw:toSign}};switch(requestInfo.type){case thisSignatureRequester.REQUEST_TYPE.MULTIPART_ABORT:method="DELETE",endOfUrl=qq.format("uploadId={}",requestInfo.uploadId);break;case thisSignatureRequester.REQUEST_TYPE.MULTIPART_INITIATE:endOfUrl="uploads";break;case thisSignatureRequester.REQUEST_TYPE.MULTIPART_COMPLETE:endOfUrl=qq.format("uploadId={}",requestInfo.uploadId);break;case thisSignatureRequester.REQUEST_TYPE.MULTIPART_UPLOAD:method="PUT",endOfUrl=qq.format("partNumber={}&uploadId={}",requestInfo.partNum,requestInfo.uploadId)}return endOfUrl=requestInfo.key+"?"+endOfUrl,4===version?v4.getEncodedHashedPayload(requestInfo.content).then(function(hashedContent){requestInfo.headers["x-amz-content-sha256"]=hashedContent,requestInfo.headers.Host=requestInfo.host,requestInfo.headers["x-amz-date"]=qq.s3.util.getV4PolicyDate(now,options.signatureSpec.drift),requestInfo.hashedContent=hashedContent,promise.success(generateStringToSign(requestInfo))},function(err){promise.failure(err)}):promise.success(generateStringToSign(requestInfo)),promise}function determineSignatureClientSide(id,toBeSigned,signatureEffort,updatedAccessKey,updatedSessionToken){var updatedHeaders;toBeSigned.signatureConstructor?(updatedSessionToken&&(updatedHeaders=toBeSigned.signatureConstructor.getHeaders(),updatedHeaders[qq.s3.util.SESSION_TOKEN_PARAM_NAME]=updatedSessionToken,toBeSigned.signatureConstructor.withHeaders(updatedHeaders)),toBeSigned.signatureConstructor.getToSign(id).then(function(signatureArtifacts){signApiRequest(toBeSigned.signatureConstructor,signatureArtifacts.stringToSign,signatureEffort)},function(err){signatureEffort.failure(err)})):(updatedSessionToken&&qq.s3.util.refreshPolicyCredentials(toBeSigned,updatedSessionToken),signPolicy(toBeSigned,signatureEffort,updatedAccessKey,updatedSessionToken))}function signPolicy(policy,signatureEffort,updatedAccessKey,updatedSessionToken){4===options.signatureSpec.version?v4.signPolicy(policy,signatureEffort,updatedAccessKey,updatedSessionToken):v2.signPolicy(policy,signatureEffort,updatedAccessKey,updatedSessionToken)}function signApiRequest(signatureConstructor,headersStr,signatureEffort){4===options.signatureSpec.version?v4.signApiRequest(signatureConstructor,headersStr,signatureEffort):v2.signApiRequest(signatureConstructor,headersStr,signatureEffort)}var requester,credentialsProvider,thisSignatureRequester=this,pendingSignatures={},options={expectingPolicy:!1,method:"POST",signatureSpec:{drift:0,credentialsProvider:{},endpoint:null,customHeaders:{},version:2},maxConnections:3,endpointStore:{},paramsStore:{},cors:{expected:!1,sendCredentials:!1},log:function(str,level){}},generateHeaders=function(signatureConstructor,signature,promise){var headers=signatureConstructor.getHeaders();4===options.signatureSpec.version?headers.Authorization=qq.s3.util.V4_ALGORITHM_PARAM_VALUE+" Credential="+options.signatureSpec.credentialsProvider.get().accessKey+"/"+qq.s3.util.getCredentialsDate(signatureConstructor.getRequestDate())+"/"+options.signatureSpec.region+"/s3/aws4_request,SignedHeaders="+signatureConstructor.getSignedHeaders()+",Signature="+signature:headers.Authorization="AWS "+options.signatureSpec.credentialsProvider.get().accessKey+":"+signature,promise.success(headers,signatureConstructor.getEndOfUrl())},v2={getStringToSign:function(signatureSpec){return qq.format("{}\n{}\n{}\n\n{}/{}/{}",signatureSpec.method,signatureSpec.contentMd5||"",signatureSpec.contentType||"",signatureSpec.headersStr||"\n",signatureSpec.bucket,signatureSpec.endOfUrl)},signApiRequest:function(signatureConstructor,headersStr,signatureEffort){var headersWordArray=qq.CryptoJS.enc.Utf8.parse(headersStr),headersHmacSha1=qq.CryptoJS.HmacSHA1(headersWordArray,credentialsProvider.get().secretKey),headersHmacSha1Base64=qq.CryptoJS.enc.Base64.stringify(headersHmacSha1);generateHeaders(signatureConstructor,headersHmacSha1Base64,signatureEffort)},signPolicy:function(policy,signatureEffort,updatedAccessKey,updatedSessionToken){var policyStr=JSON.stringify(policy),policyWordArray=qq.CryptoJS.enc.Utf8.parse(policyStr),base64Policy=qq.CryptoJS.enc.Base64.stringify(policyWordArray),policyHmacSha1=qq.CryptoJS.HmacSHA1(base64Policy,credentialsProvider.get().secretKey),policyHmacSha1Base64=qq.CryptoJS.enc.Base64.stringify(policyHmacSha1);signatureEffort.success({policy:base64Policy,signature:policyHmacSha1Base64},updatedAccessKey,updatedSessionToken)}},v4={getCanonicalQueryString:function(endOfUri){var encodedQueryParams,encodedQueryParamNames,queryStrings,queryParamIdx=endOfUri.indexOf("?"),canonicalQueryString="";return queryParamIdx>=0&&(encodedQueryParams={},queryStrings=endOfUri.substr(queryParamIdx+1).split("&"),qq.each(queryStrings,function(idx,queryString){var nameAndVal=queryString.split("="),paramVal=nameAndVal[1];null==paramVal&&(paramVal=""),encodedQueryParams[encodeURIComponent(nameAndVal[0])]=encodeURIComponent(paramVal)}),encodedQueryParamNames=Object.keys(encodedQueryParams).sort(),encodedQueryParamNames.forEach(function(encodedQueryParamName,idx){canonicalQueryString+=encodedQueryParamName+"="+encodedQueryParams[encodedQueryParamName],idx<encodedQueryParamNames.length-1&&(canonicalQueryString+="&")})),canonicalQueryString},getCanonicalRequest:function(signatureSpec){return qq.format("{}\n{}\n{}\n{}\n{}\n{}",signatureSpec.method,v4.getCanonicalUri(signatureSpec.endOfUrl),v4.getCanonicalQueryString(signatureSpec.endOfUrl),signatureSpec.headersStr||"\n",v4.getSignedHeaders(signatureSpec.headerNames),signatureSpec.hashedContent)},getCanonicalUri:function(endOfUri){var path=endOfUri,queryParamIdx=endOfUri.indexOf("?");return queryParamIdx>0&&(path=endOfUri.substr(0,queryParamIdx)),"/"+path},getEncodedHashedPayload:function(body){var reader,promise=new qq.Promise;return qq.isBlob(body)?(reader=new FileReader,reader.onloadend=function(e){if(e.target.readyState===FileReader.DONE)if(e.target.error)promise.failure(e.target.error);else{var wordArray=qq.CryptoJS.lib.WordArray.create(e.target.result);promise.success(qq.CryptoJS.SHA256(wordArray).toString())}},reader.readAsArrayBuffer(body)):(body=body||"",promise.success(qq.CryptoJS.SHA256(body).toString())),promise},getScope:function(date,region){return qq.s3.util.getCredentialsDate(date)+"/"+region+"/s3/aws4_request"},getStringToSign:function(signatureSpec){var canonicalRequest=v4.getCanonicalRequest(signatureSpec),date=qq.s3.util.getV4PolicyDate(signatureSpec.date,signatureSpec.drift),hashedRequest=qq.CryptoJS.SHA256(canonicalRequest).toString(),scope=v4.getScope(signatureSpec.date,options.signatureSpec.region),stringToSignTemplate="AWS4-HMAC-SHA256\n{}\n{}\n{}";return{hashed:qq.format(stringToSignTemplate,date,scope,hashedRequest),raw:qq.format(stringToSignTemplate,date,scope,canonicalRequest)}},getSignedHeaders:function(headerNames){var signedHeaders="";return headerNames.forEach(function(headerName,idx){signedHeaders+=headerName.toLowerCase(),idx<headerNames.length-1&&(signedHeaders+=";")}),signedHeaders},signApiRequest:function(signatureConstructor,headersStr,signatureEffort){var dateKey,dateRegionKey,dateRegionServiceKey,signingKey,secretKey=credentialsProvider.get().secretKey,headersPattern=/.+\n.+\n(\d+)\/(.+)\/s3\/.+\n(.+)/,matches=headersPattern.exec(headersStr);dateKey=qq.CryptoJS.HmacSHA256(matches[1],"AWS4"+secretKey),dateRegionKey=qq.CryptoJS.HmacSHA256(matches[2],dateKey),dateRegionServiceKey=qq.CryptoJS.HmacSHA256("s3",dateRegionKey),signingKey=qq.CryptoJS.HmacSHA256("aws4_request",dateRegionServiceKey),generateHeaders(signatureConstructor,qq.CryptoJS.HmacSHA256(headersStr,signingKey),signatureEffort)},signPolicy:function(policy,signatureEffort,updatedAccessKey,updatedSessionToken){var matches,dateKey,dateRegionKey,dateRegionServiceKey,signingKey,policyStr=JSON.stringify(policy),policyWordArray=qq.CryptoJS.enc.Utf8.parse(policyStr),base64Policy=qq.CryptoJS.enc.Base64.stringify(policyWordArray),secretKey=credentialsProvider.get().secretKey,credentialPattern=/.+\/(.+)\/(.+)\/s3\/aws4_request/,credentialCondition=function(){var credential=null;return qq.each(policy.conditions,function(key,condition){var val=condition["x-amz-credential"];if(val)return credential=val,!1}),credential}();matches=credentialPattern.exec(credentialCondition),dateKey=qq.CryptoJS.HmacSHA256(matches[1],"AWS4"+secretKey),dateRegionKey=qq.CryptoJS.HmacSHA256(matches[2],dateKey),dateRegionServiceKey=qq.CryptoJS.HmacSHA256("s3",dateRegionKey),signingKey=qq.CryptoJS.HmacSHA256("aws4_request",dateRegionServiceKey),signatureEffort.success({policy:base64Policy,signature:qq.CryptoJS.HmacSHA256(base64Policy,signingKey).toString()},updatedAccessKey,updatedSessionToken)}};qq.extend(options,o,!0),credentialsProvider=options.signatureSpec.credentialsProvider,requester=qq.extend(this,new qq.AjaxRequester({acceptHeader:"application/json",method:options.method,contentType:"application/json; charset=utf-8",endpointStore:{get:function(){return options.signatureSpec.endpoint}},paramsStore:options.paramsStore,maxConnections:options.maxConnections,customHeaders:options.signatureSpec.customHeaders,log:options.log,onComplete:handleSignatureReceived,cors:options.cors})),qq.extend(this,{getSignature:function(id,toBeSigned){var queryParams,params=toBeSigned,signatureConstructor=toBeSigned.signatureConstructor,signatureEffort=new qq.Promise;return 4===options.signatureSpec.version&&(queryParams={v4:!0}),credentialsProvider.get().secretKey&&qq.CryptoJS?credentialsProvider.get().expiration.getTime()>Date.now()?determineSignatureClientSide(id,toBeSigned,signatureEffort):credentialsProvider.onExpired().then(function(){determineSignatureClientSide(id,toBeSigned,signatureEffort,credentialsProvider.get().accessKey,credentialsProvider.get().sessionToken)},function(errorMsg){options.log("Attempt to update expired credentials apparently failed! Unable to sign request.  ","error"),signatureEffort.failure("Unable to sign request - expired credentials.")}):(options.log("Submitting S3 signature request for "+id),signatureConstructor?signatureConstructor.getToSign(id).then(function(signatureArtifacts){params={headers:signatureArtifacts.stringToSignRaw},requester.initTransport(id).withParams(params).withQueryParams(queryParams).send()},function(err){options.log("Failed to construct signature. ","error"),signatureEffort.failure("Failed to construct signature.")}):requester.initTransport(id).withParams(params).withQueryParams(queryParams).send(),pendingSignatures[id]={promise:signatureEffort,signatureConstructor:signatureConstructor}),signatureEffort},constructStringToSign:function(type,bucket,host,key){var uploadId,content,contentType,partNum,artifacts,headers={};return{withHeaders:function(theHeaders){return headers=theHeaders,this},withUploadId:function(theUploadId){return uploadId=theUploadId,this},withContent:function(theContent){return content=theContent,this},withContentType:function(theContentType){return contentType=theContentType,this},withPartNum:function(thePartNum){return partNum=thePartNum,this},getToSign:function(id){var sessionToken=credentialsProvider.get().sessionToken,promise=new qq.Promise,adjustedDate=new Date(Date.now()+options.signatureSpec.drift);return headers["x-amz-date"]=adjustedDate.toUTCString(),sessionToken&&(headers[qq.s3.util.SESSION_TOKEN_PARAM_NAME]=sessionToken),getStringToSignArtifacts(id,options.signatureSpec.version,{bucket:bucket,content:content,contentType:contentType,headers:headers,host:host,key:key,partNum:partNum,type:type,uploadId:uploadId}).then(function(_artifacts_){artifacts=_artifacts_,promise.success({headers:function(){return contentType&&(headers["Content-Type"]=contentType),delete headers.Host,headers}(),date:artifacts.date,endOfUrl:artifacts.endOfUrl,signedHeaders:artifacts.signedHeaders,stringToSign:artifacts.toSign,stringToSignRaw:artifacts.toSignRaw})},function(err){promise.failure(err)}),promise},getHeaders:function(){return qq.extend({},headers)},getEndOfUrl:function(){return artifacts&&artifacts.endOfUrl},getRequestDate:function(){return artifacts&&artifacts.date},getSignedHeaders:function(){return artifacts&&artifacts.signedHeaders}}}})},qq.s3.RequestSigner.prototype.REQUEST_TYPE={MULTIPART_INITIATE:"multipart_initiate",MULTIPART_COMPLETE:"multipart_complete",MULTIPART_ABORT:"multipart_abort",MULTIPART_UPLOAD:"multipart_upload"},qq.UploadSuccessAjaxRequester=function(o){"use strict";function handleSuccessResponse(id,xhrOrXdr,isError){var parsedResponse,promise=pendingRequests[id],responseJson=xhrOrXdr.responseText,successIndicator={success:!0},failureIndicator={success:!1};delete pendingRequests[id],options.log(qq.format("Received the following response body to an upload success request for id {}: {}",id,responseJson));try{parsedResponse=qq.parseJson(responseJson),isError||parsedResponse&&(parsedResponse.error||!1===parsedResponse.success)?(options.log("Upload success request was rejected by the server.","error"),promise.failure(qq.extend(parsedResponse,failureIndicator))):(options.log("Upload success was acknowledged by the server."),promise.success(qq.extend(parsedResponse,successIndicator)))}catch(error){isError?(options.log(qq.format("Your server indicated failure in its upload success request response for id {}!",id),"error"),promise.failure(failureIndicator)):(options.log("Upload success was acknowledged by the server."),promise.success(successIndicator))}}var requester,pendingRequests=[],options={method:"POST",endpoint:null,maxConnections:3,customHeaders:{},paramsStore:{},cors:{expected:!1,sendCredentials:!1},log:function(str,level){}};qq.extend(options,o),requester=qq.extend(this,new qq.AjaxRequester({acceptHeader:"application/json",method:options.method,endpointStore:{get:function(){return options.endpoint}},paramsStore:options.paramsStore,maxConnections:options.maxConnections,customHeaders:options.customHeaders,log:options.log,onComplete:handleSuccessResponse,cors:options.cors})),qq.extend(this,{sendSuccessRequest:function(id,spec){var promise=new qq.Promise;return options.log("Submitting upload success request/notification for "+id),requester.initTransport(id).withParams(spec).send(),pendingRequests[id]=promise,promise}})},qq.s3.InitiateMultipartAjaxRequester=function(o){"use strict";function getHeaders(id){var signatureConstructor,bucket=options.getBucket(id),host=options.getHost(id),headers={},promise=new qq.Promise,key=options.getKey(id);return headers["x-amz-acl"]=options.aclStore.get(id),options.reducedRedundancy&&(headers[qq.s3.util.REDUCED_REDUNDANCY_PARAM_NAME]=qq.s3.util.REDUCED_REDUNDANCY_PARAM_VALUE),options.serverSideEncryption&&(headers[qq.s3.util.SERVER_SIDE_ENCRYPTION_PARAM_NAME]=qq.s3.util.SERVER_SIDE_ENCRYPTION_PARAM_VALUE),headers[qq.s3.util.AWS_PARAM_PREFIX+options.filenameParam]=encodeURIComponent(options.getName(id)),qq.each(options.paramsStore.get(id),function(name,val){qq.indexOf(qq.s3.util.UNPREFIXED_PARAM_NAMES,name)>=0?headers[name]=val:headers[qq.s3.util.AWS_PARAM_PREFIX+name]=encodeURIComponent(val)}),signatureConstructor=getSignatureAjaxRequester.constructStringToSign(getSignatureAjaxRequester.REQUEST_TYPE.MULTIPART_INITIATE,bucket,host,key).withContentType(options.getContentType(id)).withHeaders(headers),getSignatureAjaxRequester.getSignature(id,{signatureConstructor:signatureConstructor}).then(promise.success,promise.failure),promise}function handleInitiateRequestComplete(id,xhr,isError){var uploadIdElements,messageElements,uploadId,errorMessage,status,promise=pendingInitiateRequests[id],domParser=new DOMParser,responseDoc=domParser.parseFromString(xhr.responseText,"application/xml");delete pendingInitiateRequests[id],isError?(status=xhr.status,messageElements=responseDoc.getElementsByTagName("Message"),messageElements.length>0&&(errorMessage=messageElements[0].textContent)):(uploadIdElements=responseDoc.getElementsByTagName("UploadId"),uploadIdElements.length>0?uploadId=uploadIdElements[0].textContent:errorMessage="Upload ID missing from request"),void 0===uploadId?(errorMessage?options.log(qq.format("Specific problem detected initiating multipart upload request for {}: '{}'.",id,errorMessage),"error"):options.log(qq.format("Unexplained error with initiate multipart upload request for {}.  Status code {}.",id,status),"error"),promise.failure("Problem initiating upload request.",xhr)):(options.log(qq.format("Initiate multipart upload request successful for {}.  Upload ID is {}",id,uploadId)),promise.success(uploadId,xhr))}var requester,getSignatureAjaxRequester,pendingInitiateRequests={},options={filenameParam:"qqfilename",method:"POST",endpointStore:null,paramsStore:null,signatureSpec:null,aclStore:null,reducedRedundancy:!1,serverSideEncryption:!1,maxConnections:3,getContentType:function(id){},getBucket:function(id){},getHost:function(id){},getKey:function(id){},getName:function(id){},log:function(str,level){}};qq.extend(options,o),getSignatureAjaxRequester=new qq.s3.RequestSigner({endpointStore:options.endpointStore,signatureSpec:options.signatureSpec,cors:options.cors,log:options.log}),requester=qq.extend(this,new qq.AjaxRequester({method:options.method,contentType:null,endpointStore:options.endpointStore,maxConnections:options.maxConnections,allowXRequestedWithAndCacheControl:!1,log:options.log,onComplete:handleInitiateRequestComplete,successfulResponseCodes:{POST:[200]}})),qq.extend(this,{send:function(id){var promise=new qq.Promise;return getHeaders(id).then(function(headers,endOfUrl){options.log("Submitting S3 initiate multipart upload request for "+id),pendingInitiateRequests[id]=promise,requester.initTransport(id).withPath(endOfUrl).withHeaders(headers).send()},promise.failure),promise}})},qq.s3.CompleteMultipartAjaxRequester=function(o){"use strict";function getHeaders(id,uploadId,body){var promise=new qq.Promise,bucket=options.getBucket(id),host=options.getHost(id),signatureConstructor=getSignatureAjaxRequester.constructStringToSign(getSignatureAjaxRequester.REQUEST_TYPE.MULTIPART_COMPLETE,bucket,host,options.getKey(id)).withUploadId(uploadId).withContent(body).withContentType("application/xml; charset=UTF-8");return getSignatureAjaxRequester.getSignature(id,{signatureConstructor:signatureConstructor}).then(promise.success,promise.failure),promise}function handleCompleteRequestComplete(id,xhr,isError){var promise=pendingCompleteRequests[id],domParser=new DOMParser,bucket=options.getBucket(id),responseDoc=(options.getKey(id),domParser.parseFromString(xhr.responseText,"application/xml")),bucketEls=responseDoc.getElementsByTagName("Bucket"),keyEls=responseDoc.getElementsByTagName("Key");delete pendingCompleteRequests[id],options.log(qq.format("Complete response status {}, body = {}",xhr.status,xhr.responseText)),isError?options.log(qq.format("Complete Multipart Upload request for {} failed with status {}.",id,xhr.status),"error"):bucketEls.length&&keyEls.length?bucketEls[0].textContent!==bucket&&(isError=!0,options.log(qq.format("Wrong bucket in response to Complete Multipart Upload request for {}.",id),"error")):(isError=!0,options.log(qq.format("Missing bucket and/or key in response to Complete Multipart Upload request for {}.",id),"error")),isError?promise.failure("Problem combining the file parts!",xhr):promise.success({},xhr)}function getCompleteRequestBody(etagEntries){var doc=document.implementation.createDocument(null,"CompleteMultipartUpload",null);return etagEntries.sort(function(a,b){return a.part-b.part}),qq.each(etagEntries,function(idx,etagEntry){var part=etagEntry.part,etag=etagEntry.etag,partEl=doc.createElement("Part"),partNumEl=doc.createElement("PartNumber"),partNumTextEl=doc.createTextNode(part),etagTextEl=doc.createTextNode(etag),etagEl=doc.createElement("ETag");etagEl.appendChild(etagTextEl),partNumEl.appendChild(partNumTextEl),partEl.appendChild(partNumEl),partEl.appendChild(etagEl),qq(doc).children()[0].appendChild(partEl)}),(new XMLSerializer).serializeToString(doc)}var requester,getSignatureAjaxRequester,pendingCompleteRequests={},options={method:"POST",contentType:"text/xml",endpointStore:null,signatureSpec:null,maxConnections:3,getBucket:function(id){},getHost:function(id){},getKey:function(id){},log:function(str,level){}};qq.extend(options,o),getSignatureAjaxRequester=new qq.s3.RequestSigner({endpointStore:options.endpointStore,signatureSpec:options.signatureSpec,cors:options.cors,log:options.log}),requester=qq.extend(this,new qq.AjaxRequester({method:options.method,contentType:"application/xml; charset=UTF-8",endpointStore:options.endpointStore,maxConnections:options.maxConnections,allowXRequestedWithAndCacheControl:!1,log:options.log,onComplete:handleCompleteRequestComplete,successfulResponseCodes:{POST:[200]}})),qq.extend(this,{send:function(id,uploadId,etagEntries){var promise=new qq.Promise,body=getCompleteRequestBody(etagEntries);return getHeaders(id,uploadId,body).then(function(headers,endOfUrl){options.log("Submitting S3 complete multipart upload request for "+id),pendingCompleteRequests[id]=promise,delete headers["Content-Type"],requester.initTransport(id).withPath(endOfUrl).withHeaders(headers).withPayload(body).send()},promise.failure),promise}})},qq.s3.AbortMultipartAjaxRequester=function(o){"use strict";function getHeaders(id,uploadId){var promise=new qq.Promise,bucket=options.getBucket(id),host=options.getHost(id),signatureConstructor=getSignatureAjaxRequester.constructStringToSign(getSignatureAjaxRequester.REQUEST_TYPE.MULTIPART_ABORT,bucket,host,options.getKey(id)).withUploadId(uploadId);return getSignatureAjaxRequester.getSignature(id,{signatureConstructor:signatureConstructor}).then(promise.success,promise.failure),promise}function handleAbortRequestComplete(id,xhr,isError){var awsErrorMsg,domParser=new DOMParser,responseDoc=domParser.parseFromString(xhr.responseText,"application/xml"),errorEls=responseDoc.getElementsByTagName("Error");options.log(qq.format("Abort response status {}, body = {}",xhr.status,xhr.responseText)),isError?options.log(qq.format("Abort Multipart Upload request for {} failed with status {}.",id,xhr.status),"error"):errorEls.length?(isError=!0,awsErrorMsg=responseDoc.getElementsByTagName("Message")[0].textContent,options.log(qq.format("Failed to Abort Multipart Upload request for {}.  Error: {}",id,awsErrorMsg),"error")):options.log(qq.format("Abort MPU request succeeded for file ID {}.",id))}var requester,getSignatureAjaxRequester,options={method:"DELETE",endpointStore:null,signatureSpec:null,maxConnections:3,getBucket:function(id){},getHost:function(id){},getKey:function(id){},log:function(str,level){}};qq.extend(options,o),getSignatureAjaxRequester=new qq.s3.RequestSigner({endpointStore:options.endpointStore,signatureSpec:options.signatureSpec,cors:options.cors,log:options.log}),requester=qq.extend(this,new qq.AjaxRequester({validMethods:["DELETE"],method:options.method,contentType:null,endpointStore:options.endpointStore,maxConnections:options.maxConnections,allowXRequestedWithAndCacheControl:!1,log:options.log,onComplete:handleAbortRequestComplete,successfulResponseCodes:{DELETE:[204]}})),qq.extend(this,{send:function(id,uploadId){getHeaders(id,uploadId).then(function(headers,endOfUrl){options.log("Submitting S3 Abort multipart upload request for "+id),requester.initTransport(id).withPath(endOfUrl).withHeaders(headers).send()})}})},qq.s3.XhrUploadHandler=function(spec,proxy){"use strict";var getName=proxy.getName,log=proxy.log,clockDrift=spec.clockDrift,expectedStatus=200,onGetBucket=spec.getBucket,onGetHost=spec.getHost,onGetKeyName=spec.getKeyName,filenameParam=spec.filenameParam,paramsStore=spec.paramsStore,endpointStore=spec.endpointStore,aclStore=spec.aclStore,reducedRedundancy=spec.objectProperties.reducedRedundancy,region=spec.objectProperties.region,serverSideEncryption=spec.objectProperties.serverSideEncryption,validation=spec.validation,signature=qq.extend({region:region,drift:clockDrift},spec.signature),handler=this,credentialsProvider=spec.signature.credentialsProvider,chunked={combine:function(id){var uploadId=handler._getPersistableData(id).uploadId,etagMap=handler._getPersistableData(id).etags,result=new qq.Promise;return requesters.completeMultipart.send(id,uploadId,etagMap).then(result.success,function(reason,xhr){result.failure(upload.done(id,xhr).response,xhr)}),result},done:function(id,xhr,chunkIdx){var etag,response=upload.response.parse(id,xhr);response.success&&(etag=xhr.getResponseHeader("ETag"),handler._getPersistableData(id).etags||(handler._getPersistableData(id).etags=[]),handler._getPersistableData(id).etags.push({part:chunkIdx+1,etag:etag}))},initHeaders:function(id,chunkIdx,blob){var bucket=upload.bucket.getName(id),host=upload.host.getName(id),key=upload.key.urlSafe(id),promise=new qq.Promise,signatureConstructor=requesters.restSignature.constructStringToSign(requesters.restSignature.REQUEST_TYPE.MULTIPART_UPLOAD,bucket,host,key).withPartNum(chunkIdx+1).withContent(blob).withUploadId(handler._getPersistableData(id).uploadId);return requesters.restSignature.getSignature(id+"."+chunkIdx,{signatureConstructor:signatureConstructor}).then(promise.success,promise.failure),promise},put:function(id,chunkIdx){var xhr=handler._createXhr(id,chunkIdx),chunkData=handler._getChunkData(id,chunkIdx),domain=spec.endpointStore.get(id),promise=new qq.Promise;return chunked.initHeaders(id,chunkIdx,chunkData.blob).then(function(headers,endOfUrl){if(xhr._cancelled)log(qq.format("Upload of item {}.{} cancelled. Upload will not start after successful signature request.",id,chunkIdx)),promise.failure({error:"Chunk upload cancelled"});else{var url=domain+"/"+endOfUrl;handler._registerProgressHandler(id,chunkIdx,chunkData.size),upload.track(id,xhr,chunkIdx).then(promise.success,promise.failure),xhr.open("PUT",url,!0),qq.each(headers,function(name,val){xhr.setRequestHeader(name,val)}),xhr.send(chunkData.blob)}},function(){promise.failure({error:"Problem signing the chunk!"},xhr)}),promise},send:function(id,chunkIdx){var promise=new qq.Promise;return chunked.setup(id).then(function(){chunked.put(id,chunkIdx).then(promise.success,promise.failure)},function(errorMessage,xhr){promise.failure({error:errorMessage},xhr)}),promise},setup:function(id){var promise=new qq.Promise,uploadId=handler._getPersistableData(id).uploadId,uploadIdPromise=new qq.Promise;return uploadId?uploadId instanceof qq.Promise?uploadId.then(function(uploadId){promise.success(uploadId)}):promise.success(uploadId):(handler._getPersistableData(id).uploadId=uploadIdPromise,requesters.initiateMultipart.send(id).then(function(uploadId){handler._getPersistableData(id).uploadId=uploadId,uploadIdPromise.success(uploadId),promise.success(uploadId)},function(errorMsg,xhr){handler._getPersistableData(id).uploadId=null,promise.failure(errorMsg,xhr),uploadIdPromise.failure(errorMsg,xhr)})),promise}},requesters={abortMultipart:new qq.s3.AbortMultipartAjaxRequester({endpointStore:endpointStore,signatureSpec:signature,cors:spec.cors,log:log,getBucket:function(id){return upload.bucket.getName(id)},getHost:function(id){return upload.host.getName(id)},getKey:function(id){return upload.key.urlSafe(id)}}),completeMultipart:new qq.s3.CompleteMultipartAjaxRequester({endpointStore:endpointStore,signatureSpec:signature,cors:spec.cors,log:log,getBucket:function(id){return upload.bucket.getName(id)},getHost:function(id){return upload.host.getName(id)},getKey:function(id){return upload.key.urlSafe(id)}}),initiateMultipart:new qq.s3.InitiateMultipartAjaxRequester({filenameParam:filenameParam,endpointStore:endpointStore,paramsStore:paramsStore,signatureSpec:signature,aclStore:aclStore,reducedRedundancy:reducedRedundancy,serverSideEncryption:serverSideEncryption,cors:spec.cors,log:log,getContentType:function(id){return handler._getMimeType(id)},getBucket:function(id){return upload.bucket.getName(id)},getHost:function(id){return upload.host.getName(id)},getKey:function(id){return upload.key.urlSafe(id)},getName:function(id){return getName(id)}}),policySignature:new qq.s3.RequestSigner({expectingPolicy:!0,signatureSpec:signature,cors:spec.cors,log:log}),restSignature:new qq.s3.RequestSigner({endpointStore:endpointStore,signatureSpec:signature,cors:spec.cors,log:log})},simple={initParams:function(id){var customParams=paramsStore.get(id);return customParams[filenameParam]=getName(id),qq.s3.util.generateAwsParams({endpoint:endpointStore.get(id),clockDrift:clockDrift,params:customParams,type:handler._getMimeType(id),bucket:upload.bucket.getName(id),key:handler.getThirdPartyFileId(id),accessKey:credentialsProvider.get().accessKey,sessionToken:credentialsProvider.get().sessionToken,acl:aclStore.get(id),expectedStatus:expectedStatus,minFileSize:validation.minSizeLimit,maxFileSize:validation.maxSizeLimit,reducedRedundancy:reducedRedundancy,region:region,serverSideEncryption:serverSideEncryption,signatureVersion:signature.version,log:log},qq.bind(requesters.policySignature.getSignature,this,id))},send:function(id){var promise=new qq.Promise,xhr=handler._createXhr(id),fileOrBlob=handler.getFile(id);return handler._registerProgressHandler(id),upload.track(id,xhr).then(promise.success,promise.failure),simple.setup(id,xhr,fileOrBlob).then(function(toSend){log("Sending upload request for "+id),xhr.send(toSend)},promise.failure),promise},setup:function(id,xhr,fileOrBlob){var formData=new FormData,endpoint=endpointStore.get(id),url=endpoint,promise=new qq.Promise;return simple.initParams(id).then(function(awsParams){xhr.open("POST",url,!0),qq.obj2FormData(awsParams,formData),formData.append("file",fileOrBlob),promise.success(formData)},function(errorMessage){promise.failure({error:errorMessage})}),promise}},upload={bucket:{promise:function(id){var promise=new qq.Promise,cachedBucket=handler._getFileState(id).bucket;return cachedBucket?promise.success(cachedBucket):onGetBucket(id).then(function(bucket){handler._getFileState(id).bucket=bucket,promise.success(bucket)},promise.failure),promise},getName:function(id){return handler._getFileState(id).bucket}},host:{promise:function(id){var promise=new qq.Promise,cachedHost=handler._getFileState(id).host;return cachedHost?promise.success(cachedHost):onGetHost(id).then(function(host){handler._getFileState(id).host=host,promise.success(host)},promise.failure),promise},getName:function(id){return handler._getFileState(id).host}},done:function(id,xhr){var response=upload.response.parse(id,xhr),isError=!0!==response.success
;return isError&&upload.response.shouldReset(response.code)&&(log("This is an unrecoverable error, we must restart the upload entirely on the next retry attempt.","error"),response.reset=!0),{success:!isError,response:response}},key:{promise:function(id){var promise=new qq.Promise,key=handler.getThirdPartyFileId(id);return null==key?(handler._setThirdPartyFileId(id,promise),onGetKeyName(id,getName(id)).then(function(keyName){handler._setThirdPartyFileId(id,keyName),promise.success(keyName)},function(errorReason){handler._setThirdPartyFileId(id,null),promise.failure(errorReason)})):qq.isGenericPromise(key)?key.then(promise.success,promise.failure):promise.success(key),promise},urlSafe:function(id){var encodedKey=handler.getThirdPartyFileId(id);return qq.s3.util.uriEscapePath(encodedKey)}},response:{parse:function(id,xhr){var parsedErrorProps,response={};try{log(qq.format("Received response status {} with body: {}",xhr.status,xhr.responseText)),xhr.status===expectedStatus?response.success=!0:(parsedErrorProps=upload.response.parseError(xhr.responseText))&&(response.error=parsedErrorProps.message,response.code=parsedErrorProps.code)}catch(error){log("Error when attempting to parse xhr response text ("+error.message+")","error")}return response},parseError:function(awsResponseXml){var codeEls,messageEls,parser=new DOMParser,parsedDoc=parser.parseFromString(awsResponseXml,"application/xml"),errorEls=parsedDoc.getElementsByTagName("Error"),errorDetails={};if(errorEls.length)return codeEls=parsedDoc.getElementsByTagName("Code"),messageEls=parsedDoc.getElementsByTagName("Message"),messageEls.length&&(errorDetails.message=messageEls[0].textContent),codeEls.length&&(errorDetails.code=codeEls[0].textContent),errorDetails},shouldReset:function(errorCode){return"EntityTooSmall"===errorCode||"InvalidPart"===errorCode||"InvalidPartOrder"===errorCode||"NoSuchUpload"===errorCode}},start:function(id,optChunkIdx){var promise=new qq.Promise;return upload.key.promise(id).then(function(){upload.bucket.promise(id).then(function(){upload.host.promise(id).then(function(){null==optChunkIdx?simple.send(id).then(promise.success,promise.failure):chunked.send(id,optChunkIdx).then(promise.success,promise.failure)})})},function(errorReason){promise.failure({error:errorReason})}),promise},track:function(id,xhr,optChunkIdx){var promise=new qq.Promise;return xhr.onreadystatechange=function(){if(4===xhr.readyState){var result;null==optChunkIdx?(result=upload.done(id,xhr),promise[result.success?"success":"failure"](result.response,xhr)):(chunked.done(id,xhr,optChunkIdx),result=upload.done(id,xhr),promise[result.success?"success":"failure"](result.response,xhr))}},promise}};qq.extend(this,{uploadChunk:upload.start,uploadFile:upload.start}),qq.extend(this,new qq.XhrUploadHandler({options:qq.extend({namespace:"s3"},spec),proxy:qq.extend({getEndpoint:spec.endpointStore.get},proxy)})),qq.override(this,function(super_){return{expunge:function(id){var uploadId=handler._getPersistableData(id)&&handler._getPersistableData(id).uploadId,existedInLocalStorage=handler._maybeDeletePersistedChunkData(id);void 0!==uploadId&&existedInLocalStorage&&requesters.abortMultipart.send(id,uploadId),super_.expunge(id)},finalizeChunks:function(id){return chunked.combine(id)},_getLocalStorageId:function(id){return super_._getLocalStorageId(id)+"-"+upload.bucket.getName(id)}}})},qq.s3.FormUploadHandler=function(options,proxy){"use strict";function isValidResponse(id,iframe){var doc,responseData,bucket=(options.endpointStore.get(id),handler._getFileState(id).bucket);try{if(doc=iframe.contentDocument||iframe.contentWindow.document,doc.body.innerHTML,responseData=qq.s3.util.parseIframeResponse(iframe),responseData.bucket===bucket&&responseData.key===qq.s3.util.encodeQueryStringParam(handler.getThirdPartyFileId(id)))return!0;log("Response from AWS included an unexpected bucket or key name.","error")}catch(error){log("Error when attempting to parse form upload response ("+error.message+")","error")}return!1}function generateAwsParams(id){var customParams=paramsStore.get(id);return customParams[filenameParam]=getName(id),qq.s3.util.generateAwsParams({endpoint:endpointStore.get(id),clockDrift:clockDrift,params:customParams,bucket:handler._getFileState(id).bucket,key:handler.getThirdPartyFileId(id),accessKey:credentialsProvider.get().accessKey,sessionToken:credentialsProvider.get().sessionToken,acl:aclStore.get(id),minFileSize:validation.minSizeLimit,maxFileSize:validation.maxSizeLimit,successRedirectUrl:successRedirectUrl,reducedRedundancy:reducedRedundancy,region:region,serverSideEncryption:serverSideEncryption,signatureVersion:signature.version,log:log},qq.bind(getSignatureAjaxRequester.getSignature,this,id))}function createForm(id,iframe){var promise=new qq.Promise,endpoint=options.endpointStore.get(id),fileName=getName(id);return generateAwsParams(id).then(function(params){var form=handler._initFormForUpload({method:"POST",endpoint:endpoint,params:params,paramsInBody:!0,targetName:iframe.name});promise.success(form)},function(errorMessage){promise.failure(errorMessage),handleFinishedUpload(id,iframe,fileName,{error:errorMessage})}),promise}function handleUpload(id){var iframe=handler._createIframe(id),input=handler.getInput(id),promise=new qq.Promise;return createForm(id,iframe).then(function(form){form.appendChild(input),handler._attachLoadEvent(iframe,function(response){log("iframe loaded"),response?!1===response.success&&(log("Amazon likely rejected the upload request","error"),promise.failure(response)):(response={},response.success=isValidResponse(id,iframe),!1===response.success?(log("A success response was received by Amazon, but it was invalid in some way.","error"),promise.failure(response)):(qq.extend(response,qq.s3.util.parseIframeResponse(iframe)),promise.success(response))),handleFinishedUpload(id,iframe)}),log("Sending upload request for "+id),form.submit(),qq(form).remove()},promise.failure),promise}function handleFinishedUpload(id,iframe){handler._detachLoadEvent(id),iframe&&qq(iframe).remove()}var handler=this,clockDrift=options.clockDrift,onUuidChanged=proxy.onUuidChanged,getName=proxy.getName,getUuid=proxy.getUuid,log=proxy.log,onGetBucket=options.getBucket,onGetKeyName=options.getKeyName,filenameParam=options.filenameParam,paramsStore=options.paramsStore,endpointStore=options.endpointStore,aclStore=options.aclStore,reducedRedundancy=options.objectProperties.reducedRedundancy,region=options.objectProperties.region,serverSideEncryption=options.objectProperties.serverSideEncryption,validation=options.validation,signature=options.signature,successRedirectUrl=options.iframeSupport.localBlankPagePath,credentialsProvider=options.signature.credentialsProvider,getSignatureAjaxRequester=new qq.s3.RequestSigner({signatureSpec:signature,cors:options.cors,log:log});if(void 0===successRedirectUrl)throw new Error("successRedirectEndpoint MUST be defined if you intend to use browsers that do not support the File API!");qq.extend(this,new qq.FormUploadHandler({options:{isCors:!1,inputName:"file"},proxy:{onCancel:options.onCancel,onUuidChanged:onUuidChanged,getName:getName,getUuid:getUuid,log:log}})),qq.extend(this,{uploadFile:function(id){var name=getName(id),promise=new qq.Promise;return handler.getThirdPartyFileId(id)?handler._getFileState(id).bucket?handleUpload(id).then(promise.success,promise.failure):onGetBucket(id).then(function(bucket){handler._getFileState(id).bucket=bucket,handleUpload(id).then(promise.success,promise.failure)}):onGetKeyName(id,name).then(function(key){onGetBucket(id).then(function(bucket){handler._getFileState(id).bucket=bucket,handler._setThirdPartyFileId(id,key),handleUpload(id).then(promise.success,promise.failure)},function(errorReason){promise.failure({error:errorReason})})},function(errorReason){promise.failure({error:errorReason})}),promise}})},function(){"use strict";qq.s3.FineUploader=function(o){var options={failedUploadTextDisplay:{mode:"custom"}};qq.extend(options,o,!0),qq.FineUploader.call(this,options,"s3"),qq.supportedFeatures.ajaxUploading||void 0!==options.iframeSupport.localBlankPagePath||(this._options.element.innerHTML="<div>You MUST set the <code>localBlankPagePath</code> property of the <code>iframeSupport</code> option since this browser does not support the File API!</div>")},qq.extend(qq.s3.FineUploader.prototype,qq.s3.FineUploaderBasic.prototype),qq.extend(qq.s3.FineUploader.prototype,qq.uiPublicApi),qq.extend(qq.s3.FineUploader.prototype,qq.uiPrivateApi)}(),qq.azure=qq.azure||{},qq.azure.util=qq.azure.util||function(){"use strict";return{AZURE_PARAM_PREFIX:"x-ms-meta-",_paramNameMatchesAzureParameter:function(name){switch(name){case"Cache-Control":case"Content-Disposition":case"Content-Encoding":case"Content-MD5":case"x-ms-blob-content-encoding":case"x-ms-blob-content-disposition":case"x-ms-blob-content-md5":case"x-ms-blob-cache-control":return!0;default:return!1}},_getPrefixedParamName:function(name){return qq.azure.util._paramNameMatchesAzureParameter(name)?name:qq.azure.util.AZURE_PARAM_PREFIX+name},getParamsAsHeaders:function(params){var headers={};return qq.each(params,function(name,val){var headerName=qq.azure.util._getPrefixedParamName(name),value=null;qq.isFunction(val)?value=String(val()):qq.isObject(val)?qq.extend(headers,qq.azure.util.getParamsAsHeaders(val)):value=String(val),null!==value&&(qq.azure.util._paramNameMatchesAzureParameter(name)?headers[headerName]=value:headers[headerName]=encodeURIComponent(value))}),headers},parseAzureError:function(responseText,log){var codeTag,messageTag,domParser=new DOMParser,responseDoc=domParser.parseFromString(responseText,"application/xml"),errorTag=responseDoc.getElementsByTagName("Error")[0],errorDetails={};if(log("Received error response: "+responseText,"error"),errorTag)return messageTag=errorTag.getElementsByTagName("Message")[0],messageTag&&(errorDetails.message=messageTag.textContent),codeTag=errorTag.getElementsByTagName("Code")[0],codeTag&&(errorDetails.code=codeTag.textContent),log("Parsed Azure error: "+JSON.stringify(errorDetails),"error"),errorDetails}}}(),function(){"use strict";qq.nonTraditionalBasePublicApi={setUploadSuccessParams:function(params,id){this._uploadSuccessParamsStore.set(params,id)},setUploadSuccessEndpoint:function(endpoint,id){this._uploadSuccessEndpointStore.set(endpoint,id)}},qq.nonTraditionalBasePrivateApi={_onComplete:function(id,name,result,xhr){var submitSuccessRequest,successAjaxRequester,success=!!result.success,self=this,onCompleteArgs=arguments,successEndpoint=this._uploadSuccessEndpointStore.get(id),successCustomHeaders=this._options.uploadSuccess.customHeaders,successMethod=this._options.uploadSuccess.method,cors=this._options.cors,promise=new qq.Promise,uploadSuccessParams=this._uploadSuccessParamsStore.get(id),fileParams=this._paramsStore.get(id),onSuccessFromServer=function(successRequestResult){delete self._failedSuccessRequestCallbacks[id],qq.extend(result,successRequestResult),qq.FineUploaderBasic.prototype._onComplete.apply(self,onCompleteArgs),promise.success(successRequestResult)},onFailureFromServer=function(successRequestResult){var callback=submitSuccessRequest;qq.extend(result,successRequestResult),result&&result.reset&&(callback=null),callback?self._failedSuccessRequestCallbacks[id]=callback:delete self._failedSuccessRequestCallbacks[id],self._onAutoRetry(id,name,result,xhr,callback)||(qq.FineUploaderBasic.prototype._onComplete.apply(self,onCompleteArgs),promise.failure(successRequestResult))};return success&&successEndpoint?(successAjaxRequester=new qq.UploadSuccessAjaxRequester({endpoint:successEndpoint,method:successMethod,customHeaders:successCustomHeaders,cors:cors,log:qq.bind(this.log,this)}),qq.extend(uploadSuccessParams,self._getEndpointSpecificParams(id,result,xhr),!0),fileParams&&qq.extend(uploadSuccessParams,fileParams,!0),submitSuccessRequest=qq.bind(function(){successAjaxRequester.sendSuccessRequest(id,uploadSuccessParams).then(onSuccessFromServer,onFailureFromServer)},self),submitSuccessRequest(),promise):qq.FineUploaderBasic.prototype._onComplete.apply(this,arguments)},_manualRetry:function(id){var successRequestCallback=this._failedSuccessRequestCallbacks[id];return qq.FineUploaderBasic.prototype._manualRetry.call(this,id,successRequestCallback)}}}(),function(){"use strict";qq.azure.FineUploaderBasic=function(o){if(!qq.supportedFeatures.ajaxUploading)throw new qq.Error("Uploading directly to Azure is not possible in this browser.");var options={signature:{endpoint:null,customHeaders:{}},blobProperties:{name:"uuid"},uploadSuccess:{endpoint:null,method:"POST",params:{},customHeaders:{}},chunking:{partSize:4e6,minFileSize:4000001}};qq.extend(options,o,!0),qq.FineUploaderBasic.call(this,options),this._uploadSuccessParamsStore=this._createStore(this._options.uploadSuccess.params),this._uploadSuccessEndpointStore=this._createStore(this._options.uploadSuccess.endpoint),this._failedSuccessRequestCallbacks={},this._cannedBlobNames={}},qq.extend(qq.azure.FineUploaderBasic.prototype,qq.basePublicApi),qq.extend(qq.azure.FineUploaderBasic.prototype,qq.basePrivateApi),qq.extend(qq.azure.FineUploaderBasic.prototype,qq.nonTraditionalBasePublicApi),qq.extend(qq.azure.FineUploaderBasic.prototype,qq.nonTraditionalBasePrivateApi),qq.extend(qq.azure.FineUploaderBasic.prototype,{getBlobName:function(id){return null==this._cannedBlobNames[id]?this._handler.getThirdPartyFileId(id):this._cannedBlobNames[id]},_getEndpointSpecificParams:function(id){return{blob:this.getBlobName(id),uuid:this.getUuid(id),name:this.getName(id),container:this._endpointStore.get(id)}},_createUploadHandler:function(){return qq.FineUploaderBasic.prototype._createUploadHandler.call(this,{signature:this._options.signature,onGetBlobName:qq.bind(this._determineBlobName,this),deleteBlob:qq.bind(this._deleteBlob,this,!0)},"azure")},_determineBlobName:function(id){var blobNameOptionValue=this._options.blobProperties.name,uuid=this.getUuid(id),filename=this.getName(id),fileExtension=qq.getExtension(filename),blobNameToUse=uuid;if(!qq.isString(blobNameOptionValue))return blobNameOptionValue.call(this,id);switch(blobNameOptionValue){case"uuid":return void 0!==fileExtension&&(blobNameToUse+="."+fileExtension),(new qq.Promise).success(blobNameToUse);case"filename":return(new qq.Promise).success(filename);default:return new qq.Promise.failure("Invalid blobName option value - "+blobNameOptionValue)}},_addCannedFile:function(sessionData){var id;if(null==sessionData.blobName)throw new qq.Error("Did not find blob name property in server session response.  This is required!");return id=qq.FineUploaderBasic.prototype._addCannedFile.apply(this,arguments),this._cannedBlobNames[id]=sessionData.blobName,id},_deleteBlob:function(relatedToCancel,id){var self=this,deleteBlobSasUri={},blobUriStore={get:function(id){return self._endpointStore.get(id)+"/"+self.getBlobName(id)}},deleteFileEndpointStore={get:function(id){return deleteBlobSasUri[id]}},getSasSuccess=function(id,sasUri){deleteBlobSasUri[id]=sasUri,deleteBlob.send(id)},getSasFailure=function(id,reason,xhr){relatedToCancel?(self.log("Will cancel upload, but cannot remove uncommitted parts from Azure due to issue retrieving SAS","error"),qq.FineUploaderBasic.prototype._onCancel.call(self,id,self.getName(id))):(self._onDeleteComplete(id,xhr,!0),self._options.callbacks.onDeleteComplete(id,xhr,!0))},deleteBlob=new qq.azure.DeleteBlob({endpointStore:deleteFileEndpointStore,log:qq.bind(self.log,self),onDelete:function(id){self._onDelete(id),self._options.callbacks.onDelete(id)},onDeleteComplete:function(id,xhrOrXdr,isError){delete deleteBlobSasUri[id],isError&&(relatedToCancel?self.log("Will cancel upload, but failed to remove uncommitted parts from Azure.","error"):qq.azure.util.parseAzureError(xhrOrXdr.responseText,qq.bind(self.log,self))),relatedToCancel?(qq.FineUploaderBasic.prototype._onCancel.call(self,id,self.getName(id)),self.log("Deleted uncommitted blob chunks for "+id)):(self._onDeleteComplete(id,xhrOrXdr,isError),self._options.callbacks.onDeleteComplete(id,xhrOrXdr,isError))}});new qq.azure.GetSas({cors:this._options.cors,customHeaders:this._options.signature.customHeaders,endpointStore:{get:function(){return self._options.signature.endpoint}},restRequestVerb:deleteBlob.method,log:qq.bind(self.log,self)}).request(id,blobUriStore.get(id)).then(qq.bind(getSasSuccess,self,id),qq.bind(getSasFailure,self,id))},_createDeleteHandler:function(){var self=this;return{sendDelete:function(id,uuid){self._deleteBlob(!1,id)}}}})}(),qq.azure.XhrUploadHandler=function(spec,proxy){"use strict";function combineChunks(id){var promise=new qq.Promise;return getSignedUrl(id).then(function(sasUri){var mimeType=handler._getMimeType(id),blockIdEntries=handler._getPersistableData(id).blockIdEntries;api.putBlockList.send(id,sasUri,blockIdEntries,mimeType,function(xhr){handler._registerXhr(id,null,xhr,api.putBlockList)}).then(function(xhr){log("Success combining chunks for id "+id),promise.success({},xhr)},function(xhr){log("Attempt to combine chunks failed for id "+id,"error"),handleFailure(xhr,promise)})},promise.failure),promise}function determineBlobUrl(id){var containerUrl=endpointStore.get(id),promise=new qq.Promise,getBlobNameSuccess=function(blobName){handler._setThirdPartyFileId(id,blobName),promise.success(containerUrl+"/"+blobName)},getBlobNameFailure=function(reason){promise.failure(reason)};return onGetBlobName(id).then(getBlobNameSuccess,getBlobNameFailure),promise}function getSignedUrl(id,optChunkIdx){var getSasId=null==optChunkIdx?id:id+"."+optChunkIdx,promise=new qq.Promise,getSasSuccess=function(sasUri){log("GET SAS request succeeded."),promise.success(sasUri)},getSasFailure=function(reason,getSasXhr){log("GET SAS request failed: "+reason,"error"),promise.failure({error:"Problem communicating with local server"},getSasXhr)},determineBlobUrlSuccess=function(blobUrl){api.getSasForPutBlobOrBlock.request(getSasId,blobUrl).then(getSasSuccess,getSasFailure)},determineBlobUrlFailure=function(reason){log(qq.format("Failed to determine blob name for ID {} - {}",id,reason),"error"),promise.failure({error:reason})};return determineBlobUrl(id).then(determineBlobUrlSuccess,determineBlobUrlFailure),promise}function handleFailure(xhr,promise){var azureError=qq.azure.util.parseAzureError(xhr.responseText,log);promise.failure({error:"Problem sending file to Azure",azureError:azureError&&azureError.message,reset:403===xhr.status})}var handler=this,log=proxy.log,cors=spec.cors,endpointStore=spec.endpointStore,paramsStore=spec.paramsStore,signature=spec.signature,filenameParam=spec.filenameParam,minFileSizeForChunking=spec.chunking.minFileSize,deleteBlob=spec.deleteBlob,onGetBlobName=spec.onGetBlobName,getName=proxy.getName,getSize=proxy.getSize,getBlobMetadata=function(id){var params=paramsStore.get(id);return params[filenameParam]=getName(id),params},api={putBlob:new qq.azure.PutBlob({getBlobMetadata:getBlobMetadata,log:log}),putBlock:new qq.azure.PutBlock({log:log}),putBlockList:new qq.azure.PutBlockList({getBlobMetadata:getBlobMetadata,log:log}),getSasForPutBlobOrBlock:new qq.azure.GetSas({cors:cors,customHeaders:signature.customHeaders,endpointStore:{get:function(){return signature.endpoint}},log:log,restRequestVerb:"PUT"})};qq.extend(this,{uploadChunk:function(id,chunkIdx){var promise=new qq.Promise;return getSignedUrl(id,chunkIdx).then(function(sasUri){var xhr=handler._createXhr(id,chunkIdx),chunkData=handler._getChunkData(id,chunkIdx);handler._registerProgressHandler(id,chunkIdx,chunkData.size),handler._registerXhr(id,chunkIdx,xhr,api.putBlock),api.putBlock.upload(id+"."+chunkIdx,xhr,sasUri,chunkIdx,chunkData.blob).then(function(blockIdEntry){handler._getPersistableData(id).blockIdEntries||(handler._getPersistableData(id).blockIdEntries=[]),handler._getPersistableData(id).blockIdEntries.push(blockIdEntry),log("Put Block call succeeded for "+id),promise.success({},xhr)},function(){log(qq.format("Put Block call failed for ID {} on part {}",id,chunkIdx),"error"),handleFailure(xhr,promise)})},promise.failure),promise},uploadFile:function(id){var promise=new qq.Promise,fileOrBlob=handler.getFile(id);return getSignedUrl(id).then(function(sasUri){var xhr=handler._createXhr(id);handler._registerProgressHandler(id),api.putBlob.upload(id,xhr,sasUri,fileOrBlob).then(function(){log("Put Blob call succeeded for "+id),promise.success({},xhr)},function(){log("Put Blob call failed for "+id,"error"),handleFailure(xhr,promise)})},promise.failure),promise}}),qq.extend(this,new qq.XhrUploadHandler({options:qq.extend({namespace:"azure"},spec),proxy:qq.extend({getEndpoint:spec.endpointStore.get},proxy)})),qq.override(this,function(super_){return{expunge:function(id){var relatedToCancel=handler._wasCanceled(id),chunkingData=handler._getPersistableData(id),blockIdEntries=chunkingData&&chunkingData.blockIdEntries||[];relatedToCancel&&blockIdEntries.length>0&&deleteBlob(id),super_.expunge(id)},finalizeChunks:function(id){return combineChunks(id)},_shouldChunkThisFile:function(id){return super_._shouldChunkThisFile(id)&&getSize(id)>=minFileSizeForChunking}}})},qq.azure.GetSas=function(o){"use strict";function sasResponseReceived(id,xhr,isError){var promise=requestPromises[id];isError?promise.failure("Received response code "+xhr.status,xhr):xhr.responseText.length?promise.success(xhr.responseText):promise.failure("Empty response.",xhr),delete requestPromises[id]}var requester,options={cors:{expected:!1,sendCredentials:!1},customHeaders:{},restRequestVerb:"PUT",endpointStore:null,log:function(str,level){}},requestPromises={};qq.extend(options,o),requester=qq.extend(this,new qq.AjaxRequester({acceptHeader:"application/json",validMethods:["GET"],method:"GET",successfulResponseCodes:{GET:[200]},contentType:null,customHeaders:options.customHeaders,endpointStore:options.endpointStore,cors:options.cors,log:options.log,onComplete:sasResponseReceived})),qq.extend(this,{request:function(id,blobUri){var requestPromise=new qq.Promise,restVerb=options.restRequestVerb;return options.log(qq.format("Submitting GET SAS request for a {} REST request related to file ID {}.",restVerb,id)),requestPromises[id]=requestPromise,requester.initTransport(id).withParams({bloburi:blobUri,_method:restVerb}).withCacheBuster().send(),requestPromise}})},qq.UploadSuccessAjaxRequester=function(o){"use strict";function handleSuccessResponse(id,xhrOrXdr,isError){var parsedResponse,promise=pendingRequests[id],responseJson=xhrOrXdr.responseText,successIndicator={success:!0},failureIndicator={success:!1};delete pendingRequests[id],options.log(qq.format("Received the following response body to an upload success request for id {}: {}",id,responseJson));try{parsedResponse=qq.parseJson(responseJson),isError||parsedResponse&&(parsedResponse.error||!1===parsedResponse.success)?(options.log("Upload success request was rejected by the server.","error"),promise.failure(qq.extend(parsedResponse,failureIndicator))):(options.log("Upload success was acknowledged by the server."),promise.success(qq.extend(parsedResponse,successIndicator)))}catch(error){isError?(options.log(qq.format("Your server indicated failure in its upload success request response for id {}!",id),"error"),promise.failure(failureIndicator)):(options.log("Upload success was acknowledged by the server."),promise.success(successIndicator))}}var requester,pendingRequests=[],options={method:"POST",endpoint:null,maxConnections:3,customHeaders:{},paramsStore:{},cors:{expected:!1,sendCredentials:!1},log:function(str,level){}};qq.extend(options,o),requester=qq.extend(this,new qq.AjaxRequester({acceptHeader:"application/json",method:options.method,endpointStore:{get:function(){return options.endpoint}},paramsStore:options.paramsStore,maxConnections:options.maxConnections,customHeaders:options.customHeaders,log:options.log,onComplete:handleSuccessResponse,cors:options.cors})),qq.extend(this,{sendSuccessRequest:function(id,spec){var promise=new qq.Promise;return options.log("Submitting upload success request/notification for "+id),requester.initTransport(id).withParams(spec).send(),pendingRequests[id]=promise,promise}})},qq.azure.DeleteBlob=function(o){"use strict";var requester,method="DELETE",options={endpointStore:{},onDelete:function(id){},onDeleteComplete:function(id,xhr,isError){},log:function(str,level){}};qq.extend(options,o),requester=qq.extend(this,new qq.AjaxRequester({validMethods:[method],method:method,successfulResponseCodes:function(){var codes={};return codes[method]=[202],codes}(),contentType:null,endpointStore:options.endpointStore,allowXRequestedWithAndCacheControl:!1,cors:{expected:!0},log:options.log,onSend:options.onDelete,onComplete:options.onDeleteComplete})),qq.extend(this,{method:method,send:function(id){return options.log("Submitting Delete Blob request for "+id),requester.initTransport(id).send()}})},qq.azure.PutBlob=function(o){"use strict";var requester,method="PUT",options={getBlobMetadata:function(id){},log:function(str,level){}},endpoints={},promises={},endpointHandler={get:function(id){return endpoints[id]}};qq.extend(options,o),requester=qq.extend(this,new qq.AjaxRequester({validMethods:[method],method:method,successfulResponseCodes:function(){var codes={};return codes[method]=[201],codes}(),contentType:null,customHeaders:function(id){var params=options.getBlobMetadata(id),headers=qq.azure.util.getParamsAsHeaders(params);return headers["x-ms-blob-type"]="BlockBlob",headers},endpointStore:endpointHandler,allowXRequestedWithAndCacheControl:!1,cors:{expected:!0},log:options.log,onComplete:function(id,xhr,isError){var promise=promises[id];delete endpoints[id],delete promises[id],isError?promise.failure():promise.success()}})),qq.extend(this,{method:method,upload:function(id,xhr,url,file){var promise=new qq.Promise;return options.log("Submitting Put Blob request for "+id),promises[id]=promise,endpoints[id]=url,requester.initTransport(id).withPayload(file).withHeaders({"Content-Type":file.type}).send(xhr),promise}})},qq.azure.PutBlock=function(o){"use strict";function createBlockId(partNum){var digits=5,zeros=new Array(digits+1).join("0"),paddedPartNum=(zeros+partNum).slice(-digits);return btoa(paddedPartNum)}var requester,method="PUT",blockIdEntries={},promises={},options={log:function(str,level){}},endpoints={},endpointHandler={get:function(id){return endpoints[id]}};qq.extend(options,o),requester=qq.extend(this,new qq.AjaxRequester({validMethods:[method],method:method,successfulResponseCodes:function(){var codes={};return codes[method]=[201],codes}(),contentType:null,endpointStore:endpointHandler,allowXRequestedWithAndCacheControl:!1,cors:{expected:!0},log:options.log,onComplete:function(id,xhr,isError){var promise=promises[id],blockIdEntry=blockIdEntries[id];delete endpoints[id],delete promises[id],delete blockIdEntries[id],isError?promise.failure():promise.success(blockIdEntry)}})),qq.extend(this,{method:method,upload:function(id,xhr,sasUri,partNum,blob){var promise=new qq.Promise,blockId=createBlockId(partNum);return promises[id]=promise,options.log(qq.format("Submitting Put Block request for {} = part {}",id,partNum)),endpoints[id]=qq.format("{}&comp=block&blockid={}",sasUri,encodeURIComponent(blockId)),blockIdEntries[id]={part:partNum,id:blockId},requester.initTransport(id).withPayload(blob).send(xhr),promise}})},qq.azure.PutBlockList=function(o){"use strict";function createRequestBody(blockIdEntries){var doc=document.implementation.createDocument(null,"BlockList",null);return blockIdEntries.sort(function(a,b){return a.part-b.part}),qq.each(blockIdEntries,function(idx,blockIdEntry){var latestEl=doc.createElement("Latest"),latestTextEl=doc.createTextNode(blockIdEntry.id);latestEl.appendChild(latestTextEl),qq(doc).children()[0].appendChild(latestEl)}),(new XMLSerializer).serializeToString(doc)}var requester,method="PUT",promises={},options={getBlobMetadata:function(id){},log:function(str,level){}},endpoints={},endpointHandler={get:function(id){return endpoints[id]}};qq.extend(options,o),requester=qq.extend(this,new qq.AjaxRequester({validMethods:[method],method:method,successfulResponseCodes:function(){var codes={};return codes[method]=[201],codes}(),customHeaders:function(id){var params=options.getBlobMetadata(id);return qq.azure.util.getParamsAsHeaders(params)},contentType:"text/plain",endpointStore:endpointHandler,allowXRequestedWithAndCacheControl:!1,cors:{expected:!0},log:options.log,onSend:function(){},onComplete:function(id,xhr,isError){var promise=promises[id];delete endpoints[id],delete promises[id],isError?promise.failure(xhr):promise.success(xhr)}})),qq.extend(this,{method:method,send:function(id,sasUri,blockIdEntries,fileMimeType,registerXhrCallback){var xhr,promise=new qq.Promise,blockIdsXml=createRequestBody(blockIdEntries);return promises[id]=promise,options.log(qq.format("Submitting Put Block List request for {}",id)),endpoints[id]=qq.format("{}&comp=blocklist",sasUri),xhr=requester.initTransport(id).withPayload(blockIdsXml).withHeaders({"x-ms-blob-content-type":fileMimeType}).send(),registerXhrCallback(xhr),promise}})},function(){"use strict";qq.azure.FineUploader=function(o){var options={failedUploadTextDisplay:{mode:"custom"}};qq.extend(options,o,!0),qq.FineUploader.call(this,options,"azure")},qq.extend(qq.azure.FineUploader.prototype,qq.azure.FineUploaderBasic.prototype),qq.extend(qq.azure.FineUploader.prototype,qq.uiPublicApi),qq.extend(qq.azure.FineUploader.prototype,qq.uiPrivateApi),qq.extend(qq.azure.FineUploader.prototype,{})}()}(window),function(e){"use strict";e.merge||(e.merge=e.extend),String.prototype.toPersianDigits=function(){var e=["۰","۱","۲","۳","۴","۵","۶","۷","۸","۹"];return this.replace(/[0-9]/g,function(t){return e[+t]})},String.prototype.toEnglishDigits=function(){var e={"۰":"0","۱":"1","۲":"2","۳":"3","۴":"4","۵":"5","۶":"6","۷":"7","۸":"8","۹":"9"};return this.replace(/[^0-9.]/g,function(t){return e[t]||t})},String.prototype.lZero=function(){return this.length<2?"0"+this:this},Array.prototype.toNumber=function(){return this.map(function(e){return Number(e)})},Array.prototype.dtp_toDate=function(e){var t="-";/invalid/i.test(new Date("1991-9-12"))&&(t="/");var a=this.join(t);return 5==this.length&&(a=this.slice(0,3).join(t)+" "+this.slice(3,5).join(":")),e?(a=new Date(a),"unix"==e?a.getTime():a):a},Number.prototype.lZero=function(){return this<10?"0"+this:this},Date.prototype.dtp_shortDate=function(){return[this.getFullYear(),this.getMonth()+1,this.getDate()].dtp_toDate()};var t=function(){var t={calType:"gregorian",format:"YYYY/MM/DD hh:mm",multiple:!0,autoClose:!1,transition:!0,disabled:[],smartDisabling:!0,minuteStep:1,gregorianStartDay:0,gregorianDic:{title:"Gregorian",monthsNames:["January","February","March","April","May","June","July","August","September","October","November","December"],daysNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],todayBtn:"Today"},jalaliDic:{title:"جلالی",monthsNames:["فروردین","اردیبهشت","خرداد","تیر","مرداد","شهریور","مهر","آبان","آذر","دی","بهمن","اسفند"],daysNames:["ش","ی","د","س","چ","پ","ج"],todayBtn:"امروز"}},a={getOptions:function(e){return e&&t[e]||t}};this.setOptions=function(a,n){return n?void(t[a]=e.merge(t[a]||{},n)):(n=a,void(t=e.merge(t,n)))},this.$get=function(){return a}},a=function(){return function(e,t){return"jalali"==t?String(e).toPersianDigits():e}},n=function(){function e(e){var a=l(e);return a-=226894,t(a)}function t(e){var t=r(e),i=n(e,t);return{day:a(e,t,i),month:i,year:t}}function a(e,t,a){e-=o(t)+365*(t-1);for(var i=1;i<a;i++)e-=i<=6?31:30;return e}function n(e,t){e-=o(t)+365*(t-1);for(var n=i(),r=0;r<n.length;r++){if(e<=n[r].count)return n[r].id;e-=n[r].count}return 12}function i(){return[{id:1,count:31},{id:2,count:31},{id:3,count:31},{id:4,count:31},{id:5,count:31},{id:6,count:31},{id:7,count:30},{id:8,count:30},{id:9,count:30},{id:10,count:30},{id:11,count:30},{id:12,count:29}]}function r(e){var t=Math.floor((e-1)/365),a=0;if(t>22){var n=t-22-1,i=t-22,r=Math.floor(n/33),l=i-33*r
;l>=28&&(l=28);var s=Math.floor(l/4),c=s+8*r+6,u=Math.floor((e-c)/365);return a=o(u),e-365*u-a-(D(u)?1:0)>0?++u:u}return a=t<1?0:t>=1&&t<=4?1:t>=5&&t<=8?2:t>=9&&t<=12?3:t>=13&&t<=16?4:t>=17&&t<22?5:6,(t=Math.floor((e-a-1)/365))+1}function o(e){if(e<23)switch(e){case 1:return 0;case 2:case 3:case 4:case 5:return 1;case 6:case 7:case 8:case 9:return 2;case 10:case 11:case 12:case 13:return 3;case 14:case 15:case 16:case 17:return 4;case 18:case 19:case 20:case 21:case 22:return 5}var t=e-22,a=Math.floor((t-1)/33),n=t-33*a;n>28&&(n=28);var i=Math.floor(n/4)+8*a+6;return D(e)&&t-33*a<=28&&i--,i}function l(e){var t=s(),a=u(e.year),n=a,i=c(e.year);n+=365*(e.year-1);for(var r=0;r<e.month-1;r++)i&&r+1==2&&(t[r].count=29),n+=t[r].count;return n+=e.day}function s(){return[{id:1,count:31},{id:2,count:28},{id:3,count:31},{id:4,count:30},{id:5,count:31},{id:6,count:30},{id:7,count:31},{id:8,count:31},{id:9,count:30},{id:10,count:31},{id:11,count:30},{id:12,count:31}]}function c(e){return e%4==0&&(e%100!=0||e%400==0)}function u(e){var t=e-1;return Math.floor(t/4)-Math.floor(t/100)+Math.floor(t/400)}function d(e){var t=Math.floor(e/365),a=u(t),n=Math.floor((e-a)/365);return 0!=e-365*n-a?n++:c(n+1)&&(n+=a/365),Math.floor(n)}function p(e){var t=d(e);e-=365*(t-1)+u(t);for(var n=s(),i=0,r=c(t),o=0;o<n.length;o++){if(r&&2==n[o].id&&(n[o].count=29),e<n[o].count)return 0==e&&0!=i||i++,i;e-=n[o].count,i=n[o].id}return i}function g(e){return m(d(e),p(e),e)}function m(e,t,a){for(var n=u(e),i=s(),r=0,o=0;o<i.length;o++)i[o].id<t&&(r+=i[o].count);return c(e)&&t>2&&r++,a-365*(e-1)-n-r}function h(e){var t=e.day;return t+=y(e.month),t+=f(e.year)}function y(e){for(var t=0,a=i(),n=0;n<e-1;n++)t+=a[n].count;return t}function f(e){var t=o(e);return t+=365*(e-1)}function v(e){var t=h(e)+226894,a=g(t),n=p(t),i=d(t);return 0==a&&(a=31,n=12,i--),{day:a,month:n,year:i}}var D=function(e){if(1==e||5==e||9==e||13==e||17==e||22==e)return!0;if(e<22)return!1;var t=e-22,a=Math.floor(t/33);return(t-33*a)%4==0&&(t-33*a)/4!=8};return{toJalali:function(t,a,n){t=t<=99?2e3+t:t;var i={year:t,month:a,day:n};return i=e(i)},toGregorian:function(e,t,a){return e=e<=99?1300+e:e,v({day:a,month:t,year:e})},isLeapJalali:D}},i=function(t){return this.dateFormat=function(e,t,a,n){if(!e.year)return"";for(var i=e.year,r=n?e.year:e.year%100,o=e.month.lZero(),l=e.day.lZero(),s=t.hour.lZero(),c=t.minute.lZero(),u=[{key:"YYYY",value:i},{key:"YY",value:r},{key:"MM",value:o},{key:"DD",value:l},{key:"hh",value:s},{key:"mm",value:c}],d=0,p=u.length;d<p;d++)a=a.replace(u[d].key,u[d].value);return a},this.parseString=function(e,t){var a=[],n={},i=["YY/MM/DD","YY/MM/DD hh:mm","YY-MM-DD","YY-MM-DD hh:mm","MM/DD/YY","MM-DD-YY","MM/DD/YY hh:mm","MM-DD-YY hh:mm"];i.unshift(t);for(var r=0,o=i.length;r<o;r++){if(new RegExp("^"+i[r].replace(/[a-z]+/gi,function(e){var t=!1;return-1!=e.indexOf("YY")?(a.push("year"),t=!0):-1!=e.indexOf("MM")?(a.push("month"),t=!0):-1!=e.indexOf("DD")?(a.push("day"),t=!0):-1!=e.indexOf("hh")?(a.push("hour"),t=!0):-1!=e.indexOf("mm")&&(a.push("minute"),t=!0),t?"[0-9]+":e}).replace(/[(]/g,"[(]").replace(/[)]/g,"[)]")+"$").test(e))return a.reverse(),e.replace(/[0-9]+/g,function(e){return n[a.pop()]=Number(e),e}),n.hour=n.hour||0,n.minute=n.minute||0,n}return!1},this.toRegularFormat=function(e,t,a){return!!e&&("string"==typeof e?e=this.parseString(e,a):"number"==typeof e&&(e=this.convertFromUnix(e,t)),!!e&&(e.year<=99&&(e.year="jalali"==t?1300+e.year:2e3+e.year),[e.year,e.month.lZero(),e.day.lZero(),e.hour.lZero(),e.minute.lZero()].dtp_toDate()))},this.isDateEqual=function(e,t){return 0==new Date(e)-new Date(t)},this.isDateBigger=function(e,t){return new Date(e)-new Date(t)>=0},this.isMonthBigger=function(e,t){return new Date(e.year,e.month)-new Date(t.year,t.month)>=0},this.joinTime=function(e,t){return new Date(new Date(new Date(e).setHours(t.hour)).setMinutes(t.minute))},this.removeTime=function(e){return[e.getFullYear(),e.getMonth()+1,e.getDate()].dtp_toDate("date")},this.validateJalaliDateSeparate=function(e,a){if(3!=e.length||2!=a.length)return!1;if(a[0]>23||a[0]<0||a[1]>59||a[1]<0||e[0]<0||e[1]<1||e[1]>12)return!1;if(e[1]>0&&e[1]<7){if(e[2]<1||e[2]>31)return!1}else if(e[1]>6&&e[1]<12){if(e[2]<1||e[2]>30)return!1}else if(12==e[1]){var n=t.isLeapJalali(e[0]);if(n&&(e[2]<1||e[2]>30)||!n&&(e[2]<1||e[2]>29))return!1}return!0},this.validateJalaliDate=function(a,n){var i;if("number"==typeof a){var r=new Date(a);if(/invalid/i.test(r))return!1;var o=this.convertToJalali(r);i=e.merge(o,{hour:r.getHours(),minute:r.getMinutes()})}else"string"==typeof a?i=this.parseString(a,n):a instanceof Object&&(i=a);if(!i)return!1;var l=[i.year,i.month,i.day],s=[i.hour,i.minute];if(this.validateJalaliDateSeparate(l,s)){var c=t.toGregorian(l[0],l[1],l[2]),r=[c.year,c.month,c.day,s[0],s[1]].dtp_toDate("date");return{year:l[0],month:l[1],day:l[2],hour:s[0],minute:s[1],unix:r.getTime(),gDate:r}}return!1},this.convertToUnix=function(e,t,a){if(!e)return null;if("number"==typeof e)return e;if("string"==typeof e)e=this.parseString(e,a);else{if(!(e instanceof Date))return null;e={year:e.getFullYear(),month:e.getMonth()+1,day:e.getDate(),hour:e.getHours(),minute:e.getMinutes()}}if(e.year<=99&&(e.year="jalali"==t?1300+e.year:2e3+e.year),"jalali"==t){var n=this.validateJalaliDate(e,a);return n.unix||null}if("gregorian"==t){var n=new Date(this.toRegularFormat(e,t));return/invalid/i.test(n)?null:n.getTime()}return null},this.convertFromUnix=function(e,t){var a=new Date(e);return"jalali"==t?this.convertToJalali(a):"gregorian"==t?{year:a.getFullYear(),month:a.getMonth()+1,day:a.getDate(),unix:e}:void 0},this.convertToJalali=function(a){if(a instanceof Date){a={year:a.getFullYear(),month:a.getMonth()+1,day:a.getDate(),unix:a.getTime()}}if(a instanceof Object)return e.merge(t.toJalali(a.year,a.month,a.day),{unix:a.unix})},this.parseDisablePattern=function(e){var t=e.disabled,a=e.smartDisabling,n=e.calType,i=e.format,r=Array.apply(null,Array(7)).map(Number.prototype.valueOf,0),o=Array.apply(null,Array(31)).map(Number.prototype.valueOf,0),l={};if(t instanceof Array)for(var s=0,c=t.length;s<c;s++)if("number"==typeof t[s]){var u=new Date(t[s]);/invalid/i.test(u)||(l[this.removeTime(u).getTime()]=!0)}else if("string"==typeof t[s])if(t[s]=t[s].toLowerCase(),-1==t[s].indexOf("d")&&-1==t[s].indexOf("i")){var d=this.convertToUnix(t[s],n,i);d&&(l[d]=!0)}else{var p=new RegExp("^[!]?(([0-9]?[0-9])?[d]([+][0-9][0-9]?)?)([&]([0-9]?[0-9])?[d]([+][0-9][0-9]?)?)*?$").test(t[s]),g=new RegExp("^[!]?([i]([+][0-9][0-9]?)?)([&][i]([+][0-9][0-9]?)?)*?$").test(t[s]);if(p||g){var m="!"==t[s][0];t[s]=m?t[s].split("!")[1]:t[s];var h=t[s].split("&");if(p){var y={};h.forEach(function(e){var t=e.split(/d[+]?/).map(function(e){return Number(e)});t[0]=t[0]?t[0]:1,t[1]%=31;for(var a=0;a<31;a++)(1!=t[0]&&a%t[0]==t[1]||1==t[0]&&a==t[1])&&(y[a]=1)});for(var f=0;f<31;f++)m?y[f]||(o[f]=1):y[f]&&(o[f]=1)}else if(g){var y={};h.forEach(function(e){var t=e.split(/i[+]?/).map(function(e){return Number(e)});t[1]%=7,y[t[1]]=1});for(var f=0;f<7;f++)m?y[f]||(r[f]=1):y[f]&&(r[f]=1)}}else console.warn(t[s]+" is not valid!")}return{smart:a,calType:n,static:l,inWeek:r,inMonth:o}},this.isDayDisable=function(e,t,a){if(t.static[a.unix])return!0;var n=0;t.smart?"gregorian"==t.calType&&"jalali"==e?n=1:"jalali"==t.calType&&"gregorian"==e&&(n=-1):"gregorian"==t.calType&&"jalali"==e?n=-1:"jalali"==t.calType&&"gregorian"==e&&(n=1);var i=(a.dayName+7+n)%7;return!!t.inMonth[a.day-1]||!!+t.inWeek[i]},{dateFormat:this.dateFormat,parseString:this.parseString,toRegularFormat:this.toRegularFormat,isDateEqual:this.isDateEqual,isDateBigger:this.isDateBigger,isMonthBigger:this.isMonthBigger,joinTime:this.joinTime,removeTime:this.removeTime,validateJalaliDateSeparate:this.validateJalaliDateSeparate,validateJalaliDate:this.validateJalaliDate,convertToUnix:this.convertToUnix,convertFromUnix:this.convertFromUnix,convertToJalali:this.convertToJalali,parseDisablePattern:this.parseDisablePattern,isDayDisable:this.isDayDisable,counter:0}},r=function(t,a,n,i,r){return{restrict:"E",replace:!0,link:function(t,i,o){var l,s=t.api;l=t.dtpValue.unix?new Date(t.dtpValue.fullDate):new Date,"jalali"==t.calType&&(l=n.convertToJalali(l)),s.fillDays(l,!t.option.transition),t.previousMonth=function(e){return"jalali"!=t.calType||e?(1==t.current.month?(t.current.month=12,t.current.year--):t.current.month--,void s.reload()):void t.nextMonth(!0)},t.nextMonth=function(e){return"jalali"!=t.calType||e?(12==t.current.month?(t.current.month=1,t.current.year++):t.current.month++,void s.reload()):void t.previousMonth(!0)},t.previousYear=function(e){if("jalali"==t.calType&&!e)return void t.nextYear(!0);var a=t.generatedYears.shift();t.generatedYears=[];for(var n=1;n<17;n++)t.generatedYears.push(a-17+n)},t.nextYear=function(e){if("jalali"==t.calType&&!e)return void t.previousYear(!0);var a=t.generatedYears.pop();t.generatedYears=[];for(var n=1;n<17;n++)t.generatedYears.push(a+n)},t.selectMonthInit=function(){t.yearSelectStat=!1,t.monthPickerStat=!0},t.selectYearInit=function(){t.yearSelectStat=!0,t.generatedYears=[];for(var e=0;e<16;e++)t.generatedYears.push(t.current.year+e-7)},t.selectMonth=function(e){e+1!=t.current.month&&(t.current.month=e+1,s.reload()),t.monthPickerStat=!1},t.selectYear=function(e){e!=t.current.year&&(t.current.year=e,s.reload()),t.monthPickerStat=!1},t.selectThisDay=function(e){if(0!=e.valid)return t.dtpValue.selected=!1,s.updateMasterValue(e,"day"),t.option.autoClose?void r(function(){t.closeCalendar()},100):void(e.disable?r(function(){n.isMonthBigger(e,t.current)?t.nextMonth(!0):t.previousMonth(!0)},0):e.selected=!0)},t.today=function(){var e=new Date;"jalali"==t.calType&&(e=n.convertToJalali(e)),s.fillDays(e,!t.option.transition)},t.changeTimeValue=function(a,i){i*="minute"==a?t.option.minuteStep:1;var r=(Number(t.time[a])+i+("hour"==a?24:60))%("hour"==a?24:60),o=e.copy(t.time);if(o[a]=r.lZero(),t.dtpValue.unix&&(t.minDate||t.maxDate)){var l=n.joinTime(t.dtpValue.unix,o);if(t.minDate&&!n.isDateBigger(l,t.minDate)||t.maxDate&&!n.isDateBigger(t.maxDate,l))return}t.time[a]=r.lZero(),t.dtpValue.unix&&s.updateMasterValue(!1,"time"),s.reload()},t.modelChanged=function(a){var i=e.isDefined(a)?a:t.dtpValue.formated;if(!i)return void(t.dtpValue.unix&&t.destroy());var r=n.convertToUnix(i,t.calType,t.option.format);if(!r||t.option.freezeInput||t.disable||t.minDate&&!n.isDateBigger(r,t.minDate)||t.maxDate&&!n.isDateBigger(t.maxDate,r))return void s.updateMasterValue(!1);if(r!=t.fullData.unix){t.parseInputValue(i,!1,!0);var o=new Date(r);"jalali"==t.calType&&(o=n.convertToJalali(o)),s.fillDays(o,!0)}},s.modelChanged=t.modelChanged,t.calTypeChanged=function(i){t.calType=i||("gregorian"==t.calType?"jalali":"gregorian"),t.monthNames=t.option[t.calType+"Dic"].monthsNames,t.daysNames=t.option[t.calType+"Dic"].daysNames;var r,o=e.copy(t.current);"jalali"==t.calType?r=a.toJalali(o.year,o.month,15):(r=a.toGregorian(o.year,o.month,15),r=[r.year,r.month,r.day].dtp_toDate("date")),t.dtpValue.unix&&s.updateMasterValue(n.convertFromUnix(t.dtpValue.unix,t.calType)),s.fillDays(r,!0)}},template:'<div class="ADMdtp-box ADMdtp-calendar-container" ng-class="{rtl: (calType==\'jalali\'), square: monthPickerStat||timePickerStat}"> <div class="dtpNewBox" ng-class="{active: monthPickerStat}"> <i class="calendarIcon" ng-class="{show: monthPickerStat}" ng-click="monthPickerStat = false"> <svg class="dtp-i" viewBox="0 0 24 24"> <use xlink:href="#dtp-i-calendar" /> </svg> </i> <div class="content"> <div class="ADMdtpMonths" ng-class="{onYear: yearSelectStat, rtl: (calType==\'jalali\')}"> <div class="ADMdtpYears"> <svg class="dtp-i dtp-i-180 dtp-trs-3 arrow left" viewBox="0 0 24 24" ng-if="yearSelectStat" ng-click="previousYear()"> <use xlink:href="#dtp-i-right" /> </svg> <p class="dtp-trs-3" ng-click="selectYearInit()">{{current.year | digitType:calType}}</p> <svg class="dtp-i dtp-trs-3 arrow right" viewBox="0 0 24 24" ng-if="yearSelectStat" ng-click="nextYear()"> <use xlink:href="#dtp-i-right" /> </svg> </div> <span ng-repeat="yearName in generatedYears" ng-if="yearSelectStat"><span class="dtp-trs-5" ng-class="{selected: yearName==current.year}" ng-click="selectYear(yearName)">{{yearName | digitType:calType}}</span></span> <span ng-repeat="monthName in monthNames" ng-if="!yearSelectStat"><span class="dtp-trs-5" ng-class="{selected: monthName==current.monthDscr}" ng-click="selectMonth($index)">{{monthName}}</span></span> </div> </div> </div> <div class="dtpNewBox" ng-class="{active: timePickerStat}"> <i class="calendarIcon" ng-class="{show: timePickerStat}" ng-click="timePickerStat = false"> <svg class="dtp-i" viewBox="0 0 24 24"> <use xlink:href="#dtp-i-calendar" /> </svg> </i> <div class="content"> <div class="ADMdtpTime"> <span class="dtpIcon null up" ng-click="changeTimeValue(\'hour\', 1)"><svg class="dtp-i dtp-trs-5 dtp-i-270" viewBox="0 0 24 24"><use xlink:href="#dtp-i-right" /></svg></span>\x3c!-- --\x3e<span></span>\x3c!-- --\x3e<span class="dtpIcon null up" ng-click="changeTimeValue(\'minute\', 1)"><svg class="dtp-i dtp-trs-5 dtp-i-270" viewBox="0 0 24 24"><use xlink:href="#dtp-i-right" /></svg></span>\x3c!-- --\x3e<span>{{time.hour}}</span>\x3c!-- --\x3e<span class="period">:</span>\x3c!-- --\x3e<span>{{time.minute}}</span>\x3c!-- --\x3e<span class="dtpIcon null down" ng-click="changeTimeValue(\'hour\', -1)"><svg class="dtp-i dtp-trs-5 dtp-i-90" viewBox="0 0 24 24"><use xlink:href="#dtp-i-right" /></svg></span>\x3c!-- --\x3e<span></span>\x3c!-- --\x3e<span class="dtpIcon null down" ng-click="changeTimeValue(\'minute\', -1)"><svg class="dtp-i dtp-trs-5 dtp-i-90" viewBox="0 0 24 24"><use xlink:href="#dtp-i-right" /></svg></span> </div> </div> </div> <header> <svg class="dtp-i dtp-i-180 dtp-trs-3 arrow left" viewBox="0 0 24 24" ng-click="previousMonth()"> <use xlink:href="#dtp-i-right" /> </svg> <span class="yearMonth" ng-click="selectMonthInit()">{{current.monthDscr}} {{current.year | digitType:calType}}</span> <svg class="dtp-i dtp-trs-3 arrow right" viewBox="0 0 24 24" ng-click="nextMonth()"> <use xlink:href="#dtp-i-right" /> </svg> </header> <div class="daysNames"> <span ng-repeat="dayName in daysNames">{{dayName}}</span> </div> <hr> <div class="ADMdtpDays" ng-class="{loading:loadingDays}"> <span ng-repeat="day in current.days" ng-click="selectThisDay(day)"><span ng-class="[{disable: day.disable||!day.valid, today: day.today, selected: day.selected, valid:(day.valid==2)}, (day.isMin)?((calType==\'jalali\')?\'max\':\'min\'):\'\', (day.isMax)?((calType==\'jalali\')?\'min\':\'max\'):\'\']">{{day.day | digitType:calType}}</span></span> </div> <hr> <footer> <div class="calTypeContainer dtp-trs-3" ng-class="$parent.calType" ng-click="calTypeChanged()" ng-if="option.multiple"> <p class="gregorian">{{option.gregorianDic.title}}</p> <p class="jalali">{{option.jalaliDic.title}}</p> </div> <button type="button" class="today dtp-trs-3" ng-click="today()">{{option[calType + "Dic"].todayBtn}}</button> <svg class="dtp-i dtp-trs-5 timeSelectIcon" viewBox="0 0 24 24" ng-show="option.dtpType != \'date\'" ng-click="timePickerStat = !timePickerStat"> <use xlink:href="#dtp-i-clock" /> </svg> </footer> </div>'}},o=function(t,a,n,i,r,o){return{restrict:"E",replace:!0,transclude:!0,require:["ngModel","admDtp"],scope:{options:"=?",fullData:"=?",name:"=?",ngRequired:"=?",onChange:"&?",onDatechange:"&?",onTimechange:"&?",onOpen:"&?",onClose:"&?"},link:function(a,i,l,s){var c=s[0],u=s[1];a.api=u,a.dtpId="adm-"+ ++n.counter,i.find("ng-transclude").children().length||(a.defaultTemplate=!0,i.find("ng-transclude").remove());var d=a.options;d instanceof Object||(d={}),a.option=e.merge(e.copy(t.getOptions()),d),a.option.minuteStep=Math.max(Math.min(a.option.minuteStep,60),1);var p=e.copy(a.option.gregorianDic.daysNames);a.option.gregorianDic.daysNamesUntouched=p,a.option.gregorianDic.daysNames=p.slice(a.option.gregorianStartDay,7).concat(p.slice(0,a.option.gregorianStartDay)),a.disableDays=n.parseDisablePattern(a.option),a.calType=a.option.calType,a.monthNames=a.option[a.calType+"Dic"].monthsNames,a.daysNames=a.option[a.calType+"Dic"].daysNames,a.timeoutValue=[0,0],a.dtpValue={},a.minDate=a.mindate?new Date(a.mindate):null,a.maxDate=a.maxdate?new Date(a.maxdate):null,a.current={year:"",month:"",monthDscr:"",days:[]},a.updateMasterValue=function(e,t){e||(e=a.dtpValue.unix?a.dtpValue:{}),a.$applyAsync(function(){a.dtpValue=e;var r=Number(a.time.minute);r-=r%a.option.minuteStep,a.time.minute=r.lZero(),a.dtpValue.formated=n.dateFormat(e,a.time,a.option.format),a.dtpValue.fullDate=n.joinTime(e.unix,a.time),a.fullData={formated:a.dtpValue.formated,lDate:a.dtpValue.fullDate.dtp_shortDate(),gDate:a.dtpValue.fullDate,unix:a.dtpValue.fullDate.getTime(),year:e.year,month:e.month,day:e.day,hour:Number(a.time.hour),minute:Number(a.time.minute),minDate:a.minDate,maxDate:a.maxDate,calType:a.calType,format:a.option.format},c.$setViewValue(a.dtpValue.formated),c.$render(),a.hasInputDtp&&(i[0].querySelector("[dtp-input]").value=a.dtpValue.formated),t&&(a.onChange&&a.onChange({date:a.fullData}),"time"==t&&a.onTimechange?a.onTimechange({date:a.fullData}):"day"==t&&a.onDatechange&&a.onDatechange({date:a.fullData}))})},a.parseInputValue=function(e,t,i){"today"==e&&(e=n.removeTime(new Date).getTime());var r=!1;e&&("jalali"==a.calType?r=n.validateJalaliDate(e,a.option.format):("string"==typeof e&&(e=n.toRegularFormat(e,a.calType,a.option.format)),r=new Date(e),r=!/invalid/i.test(r)&&r)),r?(a.dtpValue={year:r.year||r.getFullYear(),month:r.month||r.getMonth()+1,day:r.day||r.getDate(),unix:r.unix||r.getTime(),fullDate:r.gDate||r},a.dtpValue.fullDate=n.removeTime(a.dtpValue.fullDate),a.dtpValue.unix=a.dtpValue.fullDate.getTime(),a.time={hour:(r.getHours?r.getHours():r.hour).lZero(),minute:(r.getMinutes?r.getMinutes():r.minute).lZero()},a.updateMasterValue(!1,i)):t&&(a.time={hour:"00",minute:"00"})},a.parseInputValue(c.$viewValue||a.option.default,!0,!1),c.$formatters.push(function(e){return!e&&a.dtpValue.unix?a.destroy():a.dtpValue&&e==a.dtpValue.formated||a.parseInputValue(e,!1,!0),e}),a.option.watchingOptions&&a.$watch("options",function(i,r){if(i&&"object"==typeof i&&(!r||JSON.stringify(r)!=JSON.stringify(i))){var o=a.option.gregorianDic.daysNamesUntouched;a.option=e.merge(e.copy(t.getOptions()),i),a.option.minuteStep=Math.max(Math.min(a.option.minuteStep,60),1),i.gregorianDic&&i.gregorianDic.daysNames?a.option.gregorianDic.daysNamesUntouched=i.gregorianDic.daysNames:a.option.gregorianDic.daysNamesUntouched=o;var l=e.copy(a.option.gregorianDic.daysNamesUntouched);a.option.gregorianDic.daysNames=l.slice(a.option.gregorianStartDay,7).concat(l.slice(0,a.option.gregorianStartDay)),a.disableDays=n.parseDisablePattern(a.option),a.calTypeChanged&&a.calTypeChanged(a.option.calType)}},!0),l.$observe("disable",function(e){a.$applyAsync(function(){e=a.$eval(e),a.disable=e})}),l.$observe("mindate",function(e){a.$applyAsync(function(){e=a.$eval(e),a.minDate=n.convertToUnix(e,a.calType,a.option.format)})}),l.$observe("maxdate",function(e){a.$applyAsync(function(){e=a.$eval(e),a.maxDate=n.convertToUnix(e,a.calType,a.option.format)})}),a.onKeydown=function(e){9==e.keyCode&&a.closeCalendar()},a.openCalendar=function(){if(!a.showCalendarStat&&!a.disable){a.timeoutValue[0]=0,a.showCalendarStat=!0;var t=e.element('<adm-dtp-calendar id="'+a.dtpId+'" style="opacity:0; z-index: '+a.option.zIndex+';"></adm-dtp-calendar>');e.element(document.body).append(t),a.$applyAsync(function(){r(t)(a)}),o(function(){var t=document.documentElement.scrollTop||document.body.scrollTop,n=document.getElementById(a.dtpId),r=n.getBoundingClientRect(),o=i.children().children()[0],l=o.getBoundingClientRect(),s={x:l.left,y:l.top+l.height},c={width:r.width+s.x,height:r.height+s.y},u={top:"",bottom:"",left:"",right:""};c.height>window.innerHeight?u.top=t+l.top-r.height+"px":u.top=t+l.top+l.height+"px",c.width>window.innerWidth?u.left=s.x+window.innerWidth-c.width-20+"px":u.left=s.x+"px",e.element(n).css({top:u.top,bottom:u.bottom,left:u.left,opacity:1})},70),a.onOpen&&a.onOpen()}},a.closeCalendar=function(){if(a.showCalendarStat){a.$applyAsync(function(){a.monthPickerStat=!1,a.timePickerStat=!1,a.showCalendarStat=!1});var t=document.getElementById(a.dtpId);t&&(e.element(t).remove(),a.onClose&&a.onClose())}},a.toggleCalendar=function(){a.showCalendarStat?a.closeCalendar():a.openCalendar()},a.destroy=function(e){if(!a.disable){a.monthPickerStat=!1,a.timePickerStat=!1,a.current={year:"",month:"",monthDscr:"",days:[]},a.dtpValue={},a.fullData={minDate:a.minDate,maxDate:a.maxDate},a.time={hour:"00",minute:"00"};var t=new Date;"jalali"==a.calType&&(t=n.convertToJalali(t)),c.$setViewValue(""),c.$render(),e||u.fillDays(t,!a.option.transition),a.onChange&&a.onChange({date:a.fullData})}},(i[0].querySelector("[dtp-open]")||{}).onclick=a.openCalendar,(i[0].querySelector("[dtp-close]")||{}).onclick=a.closeCalendar,(i[0].querySelector("[dtp-toggle]")||{}).onclick=a.toggleCalendar,(i[0].querySelector("[dtp-destroy]")||{}).onclick=a.destroy},controller:["$scope",function(t){this.updateMasterValue=function(e,a){t.updateMasterValue(e,a)},this.fillDays=function(i,r){r?t.timeoutValue[0]=0:t.loadingDays=!0;var l=e.copy(i);if("jalali"==t.calType){var s=a.toGregorian(i.year,i.month,29);i=[s.year,s.month,s.day].dtp_toDate("date")}var c={year:i.getFullYear(),month:i.getMonth()+1,day:i.getDate()};t.$applyAsync(function(){var a=l.month||l.getMonth()+1;e.merge(t.current,{year:l.year||l.getFullYear(),month:a,monthDscr:t.monthNames[a-1]})});var u,d=u=t.option.gregorianStartDay;"jalali"==t.calType&&(d=0,u=6);var p=new Date;p=[p.getFullYear(),p.getMonth()+1,p.getDate(),1,0].dtp_toDate("unix");var g,m,h=t.dtpValue.unix||-1,y=[c.year,c.month,c.day,1,0].dtp_toDate("date"),f=new Date(e.copy(y).setDate(1)).getDay(),v=[],D=-1*(f-d+7)%7,x=!0,M=-1;if("jalali"==t.calType){var m=new Date(e.copy(y).setDate(D)),T=a.toJalali(m.getFullYear(),m.getMonth()+1,m.getDate());D-=7*Math.ceil((T.day-1)/7)+1}for(;;){D++;var m=new Date(e.copy(y).setDate(D)),T=!1;"jalali"==t.calType&&(T=a.toJalali(m.getFullYear(),m.getMonth()+1,m.getDate()));var w=T.day||m.getDate();if(1==w&&(x=!x),x&&w<8&&m.getDay()==u)break;var k=!1,S=1;if(t.minDate||t.maxDate){var b=n.joinTime(m,t.time);t.minDate&&!n.isDateBigger(b,t.minDate)||t.maxDate&&!n.isDateBigger(t.maxDate,b)?(S=0,2==M&&(v[v.length-1].isMax=!0)):(S=2,0==M&&(k=!0)),M=S}var V=m.getTime(),Y=m.getDay()+("jalali"==t.calType?1:0),N={day:w,month:T.month||m.getMonth()+1,year:T.year||m.getFullYear(),dayName:Y,fullDate:m,disable:x,today:V==p,selected:V==h,unix:V,valid:S,isMin:k};n.isDayDisable(t.calType,t.disableDays,N)&&(N.valid=0),N.selected&&(g=v.length),v.push(N)}o(function(){t.timeoutValue[0]=500,t.$applyAsync(function(){t.current.days=v,g&&t.updateMasterValue(t.current.days[g]),o(function(){t.loadingDays=!1},t.timeoutValue[1])})},t.timeoutValue[0])},this.reload=function(){var a=e.copy(t.current);a.day=29;var n=[a.year,a.month,8].dtp_toDate("date");"jalali"==t.calType&&(n=a),this.fillDays(n,!t.option.transition)},this.vm=t}],template:'<div class="ADMdtp ADMdtp-container" ng-class="{rtl: (calType==\'jalali\'), touch: option.isDeviceTouch, disable: disable}"> <div class="clickOutContainer" click-out="closeCalendar()"  alias="{{dtpId}}"> <ng-transclude></ng-transclude> <div ng-if="defaultTemplate" class="ADMdtpInput masterInput" ng-class="{touch: option.isDeviceTouch, disable: disable, open: showCalendarStat}"> <input type="text" name="{{name}}" ng-model="dtpValue.formated" ng-focus="openCalendar()" ng-click="openCalendar()" ng-readonly="option.freezeInput || option.isDeviceTouch || disable" ng-blur="modelChanged()" ng-keydown="onKeydown($event)" ng-required="ngRequired" > <div class="dtp-ig" ng-click="toggleCalendar()"> <svg class="dtp-i fakeIcon" viewBox="0 0 24 24"> <use xlink:href="#dtp-i-right" /> </svg> <svg class="dtp-i calendarIcon" viewBox="0 0 24 24"> <use xlink:href="#dtp-i-calendar" /> </svg> <svg class="dtp-i closeIcon" viewBox="0 0 24 24"> <use xlink:href="#dtp-i-off" /> </svg> </div> <svg class="removeIcon" viewBox="0 0 24 24" ng-if="dtpValue.formated" ng-click="destroy()"> <use xlink:href="#dtp-i-close" /> </svg> </div> </div> <svg style="display:none;" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1"> <defs> <g id="dtp-i-calendar"> <path d="M17 12h-5v5h5v-5zM16 1v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-1V1h-2zm3 18H5V8h14v11z"/> <path d="M0 0h24v24H0z" fill="none"/> </g> <g id="dtp-i-clock"> <path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"/> <path d="M0 0h24v24H0z" fill="none"/> <path d="M12.5 7H11v6l5.25 3.15.75-1.23-4.5-2.67z"/> </g> <g id="dtp-i-right"> <path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/> <path d="M0 0h24v24H0z" fill="none"/> </g> <g id="dtp-i-close"> <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/> <path d="M0 0h24v24H0z" fill="none"/> </g> <g id="dtp-i-off"> <path d="M0 0h24v24H0z" fill="none"/> <path d="M13 3h-2v10h2V3zm4.83 2.17l-1.42 1.42C17.99 7.86 19 9.81 19 12c0 3.87-3.13 7-7 7s-7-3.13-7-7c0-2.19 1.01-4.14 2.58-5.42L6.17 5.17C4.23 6.82 3 9.26 3 12c0 4.97 4.03 9 9 9s9-4.03 9-9c0-2.74-1.23-5.18-3.17-6.83z"/> </g> </defs> </svg> </div>'}},l=function(){return{require:["^^admDtp","ngModel"],link:function(e,t,a,n){var i=n[0],r=n[1];r.$parsers.push(function(){return r.$modelValue}),i.vm.hasInputDtp=!0,t.on("focus",function(){i.vm.openCalendar()}),t.on("blur",function(){i.vm.modelChanged(t[0].value)})}}},s=function(e){return{restrict:"A",scope:{clickOut:"&"},link:function(t,a,n){void 0==n.id&&n.$set("id","id_"+Math.random()),e.on("click contextmenu",function(e){var a,i=0;if(e.target){var r=void 0!==n.alias?n.alias.replace(", ",",").split(","):[];for(r.push(n.id),a=e.target;a;a=a.parentNode){var o=a.id,l=a.className;if(void 0!==o)for(i=0;i<r.length;i++)if(o.indexOf(r[i])>-1||"string"==typeof l&&l.indexOf(r[i])>-1)return}t.$eval(t.clickOut)}})}}},c=function(e){e.setOptions({isDeviceTouch:"ontouchstart"in window||navigator.maxTouchPoints});var t=document.createElement("style");t.type="text/css";for(var a=function(e){return"-moz-"+e+"-o-"+e+"-webkit-"+e+e},n=1;n<51;n++)t.innerHTML+=".ADMdtpDays>span:nth-child("+n+")>span {"+a("transition: all .5s, transform 0.2s "+.01*n+"s cubic-bezier(0.680, -0.550, 0.265, 1.550); ")+"}";document.getElementsByTagName("head")[0].appendChild(t)};e.module("ADM-dateTimePicker",[]).constant("constants",{}).provider("ADMdtp",t).filter("digitType",[a]).factory("ADMdtpConvertor",[n]).factory("ADMdtpFactory",["ADMdtpConvertor",i]).directive("admDtp",["ADMdtp","ADMdtpConvertor","ADMdtpFactory","constants","$compile","$timeout",o]).directive("admDtpCalendar",["ADMdtp","ADMdtpConvertor","ADMdtpFactory","constants","$timeout",r]).directive("dtpInput",[l]).directive("clickOut",["$document",s]).config(["ADMdtpProvider",c])}(window.angular);var app=app||{};!function(){app.module=angular.module("app",["ngRoute","ngResource","ngSanitize","ngCookies","ui.tinymce","angularMoment","ngTagsInput","ADM-dateTimePicker"])}(),function(app){function config($routeProvider,$locationProvider,$sceDelegateProvider){$sceDelegateProvider.resourceUrlWhitelist(["self"]),$routeProvider.when("/user/login",{templateUrl:"/assets/app/login/login.html",controller:"LoginController",controllerAs:"LC",access:{restricted:!1}}).when("/user/register",{templateUrl:"/assets/app/register/register.html",controller:"RegisterController",controllerAs:"RC",access:{restricted:!1}}).when("/user/registerverification/:id",{templateUrl:"/assets/app/register/emailVerification.html",controller:"EmailVerification",controllerAs:"EmailV",access:{restricted:!1}}).when("/user/forgotpassword",{templateUrl:"/assets/app/register/forgotpassword.html",controller:"ForgotPassword",controllerAs:"FP",access:{restricted:!1}}).when("/user/resetpassword/:id",{templateUrl:"/assets/app/register/resetpassword.html",controller:"ResetPassword",controllerAs:"RP",access:{restricted:!1}}).when("/user/logout",{templateUrl:"/assets/app/logout/logout.html",controller:"LogoutController",controllerAs:"Logout"}).when("/user/profile",{templateUrl:"/assets/app/profile/view/view.html",controller:"ProfileViewController",controllerAs:"PVC",access:{restricted:!0}}).when("/user/update",{templateUrl:"/assets/app/profile/update/update.html",controller:"ProfileUpdateController",controllerAs:"PUC",access:{restricted:!0}}),$locationProvider.hashPrefix(""),window.history&&window.history.pushState&&$locationProvider.html5Mode({enabled:!0})}app.module.config(config),config.$inject=["$routeProvider","$locationProvider","$sceDelegateProvider"]}(app),function(app){function config($routeProvider,$locationProvider,$sceDelegateProvider){$routeProvider.when("/",{templateUrl:"/assets/app/index/index.html",controller:"HomeController",controllerAs:"HC"}).when("/category/:cat",{templateUrl:"/assets/app/index/index.html",controller:"HomeController",controllerAs:"HC"}).when("/tags/:tags",{templateUrl:"/assets/app/index/index.html",controller:"HomeController",controllerAs:"HC"}).when("/author/:author",{templateUrl:"/assets/app/index/index.html",controller:"HomeController",controllerAs:"HC"}).when("/search",{templateUrl:"/assets/app/search/search.html",controller:"SearchController",controllerAs:"SearchC"}).when("/post/:id",{templateUrl:"/assets/app/post/read/read.html",controller:"BlogReadController",controllerAs:"BRC"}).when("/create/:id?",{templateUrl:"/assets/app/post/create/create.html",controller:"BlogCreateController",controllerAs:"BCC",access:{restricted:!0}}).when("/dashboard/:type",{templateUrl:"/assets/app/dashboard/dashboard.html",controller:"DashController",controllerAs:"DC",access:{routeType:"dashboard",restricted:!0}}).otherwise({redirectTo:"/"})}app.module.config(config),config.$inject=["$routeProvider","$locationProvider","$sceDelegateProvider"]}(app),function(app){function run($rootScope,$location,$route,$cookies,$http,AuthenticationService){function routeChangeStart(event,next,current){var access=next.access||{};access.routeType&&!isValidRoute(next)&&$location.path("/"),angular.equals({},access)||!access.restricted||AuthenticationService.isLogin?angular.equals({},access)||access.restricted||!AuthenticationService.isLogin||$location.path("/dashboard/published/1"):($location.path("/"),$route.reload())}var xhr=new XMLHttpRequest;xhr.open("POST","/api/islogin",!1),xhr.onload=function(e){4===xhr.readyState&&(200===xhr.status||401===xhr.status&&AuthenticationService.ClearCredentials())},xhr.send(null),xhr.open("GET","/api/getcategorylist",!1),xhr.onload=function(e){4===xhr.readyState&&(200===xhr.status?$rootScope.category=JSON.parse(xhr.responseText):$rootScope.category={})},xhr.send(null);var blogLogin=$cookies.get("BLOG.LOGIN");$rootScope.globals=blogLogin?JSON.parse(blogLogin):{},$rootScope.globals.currentUser&&(AuthenticationService.isLogin=!0),$rootScope.$on("$routeChangeStart",function(event,next,current){$rootScope.bodyClass="",$rootScope.navActiveTab="",routeChangeStart(event,next,current)})}function isValidRoute(routeObj){var isroute=!1,routeType=routeObj.access.routeType,params=routeObj.params||{};return"dashboard"===routeType&&("published"!==params.type&&"draft"!==params.type||(isroute=!0)),isroute}app.module.run(run),run.$inject=["$rootScope","$location","$route","$cookies","$http","AuthenticationService"]}(app),function(app){app.module.filter("replaceSpaceWithDash",function(){return function(str){return str?str.replace(/ /g,"-"):""}}),app.module.filter("userAvatarText",function(){return function(str){var arr=[];return angular.forEach(str.split(" "),function(item){item&&arr.push(item)}),arr[0].charAt(0)+arr.pop().charAt(0)}}),app.module.filter("getShortDescription",function(){return function(str,len){len=len||350
;var elem=angular.element("<div>"+str+"</div>"),txt=elem.text(),ellipsis="";return str.length>len&&(ellipsis="..."),txt.substr(0,len)+ellipsis}})}(app),function(app){"use strict";function FormErrorService(){return{messages:{required:"This field is required.",email:"Please enter a valid email.",passwdAgain:"Password do not match.",emailTaken:"This email already taken.",emailVerification:"Email already register. But verification is pending!",unameTaken:"This username already taken."},show:function(errObj){var obj={};return angular.forEach(errObj,function(error){obj[error.param]||(obj[error.param]=error.msg)}),obj},hide:function(obj){}}}app.module.factory("FormErrorService",FormErrorService),FormErrorService.$inject=[]}(app),function(app){"use strict";function AuthenticationService($http,$cookies,$rootScope,$timeout){return{IsLogin:function(){var _this=this;$http.post("/api/islogin").then(function(response){},function(response){401===response.status&&_this.ClearCredentials()})},Login:function(data,callback){$http.post("/api/login",data).then(function(response){callback(response)},function(response){callback(response)})},Logout:function(callback){$http.post("/api/logout").then(function(response){callback(response)},function(response){callback(response)})},SetCredentials:function(user,extend){extend&&(user=angular.extend({},$rootScope.globals.currentUser,user)),$rootScope.globals={currentUser:user},$cookies.putObject("BLOG.LOGIN",$rootScope.globals),this.isLogin=!0},ClearCredentials:function(){$rootScope.globals={},$cookies.remove("BLOG.LOGIN",{path:"/"}),this.isLogin=!1},GetUser:function(){return $rootScope.globals.currentUser}}}app.module.factory("AuthenticationService",AuthenticationService),AuthenticationService.$inject=["$http","$cookies","$rootScope"]}(app),function(app){"use strict";function RegisterService($http,$cookies,$rootScope,$timeout){return{register:function(data,callback){$http.post("/api/register",data).then(function(response){callback(response)},function(response){})},emailVerification:function(id,callback){$http.post("/api/registerverification",{id:id}).then(function(response){callback(response)},function(response){})},resendEmail:function(email,callback){$http.post("/api/resendemail",{email:email}).then(function(response){callback(response)},function(response){})},forgotPassword:function(data,callback){$http.post("/api/forgotpassword",data).then(function(response){callback(response)},function(response){})},resetPassword:function(data,callback){$http.post("/api/resetpassword",data).then(function(response){callback(response)},function(response){})}}}app.module.factory("RegisterService",RegisterService),RegisterService.$inject=["$http","$cookies","$rootScope"]}(app),function(app){"use strict";function PostService($http,$rootScope){return{list:[],category:$rootScope.category,tags:{technology:"Technology",music:"Music",fashion:"Fashion",movie:"Movie",law:"law",history:"History"},create:function(data,callback){$http.post("/api/post/create",data).then(function(response){callback(response)},function(response){})},getPosts:function(data,callback){$http.post("/api/post/posts",data).then(function(response){callback(response)},function(response){callback(response)})},getSearchQueryResults:function(qobj,callback){var queryStr="";angular.forEach(qobj,function(value,key){queryStr&&(queryStr+="&"),queryStr+=key+"="+value}),$http.get("/api/post/search?"+queryStr).then(function(response){callback(response)},function(response){callback(response)})},getPostsById:function(data,callback){$http.post("/api/post/posts/id",data).then(function(response){callback(response)},function(response){callback(response)})},getComments:function(data,callback){$http.post("/api/comments",data).then(function(response){callback(response)},function(response){callback(response)})},saveComment:function(data,callback){$http.post("/api/comment",data).then(function(response){callback(response)},function(response){callback(response)})},update:function(data,callback){$http.post("/api/post/update",data).then(function(response){callback(response)},function(response){})},publish:function(data,callback){$http.post("/api/post/publish",data).then(function(response){callback(response)},function(response){})},delete:function(data,callback){$http.delete("/api/post/delete",data).then(function(response){callback(response)},function(response){})}}}app.module.factory("PostService",PostService),PostService.$inject=["$http","$rootScope"]}(app),function(app){"use strict";function UserUpdateService($http){return{update:function(data,callback){$http.post("/api/user/update",data).then(function(response){callback(response)},function(response){})},upload:function(data,callback){$http({method:"POST",url:"/api/user/upload",headers:{"Content-Type":"application/json"},data:data}).then(function(response){callback(response)},function(response){})},delete:function(data,callback){$http.delete("/api/user/delete",data).then(function(response){callback(response)},function(response){})}}}app.module.factory("UserUpdateService",UserUpdateService),UserUpdateService.$inject=["$http"]}(app),function(app){"use strict";function PagerService(){return{GetPager:function(totalItems,currentPage,pageSize){currentPage=currentPage||1,pageSize=pageSize||10;var startPage,endPage,totalPages=Math.ceil(totalItems/pageSize);totalPages<=10?(startPage=1,endPage=totalPages):currentPage<=6?(startPage=1,endPage=10):currentPage+4>=totalPages?(startPage=totalPages-9,endPage=totalPages):(startPage=currentPage-5,endPage=currentPage+4);for(var startIndex=(currentPage-1)*pageSize,endIndex=Math.min(startIndex+pageSize-1,totalItems-1),pages=[],i=startPage;i<endPage+1;i++)pages.push(i);return{totalItems:totalItems,currentPage:currentPage,pageSize:pageSize,totalPages:totalPages,startPage:startPage,endPage:endPage,startIndex:startIndex,endIndex:endIndex,pages:pages}},SetPage:function(page,listLength,pageSize){if(!(page<1||page>listLength))return this.GetPager(listLength,page,pageSize)}}}app.module.factory("PagerService",PagerService),PagerService.$inject=[]}(app),function(app){app.module.directive("expandingTextarea",function(){return{restrict:"A",controller:function($scope,$rootScope,$element,$attrs,$timeout){function setHeight(height){$element.css("height",height+"px"),$element.css("max-height",height+"px")}function setHeightToScrollHeight(){setHeight(0);var elem=angular.element($element),scrollHeight=elem[0].scrollHeight;void 0!==scrollHeight&&(setHeight(scrollHeight),$rootScope.tinymceTopPos=elem.prop("offsetTop")+scrollHeight)}$element.css("min-height","0"),$element.css("overflow-y","hidden"),setHeight(0),$timeout(setHeightToScrollHeight),$scope.$watch(function(){return angular.element($element)[0].value},setHeightToScrollHeight)}}}),app.module.directive("setFocus",[function($timeout,$parse){return{link:function(scope,element,attrs){element[0].focus()}}}]),app.module.directive("disableEnterKey",[function(){return{controller:function($scope,$element){$element.on("keypress",function(e){$scope.$apply(function(){13===e.keyCode&&e.preventDefault()})})}}}])}(app),function(app){function pageSearch($location,$timeout){return{restrict:"E",templateUrl:"/assets/app/directives/search/search.html",replace:!0,scope:{searchQuery:"@"},link:function($scope,$element,$attr){$element.on("submit",function(){var query=$scope.searchQuery.trim();query&&$timeout(function(){$location.path("/search").search({query:query})},0)})}}}app.module.directive("pageSearch",["$location","$timeout",pageSearch])}(app),function(app){function dropdown($document){return{restrict:"E",require:"?ngModel",templateUrl:"/assets/app/directives/dropdown/dropdown.html",replace:!0,scope:{items:"=",value:"@"},link:function($scope,$element,$attr,ngModel){var marker="marker-current";$element.on("click",function($event){$element.toggleClass("open "+marker)}),$document.on("click",function($event){$element.hasClass(marker)?$element.removeClass(marker):$element.removeClass("open")}),$element.on("$destroy",function(){$scope.$destroy()})}}}app.module.directive("dropdown",["$document",dropdown])}(app),function(app){function honeypot($parse){return{restrict:"E",require:"ngModel",templateUrl:"/assets/app/directives/honeypot/honeypot.html",replace:!0,scope:{},link:function($scope,$element,$attr,ngModel){$scope.$watch("honey",function(newval){ngModel.$setViewValue(newval),ngModel.$render()})}}}app.module.directive("honeypot",["$parse",honeypot])}(app),function(app){function routeLoader($http){return{restrict:"EA",link:function(scope,element){function showElement(){element.css("display",shownType)}function hideElement(){element.css("display","none")}var shownType=element.css("display"),isRequesting=!1;scope.isLoading=function(){return $http.pendingRequests.length>0},scope.$watch(scope.isLoading,function(isReq){isReq?(isRequesting=!0,showElement()):(isRequesting=!1,hideElement())}),scope.$on("$routeChangeStart",function(){showElement()}),scope.$on("$routeChangeSuccess",function(){isRequesting||hideElement()}),scope.$on("$routeChangeError",hideElement),hideElement()}}}app.module.directive("routeLoader",routeLoader),routeLoader.$inject=["$http"]}(app),function(app){function NavDirective(){return{restrict:"E",templateUrl:"/assets/app/directives/nav/nav.html",replace:!0}}app.module.directive("navDirective",NavDirective)}(app),function(app){function postList(){return{restrict:"E",templateUrl:"/assets/app/directives/list/list.html",replace:!0,scope:{posts:"=",owner:"@",publish:"&"}}}app.module.directive("postList",postList)}(app),function(app){function pagination(){return{restrict:"E",templateUrl:"/assets/app/directives/pagination/pagination.html",replace:!0,scope:{pager:"=",setPage:"&"}}}app.module.directive("pagination",pagination)}(app),function(app){function NavController($scope,$rootScope,$location,AuthenticationService){var _this=this;this.Authentication=AuthenticationService.isLogin,this.user={},this.displayNav=!1,$scope.$watch(function(){return AuthenticationService.isLogin},function(){_this.Authentication=AuthenticationService.isLogin,_this.Authentication&&(_this.currentUser=AuthenticationService.GetUser())},!1),$rootScope.$watch("navActiveTab",function(newval){_this.navActiveTab=newval}),this.toggle=function(){_this.displayNav=!_this.displayNav}}app.module.controller("NavController",NavController),NavController.$inject=["$scope","$rootScope","$location","AuthenticationService"]}(app),function(app){function HomeController($scope,$rootScope,$location,PostService,PagerService,UserUpdateService){var _this=this,queryObj=$location.search(),path=window.location.pathname,splitPath=path.split("/"),category=splitPath[1],catType=splitPath.pop(),page=queryObj.page;this.posts=[],this.category=PostService.category,$rootScope.navActiveTab="home",$scope.posts=[],$scope.$watch("posts",function(){PostService.list=$scope.posts}),page=page&&!isNaN(page)?parseInt(page):1;var query={page:page};"author"==category?query[category]=decodeURIComponent(catType.split("-").pop()):catType&&(query[category]=decodeURIComponent(catType)),"category"==category&&(this.catType=catType),this.setPage=function(obj){obj.page<1||obj.page>_this.pager.totalItems||$location.search({page:obj.page})},PostService.getPosts(query,function(res){var data=res.data;data.success&&(_this.posts=$scope.posts=data.list,_this.pager=PagerService.SetPage(page,data.totalPosts))})}app.module.controller("HomeController",HomeController),HomeController.$inject=["$scope","$rootScope","$location","PostService","PagerService","UserUpdateService"]}(app),function(app){function RegisterController($scope,$rootScope,$http,$interval,FormErrorService,RegisterService){var _this=this;this.formData={gender:""},this.formError={},this.formValidateMsg=FormErrorService.messages,this.userSuccess=!1,$rootScope.navActiveTab="signup",this.submit=function(){_this.formData.honeypot||RegisterService.register(_this.formData,function(res){var data=res.data||{};_this.emailunameTaken={},_this.userSuccess=!1,data.errors?_this.formError=FormErrorService.show(data.errors):data.error?_this.emailunameTaken[data.error.name]=!0:data.success&&(_this.userSuccess=!0)})}}app.module.controller("RegisterController",RegisterController),RegisterController.$inject=["$scope","$rootScope","$http","$interval","FormErrorService","RegisterService"]}(app),function(app){function EmailVerification($routeParams,$location,RegisterService){var ID=$routeParams.id,_this=this;this.error=!1,ID?RegisterService.emailVerification(ID,function(res){res.data.error?_this.error=!0:res.data.success&&$location.path("/user/login")}):$location.path("/")}app.module.controller("EmailVerification",EmailVerification),EmailVerification.$inject=["$routeParams","$location","RegisterService"]}(app),function(app){function ForgotPassword($scope,$http,$interval,FormErrorService,RegisterService){var _this=this;this.formData={},this.formError={},this.formValidateMsg=FormErrorService.messages,this.userSuccess=!1,this.displayForm=!0,this.submit=function(){_this.formData.honeypot||RegisterService.forgotPassword(_this.formData,function(res){const data=res.data||{};_this.userSuccess=!1,_this.userEmpty=!1,_this.error=!1,data.errors?_this.formError=FormErrorService.show(data.errors):data.userEmpty?(_this.displayForm=!1,_this.userEmpty=!0):data.error?_this.error=!0:data.success&&(_this.displayForm=!1,_this.userSuccess=!0)})}}app.module.controller("ForgotPassword",ForgotPassword),ForgotPassword.$inject=["$scope","$http","$interval","FormErrorService","RegisterService"]}(app),function(app){function ResetPassword($routeParams,$location,$interval,FormErrorService,RegisterService){var URL_PARAM=$routeParams.id,_this=this;this.displayForm=!1,this.error=!1,this.norecord=!1,URL_PARAM||$location.path("/"),this.formData={},this.formError={},this.formValidateMsg=FormErrorService.messages,this.userSuccess=!1,RegisterService.resetPassword({url:URL_PARAM,reqType:"get"},function(res){const data=res.data||{};_this.error=!1,_this.norecord=!1,_this.displayForm=!1,data.err?(_this.error=!0,_this.norecord=!1):data.user?(_this.formData=data.user,_this.displayForm=!0):(_this.error=!1,_this.norecord=!0)}),this.submit=function(){_this.formData.honeypot||RegisterService.resetPassword(_this.formData,function(res){const data=res.data||{};data.errors?_this.formError=FormErrorService.show(data.errors):data.error?(_this.displayForm=!1,this.error=!0):data.success&&$location.path("/user/login")})}}app.module.controller("ResetPassword",ResetPassword),ResetPassword.$inject=["$routeParams","$location","$interval","FormErrorService","RegisterService"]}(app),function(app){function LoginController($scope,$rootScope,$http,$location,AuthenticationService,RegisterService){var _this=this;_this.formData={},_this.formError={},_this.loginform=!0,$rootScope.navActiveTab="login",this.submit=function(){_this.formData.honeypot||AuthenticationService.Login(_this.formData,function(res){res.data.success?(AuthenticationService.SetCredentials(res.data.user),$location.path("/dashboard/published")):res.data.status?(_this.authenticationFailed=!1,_this.loginform=!1,_this.status=res.data.status,_this.email=res.data.email):res.data.authenticationFailed&&(_this.authenticationFailed=!0)})},this.resend=function(){RegisterService.resendEmail(_this.email,function(err){_this.loginform=!1,_this.status="",_this.emailSend=!0})}}app.module.controller("LoginController",LoginController),LoginController.$inject=["$scope","$rootScope","$http","$location","AuthenticationService","RegisterService"]}(app),function(app){function LogoutController($window,AuthenticationService){AuthenticationService.Logout(function(res){res.data.success&&(AuthenticationService.ClearCredentials(),$window.location.href="/user/login")})}app.module.controller("LogoutController",LogoutController),LogoutController.$inject=["$window","AuthenticationService"]}(app),function(app){function ProfileViewController($rootScope,AuthenticationService){this.user=$rootScope.globals.currentUser}app.module.controller("ProfileViewController",ProfileViewController),ProfileViewController.$inject=["$rootScope","AuthenticationService"]}(app),function(app){function ProfileUpdateController($scope,$rootScope,UserUpdateService,AuthenticationService){var _this=this,currentUser=$rootScope.globals.currentUser;this.formData={_id:currentUser._id,avatar:currentUser.avatar,aboutme:currentUser.aboutme,country:currentUser.country,gender:currentUser.gender,website:currentUser.website,facebook:currentUser.facebook,twitter:currentUser.twitter,google_plus:currentUser.google_plus,linkedIn:currentUser.linkedIn,instagram:currentUser.instagram,tumblr:currentUser.tumblr,pinterest:currentUser.pinterest,name:currentUser.name,email:currentUser.email},this.success=!1,this.submit=function(){UserUpdateService.update(_this.formData,function(res){if(res.data.error)_this.error=!0;else if(res.data.success){var formData=_this.formData;AuthenticationService.SetCredentials({avatar:formData.avatar,aboutme:formData.aboutme,country:formData.country,gender:formData.gender,website:formData.website,facebook:formData.facebook,twitter:formData.twitter,google_plus:formData.google_plus,linkedIn:formData.linkedIn,instagram:formData.instagram,tumblr:formData.tumblr,pinterest:formData.pinterest},!0),_this.success=!0}})},new qq.FineUploader({element:document.getElementById("fine-uploader"),request:{endpoint:"/api/user/upload",inputName:"avatar",params:{id:currentUser._id}},deleteFile:{enabled:!0,endpoint:"/api/user/upload"},validation:{allowedExtensions:["png","jpg","jpge","gif"]},callbacks:{onComplete:function(id,name,responseObj,xhr){_this.formData.avatar=responseObj.filename,AuthenticationService.SetCredentials({avatar:_this.formData.avatar},!0),$scope.$apply()}}})}app.module.controller("ProfileUpdateController",ProfileUpdateController),ProfileUpdateController.$inject=["$scope","$rootScope","UserUpdateService","AuthenticationService"]}(app),function(app){function DashController($scope,$rootScope,$routeParams,$location,PostService,PagerService,AuthenticationService){var _this=this,type=$routeParams.type,queryObj=$location.search(),page=queryObj.page;this.posts=[],this.pager={},this.limit=10,this.currentUser=AuthenticationService.GetUser(),this.activeTab=type.toUpperCase(),$rootScope.navActiveTab="dashboard",page=page&&!isNaN(page)?parseInt(page):1,this.setPage=function(obj){obj.page<1||obj.page>_this.pager.totalItems||$location.search({page:obj.page})},$scope.posts=[],$scope.$watch("posts",function(){PostService.list=$scope.posts}),PostService.getPosts({author:this.currentUser._id,status:_this.activeTab,limit:_this.limit,page:page},function(res){var data=res.data;data.success&&(_this.posts=$scope.posts=data.list,_this.pager=PagerService.SetPage(page,data.totalPosts,_this.limit))})}app.module.controller("DashController",DashController),DashController.$inject=["$scope","$rootScope","$routeParams","$location","PostService","PagerService","AuthenticationService"]}(app),function(app){function BlogCreateController($scope,$rootScope,$document,$window,$location,PostService,FormErrorService,AuthenticationService){function setAndModifyData(postObj){postObj&&(postObj.tags=getTagArrayFormat(postObj.tags),postObj.post_reference_id||"DRAFT"===postObj.status||PostService.getPosts({post_reference_id:postObj._id,status:"DRAFT"},function(response){var res=response.data;res.success?res.list[0]&&(_this.isDraft=!0,PostService.tempList=res.list[0]):_this.error=!0}),_this.frm.data=postObj)}function getTagArrayFormat(str){var arr=[];return str&&"string"==typeof str?str.split(",").forEach(function(val){arr.push({text:val})}):arr=str,arr}var _this=this,path=window.location.pathname,patharr=path.split("/"),postId=patharr.length>2?path.split("/").pop():"";$rootScope.bodyClass="bg-white",this.currentUser=AuthenticationService.GetUser(),this.frm={data:{},error:{},msg:FormErrorService.messages},this.category=PostService.category,this.tinymceOptions={height:500,theme:"modern",menubar:!1,branding:!1,autoresize_bottom_margin:0,autoresize_min_height:400,content_css:["/assets/css/bootstrap.min.css","/assets/css/tinymce.content.css","//fonts.googleapis.com/css?family=Merriweather|Roboto:300,400,700"],plugins:["advlist autolink lists link image charmap print preview hr anchor pagebreak","searchreplace wordcount visualblocks visualchars code fullscreen","insertdatetime media nonbreaking save table contextmenu directionality","emoticons template paste textcolor colorpicker textpattern imagetools codesample toc help autoresize placeholder"],toolbar:"undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent table | link image, media | forecolor backcolor",image_advtab:!0},postId&&(PostService.tempList?(setAndModifyData(PostService.tempList),PostService.tempList=null):PostService.list.length?angular.forEach(PostService.list,function(postObj){postObj._id===postId&&setAndModifyData(postObj)}):PostService.getPostsById({id:postId},function(response){var res=response.data;res.success?setAndModifyData(res.list[0]):_this.error=!0}));var d=new Date;d.setDate(d.getDate()-1),this.mintime=d.getTime(),this.resetDraftData=function(){_this.isDraft=!1,$location.path("/create/"+PostService.tempList._id)},this.submit=function(){_this.frm.data.owner=_this.currentUser._id,_this.frm.data.date=new Date,_this.frm.data.schedule_at&&(_this.frm.data.schedule_at=new Date(_this.frm.data.schedule_at)),PostService.create(_this.frm.data,function(res){var data=res.data||{},action=_this.frm.data._action;_this.success=!1,_this.error=!1,_this.successMsg="",data.error?_this.error=!0:data.errors?_this.frm.error=FormErrorService.show(data.errors):data.success&&(_this.success=!0,data.post&&(_this.frm.data.post_reference_id=data.post.post_reference_id,_this.frm.data._id=data.post._id,_this.frm.data.status=data.post.status),"DRAFT"==action?_this.successMsg="Post saved successfully":"PUBLISH"==action?(_this.successMsg="Post published successfully",_this.frm.data.status="PUBLISHED",_this.frm.data._id=_this.frm.data.post_reference_id||_this.frm.data._id,$location.path("/post/"+_this.frm.data._id).replace()):"SCHEDULE"==action&&(_this.successMsg="Post scheduled on"))})},$document.on("scroll",function(){$window.scrollY>=60?_this.colRightFixed=!0:_this.colRightFixed=!1,$window.scrollY>=$rootScope.tinymceTopPos?_this.colLeftFixed=!0:_this.colLeftFixed=!1,$scope.$apply(function(){$scope.pixelsScrolled=$window.scrollY})})}app.module.controller("BlogCreateController",BlogCreateController),BlogCreateController.$inject=["$scope","$rootScope","$document","$window","$location","PostService","FormErrorService","AuthenticationService"]}(app),function(app){function BlogReadController($scope,$rootScope,PostService,FormErrorService,AuthenticationService){function getPostsById(){PostService.getPostsById({id:postId},function(response){var res=response.data;res.success&&(_this.post=res.list[0])})}function getComments(){PostService.getComments({postId:postId},function(response){var res=response.data;res.success?_this.comments.list=res.list:res.error&&(_this.comments.error=!0)})}var _this=this,path=window.location.pathname,postId=path.split("/").pop();this.currentUser=AuthenticationService.GetUser(),this.isLogin=AuthenticationService.isLogin,this.category=PostService.category,this.tags=PostService.tags,this.frm={msg:FormErrorService.messages},this.comments={},this.submit=function(){var newComment={comment:this.frm.comment,date:new Date,created_by:_this.currentUser._id,postId:postId};PostService.saveComment(newComment,function(response){var res=response.data;res.success?(getComments.call(_this),_this.frm.comment=""):res.errors&&(_this.frm.errors=FormErrorService.show(res.errors))})},PostService.list.length?(angular.forEach(PostService.list,function(postObj){postObj._id===postId&&(_this.post=postObj)}),_this.post||getPostsById()):getPostsById(),getComments.call(this)}app.module.controller("BlogReadController",BlogReadController),BlogReadController.$inject=["$scope","$rootScope","PostService","FormErrorService","AuthenticationService"]}(app),function(app){function SearchController($scope,$rootScope,$location,PostService,PagerService,UserUpdateService){var _this=this,queryObj=$location.search(),page=0;angular.equals({},queryObj)||!queryObj.query?$location.path("/"):(this.searchQuery=queryObj.query,page=queryObj.page),page&&!isNaN(page)?queryObj.page=parseInt(page):queryObj.page=1,this.posts=[],this.category=PostService.category,$rootScope.navActiveTab="home",$scope.posts=[],$scope.$watch("posts",function(){PostService.list=$scope.posts}),this.setPage=function(obj){obj.page<1||obj.page>_this.pager.totalItems||$location.search({query:this.searchQuery,page:obj.page})},PostService.getSearchQueryResults(queryObj,function(res){const data=res.data;data.success&&(_this.posts=$scope.posts=data.list,_this.pager=PagerService.SetPage(queryObj.page,data.totalPosts))})}app.module.controller("SearchController",SearchController),SearchController.$inject=["$scope","$rootScope","$location","PostService","PagerService","UserUpdateService"]}(app);
//# sourceMappingURL=core.min.js.map